import"./useNonce-VOgClyGr.js";import"./ConfigProvider-BwNXqMge.js";import"./useDirection-DYJPYRsI.js";import{t as e}from"./ScrollArea-CHNzvhCN.js";import{Bi as t,Fa as n,Fi as r,Hi as i,J as a,Ki as o,Li as s,Oa as c,Pa as l,Qn as u,Ra as d,Ui as f,Vi as p,Wi as m,Yt as ee,ba as h,ca as g,ha as te,ia as ne,lt as re,o as _,oa as v,pr as ie,qi as y,sn as ae,yr as oe,zn as b,zt as x}from"./index-CTHZVx0Q.js";import{n as S}from"./button-BXx_oIr0.js";import{t as C}from"./badge-7N10jYOC.js";var w={async getSessions(e=0,t=20){return _.get(`/org/reconciliation`,{query:{page:e,size:t},authorizeRequest:!0,organisationAware:!0})},async startReconciliation(e,t,n,r,i){return _.post(`/org/reconciliation/start`,{data:{bankAccountReference:e,periodStart:t,periodEnd:n,openingBalance:r,closingBalance:i},authorizeRequest:!0,organisationAware:!0})},async getSession(e){return _.get(`/org/reconciliation/${e}`,{authorizeRequest:!0,organisationAware:!0})},async getSessionItems(e){return _.get(`/org/reconciliation/${e}/items`,{authorizeRequest:!0,organisationAware:!0})},async getItemsByStatus(e,t){return _.get(`/org/reconciliation/${e}/items/${t}`,{authorizeRequest:!0,organisationAware:!0})},async approveItem(e){return _.post(`/org/reconciliation/items/${e}/approve`,{data:{},authorizeRequest:!0,organisationAware:!0})},async manualMatch(e,t,n){return _.post(`/org/reconciliation/${e}/match`,{data:{transactionReference:t,entryReference:n},authorizeRequest:!0,organisationAware:!0})},async addAdjustment(e,t,n,r,i,a=!0){return _.post(`/org/reconciliation/${e}/adjustments`,{data:{type:t,description:n,amount:r,adjustmentDate:i,addsToBook:a},authorizeRequest:!0,organisationAware:!0})},async finalizeReconciliation(e){return _.post(`/org/reconciliation/${e}/finalize`,{data:{},authorizeRequest:!0,organisationAware:!0})}},T={class:`flex-1 min-w-0`},E={class:`flex items-center justify-between gap-2`},D={class:`font-medium text-slate-800 truncate`},O={class:`flex items-center gap-2 text-xs text-slate-500`},k={key:0,class:`text-slate-400`},A={__name:`ReconciliationRow`,props:{item:Object,side:String,selected:Boolean,matched:Boolean,suggested:Boolean},emits:[`click`,`approve`],setup(e){function t(e){return new Intl.NumberFormat(`en-NG`,{minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.abs(e||0))}function o(e){return e?new Date(e).toLocaleDateString(`en-US`,{month:`short`,day:`numeric`}):``}return(s,c)=>(v(),m(`div`,{class:n([`flex items-center gap-3 px-3 py-2 rounded-lg cursor-pointer transition-all text-sm`,e.matched?`bg-green-50 border border-green-200`:e.suggested?`bg-blue-50 border border-blue-200`:e.selected?`bg-slate-100 border border-slate-300`:`hover:bg-slate-50 border border-transparent`]),onClick:c[1]||=e=>s.$emit(`click`)},[p(`div`,{class:n([`h-6 w-6 rounded-full flex items-center justify-center flex-shrink-0`,e.matched?`bg-green-500 text-white`:e.suggested?`bg-blue-500 text-white`:`bg-slate-200 text-slate-500`])},[e.matched?(v(),i(l(u),{key:0,class:`h-3.5 w-3.5`})):e.suggested?(v(),i(l(a),{key:1,class:`h-3.5 w-3.5`})):(v(),i(l(b),{key:2,class:`h-3 w-3`}))],2),p(`div`,T,[p(`div`,E,[p(`span`,D,d(e.item.description),1),p(`span`,{class:n([`text-sm font-semibold whitespace-nowrap`,e.item.type===`CREDIT`?`text-green-600`:`text-red-600`])},d(e.item.type===`CREDIT`?`+`:`-`)+d(t(e.item.amount)),3)]),p(`div`,O,[p(`span`,null,d(o(e.item.transactionDate||e.item.entryDate)),1),e.item.reference?(v(),m(`span`,k,`â€¢ `+d(e.item.reference),1)):f(``,!0)])]),e.suggested&&!e.matched?(v(),i(l(S),{key:0,variant:`ghost`,size:`sm`,class:`h-7 w-7 p-0 flex-shrink-0`,onClick:c[0]||=r(e=>s.$emit(`approve`),[`stop`])},{default:h(()=>[y(l(u),{class:`h-4 w-4 text-green-600`})]),_:1})):f(``,!0)],2))}},se={class:`flex flex-col h-full`},ce={key:0,class:`flex-1 flex items-center justify-center`},le={class:`flex items-center justify-between px-4 py-2 border-b border-slate-100 bg-white`},ue={class:`flex items-center gap-3`},de={class:`flex items-center gap-1.5 text-sm`},fe={class:`font-medium`},pe={class:`flex items-center gap-2`},j={class:`flex items-center justify-between px-4 py-3 bg-slate-50 border-b border-slate-100`},M={class:`flex items-center gap-6`},N={class:`text-center`},P={class:`text-lg font-bold text-slate-800`},F={class:`text-center`},I={class:`text-lg font-bold text-slate-800`},L={class:`text-lg font-bold`},R={class:`text-xs opacity-80`},z={class:`flex items-center gap-4`},B={class:`text-center`},me={class:`text-lg font-bold text-green-600`},he={class:`text-center`},ge={class:`text-lg font-bold text-amber-600`},_e={class:`text-center`},ve={class:`text-lg font-bold text-slate-800`},ye={class:`flex-1 flex overflow-hidden`},be={class:`w-1/2 border-r border-slate-200 flex flex-col`},xe={class:`px-4 py-2 bg-blue-50 border-b border-slate-200`},Se={class:`flex items-center gap-2`},Ce={class:`p-2 space-y-1`},we={class:`w-1/2 flex flex-col`},Te={class:`px-4 py-2 bg-green-50 border-b border-slate-200`},Ee={class:`flex items-center gap-2`},De={class:`p-2 space-y-1`},Oe={key:0,class:`px-4 py-3 bg-white border-t border-slate-200`},ke={class:`flex items-center justify-between`},Ae={class:`flex items-center gap-4`},je={class:`text-sm`},Me={class:`font-medium ml-1`},Ne={class:`font-medium`},Pe={class:`flex items-center gap-2`},V={__name:`ReconciliationView`,props:{sessionReference:String,account:Object},emits:[`finalized`,`updated`],setup(r,{emit:a}){let _=r,b=a,T=c(!1),E=c(!1),D=c(!1),O=c(!1),k=c(null),V=c([]),H=c(null),U=c(null),Fe=t(()=>k.value?.periodStart&&k.value?.periodEnd?`${$(k.value.periodStart)} - ${$(k.value.periodEnd)}`:k.value?.name||`Reconciliation`),Ie=t(()=>({COMPLETED:`default`,IN_PROGRESS:`secondary`,PENDING_REVIEW:`outline`,DRAFT:`outline`,CANCELLED:`destructive`})[k.value?.status]||`outline`),Le=t(()=>{let e=k.value?.difference||0;return e===0?`bg-green-100 text-green-800`:e>0?`bg-amber-100 text-amber-800`:`bg-red-100 text-red-800`}),Re=t(()=>{let e=k.value?.difference||0;return e===0?`Balanced`:e>0?`Bank Higher`:`Book Higher`}),W=t(()=>(k.value?.unmatchedBankItems||0)+(k.value?.unmatchedBookItems||0)),ze=t(()=>{let e=(k.value?.totalBankItems||0)+(k.value?.totalBookItems||0),t=k.value?.matchedItems||0;return e>0?Math.round(t*2/e*100):0}),Be=t(()=>W.value===0&&k.value?.status!==`COMPLETED`),G=t(()=>V.value.filter(e=>e.bookEntry!=null)),K=t(()=>V.value.filter(e=>e.bankTransaction!=null));ne(()=>{_.sessionReference&&q()}),te(()=>_.sessionReference,e=>{e&&q()});async function q(){T.value=!0;try{let[e,t]=await Promise.all([w.getSession(_.sessionReference),w.getSessionItems(_.sessionReference)]);k.value=e.data,V.value=t.data}catch(e){console.error(`Failed to load session:`,e)}finally{T.value=!1}}async function J(){E.value=!0;try{let[e,t]=await Promise.all([w.getSession(_.sessionReference),w.getSessionItems(_.sessionReference)]);k.value=e.data,V.value=t.data}catch(e){console.error(`Failed to refresh:`,e)}finally{E.value=!1}}function Ve(e){H.value=e}function Y(e){U.value=e}function X(){H.value=null,U.value=null}async function Z(e){try{await w.approveItem(e.reference),await J()}catch(e){console.error(`Failed to approve:`,e)}}async function He(){if(!(!H.value?.bookEntry||!U.value?.bankTransaction)){D.value=!0;try{await w.manualMatch(_.sessionReference,U.value.bankTransaction.reference,H.value.bookEntry.reference),X(),await J(),b(`updated`)}catch(e){console.error(`Failed to match:`,e)}finally{D.value=!1}}}async function Ue(){O.value=!0;try{await w.finalizeReconciliation(_.sessionReference),await J(),b(`finalized`)}catch(e){console.error(`Failed to finalize:`,e)}finally{O.value=!1}}function Q(e){return new Intl.NumberFormat(`en-NG`,{style:`currency`,currency:_.account?.currency||`NGN`,minimumFractionDigits:0}).format(e)}function $(e){return e?new Date(e).toLocaleDateString(`en-US`,{month:`short`,year:`numeric`}):``}return(t,r)=>(v(),m(`div`,se,[T.value?(v(),m(`div`,ce,[y(l(x),{class:`h-8 w-8 animate-spin text-slate-400`})])):(v(),m(s,{key:1},[p(`div`,le,[p(`div`,ue,[p(`div`,de,[y(l(ae),{class:`h-4 w-4 text-green-600`}),p(`span`,fe,d(Fe.value),1)]),y(l(C),{variant:Ie.value},{default:h(()=>[o(d(k.value?.status||`New`),1)]),_:1},8,[`variant`])]),p(`div`,pe,[y(l(S),{variant:`outline`,size:`sm`,class:`h-8`,onClick:J,disabled:E.value},{default:h(()=>[E.value?(v(),i(l(x),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(v(),i(l(re),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),r[0]||=o(` Refresh `,-1)]),_:1},8,[`disabled`]),y(l(S),{size:`sm`,class:`h-8`,disabled:!Be.value||O.value,onClick:Ue},{default:h(()=>[O.value?(v(),i(l(x),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(v(),i(l(u),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),r[1]||=o(` Finalize `,-1)]),_:1},8,[`disabled`])])]),p(`div`,j,[p(`div`,M,[p(`div`,N,[p(`div`,P,d(Q(k.value?.bookBalance||0)),1),r[2]||=p(`div`,{class:`text-xs text-slate-500`},`Book Balance`,-1)]),p(`div`,F,[p(`div`,I,d(Q(k.value?.closingBalance||0)),1),r[3]||=p(`div`,{class:`text-xs text-slate-500`},`Bank Balance`,-1)]),p(`div`,{class:n([`text-center px-4 py-1 rounded-lg`,Le.value])},[p(`div`,L,d(Q(Math.abs(k.value?.difference||0))),1),p(`div`,R,d(Re.value),1)],2)]),p(`div`,z,[p(`div`,B,[p(`div`,me,d(k.value?.matchedItems||0),1),r[4]||=p(`div`,{class:`text-xs text-slate-500`},`Matched`,-1)]),p(`div`,he,[p(`div`,ge,d(W.value),1),r[5]||=p(`div`,{class:`text-xs text-slate-500`},`Unmatched`,-1)]),p(`div`,_e,[p(`div`,ve,d(ze.value)+`%`,1),r[6]||=p(`div`,{class:`text-xs text-slate-500`},`Match Rate`,-1)])])]),p(`div`,ye,[p(`div`,be,[p(`div`,xe,[p(`div`,Se,[y(l(ie),{class:`h-4 w-4 text-blue-600`}),r[7]||=p(`span`,{class:`text-sm font-semibold text-blue-800`},`Book Entries`,-1),y(l(C),{variant:`secondary`,class:`ml-auto`},{default:h(()=>[o(d(G.value.length),1)]),_:1})])]),y(l(e),{class:`flex-1`},{default:h(()=>[p(`div`,Ce,[(v(!0),m(s,null,g(G.value,e=>(v(),i(A,{key:e.reference,item:e,side:`book`,selected:H.value?.reference===e.reference,matched:e.matchStatus===`MATCHED`,suggested:e.matchStatus===`SUGGESTED`,onClick:t=>Ve(e),onApprove:t=>Z(e)},null,8,[`item`,`selected`,`matched`,`suggested`,`onClick`,`onApprove`]))),128))])]),_:1})]),p(`div`,we,[p(`div`,Te,[p(`div`,Ee,[y(l(ee),{class:`h-4 w-4 text-green-600`}),r[8]||=p(`span`,{class:`text-sm font-semibold text-green-800`},`Bank Transactions`,-1),y(l(C),{variant:`secondary`,class:`ml-auto`},{default:h(()=>[o(d(K.value.length),1)]),_:1})])]),y(l(e),{class:`flex-1`},{default:h(()=>[p(`div`,De,[(v(!0),m(s,null,g(K.value,e=>(v(),i(A,{key:e.reference,item:e,side:`bank`,selected:U.value?.reference===e.reference,matched:e.matchStatus===`MATCHED`,suggested:e.matchStatus===`SUGGESTED`,onClick:t=>Y(e),onApprove:t=>Z(e)},null,8,[`item`,`selected`,`matched`,`suggested`,`onClick`,`onApprove`]))),128))])]),_:1})])]),H.value&&U.value?(v(),m(`div`,Oe,[p(`div`,ke,[p(`div`,Ae,[p(`div`,je,[r[9]||=p(`span`,{class:`text-slate-500`},`Selected:`,-1),p(`span`,Me,d(H.value.bookEntry?.description||`Book Entry`),1),y(l(oe),{class:`h-4 w-4 inline mx-2 text-slate-400`}),p(`span`,Ne,d(U.value.bankTransaction?.narration||`Bank Tx`),1)])]),p(`div`,Pe,[y(l(S),{variant:`outline`,size:`sm`,onClick:X},{default:h(()=>[...r[10]||=[o(`Cancel`,-1)]]),_:1}),y(l(S),{size:`sm`,onClick:He,disabled:D.value},{default:h(()=>[D.value?(v(),i(l(x),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(v(),i(l(u),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),r[11]||=o(` Confirm Match `,-1)]),_:1},8,[`disabled`])])])])):f(``,!0)],64))]))}};export{V as default};