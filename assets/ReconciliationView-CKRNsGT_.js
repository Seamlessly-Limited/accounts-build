import"./useNonce--_RD7e6O.js";import"./ConfigProvider-Cf3TFtJ9.js";import"./useDirection-CUs44sCO.js";import{t as e}from"./ScrollArea-Rj5BlxFS.js";import{Bi as t,Bt as n,Fa as r,Fi as i,Hi as a,J as o,Ki as s,Li as c,Oa as l,Pa as u,Qn as d,Ra as f,Ui as p,Vi as m,Wi as h,Xt as ee,ba as g,ca as _,cn as te,ha as ne,ia as re,o as v,oa as y,pr as ie,qi as b,ut as ae,yr as oe,zn as x}from"./index-HKVTK5TI.js";import{n as S}from"./button-qjQ8nOQL.js";import{t as C}from"./badge-BVbEvoAF.js";var w={async getSessions(e=0,t=20){return v.get(`/org/reconciliation`,{query:{page:e,size:t},authorizeRequest:!0,organisationAware:!0})},async startReconciliation(e,t,n,r,i){return v.post(`/org/reconciliation/start`,{data:{bankAccountReference:e,periodStart:t,periodEnd:n,openingBalance:r,closingBalance:i},authorizeRequest:!0,organisationAware:!0})},async getSession(e){return v.get(`/org/reconciliation/${e}`,{authorizeRequest:!0,organisationAware:!0})},async getSessionItems(e){return v.get(`/org/reconciliation/${e}/items`,{authorizeRequest:!0,organisationAware:!0})},async getItemsByStatus(e,t){return v.get(`/org/reconciliation/${e}/items/${t}`,{authorizeRequest:!0,organisationAware:!0})},async approveItem(e){return v.post(`/org/reconciliation/items/${e}/approve`,{data:{},authorizeRequest:!0,organisationAware:!0})},async manualMatch(e,t,n){return v.post(`/org/reconciliation/${e}/match`,{data:{transactionReference:t,entryReference:n},authorizeRequest:!0,organisationAware:!0})},async addAdjustment(e,t,n,r,i,a=!0){return v.post(`/org/reconciliation/${e}/adjustments`,{data:{type:t,description:n,amount:r,adjustmentDate:i,addsToBook:a},authorizeRequest:!0,organisationAware:!0})},async finalizeReconciliation(e){return v.post(`/org/reconciliation/${e}/finalize`,{data:{},authorizeRequest:!0,organisationAware:!0})}},T={class:`flex-1 min-w-0`},E={class:`flex items-center justify-between gap-2`},D={class:`font-medium text-slate-800 truncate`},O={class:`flex items-center gap-2 text-xs text-slate-500`},k={key:0,class:`text-slate-400`},A={__name:`ReconciliationRow`,props:{item:Object,side:String,selected:Boolean,matched:Boolean,suggested:Boolean},emits:[`click`,`approve`],setup(e){function t(e){return new Intl.NumberFormat(`en-NG`,{minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.abs(e||0))}function n(e){return e?new Date(e).toLocaleDateString(`en-US`,{month:`short`,day:`numeric`}):``}return(s,c)=>(y(),h(`div`,{class:r([`flex items-center gap-3 px-3 py-2 rounded-lg cursor-pointer transition-all text-sm`,e.matched?`bg-green-50 border border-green-200`:e.suggested?`bg-blue-50 border border-blue-200`:e.selected?`bg-slate-100 border border-slate-300`:`hover:bg-slate-50 border border-transparent`]),onClick:c[1]||=e=>s.$emit(`click`)},[m(`div`,{class:r([`h-6 w-6 rounded-full flex items-center justify-center flex-shrink-0`,e.matched?`bg-green-500 text-white`:e.suggested?`bg-blue-500 text-white`:`bg-slate-200 text-slate-500`])},[e.matched?(y(),a(u(d),{key:0,class:`h-3.5 w-3.5`})):e.suggested?(y(),a(u(o),{key:1,class:`h-3.5 w-3.5`})):(y(),a(u(x),{key:2,class:`h-3 w-3`}))],2),m(`div`,T,[m(`div`,E,[m(`span`,D,f(e.item.description),1),m(`span`,{class:r([`text-sm font-semibold whitespace-nowrap`,e.item.type===`CREDIT`?`text-green-600`:`text-red-600`])},f(e.item.type===`CREDIT`?`+`:`-`)+f(t(e.item.amount)),3)]),m(`div`,O,[m(`span`,null,f(n(e.item.transactionDate||e.item.entryDate)),1),e.item.reference?(y(),h(`span`,k,`â€¢ `+f(e.item.reference),1)):p(``,!0)])]),e.suggested&&!e.matched?(y(),a(u(S),{key:0,variant:`ghost`,size:`sm`,class:`h-7 w-7 p-0 flex-shrink-0`,onClick:c[0]||=i(e=>s.$emit(`approve`),[`stop`])},{default:g(()=>[b(u(d),{class:`h-4 w-4 text-green-600`})]),_:1})):p(``,!0)],2))}},se={class:`flex flex-col h-full`},ce={key:0,class:`flex-1 flex items-center justify-center`},le={class:`flex items-center justify-between px-4 py-2 border-b border-slate-100 bg-white`},ue={class:`flex items-center gap-3`},de={class:`flex items-center gap-1.5 text-sm`},fe={class:`font-medium`},pe={class:`flex items-center gap-2`},j={class:`flex items-center justify-between px-4 py-3 bg-slate-50 border-b border-slate-100`},M={class:`flex items-center gap-6`},N={class:`text-center`},P={class:`text-lg font-bold text-slate-800`},F={class:`text-center`},I={class:`text-lg font-bold text-slate-800`},L={class:`text-lg font-bold`},R={class:`text-xs opacity-80`},z={class:`flex items-center gap-4`},B={class:`text-center`},me={class:`text-lg font-bold text-green-600`},he={class:`text-center`},ge={class:`text-lg font-bold text-amber-600`},_e={class:`text-center`},ve={class:`text-lg font-bold text-slate-800`},ye={class:`flex-1 flex overflow-hidden`},be={class:`w-1/2 border-r border-slate-200 flex flex-col`},xe={class:`px-4 py-2 bg-blue-50 border-b border-slate-200`},Se={class:`flex items-center gap-2`},Ce={class:`p-2 space-y-1`},we={class:`w-1/2 flex flex-col`},Te={class:`px-4 py-2 bg-green-50 border-b border-slate-200`},Ee={class:`flex items-center gap-2`},De={class:`p-2 space-y-1`},Oe={key:0,class:`px-4 py-3 bg-white border-t border-slate-200`},ke={class:`flex items-center justify-between`},Ae={class:`flex items-center gap-4`},je={class:`text-sm`},Me={class:`font-medium ml-1`},Ne={class:`font-medium`},Pe={class:`flex items-center gap-2`},V={__name:`ReconciliationView`,props:{sessionReference:String,account:Object},emits:[`finalized`,`updated`],setup(i,{emit:o}){let v=i,x=o,T=l(!1),E=l(!1),D=l(!1),O=l(!1),k=l(null),V=l([]),H=l(null),U=l(null),Fe=t(()=>k.value?.periodStart&&k.value?.periodEnd?`${$(k.value.periodStart)} - ${$(k.value.periodEnd)}`:k.value?.name||`Reconciliation`),Ie=t(()=>({COMPLETED:`default`,IN_PROGRESS:`secondary`,PENDING_REVIEW:`outline`,DRAFT:`outline`,CANCELLED:`destructive`})[k.value?.status]||`outline`),Le=t(()=>{let e=k.value?.difference||0;return e===0?`bg-green-100 text-green-800`:e>0?`bg-amber-100 text-amber-800`:`bg-red-100 text-red-800`}),Re=t(()=>{let e=k.value?.difference||0;return e===0?`Balanced`:e>0?`Bank Higher`:`Book Higher`}),W=t(()=>(k.value?.unmatchedBankItems||0)+(k.value?.unmatchedBookItems||0)),ze=t(()=>{let e=(k.value?.totalBankItems||0)+(k.value?.totalBookItems||0),t=k.value?.matchedItems||0;return e>0?Math.round(t*2/e*100):0}),Be=t(()=>W.value===0&&k.value?.status!==`COMPLETED`),G=t(()=>V.value.filter(e=>e.bookEntry!=null)),K=t(()=>V.value.filter(e=>e.bankTransaction!=null));re(()=>{v.sessionReference&&q()}),ne(()=>v.sessionReference,e=>{e&&q()});async function q(){T.value=!0;try{let[e,t]=await Promise.all([w.getSession(v.sessionReference),w.getSessionItems(v.sessionReference)]);k.value=e.data,V.value=t.data}catch(e){console.error(`Failed to load session:`,e)}finally{T.value=!1}}async function J(){E.value=!0;try{let[e,t]=await Promise.all([w.getSession(v.sessionReference),w.getSessionItems(v.sessionReference)]);k.value=e.data,V.value=t.data}catch(e){console.error(`Failed to refresh:`,e)}finally{E.value=!1}}function Ve(e){H.value=e}function Y(e){U.value=e}function X(){H.value=null,U.value=null}async function Z(e){try{await w.approveItem(e.reference),await J()}catch(e){console.error(`Failed to approve:`,e)}}async function He(){if(!(!H.value?.bookEntry||!U.value?.bankTransaction)){D.value=!0;try{await w.manualMatch(v.sessionReference,U.value.bankTransaction.reference,H.value.bookEntry.reference),X(),await J(),x(`updated`)}catch(e){console.error(`Failed to match:`,e)}finally{D.value=!1}}}async function Ue(){O.value=!0;try{await w.finalizeReconciliation(v.sessionReference),await J(),x(`finalized`)}catch(e){console.error(`Failed to finalize:`,e)}finally{O.value=!1}}function Q(e){return new Intl.NumberFormat(`en-NG`,{style:`currency`,currency:v.account?.currency||`NGN`,minimumFractionDigits:0}).format(e)}function $(e){return e?new Date(e).toLocaleDateString(`en-US`,{month:`short`,year:`numeric`}):``}return(t,i)=>(y(),h(`div`,se,[T.value?(y(),h(`div`,ce,[b(u(n),{class:`h-8 w-8 animate-spin text-slate-400`})])):(y(),h(c,{key:1},[m(`div`,le,[m(`div`,ue,[m(`div`,de,[b(u(te),{class:`h-4 w-4 text-green-600`}),m(`span`,fe,f(Fe.value),1)]),b(u(C),{variant:Ie.value},{default:g(()=>[s(f(k.value?.status||`New`),1)]),_:1},8,[`variant`])]),m(`div`,pe,[b(u(S),{variant:`outline`,size:`sm`,class:`h-8`,onClick:J,disabled:E.value},{default:g(()=>[E.value?(y(),a(u(n),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(y(),a(u(ae),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),i[0]||=s(` Refresh `,-1)]),_:1},8,[`disabled`]),b(u(S),{size:`sm`,class:`h-8`,disabled:!Be.value||O.value,onClick:Ue},{default:g(()=>[O.value?(y(),a(u(n),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(y(),a(u(d),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),i[1]||=s(` Finalize `,-1)]),_:1},8,[`disabled`])])]),m(`div`,j,[m(`div`,M,[m(`div`,N,[m(`div`,P,f(Q(k.value?.bookBalance||0)),1),i[2]||=m(`div`,{class:`text-xs text-slate-500`},`Book Balance`,-1)]),m(`div`,F,[m(`div`,I,f(Q(k.value?.closingBalance||0)),1),i[3]||=m(`div`,{class:`text-xs text-slate-500`},`Bank Balance`,-1)]),m(`div`,{class:r([`text-center px-4 py-1 rounded-lg`,Le.value])},[m(`div`,L,f(Q(Math.abs(k.value?.difference||0))),1),m(`div`,R,f(Re.value),1)],2)]),m(`div`,z,[m(`div`,B,[m(`div`,me,f(k.value?.matchedItems||0),1),i[4]||=m(`div`,{class:`text-xs text-slate-500`},`Matched`,-1)]),m(`div`,he,[m(`div`,ge,f(W.value),1),i[5]||=m(`div`,{class:`text-xs text-slate-500`},`Unmatched`,-1)]),m(`div`,_e,[m(`div`,ve,f(ze.value)+`%`,1),i[6]||=m(`div`,{class:`text-xs text-slate-500`},`Match Rate`,-1)])])]),m(`div`,ye,[m(`div`,be,[m(`div`,xe,[m(`div`,Se,[b(u(ie),{class:`h-4 w-4 text-blue-600`}),i[7]||=m(`span`,{class:`text-sm font-semibold text-blue-800`},`Book Entries`,-1),b(u(C),{variant:`secondary`,class:`ml-auto`},{default:g(()=>[s(f(G.value.length),1)]),_:1})])]),b(u(e),{class:`flex-1`},{default:g(()=>[m(`div`,Ce,[(y(!0),h(c,null,_(G.value,e=>(y(),a(A,{key:e.reference,item:e,side:`book`,selected:H.value?.reference===e.reference,matched:e.matchStatus===`MATCHED`,suggested:e.matchStatus===`SUGGESTED`,onClick:t=>Ve(e),onApprove:t=>Z(e)},null,8,[`item`,`selected`,`matched`,`suggested`,`onClick`,`onApprove`]))),128))])]),_:1})]),m(`div`,we,[m(`div`,Te,[m(`div`,Ee,[b(u(ee),{class:`h-4 w-4 text-green-600`}),i[8]||=m(`span`,{class:`text-sm font-semibold text-green-800`},`Bank Transactions`,-1),b(u(C),{variant:`secondary`,class:`ml-auto`},{default:g(()=>[s(f(K.value.length),1)]),_:1})])]),b(u(e),{class:`flex-1`},{default:g(()=>[m(`div`,De,[(y(!0),h(c,null,_(K.value,e=>(y(),a(A,{key:e.reference,item:e,side:`bank`,selected:U.value?.reference===e.reference,matched:e.matchStatus===`MATCHED`,suggested:e.matchStatus===`SUGGESTED`,onClick:t=>Y(e),onApprove:t=>Z(e)},null,8,[`item`,`selected`,`matched`,`suggested`,`onClick`,`onApprove`]))),128))])]),_:1})])]),H.value&&U.value?(y(),h(`div`,Oe,[m(`div`,ke,[m(`div`,Ae,[m(`div`,je,[i[9]||=m(`span`,{class:`text-slate-500`},`Selected:`,-1),m(`span`,Me,f(H.value.bookEntry?.description||`Book Entry`),1),b(u(oe),{class:`h-4 w-4 inline mx-2 text-slate-400`}),m(`span`,Ne,f(U.value.bankTransaction?.narration||`Bank Tx`),1)])]),m(`div`,Pe,[b(u(S),{variant:`outline`,size:`sm`,onClick:X},{default:g(()=>[...i[10]||=[s(`Cancel`,-1)]]),_:1}),b(u(S),{size:`sm`,onClick:He,disabled:D.value},{default:g(()=>[D.value?(y(),a(u(n),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(y(),a(u(d),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),i[11]||=s(` Confirm Match `,-1)]),_:1},8,[`disabled`])])])])):p(``,!0)],64))]))}};export{V as default};