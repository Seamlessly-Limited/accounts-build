import{Bi as e,Bt as t,C as n,D as r,Dt as i,E as a,Er as ee,Et as te,Fa as o,Fn as s,Ft as ne,H as re,Hi as c,Hn as ie,In as ae,J as oe,Kt as se,L as ce,La as le,Li as l,Ln as ue,M as de,Mi as fe,Mn as pe,Mt as u,Oa as d,P as me,Pa as f,Q as p,Ra as m,Rn as he,Rt as ge,S as _e,Si as h,T as ve,Ti as ye,Tt as be,Ui as g,Ut as xe,Vi as _,Vn as v,Wi as y,X as b,Y as x,Yt as S,Z as C,_i as w,_n as T,an as E,ar as D,ca as O,da as k,dn as A,dt as j,en as M,er as Se,fn as Ce,fr as we,ft as Te,gn as Ee,gr as De,gt as Oe,ha as ke,hn as Ae,hr as je,i as N,ia as Me,ir as Ne,it as Pe,jn as Fe,ln as Ie,lt as Le,mn as Re,nr as ze,nt as P,o as F,oa as I,on as Be,or as Ve,pr as He,qi as L,r as Ue,rt as R,sr as We,tt as Ge,un as Ke,ur as qe,ut as Je,vn as Ye,x as Xe,xa as Ze,y as Qe,yn as $e,z as et}from"./index-CTHZVx0Q.js";import{t as tt}from"./WorkspaceStore-gf1m868h.js";function z(e){let t=e.map(e=>{let t=e.apps.map(e=>e.name).sort().join(`,`);return`${e.name}:[${t}]`}).sort().join(`|`),n=5381;for(let e=0;e<t.length;e++)n=(n<<5)+n+t.charCodeAt(e),n&=n;return Math.abs(n).toString(36)}var B={getDocTypes:async()=>{try{return(await F.get(`/org/doctypes`,{authorizeRequest:!0,organisationAware:!0}))?.data||[]}catch(e){return console.warn(`Failed to fetch doc types:`,e),[]}},getAllApplications:async()=>{let e=await B.getDocTypes(),t={Stock:`Package`,Inventory:`Package`,Selling:`TrendingUp`,Sales:`TrendingUp`,Administration:`ShieldCheck`,Billing:`Receipt`,CRM:`Users`,Buying:`ShoppingBag`,Purchases:`ShoppingBag`,Accounting:`Calculator`,Finance:`Landmark`,System:`Settings`,Core:`Cog`,Notifications:`Bell`,Setup:`Settings`},n=[`File`,`Brand Settings`,`Application`,`Application Group`,`Doc Event Type`],r={};e.forEach(e=>{if(e.is_child||n.includes(e.name)||!e.module)return;let i=e.module;r[i]||(r[i]={id:`module-${i.toLowerCase().replace(/\s+/g,`-`)}`,name:i,type:`group`,icon:t[i]||`Folder`,apps:[]}),r[i].apps.push({id:`doctype-${e.name.toLowerCase().replace(/\s+/g,`-`)}`,name:e.name,icon:e.icon||`FileText`,background:`bg-slate-950`,route:`/app/${encodeURIComponent(e.name)}`,type:`doctype-app`,doctype:e.name})});let i=Object.values(r);i.sort((e,t)=>e.name.localeCompare(t.name)),i.forEach(e=>{e.apps.sort((e,t)=>e.name.localeCompare(t.name))});let a=z(i);return{groups:i,structureHash:a}}},nt=B,rt={key:0,class:`absolute inset-0 z-[100] flex flex-col`},it={class:`relative z-10 flex flex-col h-full w-full max-w-7xl mx-auto p-4 md:p-8 pointer-events-auto`},at={class:`flex justify-start mb-6 mt-2`},ot={class:`relative w-full pointer-events-auto`},st={class:`flex items-center gap-4 mb-4 ml-2`},ct={class:`text-xl font-semibold text-slate-800`},lt={class:`grid grid-cols-3 md:grid-cols-5 lg:grid-cols-7 gap-4 justify-items-center`},ut=[`onClick`],dt={class:`text-black text-xs md:text-sm font-medium text-center line-clamp-3 shadow-black drop-shadow-sm opacity-90 group-hover:opacity-100`},ft={key:0,class:`flex flex-col items-center justify-center h-64 text-slate-500`},V={__name:`ApplicationsPane`,props:{isOpen:Boolean},emits:[`close`],setup(N,{emit:F}){let z=N,B=F,V=Ue(),H=tt(),U={TicketCheck:ce,GitMerge:Be,Package:te,Box:qe,SlidersHorizontal:x,Truck:de,LockKeyhole:ge,TrendingUp:me,Users:n,UserPlus:a,FileText:Ce,FileQuestion:Re,Receipt:j,Bookmark:we,ClipboardList:he,Banknote:De,FileMinus:Ee,RefreshCw:Le,CreditCard:pe,ReceiptText:Te,ShoppingCart:b,Store:re,Vault:_e,FileInput:T,CalendarClock:Ne,ShoppingBag:C,PackageCheck:i,Send:P,FilePlus:Ae,RefreshCcw:Je,Landmark:S,Scale:Pe,Link:xe,BookOpen:He,Library:se,Folder:Ie,FolderOpen:Ke,Clock:ue,User:ve,Building:Ve,Building2:We,Pin:Oe,File:A,Code:ae,FileCode:Ye,Database:Fe,Settings:Ge,BarChart:Se,HelpCircle:ie,Sparkles:oe,Mail:ne,AppWindow:ee,UserCheck:r,Camera:ze,CircleUserRound:v,History:M,Zap:Qe,Globe:E,Palette:be,Wallet:Xe,List:t,Bell:je,ShieldCheck:p,Terminal:et,FileJson:$e,Megaphone:u,Calculator:D,Cog:s};function pt(){try{let e=JSON.parse(localStorage.getItem(`organisation`)||`{}`),t=JSON.parse(localStorage.getItem(`user`)||`{}`);return e.creatorId===t.id||e.creator?.id===t.id}catch{return!1}}function W(e){return e&&(e.startsWith(`#`)||e.startsWith(`rgb`))}function mt(e){return!e||W(e)?``:e}function ht(e){return!e||!W(e)?{}:{backgroundColor:e}}function G(e){return e.type===`group`?{...e,apps:e.apps.map(e=>({...e}))}:{...e}}function K(e,t){let n=new Map;t.forEach(e=>{n.set(e.id,e)});let r=new Set(e.map(e=>e.id)),i=[];return e.forEach(e=>{let t=n.get(e.id);if(t)if(t.type===`group`&&e.type===`group`){let n=G(t);n.apps=K(e.apps||[],t.apps||[]),i.push(n)}else i.push(G(t))}),t.forEach(e=>{r.has(e.id)||i.push(G(e))}),i}let q=h(`flow-applications-order`,null),J=h(`flow-cached-apps`,[]),Y=h(`flow-apps-hash`,``),X=d(!0),Z=d([]);Me(async()=>{J.value&&J.value.length>0&&(Z.value=J.value,X.value=!1);try{let{groups:e,structureHash:t}=await nt.getAllApplications();t===Y.value?q.value&&Array.isArray(q.value)?Z.value=K(q.value,e):Z.value=e.map(G):(console.log(`Applications structure changed, resetting order`),q.value=null,Z.value=e.map(G)),J.value=e,Y.value=t}catch(e){console.error(`Failed to load applications:`,e)}finally{X.value=!1}}),ye(Z,e=>{q.value=e},{deep:!0,debounce:500});let Q=d(``),$=e(()=>{let e=pt(),t=t=>{if(!Q.value)return t.filter(t=>!t.ownerOnly||e);let n=Q.value.toLowerCase();return t.filter(t=>t.ownerOnly&&!e?!1:t.name.toLowerCase().includes(n))},n=[],r=[],i=[`System`,`Tax`];return Z.value.forEach(a=>{if(!a.ownerOnly||e)if(a.type===`group`){if(i.includes(a.name))return;let e=t(a.apps||[]);e.length>0&&n.push({...a,apps:e})}else (!Q.value||a.name.toLowerCase().includes(Q.value.toLowerCase()))&&r.push(a)}),{groups:n,looseApps:r}}),gt=e=>{try{if(e.doctype){let t={id:e.id||`doctype-${e.doctype.toLowerCase().replace(/\s+/g,`-`)}`,title:e.name,icon:e.icon,type:`doctype`,doctype:e.doctype,props:e.props||{},closable:!0};H.openTab(t),B(`close`),V.push({path:`/workspace`,hash:`#${t.id}`})}else B(`close`),V.push(e.route)}catch(e){console.error(`Failed to open app:`,e)}};return ke(()=>z.isOpen,e=>{e||setTimeout(()=>{Q.value=``},300)}),w(`Escape`,()=>{z.isOpen&&B(`close`)}),(e,t)=>N.isOpen?(I(),y(`div`,rt,[_(`div`,{class:`absolute inset-0 bg-white/40 backdrop-blur-xl`,onClick:t[0]||=t=>e.$emit(`close`)}),_(`div`,it,[_(`div`,at,[_(`div`,ot,[L(f(R),{class:`absolute left-3 top-1/2 -translate-y-1/2 text-black/60 h-5 w-5`}),Ze(_(`input`,{"onUpdate:modelValue":t[1]||=e=>Q.value=e,type:`text`,placeholder:`Type to search...`,class:`w-full bg-white/90 border-4 border-gray-200 rounded-full py-1.5 pl-10 pr-4 text-black placeholder-black/50 focus:outline-none focus:bg-white/20 focus:border-stone-100/80 transition-all`},null,512),[[fe,Q.value]])])]),_(`div`,{class:`flex-1 relative overflow-y-auto px-4 pb-20 pt-10`,onClick:t[2]||=t=>e.$emit(`close`),style:{"scrollbar-width":`none`}},[(I(!0),y(l,null,O($.value.groups,e=>(I(),y(`div`,{key:e.id,class:`mb-20`},[_(`div`,st,[(I(),c(k(U[e.icon]),{class:`h-5 w-5 text-slate-800`})),_(`h3`,ct,m(e.name),1)]),_(`div`,lt,[(I(!0),y(l,null,O(e.apps,e=>(I(),y(`div`,{key:e.id,class:`flex flex-col items-center gap-2 group cursor-pointer pointer-events-auto w-20 md:w-24 transition-transform hover:-translate-y-1 duration-200`,onClick:t=>gt(e)},[_(`div`,{class:o([`w-14 h-14 md:w-16 md:h-16 rounded-2xl flex items-center justify-center shadow-md transition-shadow group-hover:shadow-lg duration-200 opacity-80 group-hover:opacity-100`,mt(e.background)]),style:le(ht(e.background))},[(I(),c(k(U[e.icon]),{class:`text-white h-7 w-7 md:h-8 md:w-8`}))],6),_(`span`,dt,m(e.name),1)],8,ut))),128))])]))),128)),$.value.groups.length===0&&$.value.looseApps.length===0?(I(),y(`div`,ft,[L(f(R),{class:`h-12 w-12 mb-4 opacity-50`}),t[3]||=_(`p`,null,`No applications found`,-1)])):g(``,!0)])])])):g(``,!0)}},H=N(V,[[`__scopeId`,`data-v-dca0c45e`]]);export{H as default};