const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DocForm-APoJdUnp.js","assets/PopperContent-CYLydaJo.js","assets/index-DUz5oLRf.js","assets/index-DXnjN6aA.css","assets/useHideOthers-BMVpLdiv.js","assets/ConfigProvider-CX3z9H2g.js","assets/useFormControl-DNz7k4w5.js","assets/ComboboxItem-yuuEIVEa.js","assets/ListboxItem-gURPCPWT.js","assets/utils-BngY0H0a.js","assets/VisuallyHiddenInput-DzwRJu2R.js","assets/useDirection-CVICsvLJ.js","assets/useId-D49Isxay.js","assets/useKbd-BvGB3m10.js","assets/useTypeahead-DQhWDs5L.js","assets/ComboboxGroup-oY2S-egi.js","assets/Teleport-nEgZhyc-.js","assets/utils-Bv7ngM-A.js","assets/PopperAnchor-BDMp0DVx.js","assets/SelectViewport-VrHoVk6u.js","assets/useNonce-Zz8BWqvg.js","assets/nullish-CfjOSA4G.js","assets/SelectGroup-mRhUQAYm.js","assets/DynamicIcon-9hv_PMkg.js","assets/BottomSheet-BbvV1osc.js","assets/BottomSheet-C0veGV1Z.css","assets/Input-nMYpliAi.js","assets/SelectValue-B-w7Avnt.js","assets/viewRegistry-DuQEad4b.js","assets/WorkspaceStore-DloGvRxv.js","assets/DocForm-BDvxZvMs.js"])))=>i.map(i=>d[i]);
import{i as e,n as t,r as n,s as r,t as i}from"./ComboboxItem-yuuEIVEa.js";import{t as a}from"./ComboboxGroup-oY2S-egi.js";import{Ai as o,At as s,Fi as c,Gi as l,Hn as u,Ln as d,Ni as f,Oi as p,Pi as m,Ta as h,Wi as g,Yi as _,h as v,ha as y,ji as b,ki as x,lt as S,na as C,o as w,qi as T,sa as E,t as D,wi as O,xa as k}from"./index-DUz5oLRf.js";import{t as A}from"./BottomSheet-BbvV1osc.js";var j={class:`relative w-full`},ee={class:`relative w-full`},te={class:`absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400`},ne={key:0,class:`text-sm text-gray-500 p-4 text-center shrink-0`},re={key:0},ie={key:1},M={class:`flex flex-col`},N={class:`font-medium`},P={key:1,class:`p-4 text-center text-sm text-gray-500 flex justify-center items-center gap-2 shrink-0`},F={class:`h-full flex flex-col bg-stone-50`},I={__name:`LinkField`,props:{modelValue:{type:String,default:``},doctype:{type:String,default:``},label:{type:String,default:``},placeholder:{type:String,default:``},disabled:{type:Boolean,default:!1}},emits:[`update:modelValue`],setup(I,{emit:L}){let R=c(()=>D(()=>import(`./DocForm-APoJdUnp.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]))),z=I,B=L,{toast:V}=v(),H=y(!1),U=y([]),W=y(!1),G=y(!1),K=y(``),q=y(``),J=y(null),Y=y(!1),X=async()=>{if(!(J.value||!z.doctype))try{let e=await w.get(`/org/doctypes/${z.doctype}`,{authorizeRequest:!0,organisationAware:!0});e.flag===`SUCCESS`&&(J.value=e.data)}catch(e){console.error(`LinkField: Meta fetch failed`,e)}},Z=async()=>{if(!z.modelValue||!z.doctype){q.value=``,K.value=``;return}if(!Y.value){Y.value=!0;try{let e=U.value.find(e=>e.value===z.modelValue);if(e){q.value=e.label.split(` (`)[0],K.value=q.value;return}J.value||await X();let t=await w.get(`/org/doc/${z.doctype}/${z.modelValue}`,{authorizeRequest:!0,organisationAware:!0});if(t&&t.flag===`SUCCESS`&&t.data){let e=t.data,n=J.value?.title_field,r=n&&e[n]?e[n]:e.name;q.value=r,K.value=r}else q.value=z.modelValue,K.value=z.modelValue}catch(e){console.error(`LinkField: Label resolution failed`,e),q.value=z.modelValue,K.value=z.modelValue}finally{Y.value=!1}}},Q=null,$=async(e=``)=>{if(!z.doctype){U.value=[];return}W.value=!0;try{J.value||await X();let t=[];if(z.doctype===`DocType`){if(t=(await w.get(`/org/doctypes`,{authorizeRequest:!0,organisationAware:!0})).data||[],e){let n=e.toLowerCase();t=t.filter(e=>e.name?.toLowerCase().includes(n))}U.value=t.map(e=>({value:e.name,label:e.name}))}else{let n={size:50};if(e){let t=J.value?.title_field;t?n[`${t}__like`]=e:n.name__like=e}t=(await w.get(`/org/doc/${z.doctype}`,{query:n,authorizeRequest:!0,organisationAware:!0})).data?.content||[];let r=J.value?.title_field;U.value=t.map(e=>({value:e.name,label:r&&e[r]?`${e[r]} (${e.name})`:e.name}))}}catch(e){console.error(`LinkField: Options fetch failed`,e)}finally{W.value=!1}};l(async()=>{z.modelValue&&Z()}),g(()=>{clearTimeout(Q)}),C(K,e=>{!H.value||e===q.value||(clearTimeout(Q),Q=setTimeout(()=>{$(e)},300))}),C(H,e=>{e?$(K.value):K.value=q.value}),C(()=>z.modelValue,e=>{e?Z():q.value=``});let ae=e=>{e!==`__create_new__`&&(B(`update:modelValue`,e),H.value=!1)},oe=e=>{G.value=!1;let t=J.value?.title_field,n=t&&e[t]?e[t]:e.name;U.value.unshift({value:e.name,label:t&&e[t]?`${e[t]} (${e.name})`:e.name}),q.value=n,K.value=n,B(`update:modelValue`,e.name),V({title:`Created & Linked`,description:`${z.doctype} ${e.name} successfully linked.`,variant:`success`})},se=()=>{H.value=!1,G.value=!0};return(c,l)=>(T(),b(`div`,j,[m(k(n),{"model-value":I.modelValue,"onUpdate:modelValue":ae,open:H.value,"onUpdate:open":l[1]||=e=>H.value=e,"filter-function":e=>e},{default:E(()=>[p(`div`,ee,[m(k(e),{class:`w-full`},{default:E(()=>[m(k(t),{modelValue:K.value,"onUpdate:modelValue":l[0]||=e=>K.value=e,placeholder:I.placeholder||`Select ${I.doctype}...`,class:`w-full px-4 py-2 bg-white dark:bg-gray-950 border border-gray-300 dark:border-gray-800 rounded-full focus:ring-2 focus:ring-black dark:focus:ring-white transition-all outline-none pr-10`,disabled:I.disabled},null,8,[`modelValue`,`placeholder`,`disabled`]),p(`div`,te,[W.value?(T(),x(k(s),{key:0,class:`h-4 w-4 animate-spin`})):(T(),x(k(d),{key:1,class:`h-4 w-4`}))])]),_:1}),m(k(r),{class:`absolute w-full bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 shadow-xl rounded-xl mt-2 p-1 z-[100] min-w-[200px] max-h-[300px] overflow-hidden flex flex-col`},{default:E(()=>[!W.value&&U.value.length===0?(T(),b(`div`,ne,[K.value?(T(),b(`span`,re,`No results found for "`+h(K.value)+`"`,1)):(T(),b(`span`,ie,`No options available`))])):o(``,!0),m(k(a),{class:`border-b border-gray-100 dark:border-gray-800 mb-1 pb-1 shrink-0`},{default:E(()=>[m(k(i),{value:`__create_new__`,onSelect:se,class:`flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 cursor-pointer outline-none data-[highlighted]:bg-blue-200 dark:data-[highlighted]:bg-blue-900/20`},{default:E(()=>[m(k(S),{class:`h-4 w-4`}),f(` Create New `+h(I.doctype),1)]),_:1})]),_:1}),m(k(a),{class:`overflow-y-auto flex-1`},{default:E(()=>[(T(!0),b(O,null,_(U.value,e=>(T(),x(k(i),{key:e.value,value:e.value,class:`flex items-center justify-between px-3 py-2 text-sm rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-900 outline-none data-[state=checked]:bg-gray-50 dark:data-[state=checked]:bg-gray-900`},{default:E(()=>[p(`div`,M,[p(`span`,N,h(e.label),1)]),I.modelValue===e.value?(T(),x(k(u),{key:0,class:`h-4 w-4 text-black dark:text-white`})):o(``,!0)]),_:2},1032,[`value`]))),128))]),_:1}),W.value&&U.value.length===0?(T(),b(`div`,P,[m(k(s),{class:`h-4 w-4 animate-spin`}),l[3]||=f(` Searching... `,-1)])):o(``,!0)]),_:1})])]),_:1},8,[`model-value`,`open`,`filter-function`]),m(A,{modelValue:G.value,"onUpdate:modelValue":l[2]||=e=>G.value=e,"initial-height":85},{default:E(()=>[p(`div`,F,[m(k(R),{doctype:I.doctype,"is-new":!0,name:`new`,"is-embedded":!0,onSaved:oe},null,8,[`doctype`])])]),_:1},8,[`modelValue`])]))}};export{I as t};