import"./useArrowNavigation-siWGBYoD.js";import"./ConfigProvider-Ckl6KgMj.js";import"./useDirection-B1kSZwKq.js";import"./VisuallyHiddenInput-B3HVdvGc.js";import{n as e,r as t,t as n}from"./PinInputSlot-jUtq3sNR.js";import{$i as r,An as i,Fi as a,Li as o,Ln as s,Mi as c,Ni as l,Nn as u,Nt as d,Oi as f,Pi as p,Ri as m,X as h,Zi as g,a as _,d as v,da as y,i as b,ka as x,s as S,ta as C,yi as w}from"./index-CHNvwQRL.js";import{n as T}from"./button-DSlecn3R.js";import{t as E}from"./Card-DyXAPDF3.js";import{t as D}from"./CardContent-fQrFfeQu.js";import{t as O}from"./BackgroundAnimation-DnlEY4kt.js";var k={name:`VerifyAccount`,components:{Button:T,Card:E,CardContent:D,Loader2:d,CheckCircle:s,XCircle:u,ShieldCheck:h,Clock:i,BackgroundAnimation:O,PinInput:t,PinInputGroup:e,PinInputSlot:n},data(){return{currentStep:0,loading:!1,resendCount:0,resendWaitTime:0,token:[],timerInstance:null}},async mounted(){if(this.$route.params.token)await this.verifyAccount(this.$route.params.token);else try{if(!await v.IndexedDB.get(`SeamlesslyDB`,`UserStore`,`preAuthorization`)){this.$router.push(`/login`);return}}catch{this.$router.push(`/login`);return}this.startCountdown()},beforeUnmount(){this.timerInstance&&clearInterval(this.timerInstance)},methods:{startCountdown(){this.timerInstance&&clearInterval(this.timerInstance),this.resendWaitTime=60+this.resendCount*30,this.timerInstance=setInterval(()=>{this.resendWaitTime>0?this.resendWaitTime--:clearInterval(this.timerInstance)},1e3)},async resendCode(){let e=_();try{await S.resendVerificationCode(),this.resendCount++,this.startCountdown(),e.toast({message:`A new verification code has been sent.`,variant:`success`})}catch(t){e.toast({message:t.message||`Failed to resend code. Please try again later.`,variant:`error`})}},async completeVerification(){if(this.loading||this.token.length<6)return;let e=_(),t=this.token.join(``);this.loading=!0;try{let e=await S.completeAccountVerification({code:t});e&&(this.currentStep=2,await v.IndexedDB.delete(`SeamlesslyDB`,`UserStore`,`preAuthorization`),setTimeout(()=>this.redirectToApp(e.length===0),1500))}catch(t){let n=t.message?.toLowerCase()||``;n.includes(`invalid`)||n.includes(`expire`)||n.includes(`mismatch`)?(this.currentStep=0,this.token=[]):this.currentStep=3,e.toast({message:t.message||`Verification failed`,variant:`error`})}finally{this.loading=!1}},redirectToApp(e=!1){if(e){window.location=`/setup-organisation`;return}let t=localStorage.getItem(`postAuthenticationPath`);t?(localStorage.removeItem(`postAuthenticationPath`),window.location=t):window.location=`/`},async verifyAccount(e){let t=_();try{this.currentStep=1;let n=await S.verifyAccount(e);t.toast({message:n.message||`Email verified successfully`,variant:`success`}),this.currentStep=2,setTimeout(()=>this.redirectToApp(),1500)}catch(e){t.toast({message:e.message||`Email verification failed`,variant:`error`}),this.currentStep=3}}}},A={class:`flex min-h-screen justify-center items-center bg-stone-50/50 text-foreground px-4 overflow-hidden`},j={class:`flex flex-col items-center text-center space-y-2 mb-8`},M={class:`p-3 bg-primary/5 rounded-2xl mb-2`},N={key:`step-otp`,class:`space-y-8`},P={class:`flex flex-col items-center space-y-6`},F={class:`flex flex-col items-center space-y-4 w-full`},I={key:1},L={class:`h-10 flex items-center justify-center`},R={key:0,class:`text-sm text-muted-foreground flex items-center gap-2`},z={class:`font-bold text-foreground`},B={class:`pt-4 border-t border-stone-100 text-center`},V={key:`step-loading`,class:`flex flex-col items-center py-12 space-y-6`},H={key:`step-success`,class:`flex flex-col items-center py-12 space-y-6`},U={class:`w-20 h-20 bg-green-50 rounded-full flex items-center justify-center`},W={key:`step-error`,class:`flex flex-col items-center py-12 space-y-6`},G={class:`w-20 h-20 bg-destructive/10 rounded-full flex items-center justify-center`};function K(e,t,n,i,s,u){let d=C(`BackgroundAnimation`),h=C(`ShieldCheck`),_=C(`PinInputSlot`),v=C(`PinInputGroup`),b=C(`PinInput`),S=C(`Loader2`),T=C(`Button`),E=C(`Clock`),D=C(`CheckCircle`),O=C(`XCircle`),k=C(`CardContent`),K=C(`Card`);return g(),a(`div`,A,[m(d),m(w,{name:`fade-up`,appear:``},{default:y(()=>[m(K,{class:`w-full max-w-lg shadow-[0_8px_30px_rgb(0,0,0,0.04)] border-none rounded-[2rem] relative bg-white/80 backdrop-blur-xl overflow-hidden`},{default:y(()=>[m(k,{class:`p-8 md:p-12`},{default:y(()=>[c(`div`,j,[c(`div`,M,[m(h,{class:`w-8 h-8 text-primary`})]),t[4]||=c(`h2`,{class:`text-3xl font-bold tracking-tight`},`Verify Identity`,-1),t[5]||=c(`p`,{class:`text-muted-foreground text-balanced max-w-[280px]`},` We've sent a 6-digit verification code to your linked email address. `,-1)]),m(w,{name:`fade-slide`,mode:`out-in`},{default:y(()=>[s.currentStep===0?(g(),a(`div`,N,[c(`div`,P,[m(b,{id:`pin-input`,modelValue:s.token,"onUpdate:modelValue":t[0]||=e=>s.token=e,placeholder:`â—‹`,class:`gap-3`,onComplete:u.completeVerification},{default:y(()=>[m(v,{class:`gap-2 sm:gap-4`},{default:y(()=>[(g(),a(f,null,r(6,(e,t)=>m(_,{key:e,index:t,class:`w-12 h-14 sm:w-14 sm:h-16 text-xl font-bold rounded-2xl border-2 border-stone-100 bg-stone-50/50 focus-within:border-primary focus-within:ring-0 transition-all`},null,8,[`index`])),64))]),_:1})]),_:1},8,[`modelValue`,`onComplete`]),c(`div`,F,[m(T,{disabled:s.loading||s.token.length<6,onClick:u.completeVerification,class:`h-14 w-full max-w-[240px] bg-primary text-primary-foreground rounded-2xl text-lg font-semibold hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50`},{default:y(()=>[s.loading?(g(),l(S,{key:0,class:`mr-2 h-5 w-5 animate-spin`})):(g(),a(`span`,I,`Verify Now`))]),_:1},8,[`disabled`,`onClick`]),c(`div`,L,[m(w,{name:`fade`,mode:`out-in`},{default:y(()=>[s.resendWaitTime>0?(g(),a(`p`,R,[m(E,{class:`w-4 h-4`}),t[6]||=o(` Resend code in `,-1),c(`span`,z,x(s.resendWaitTime)+`s`,1)])):(g(),a(`button`,{key:1,onClick:t[1]||=(...e)=>u.resendCode&&u.resendCode(...e),class:`text-sm font-semibold text-primary hover:underline transition-all`},` Didn't receive a code? Resend `))]),_:1})])])]),c(`div`,B,[c(`button`,{onClick:t[2]||=t=>e.$router.push(`/login`),class:`text-sm text-muted-foreground hover:text-foreground transition-colors`},` Back to login `)])])):s.currentStep===1?(g(),a(`div`,V,[...t[7]||=[c(`div`,{class:`relative w-20 h-20`},[c(`div`,{class:`absolute inset-0 rounded-full border-4 border-primary/10`}),c(`div`,{class:`absolute inset-0 rounded-full border-4 border-primary border-t-transparent animate-spin`})],-1),c(`div`,{class:`text-center`},[c(`h3`,{class:`text-xl font-bold`},`Verifying Code`),c(`p`,{class:`text-muted-foreground mt-2`},`Checking your credentials...`)],-1)]])):s.currentStep===2?(g(),a(`div`,H,[c(`div`,U,[m(D,{class:`w-12 h-12 text-green-500`})]),t[9]||=c(`div`,{class:`text-center`},[c(`h3`,{class:`text-2xl font-bold text-stone-900`},`Successfully Verified`),c(`p`,{class:`text-muted-foreground mt-2`},`Redirecting you to the dashboard...`)],-1),m(T,{onClick:u.redirectToApp,class:`px-8 rounded-2xl`},{default:y(()=>[...t[8]||=[o(` Enter Flow `,-1)]]),_:1},8,[`onClick`])])):s.currentStep===3?(g(),a(`div`,W,[c(`div`,G,[m(O,{class:`w-12 h-12 text-destructive`})]),t[11]||=c(`div`,{class:`text-center`},[c(`h3`,{class:`text-2xl font-bold text-destructive`},`Verification Failed`),c(`p`,{class:`text-muted-foreground mt-2`},`The code you entered is invalid or has expired.`)],-1),m(T,{onClick:t[3]||=e=>s.currentStep=0,variant:`outline`,class:`px-8 rounded-2xl`},{default:y(()=>[...t[10]||=[o(` Try Again `,-1)]]),_:1})])):p(``,!0)]),_:1})]),_:1})]),_:1})]),_:1})])}var q=b(k,[[`render`,K],[`__scopeId`,`data-v-e7eb9d43`]]);export{q as default};