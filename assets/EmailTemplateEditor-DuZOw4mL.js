import"./useFormControl-DvkL6jNJ.js";import"./ListboxItem-qNA3-DTC.js";import"./ConfigProvider-COTvgjgS.js";import"./useHideOthers-DDpiFsmm.js";import"./useDirection-D13jZBr-.js";import"./useId-Cbz22I98.js";import"./useKbd-BvGB3m10.js";import"./PopperContent-C4v9BcUF.js";import"./useTypeahead-m4pU0-pP.js";import"./utils-DPCF9wwr.js";import"./VisuallyHiddenInput-Cjn1nZPy.js";import"./ComboboxItem-DCOWyVRk.js";import"./ComboboxGroup-DkKFLzRP.js";import{Ai as e,At as t,Di as n,Gi as r,Ni as ee,Oi as i,Pi as a,Ta as o,Yi as s,ca as c,cr as l,h as u,ha as d,ji as f,ki as te,n as ne,na as p,o as m,qi as h,r as g,wi as re,xa as _,yi as v}from"./index-DYsAJfvN.js";import{t as ie}from"./WorkspaceStore-DuZPJ7uQ.js";import{t as y}from"./Input-CVPFaPt_.js";import"./BottomSheet-CWY5Z7Ch.js";import{t as b}from"./LinkField-CVebdX8A.js";var x={class:`h-full flex flex-col bg-white`},S={class:`flex-none px-6 py-4 bg-white border-b border-gray-200 flex items-center justify-between sticky top-0 z-10`},C={class:`flex items-center space-x-4`},w={class:`text-xl font-bold text-gray-900`},T=[`disabled`],E={class:`flex-1 flex overflow-hidden`},D={class:`w-1/3 border-r border-gray-200 overflow-y-auto p-6 bg-gray-50 space-y-6`},O={class:`space-y-4`},k={class:`space-y-1`},A={class:`space-y-1`},j={class:`space-y-1`},M={class:`space-y-1`},N={class:`space-y-1`},P={class:`space-y-1`},F={key:0,class:`pt-4 border-t border-gray-200`},ae={class:`text-sm font-bold text-gray-900 mb-2`},I={class:`space-y-1 max-h-64 overflow-y-auto pr-2`},L=[`onClick`],R={class:`font-mono text-blue-600`},z={class:`text-gray-400 group-hover:text-gray-600 truncate ml-2`},B={class:`w-2/3 flex flex-col`},V={class:`flex-1 p-0 relative`},H={__name:`EmailTemplateEditor`,props:{doctype:String,name:String,isNew:Boolean},setup(H){let{toast:U}=u(),W=ie(),G=ne(),K=g(),q=H,J=d({body:`<div>
    <p>Dear \${doc.customer_name},</p>
    <p>Here is an update regarding \${doc.name}.</p>
</div>`}),Y=d(!1),X=d(null),Z=n(()=>q.name||G.params.name),Q=n(()=>q.isNew===void 0?Z.value===`new`:q.isNew),oe=n(()=>!X.value||!X.value.fields?[]:X.value.fields.filter(e=>!e.hidden)),se=async()=>{if(!Q.value)try{J.value=(await m.get(`/org/doc/Email Template/${Z.value}`,{authorizeRequest:!0,organisationAware:!0})).data||{}}catch(e){console.error(e),U({title:`Failed to load`,description:e.message,variant:`destructive`})}},ce=async()=>{if(!J.value.for_doctype){X.value=null;return}try{X.value=(await m.get(`/org/doctypes/${J.value.for_doctype}`,{authorizeRequest:!0,organisationAware:!0})).data}catch(e){console.warn(`Could not fetch target doctype meta`,e)}},le=async()=>{Y.value=!0;try{let e,t={data:J.value,authorizeRequest:!0,organisationAware:!0};e=Q.value?await m.post(`/org/doc/Email Template`,t):await m.patch(`/org/doc/Email Template/${Z.value}`,t);let n=e.data?.data||e.data;J.value=n,U({title:Q.value?`Created`:`Saved`,variant:`success`}),W.notifyDocSaved(`Email Template`,n.name),Q.value&&K.replace(`/app/Email Template/${n.name}`)}catch(e){U({title:`Error saving`,description:e.response?.data?.message||e.message,variant:`destructive`})}finally{Y.value=!1}},$=e=>{let t=`\${doc.${e}}`;navigator.clipboard.writeText(t),U({title:`Copied`,description:t,duration:1e3})};return p(()=>J.value.for_doctype,e=>{e?ce():X.value=null}),r(()=>{se(),p(()=>J.value.for_doctype,()=>{},{once:!0})}),(n,r)=>(h(),f(`div`,x,[i(`header`,S,[i(`div`,C,[i(`button`,{onClick:r[0]||=e=>n.$router.back(),class:`p-2 hover:bg-gray-100 rounded-full text-gray-500`},[a(_(l),{class:`w-5 h-5`})]),i(`div`,null,[i(`h1`,w,o(Q.value?`New Email Template`:J.value.name),1)])]),i(`button`,{onClick:le,disabled:Y.value,class:`px-6 py-2 bg-black text-white rounded-full text-sm font-medium hover:bg-gray-900 transition-colors flex items-center gap-2 shadow-sm`},[Y.value?(h(),te(_(t),{key:0,class:`w-4 h-4 animate-spin`})):e(``,!0),ee(` `+o(Q.value?`Create`:`Save`),1)],8,T)]),i(`div`,E,[i(`div`,D,[i(`div`,O,[i(`div`,k,[r[8]||=i(`label`,{class:`block text-sm font-medium text-gray-700`},`Template Name`,-1),a(y,{modelValue:J.value.name,"onUpdate:modelValue":r[1]||=e=>J.value.name=e,placeholder:`e.g. Welcome Email`,disabled:!Q.value},null,8,[`modelValue`,`disabled`])]),i(`div`,A,[r[9]||=i(`label`,{class:`block text-sm font-medium text-gray-700`},`Subject`,-1),a(y,{modelValue:J.value.subject,"onUpdate:modelValue":r[2]||=e=>J.value.subject=e,placeholder:`Email Subject`},null,8,[`modelValue`])]),i(`div`,j,[r[10]||=i(`label`,{class:`block text-sm font-medium text-gray-700`},`Category`,-1),a(y,{modelValue:J.value.category,"onUpdate:modelValue":r[3]||=e=>J.value.category=e,placeholder:`e.g. Marketing`},null,8,[`modelValue`])]),i(`div`,M,[r[11]||=i(`label`,{class:`block text-sm font-medium text-gray-700`},`For DocType (Context)`,-1),a(b,{modelValue:J.value.for_doctype,"onUpdate:modelValue":r[4]||=e=>J.value.for_doctype=e,doctype:`DocType`,placeholder:`Select DocType...`},null,8,[`modelValue`]),r[12]||=i(`p`,{class:`text-xs text-gray-500`},`Select a DocType to see available fields for dynamic content. `,-1)]),i(`div`,N,[r[13]||=i(`label`,{class:`block text-sm font-medium text-gray-700`},`Header Logo URL`,-1),a(y,{modelValue:J.value.header_logo,"onUpdate:modelValue":r[5]||=e=>J.value.header_logo=e,placeholder:`https://...`},null,8,[`modelValue`])]),i(`div`,P,[r[14]||=i(`label`,{class:`block text-sm font-medium text-gray-700`},`Footer Text`,-1),c(i(`textarea`,{class:`flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50`,"onUpdate:modelValue":r[6]||=e=>J.value.footer_text=e,rows:`2`},null,512),[[v,J.value.footer_text]])])]),X.value?(h(),f(`div`,F,[i(`h3`,ae,`Available Fields (`+o(J.value.for_doctype)+`)`,1),i(`div`,I,[(h(!0),f(re,null,s(oe.value,e=>(h(),f(`button`,{key:e.fieldname,onClick:t=>$(e.fieldname),class:`w-full text-left px-2 py-1.5 text-xs text-gray-600 hover:bg-gray-200 rounded flex justify-between group`},[i(`span`,R,"${doc."+o(e.fieldname)+`}`,1),i(`span`,z,o(e.label),1)],8,L))),128))])])):e(``,!0)]),i(`div`,B,[r[15]||=i(`div`,{class:`flex-none p-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center`},[i(`span`,{class:`text-sm font-medium text-gray-600`},`Body Content (HTML)`),i(`span`,{class:`text-xs text-gray-400`},`Supports standard HTML & Thymeleaf syntax`)],-1),i(`div`,V,[c(i(`textarea`,{"onUpdate:modelValue":r[7]||=e=>J.value.body=e,class:`w-full h-full resize-none p-6 font-mono text-sm focus:outline-none border-none text-gray-800 leading-relaxed`,placeholder:`<html>...</html> or <div>...</div>`},null,512),[[v,J.value.body]])])])])]))}};export{H as default};