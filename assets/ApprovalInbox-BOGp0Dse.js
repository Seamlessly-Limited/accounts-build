import{$i as e,Ci as t,Ea as n,Fi as r,Gn as i,In as a,Li as o,Mi as s,O as c,Oi as ee,Pi as te,Ri as l,Ta as u,Yi as d,Zi as f,fa as ne,ka as p,o as m,ot as re,u as ie,x as ae,ya as h}from"./index-CHNvwQRL.js";import{t as g}from"./WorkspaceStore-Djee2ZJb.js";var _={class:`h-full flex flex-col bg-gradient-to-br from-stone-50 to-slate-100`},v={class:`flex-none px-6 py-4 bg-white border-b border-gray-200 flex items-center justify-between`},y={class:`flex items-center gap-3`},b={class:`w-10 h-10 rounded-full bg-amber-500 flex items-center justify-center`},x=[`disabled`],S={class:`flex-1 overflow-auto p-6`},C={key:0,class:`flex justify-center items-center h-64`},w={key:1,class:`flex flex-col items-center justify-center h-64 text-center`},T={class:`w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mb-4`},E={key:2,class:`max-w-4xl mx-auto space-y-4`},D={class:`flex items-start justify-between gap-4`},O={class:`flex-1 min-w-0`},k={class:`flex items-center gap-2 mb-1`},A={class:`text-xs font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded`},j={class:`text-xs text-gray-400`},M=[`onClick`],N={class:`text-sm text-gray-500 mt-1`},P={class:`font-medium`},oe={class:`flex items-center gap-2 flex-shrink-0`},F=[`onClick`],I=[`onClick`,`disabled`],L=[`onClick`,`disabled`],R={key:0,class:`fixed inset-0 bg-black/50 flex items-center justify-center z-50`},z={class:`bg-white rounded-xl shadow-xl w-full max-w-md p-6 m-4`},B={class:`text-sm text-gray-600 mb-4`},V={class:`flex justify-end gap-2 mt-4`},H=[`disabled`],U={__name:`ApprovalInbox`,setup(U){let W=ie(),G=g(),K=h(!1),q=h([]),J=h(null),Y=h(null),X=h(``);async function Z(){K.value=!0;try{let e=(await m.get(`/org/doc/Approval Pipeline`,{params:{filters:JSON.stringify({status:[`Pending`,`Partially Approved`]}),order_by:`created_at desc`}})).data?.data||[],t=[];for(let n of e){let e=n.items||[];for(let r of e)r.assigned_to===W.email&&r.status===`Pending`&&t.push({...r,pipeline_name:n.name,target_doctype:n.target_doctype,target_document:n.target_document,requested_by:n.requested_by||n.owner,created_at:r.created_at||n.created_at})}q.value=t}catch(e){console.error(`Failed to fetch approvals:`,e)}finally{K.value=!1}}async function se(e){J.value=e.name;try{await m.patch(`/org/doc/Approval Pipeline/${e.pipeline_name}`,{data:{items:[{name:e.name,status:`Approved`,approver:W.email,decision_time:new Date().toISOString()}]}}),q.value=q.value.filter(t=>t.name!==e.name)}catch(e){console.error(`Failed to approve:`,e),alert(`Failed to approve: `+(e.response?.data?.message||e.message))}finally{J.value=null}}function ce(e){Y.value=e,X.value=``}async function le(){if(Y.value){J.value=Y.value.name;try{await m.patch(`/org/doc/Approval Pipeline/${Y.value.pipeline_name}`,{data:{items:[{name:Y.value.name,status:`Rejected`,approver:W.email,comments:X.value,decision_time:new Date().toISOString()}]}}),q.value=q.value.filter(e=>e.name!==Y.value.name),Y.value=null,X.value=``}catch(e){console.error(`Failed to reject:`,e),alert(`Failed to reject: `+(e.response?.data?.message||e.message))}finally{J.value=null}}}function Q(e){G.openTab({type:`doctype-form`,doctype:e.target_doctype,name:e.target_document,label:e.target_document})}function $(e){return e?new Date(e).toLocaleDateString(void 0,{month:`short`,day:`numeric`,hour:`2-digit`,minute:`2-digit`}):``}return d(()=>{Z()}),(d,m)=>(f(),r(`div`,_,[s(`header`,v,[s(`div`,y,[s(`div`,b,[l(u(c),{class:`w-5 h-5 text-white`})]),m[2]||=s(`div`,null,[s(`h1`,{class:`text-xl font-bold text-gray-900`},`Approvals`),s(`p`,{class:`text-sm text-gray-500`},`Pending items requiring your approval`)],-1)]),s(`button`,{onClick:Z,class:`p-2 hover:bg-gray-100 rounded-full text-gray-500 transition-colors`,disabled:K.value},[l(u(re),{class:n([`w-5 h-5`,{"animate-spin":K.value}])},null,8,[`class`])],8,x)]),s(`div`,S,[K.value&&!q.value.length?(f(),r(`div`,C,[...m[3]||=[s(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-black`},null,-1)]])):q.value.length?(f(),r(`div`,E,[(f(!0),r(ee,null,e(q.value,e=>(f(),r(`div`,{key:e.name,class:`bg-white rounded-xl border border-gray-200 p-5 hover:shadow-md transition-shadow`},[s(`div`,D,[s(`div`,O,[s(`div`,k,[s(`span`,A,p(e.stage_name||`Approval`),1),s(`span`,j,p($(e.created_at)),1)]),s(`h3`,{class:`text-lg font-semibold text-gray-900 truncate cursor-pointer hover:text-blue-600`,onClick:t=>Q(e)},p(e.target_document),9,M),s(`p`,N,[s(`span`,P,p(e.target_doctype),1),o(` â€¢ Requested by `+p(e.requested_by||`Unknown`),1)])]),s(`div`,oe,[s(`button`,{onClick:t=>Q(e),class:`px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-colors`},` View `,8,F),s(`button`,{onClick:t=>se(e),disabled:J.value===e.name,class:`px-4 py-1.5 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-1`},[l(u(i),{class:`w-4 h-4`}),m[6]||=o(` Approve `,-1)],8,I),s(`button`,{onClick:t=>ce(e),disabled:J.value===e.name,class:`px-4 py-1.5 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-1`},[l(u(ae),{class:`w-4 h-4`}),m[7]||=o(` Reject `,-1)],8,L)])])]))),128))])):(f(),r(`div`,w,[s(`div`,T,[l(u(a),{class:`w-8 h-8 text-green-600`})]),m[4]||=s(`h3`,{class:`text-lg font-medium text-gray-900 mb-1`},`All caught up!`,-1),m[5]||=s(`p`,{class:`text-gray-500`},`You have no pending approvals.`,-1)]))]),Y.value?(f(),r(`div`,R,[s(`div`,z,[m[10]||=s(`h3`,{class:`text-lg font-semibold text-gray-900 mb-4`},`Reject Approval`,-1),s(`p`,B,[m[8]||=o(` Are you sure you want to reject `,-1),s(`strong`,null,p(Y.value.target_document),1),m[9]||=o(`? `,-1)]),ne(s(`textarea`,{"onUpdate:modelValue":m[0]||=e=>X.value=e,rows:`3`,placeholder:`Reason for rejection (optional)`,class:`w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500`},null,512),[[t,X.value]]),s(`div`,V,[s(`button`,{onClick:m[1]||=e=>{Y.value=null,X.value=``},class:`px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-colors`},` Cancel `),s(`button`,{onClick:le,disabled:J.value,class:`px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors`},` Reject `,8,H)])])])):te(``,!0)]))}};export{U as default};