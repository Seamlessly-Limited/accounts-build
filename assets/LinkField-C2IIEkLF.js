const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DocForm-Cty21ley.js","assets/PopperContent-CkzV4Efh.js","assets/index-BW6FH5S4.js","assets/index-CL8FC1LI.css","assets/PopoverTrigger-DWkr4HdR.js","assets/useHideOthers-8j3pZZC2.js","assets/ConfigProvider-BeNpEDZu.js","assets/Teleport-CO7T90ZX.js","assets/PopperAnchor-DePKnfPt.js","assets/useDirection-CkCaHLjJ.js","assets/useId-C9uHTJK1.js","assets/useKbd-BvGB3m10.js","assets/button-Cg1Yo4L-.js","assets/purify.es-C6pmr44S.js","assets/marked.esm-DidRfey3.js","assets/useFormControl-BoSoz5bk.js","assets/ComboboxItem-BV80ucMH.js","assets/ListboxItem-CrspQUEb.js","assets/utils-d0L3vlW4.js","assets/VisuallyHiddenInput-Cr3vcfNb.js","assets/useTypeahead-J2lSWUJi.js","assets/ComboboxGroup-BOfthHuH.js","assets/DialogPortal-DagulIUC.js","assets/utils-1j6W-LC4.js","assets/DialogTitle-KNRScshA.js","assets/sheet-BQZlRCZC.js","assets/Label-BQWlwCJI.js","assets/SelectViewport-C4doWK-Y.js","assets/useNonce-Cry77bU8.js","assets/nullish-CfjOSA4G.js","assets/SelectGroup-D40CeBwS.js","assets/DocForm-Cw9ikweC.js","assets/DynamicIcon-D5-EdDm3.js","assets/DateField-CuEp_QeT.js","assets/button-BIS6kOZQ.js","assets/badge-DeOd_cPn.js","assets/DialogContent-DzO0B1dQ.js","assets/DialogTitle-BAO4s_Rj.js","assets/DialogFooter-BGPl6WoG.js","assets/Input-AKTRhZx5.js","assets/Label-CWz-ReQU.js","assets/SelectValue-CvGnKkl4.js","assets/Textarea-DDsE0ukV.js","assets/viewRegistry-B23Q0QQW.js","assets/WorkspaceStore-DkbvTQrR.js","assets/DocForm-D0nXgC-s.css","assets/BottomSheet-Ckf0geOJ.js","assets/BottomSheet-C0veGV1Z.css"])))=>i.map(i=>d[i]);
import{i as e,n as t,r as n,s as r,t as i}from"./ComboboxItem-BV80ucMH.js";import{t as a}from"./ComboboxGroup-BOfthHuH.js";import{$i as o,Aa as s,Bi as c,Hi as l,It as u,Li as d,Ni as f,Pa as p,Ri as m,Ui as h,Wi as g,Wn as _,Yn as ee,da as v,ea as y,ft as b,g as x,ga as S,ia as C,ja as w,na as T,o as E,t as te,wa as D,zi as O}from"./index-BW6FH5S4.js";import{t as k}from"./BottomSheet-Ckf0geOJ.js";var A={class:`relative w-full`},j={class:`relative w-full`},ne={class:`absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400`},re={key:0,class:`text-sm text-gray-500 p-4 text-center shrink-0`},ie={key:0},ae={key:1},M={class:`flex flex-col`},N={class:`font-medium`},P={key:1,class:`p-4 text-center text-sm text-gray-500 flex justify-center items-center gap-2 shrink-0`},F={class:`h-full flex flex-col bg-stone-50`},I={__name:`LinkField`,props:{modelValue:{type:String,default:``},doctype:{type:String,default:``},label:{type:String,default:``},placeholder:{type:String,default:``},disabled:{type:Boolean,default:!1},compact:{type:Boolean,default:!1}},emits:[`update:modelValue`],setup(I,{emit:L}){let R=g(()=>te(()=>import(`./DocForm-Cty21ley.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47]))),z=I,B=L,{toast:V}=x(),H=D(!1),U=D([]),W=D(!1),G=D(!1),K=D(``),q=D(``),J=D(null),Y=D(!1),X=async()=>{if(!(J.value||!z.doctype))try{let e=await E.get(`/org/doctypes/${z.doctype}`,{authorizeRequest:!0,organisationAware:!0});e.flag===`SUCCESS`&&(J.value=e.data)}catch(e){console.error(`LinkField: Meta fetch failed`,e)}},Z=async()=>{if(!z.modelValue||!z.doctype){q.value=``,K.value=``;return}if(!Y.value){Y.value=!0;try{let e=U.value.find(e=>e.value===z.modelValue);if(e){q.value=e.label.split(` (`)[0],K.value=q.value;return}J.value||await X();let t=await E.get(`/org/doc/${z.doctype}/${z.modelValue}`,{authorizeRequest:!0,organisationAware:!0});if(t&&t.flag===`SUCCESS`&&t.data){let e=t.data,n=J.value?.title_field,r=n&&e[n]?e[n]:e.name;q.value=r,K.value=r}else q.value=z.modelValue,K.value=z.modelValue}catch(e){console.error(`LinkField: Label resolution failed`,e),q.value=z.modelValue,K.value=z.modelValue}finally{Y.value=!1}}},Q=null,$=async(e=``)=>{if(!z.doctype){U.value=[];return}W.value=!0;try{J.value||await X();let t=[];if(z.doctype===`DocType`){if(t=(await E.get(`/org/doctypes`,{authorizeRequest:!0,organisationAware:!0})).data||[],e){let n=e.toLowerCase();t=t.filter(e=>e.name?.toLowerCase().includes(n))}U.value=t.map(e=>({value:e.name,label:e.name}))}else{let n={size:50};if(e){let t=J.value?.title_field;t?n[`${t}__like`]=e:n.name__like=e}t=(await E.get(`/org/doc/${z.doctype}`,{query:n,authorizeRequest:!0,organisationAware:!0})).data?.content||[];let r=J.value?.title_field;U.value=t.map(e=>({value:e.name,label:r&&e[r]?`${e[r]} (${e.name})`:e.name}))}}catch(e){console.error(`LinkField: Options fetch failed`,e)}finally{W.value=!1}};y(async()=>{z.modelValue&&Z()}),o(()=>{clearTimeout(Q)}),v(K,e=>{!H.value||e===q.value||(clearTimeout(Q),Q=setTimeout(()=>{$(e)},300))}),v(H,e=>{e?$(K.value):K.value=q.value}),v(()=>z.modelValue,e=>{e?Z():q.value=``});let oe=e=>{e!==`__create_new__`&&(B(`update:modelValue`,e),H.value=!1)},se=e=>{G.value=!1;let t=J.value?.title_field,n=t&&e[t]?e[t]:e.name;U.value.unshift({value:e.name,label:t&&e[t]?`${e[t]} (${e.name})`:e.name}),q.value=n,K.value=n,B(`update:modelValue`,e.name),V({title:`Created & Linked`,description:`${z.doctype} ${e.name} successfully linked.`,variant:`success`})},ce=()=>{H.value=!1,G.value=!0};return(o,g)=>(T(),c(`div`,A,[h(s(n),{"model-value":I.modelValue,"onUpdate:modelValue":oe,open:H.value,"onUpdate:open":g[1]||=e=>H.value=e,"filter-function":e=>e},{default:S(()=>[d(`div`,j,[h(s(e),{class:`w-full`},{default:S(()=>[h(s(t),{modelValue:K.value,"onUpdate:modelValue":g[0]||=e=>K.value=e,placeholder:I.placeholder||`Select ${I.doctype}...`,class:w([`w-full bg-white dark:bg-gray-950 border border-gray-300 dark:border-gray-800 focus:ring-2 focus:ring-black dark:focus:ring-white transition-all outline-none pr-10`,[I.compact?`px-2 py-1 text-xs rounded-lg`:`px-4 py-2 rounded-full`]]),disabled:I.disabled},null,8,[`modelValue`,`placeholder`,`class`,`disabled`]),d(`div`,ne,[W.value?(T(),m(s(u),{key:0,class:`h-4 w-4 animate-spin`})):(T(),m(s(_),{key:1,class:`h-4 w-4`}))])]),_:1}),h(s(r),{class:`absolute w-full bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 shadow-xl rounded-xl mt-2 p-1 z-[100] min-w-[200px] max-h-[300px] overflow-hidden flex flex-col`},{default:S(()=>[!W.value&&U.value.length===0?(T(),c(`div`,re,[K.value?(T(),c(`span`,ie,`No results found for "`+p(K.value)+`"`,1)):(T(),c(`span`,ae,`No options available`))])):O(``,!0),h(s(a),{class:`border-b border-gray-100 dark:border-gray-800 mb-1 pb-1 shrink-0`},{default:S(()=>[h(s(i),{value:`__create_new__`,onSelect:ce,class:`flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 cursor-pointer outline-none data-[highlighted]:bg-blue-200 dark:data-[highlighted]:bg-blue-900/20`},{default:S(()=>[h(s(b),{class:`h-4 w-4`}),l(` Create New `+p(I.doctype),1)]),_:1})]),_:1}),h(s(a),{class:`overflow-y-auto flex-1`},{default:S(()=>[(T(!0),c(f,null,C(U.value,e=>(T(),m(s(i),{key:e.value,value:e.value,class:`flex items-center justify-between px-3 py-2 text-sm rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-900 outline-none data-[state=checked]:bg-gray-50 dark:data-[state=checked]:bg-gray-900`},{default:S(()=>[d(`div`,M,[d(`span`,N,p(e.label),1)]),I.modelValue===e.value?(T(),m(s(ee),{key:0,class:`h-4 w-4 text-black dark:text-white`})):O(``,!0)]),_:2},1032,[`value`]))),128))]),_:1}),W.value&&U.value.length===0?(T(),c(`div`,P,[h(s(u),{class:`h-4 w-4 animate-spin`}),g[3]||=l(` Searching... `,-1)])):O(``,!0)]),_:1})])]),_:1},8,[`model-value`,`open`,`filter-function`]),h(k,{modelValue:G.value,"onUpdate:modelValue":g[2]||=e=>G.value=e,"initial-height":85},{default:S(()=>[d(`div`,F,[h(s(R),{doctype:I.doctype,"is-new":!0,name:`new`,"is-embedded":!0,onSaved:se},null,8,[`doctype`])])]),_:1},8,[`modelValue`])]))}};export{I as t};