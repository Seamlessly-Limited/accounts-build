import{t as e}from"./SelectGroup-mRhUQAYm.js";import{Ai as t,At as n,Di as r,Fi as i,Gi as a,Hn as ee,Ki as te,Ni as o,Oi as s,P as ne,Pi as c,Pt as re,Qi as ie,Sa as l,Ta as u,Vn as ae,Yi as d,_i as oe,b as se,ca as f,cr as ce,h as le,ha as p,it as ue,ji as m,ki as h,l as de,n as fe,na as g,o as _,qi as v,r as pe,sa as y,wi as b,xa as x,yi as S}from"./index-DUz5oLRf.js";import{t as me}from"./WorkspaceStore-DloGvRxv.js";import{t as C}from"./Input-nMYpliAi.js";import{t as he}from"./DynamicIcon-9hv_PMkg.js";import{t as ge}from"./viewRegistry-DuQEad4b.js";import{t as w}from"./LinkField-JIFjc5kv.js";import{a as _e,i as ve,n as ye,r as be,t as xe}from"./SelectValue-B-w7Avnt.js";var Se={key:1,class:`h-full flex flex-col bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] to-slate-100/50 from-stone-100/60 from-5%`},Ce={class:`flex-none px-6 py-4 bg-white border-b border-gray-200 flex items-center justify-between sticky top-0 z-10`},we={class:`flex items-center space-x-4`},Te={class:`flex items-center gap-2`},Ee={class:`text-sm font-medium text-gray-500 uppercase tracking-wider`},De={class:`text-xl font-bold text-gray-900 mt-1`},Oe={class:`flex items-center space-x-3`},ke={key:0,class:`absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20`},Ae=[`disabled`],je=[`disabled`],Me={key:3,class:`border-t border-gray-100 my-1`},Ne=[`disabled`],Pe=[`disabled`],Fe=[`disabled`],Ie={class:`flex-1 overflow-auto p-6`},Le={key:0,class:`flex justify-center items-center h-64`},Re={key:1,class:`max-w-5xl mx-auto space-y-6`},ze={class:`rounded-sm p-6 pt-8`},Be={class:`grid grid-cols-1 md:grid-cols-2 gap-6`},Ve={class:`block text-sm font-medium text-gray-700`},He={key:0,class:`text-red-500`},Ue={key:0},We={key:1},Ge={key:2},Ke={key:3},qe={key:4},Je=[`onUpdate:modelValue`,`placeholder`,`disabled`],Ye={key:5},Xe={class:`flex items-center space-x-2 cursor-pointer mt-1`},Ze=[`onUpdate:modelValue`,`disabled`],Qe={class:`text-sm text-gray-600`},$e={key:6},et={key:7},tt={class:`flex items-center gap-2`},nt=[`onUpdate:modelValue`,`disabled`],rt=[`onUpdate:modelValue`,`disabled`],it={key:8},at={class:`flex items-center gap-2`},ot={class:`h-10 w-10 flex items-center justify-center rounded border border-gray-300 bg-gray-50`},st=[`onUpdate:modelValue`,`disabled`,`placeholder`],ct={key:9,class:`p-2 bg-gray-50 border border-gray-100 rounded text-sm text-gray-600`},lt={key:10,class:`p-2 bg-gray-50 border border-gray-200 rounded text-xs text-gray-500`},ut={key:11,class:`text-[11px] text-gray-400 mt-1 italic px-1`},dt={class:`px-6 py-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center`},ft={class:`font-medium text-gray-900`},pt={class:`p-6 text-center text-gray-500 text-sm`},T={__name:`DocForm`,props:{doctype:{type:String,default:null},name:{type:String,default:null},isNew:{type:Boolean,default:void 0},isEmbedded:{type:Boolean,default:!1}},emits:[`saved`],setup(T,{emit:mt}){let{toast:E}=le(),D=me(),O=T,k=fe(),A=pe(),j=r(()=>O.doctype||k.params.doctype),M=r(()=>O.name||k.params.name),N=r(()=>O.isNew===void 0?M.value===`new`:O.isNew),P=r(()=>{if(!j.value)return null;let e=ge(j.value,`form`);return e?i(e):null}),F=p({}),I=p({}),L=p(!0),R=p(!1),z=p(!1),B=p(!1),V=p(!1),H=p(!1),U=p(!1),W=p(null),ht=new Set([`DATA`,`CURRENCY`,`FLOAT`,`INT`,`PERCENT`,`PHONE`,`EMAIL`,`PASSWORD`,`ATTACH`,`ATTACH_IMAGE`,`URL`]),G=new Set([`CURRENCY`,`FLOAT`,`PERCENT`]),gt=new Set([`TABLE`,`SECTION_BREAK`,`COLUMN_BREAK`]),K=r(()=>(F.value.fields||[]).map(e=>({...e,_isDataType:ht.has(e.fieldtype),_isNumericType:G.has(e.fieldtype),_inputType:xt(e.fieldtype),_parsedOptions:e.options?e.options.split(`
`):[],_step:G.has(e.fieldtype)?`0.01`:`1`,_placeholder:e.placeholder||`Select ${e.label}...`}))),_t=r(()=>K.value.filter(e=>!gt.has(e.fieldtype)&&!e.hidden)),vt=r(()=>K.value.filter(e=>e.fieldtype===`TABLE`&&!e.hidden)),yt=r(()=>{let e=new Map;for(let t of K.value)e.set(t.fieldname,t);return e}),bt=r(()=>{let e=new Set,t=I.value.docstatus||0;for(let n of K.value)(n.read_only||t>0&&!n.allow_on_submit)&&e.add(n.fieldname);return e}),q=e=>bt.value.has(e.fieldname),xt=e=>e===`INT`||e===`FLOAT`||e===`CURRENCY`?`number`:e===`DATE`?`date`:e===`PASSWORD`?`password`:`text`,St=e=>({Draft:`bg-gray-100 text-gray-800`,Submitted:`bg-blue-100 text-blue-800`,Paid:`bg-green-100 text-green-800`})[e]||`bg-gray-100 text-gray-800`,J=async()=>{L.value=!0;try{if(F.value=(await _.get(`/org/doctypes/${j.value}`,{authorizeRequest:!0,organisationAware:!0})).data||{},N.value){let e={};F.value.fields&&F.value.fields.forEach(t=>{t.default_value&&(e[t.fieldname]=t.default_value)}),I.value=e}else{if(!M.value){console.warn(`Cannot fetch document: docName is undefined`);return}I.value=(await _.get(`/org/doc/${j.value}/${M.value}`,{authorizeRequest:!0,organisationAware:!0})).data||{}}}catch(e){console.error(e);let t=e.response?.data?.message||e.message;E({title:`Failed to load`,description:t,variant:`destructive`}),I.value||={}}finally{L.value=!1}},Y=p(null);function X(){!N.value||!j.value||(Y.value&&clearTimeout(Y.value),Y.value=setTimeout(()=>{D.saveFormData(j.value,I.value,!0,null)},500))}g(I,()=>{X()},{deep:!0});let Z=mt,Ct=async()=>{R.value=!0;try{let e,t={data:I.value,authorizeRequest:!0,organisationAware:!0};e=N.value?await _.post(`/org/doc/${j.value}`,t):await _.patch(`/org/doc/${j.value}/${M.value}`,t);let n=e?.data;if(!n)throw Error(`Server returned empty data`);I.value=n,Z(`saved`,n),E({title:N.value?`Created`:`Saved`,description:`${F.value.name} has been ${N.value?`created`:`saved`} successfully.`,variant:`success`}),j.value&&D.clearFormData(j.value,N.value,N.value?null:M.value),D.notifyDocSaved(j.value,n.name),N.value&&!O.name&&!O.isEmbedded&&A.replace(`/app/${j.value}/${n.name}`)}catch(e){console.error(e);let t=e.response?.data?.message||e.message;E({title:`Error saving`,description:t,variant:`destructive`})}finally{R.value=!1}};g(()=>k.params.name,J),g(M,(e,t)=>{e&&e!==t&&J()}),a(()=>{if(N.value&&j.value){let e=D.getFormData(j.value,!0,null);e&&e.data&&(I.value={...e.data})}J()});let Q=de(),wt=r(()=>{if(!F.value.is_submittable||I.value.docstatus!==0)return!1;let e=F.value.config?.workflow;return e?!(e.submit_roles&&e.submit_roles.length>0&&(!Q.role||!e.submit_roles.includes(Q.role))):!0}),Tt=async()=>{B.value=!0,z.value=!1;try{let e=(await _.patch(`/org/doc/${j.value}/${M.value}`,{data:{docstatus:1},authorizeRequest:!0,organisationAware:!0})).data?.data||{};I.value=e,Z(`saved`,e),E({title:`Submitted`,description:`Document has been submitted successfully.`,variant:`success`})}catch(e){console.error(e);let t=e.response?.data?.message||e.message;E({title:`Result`,description:t,variant:t.includes(`submitted`)?`success`:`destructive`})}finally{B.value=!1}},Et=async()=>{try{let e=crypto.randomUUID();await _.post(`/org/doc/Public Document Access`,{data:{doctype:j.value,doc_name:M.value,token:e,access_type:`View`,max_views:0},authorizeRequest:!0,organisationAware:!0});let t=`${window.location.origin}/public/d/${e}`;navigator.clipboard.writeText(t),E({title:`Link Copied`,description:`Public link has been copied to clipboard.`,variant:`success`}),z.value=!1}catch(e){console.error(e),E({title:`Failed`,description:e.message,variant:`destructive`})}},Dt=async()=>{if(confirm(`Are you sure you want to cancel this document?`)){V.value=!0,z.value=!1;try{let e=(await _.patch(`/org/doc/${j.value}/${M.value}`,{data:{docstatus:2},authorizeRequest:!0,organisationAware:!0})).data?.data||{};I.value=e,Z(`saved`,e),E({title:`Cancelled`,description:`Document has been cancelled.`,variant:`default`})}catch(e){console.error(e);let t=e.response?.data?.message||e.message;E({title:`Error cancelling`,description:t,variant:`destructive`})}finally{V.value=!1}}},Ot=async()=>{if(confirm(`Are you sure you want to delete this document? This cannot be undone.`)){H.value=!0,z.value=!1;try{await _.delete(`/org/doc/${j.value}/${M.value}`,{authorizeRequest:!0,organisationAware:!0}),E({title:`Deleted`,description:`Document has been deleted.`,variant:`default`}),A.back()}catch(e){console.error(e);let t=e.response?.data?.message||e.message;E({title:`Error deleting`,description:t,variant:`destructive`})}finally{H.value=!1}}},kt=async()=>{U.value=!0;try{I.value.status=`Queued`,I.value.error_log=``,await _.patch(`/org/doc/Notification/${M.value}`,{data:{status:`Queued`,error_log:``},authorizeRequest:!0,organisationAware:!0}),E({title:`Retry Queued`,description:`Notification has been queued for retry.`,variant:`default`})}catch(e){console.error(e),E({title:`Retry Failed`,description:e.response?.data?.message||e.message,variant:`destructive`})}finally{U.value=!1}},$=e=>{W.value&&!W.value.contains(e.target)&&(z.value=!1)};return a(()=>document.addEventListener(`click`,$)),te(()=>document.removeEventListener(`click`,$)),(r,i)=>P.value?(v(),h(ie(P.value),{key:0,doctype:j.value,name:M.value,isNew:N.value},null,8,[`doctype`,`name`,`isNew`])):(v(),m(`div`,Se,[s(`header`,Ce,[s(`div`,we,[T.isEmbedded?t(``,!0):(v(),m(`button`,{key:0,onClick:i[0]||=e=>r.$router.back(),class:`p-2 hover:bg-gray-100 rounded-full text-gray-500`},[c(x(ce),{class:`w-5 h-5`})])),s(`div`,{class:l({"pl-0":T.isEmbedded})},[s(`div`,Te,[s(`span`,Ee,u(F.value.name),1),I.value.status?(v(),m(`span`,{key:0,class:l([`px-2 py-0.5 rounded text-xs font-bold`,St(I.value.status)])},u(I.value.status),3)):t(``,!0)]),s(`h1`,De,u(N.value?`New `+F.value.name:I.value[F.value.title_field]||I.value.name),1)],2)]),s(`div`,Oe,[N.value?t(``,!0):(v(),m(`div`,{key:0,class:`relative`,ref_key:`actionsDropdownRef`,ref:W},[s(`button`,{onClick:i[1]||=e=>z.value=!z.value,class:`px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-full text-sm font-medium transition-colors flex items-center gap-1`},[i[2]||=o(` Actions `,-1),c(x(ae),{class:`w-4 h-4`})]),z.value?(v(),m(`div`,ke,[wt.value?(v(),m(`button`,{key:0,onClick:Tt,disabled:B.value,class:`w-full text-left px-4 py-2 text-sm text-green-700 hover:bg-green-50 flex items-center gap-2`},[c(x(ee),{class:`w-4 h-4`}),i[3]||=o(` Submit `,-1)],8,Ae)):t(``,!0),F.value.is_submittable&&I.value.docstatus===1?(v(),m(`button`,{key:1,onClick:Dt,disabled:V.value,class:`w-full text-left px-4 py-2 text-sm text-red-700 hover:bg-red-50 flex items-center gap-2`},[c(x(se),{class:`w-4 h-4`}),i[4]||=o(` Cancel `,-1)],8,je)):t(``,!0),N.value?t(``,!0):(v(),m(`button`,{key:2,onClick:Et,class:`w-full text-left px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2`},[c(x(re),{class:`w-4 h-4`}),i[5]||=o(` Get Public Link `,-1)])),F.value.is_submittable&&(I.value.docstatus===0||I.value.docstatus===1)?(v(),m(`div`,Me)):t(``,!0),s(`button`,{onClick:Ot,disabled:H.value,class:`w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2`},[c(x(ne),{class:`w-4 h-4`}),i[6]||=o(` Delete `,-1)],8,Ne)])):t(``,!0)],512)),j.value===`Notification`&&I.value.status===`Failed`?(v(),m(`button`,{key:1,onClick:kt,disabled:U.value,class:`px-5 py-2 bg-amber-500 text-white rounded-full text-sm font-medium hover:bg-amber-600 transition-colors flex items-center gap-2 shadow-sm`},[U.value?(v(),h(x(n),{key:1,class:`w-4 h-4 animate-spin`})):(v(),h(x(ue),{key:0,class:`w-4 h-4`})),i[7]||=o(` Retry `,-1)],8,Pe)):t(``,!0),s(`button`,{onClick:Ct,disabled:R.value,class:`px-6 py-2 bg-black text-white rounded-full text-sm font-medium hover:bg-gray-900 transition-colors flex items-center gap-2 shadow-sm`},[R.value?(v(),h(x(n),{key:0,class:`w-4 h-4 animate-spin`})):t(``,!0),o(` `+u(N.value?`Create`:`Save`),1)],8,Fe)])]),s(`div`,Ie,[L.value?(v(),m(`div`,Le,[...i[8]||=[s(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-black`},null,-1)]])):(v(),m(`div`,Re,[s(`div`,ze,[s(`div`,Be,[(v(!0),m(b,null,d(_t.value,n=>(v(),m(`div`,{key:n.fieldname,class:l([`space-y-1`,{"col-span-2":n.fieldtype===`TEXT`||n.fieldtype===`LONG_TEXT`||n.fieldtype===`TABLE`||n.fieldtype===`HTML`}])},[s(`label`,Ve,[o(u(n.label)+` `,1),n.reqd?(v(),m(`span`,He,`*`)):t(``,!0)]),n._isDataType?(v(),m(`div`,Ue,[c(C,{class:`bg-white/40`,type:n._inputType,modelValue:I.value[n.fieldname],"onUpdate:modelValue":e=>I.value[n.fieldname]=e,placeholder:n.placeholder,disabled:q(n),step:n._step},null,8,[`type`,`modelValue`,`onUpdate:modelValue`,`placeholder`,`disabled`,`step`])])):n.fieldtype===`SELECT`?(v(),m(`div`,We,[c(x(_e),{modelValue:I.value[n.fieldname],"onUpdate:modelValue":e=>I.value[n.fieldname]=e,disabled:q(n)},{default:y(()=>[c(x(ye),{class:`bg-white/40`},{default:y(()=>[c(x(xe),{placeholder:n._placeholder},null,8,[`placeholder`])]),_:2},1024),c(x(ve),null,{default:y(()=>[c(x(e),null,{default:y(()=>[(v(!0),m(b,null,d(n._parsedOptions,e=>(v(),h(x(be),{key:e,value:e},{default:y(()=>[o(u(e),1)]),_:2},1032,[`value`]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):n.fieldtype===`DATE`?(v(),m(`div`,Ge,[c(C,{class:`bg-white/40`,type:`date`,modelValue:I.value[n.fieldname],"onUpdate:modelValue":e=>I.value[n.fieldname]=e,disabled:q(n)},null,8,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):[`DATETIME`,`TIME`].includes(n.fieldtype)?(v(),m(`div`,Ke,[c(C,{class:`bg-white/40`,type:n.fieldtype===`TIME`?`time`:`datetime-local`,modelValue:I.value[n.fieldname],"onUpdate:modelValue":e=>I.value[n.fieldname]=e,disabled:q(n)},null,8,[`type`,`modelValue`,`onUpdate:modelValue`,`disabled`])])):[`TEXT`,`SMALL_TEXT`,`LONG_TEXT`,`HTML`,`JSON`].includes(n.fieldtype)?(v(),m(`div`,qe,[f(s(`textarea`,{class:`flex min-h-[80px] w-full rounded-xl border border-input bg-white/40 px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all focus:ring-black/5`,"onUpdate:modelValue":e=>I.value[n.fieldname]=e,placeholder:n.placeholder,disabled:q(n),rows:`3`},null,8,Je),[[S,I.value[n.fieldname]]])])):n.fieldtype===`CHECKBOX`?(v(),m(`div`,Ye,[s(`label`,Xe,[f(s(`input`,{type:`checkbox`,"onUpdate:modelValue":e=>I.value[n.fieldname]=e,disabled:q(n),class:`w-4 h-4 text-black rounded border-gray-300 focus:ring-black`},null,8,Ze),[[oe,I.value[n.fieldname]]]),s(`span`,Qe,u(n.label),1)])])):n.fieldtype===`LINK`?(v(),m(`div`,$e,[n.meta?.link_doctype_field?(v(),m(b,{key:0},[I.value[n.meta.link_doctype_field]?(v(),h(w,{modelValue:I.value[n.fieldname],"onUpdate:modelValue":e=>I.value[n.fieldname]=e,doctype:I.value[n.meta.link_doctype_field],label:n.label,placeholder:n._placeholder,disabled:q(n),key:`${n.fieldname}-${I.value[n.meta.link_doctype_field]}`},null,8,[`modelValue`,`onUpdate:modelValue`,`doctype`,`label`,`placeholder`,`disabled`])):(v(),h(C,{key:1,type:`text`,disabled:``,placeholder:`Select ${yt.value.get(n.meta.link_doctype_field)?.label||`DocType`} first...`,class:`w-full bg-gray-100 border border-gray-200 rounded-full text-gray-400 cursor-not-allowed`},null,8,[`placeholder`]))],64)):(v(),h(w,{key:1,modelValue:I.value[n.fieldname],"onUpdate:modelValue":e=>I.value[n.fieldname]=e,doctype:n.options,label:n.label,placeholder:n._placeholder,disabled:q(n)},null,8,[`modelValue`,`onUpdate:modelValue`,`doctype`,`label`,`placeholder`,`disabled`]))])):n.fieldtype===`COLOR`?(v(),m(`div`,et,[s(`div`,tt,[f(s(`input`,{type:`color`,"onUpdate:modelValue":e=>I.value[n.fieldname]=e,disabled:q(n),class:`h-10 w-10 p-1 rounded border border-gray-300 shadow-sm`},null,8,nt),[[S,I.value[n.fieldname]]]),f(s(`input`,{type:`text`,"onUpdate:modelValue":e=>I.value[n.fieldname]=e,disabled:q(n),class:`flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-black outline-none transition-all`},null,8,rt),[[S,I.value[n.fieldname]]])])])):n.fieldtype===`ICON`?(v(),m(`div`,it,[s(`div`,at,[s(`div`,ot,[c(he,{name:I.value[n.fieldname]||`Layers`,class:`size-5 text-gray-600`},null,8,[`name`])]),f(s(`input`,{type:`text`,"onUpdate:modelValue":e=>I.value[n.fieldname]=e,disabled:q(n),placeholder:n.placeholder||`Enter Lucide icon name (e.g., Bell, FileText)`,class:`flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-black outline-none transition-all`},null,8,st),[[S,I.value[n.fieldname]]])])])):n.fieldtype===`READ_ONLY`?(v(),m(`div`,ct,u(I.value[n.fieldname]||`-`),1)):(v(),m(`div`,lt,` Unsupported field: `+u(n.fieldtype),1)),n.description?(v(),m(`p`,ut,u(n.description),1)):t(``,!0)],2))),128))])]),(v(!0),m(b,null,d(vt.value,e=>(v(),m(`div`,{key:e.fieldname,class:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden`},[s(`div`,dt,[s(`h3`,ft,u(e.label),1),i[9]||=s(`button`,{class:`text-sm text-blue-600 font-medium hover:text-blue-700`},`+ Add Row`,-1)]),s(`div`,pt,` Table editing not implemented yet for `+u(e.label),1)]))),128))]))])]))}};export{T as t};