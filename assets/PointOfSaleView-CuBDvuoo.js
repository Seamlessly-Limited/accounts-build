import"./useFormControl-CjeW_yF1.js";import"./ListboxItem-C3gY1pGN.js";import"./ConfigProvider-BY88vHZH.js";import"./useHideOthers-CleQw0cI.js";import"./useDirection-ZgC7WO53.js";import"./useId-_W-wRvmL.js";import"./useKbd-BvGB3m10.js";import"./PopperContent-D0ERvMe6.js";import"./useTypeahead-Djp42Xey.js";import"./utils-CbTsZDN1.js";import"./VisuallyHiddenInput-IXKLJ3Dv.js";import"./ComboboxItem-BtsvEZMp.js";import"./ComboboxGroup-DFukxMZX.js";import"./Label-PC3o1Jo3.js";import{Bi as e,F as t,Ki as n,Li as r,Oa as i,Pa as a,Ra as o,Ui as s,Vi as c,Wi as l,X as ee,ba as u,ca as d,ht as te,i as ne,mt as re,na as ie,o as f,oa as p,ot as ae,qi as m,r as oe,rt as se,ut as ce}from"./index-BHNnQTTo.js";import{t as h}from"./button-DHTtQedQ.js";import{t as g}from"./Input-DzP8_N3r.js";import"./BottomSheet-hG7xnWEC.js";import{t as _}from"./Card-CP12Kofe.js";import{t as v}from"./CardContent-DIOduLan.js";import{n as le,t as ue}from"./CardTitle-DDV552DC.js";import{t as y}from"./Label-C3kqb2rR.js";import{t as de}from"./LinkField-DrizSBfH.js";import"./badge-B8qxrXJg.js";var fe={class:`pos-container bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-stone-50 to-stone-100 from-5% scrollbar-hide`},pe={class:`pos-header no-print`},me={class:`flex items-center gap-3`},he={class:`icon-wrapper`},ge={class:`flex items-center gap-2`},_e={class:`pos-main`},ve={class:`entry-panel no-print`},ye={class:`space-y-3`},be=[`onKeydown`],b={class:`item-grid`},x={class:`grid grid-cols-2 gap-4`},S={key:0,class:`mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-600`},C={key:1,class:`mt-4 p-3 bg-stone-50 border border-sku-200 rounded-lg`},w={class:`text-sm text-green-700 font-medium`},T={class:`font-bold`},E={class:`mt-4 flex gap-2`},D={class:`receipt-panel`},O={class:`text-center mb-6`},k={class:`text-sm text-slate-600 mt-2`},A={key:0,class:`text-sm text-slate-600`},j={class:`space-y-2`},M={class:`flex-1`},N={class:`font-medium text-slate-700`},xe={class:`text-slate-500 text-xs ml-2`},Se={key:0,class:`text-sky-600 text-xs ml-1`},Ce={class:`font-medium text-slate-800`},we={class:`space-y-2`},Te={class:`flex justify-between text-sm`},Ee={class:`font-medium`},De={class:`flex justify-between text-sm`},Oe={class:`font-medium text-sky-600`},ke={class:`flex justify-between text-lg font-bold mt-2 pt-2 border-t border-slate-200`},P=ne({__name:`PointOfSaleView`,emits:[`saved`],setup(ne,{emit:P}){oe();let F=i(new Date().toISOString().split(`T`)[0]),I=i(``),L=i([U()]),R=i(!1),z=i(!1),B=i(null),V=i(null),H=[{value:`Standard Rated`,label:`Standard (7.5%)`,rate:7.5},{value:`Zero Rated`,label:`Zero Rated`,rate:0},{value:`Exempt`,label:`Exempt`,rate:0}];function U(){return{id:Date.now(),product:``,item_name:``,qty:1,unit_price:0,vat_category:`Standard Rated`}}async function Ae(e){if(e.product)try{let t=await f.get(`/org/doc/Product/${encodeURIComponent(e.product)}`);t.data&&(e.item_name=t.data.product_name||t.data.description||e.product,e.unit_price=t.data.standard_rate||0,t.data.vat_category&&(e.vat_category=t.data.vat_category))}catch(e){console.warn(`Product lookup failed`,e)}}let W=e(()=>L.value.map(e=>{let t=parseFloat(e.qty||0)*parseFloat(e.unit_price||0),n=H.find(t=>t.value===e.vat_category)||H[0],r=t*(n.rate/100);return{...e,net_amount:t,vat_rate:n.rate,vat_amount:r,line_total:t+r}})),G=e(()=>W.value.reduce((e,t)=>e+t.net_amount,0)),K=e(()=>W.value.reduce((e,t)=>e+t.vat_amount,0)),je=e(()=>G.value+K.value),q=e(()=>L.value.some(e=>e.item_name&&parseFloat(e.qty)>0&&parseFloat(e.unit_price)>0));function J(){L.value.push(U()),ie(()=>{let e=document.querySelectorAll(`.item-name-input`);e.length>0&&e[e.length-1].focus()})}function Me(e){L.value.length>1&&L.value.splice(e,1)}function Y(){L.value=[U()],I.value=``,F.value=new Date().toISOString().split(`T`)[0],V.value=null,B.value=null}async function Ne(){if(!q.value){B.value=`Add at least one valid item`;return}R.value=!0,B.value=null;try{let e=Z(),t=await f.post(`/org/sales/pos`,e);t?.flag===`SUCCESS`?(V.value=t.data,$(`saved`,t.data),Y()):B.value=t?.message||`Failed to save`}catch(e){B.value=e.message||`Failed to save draft`}finally{R.value=!1}}async function X(){if(!q.value){B.value=`Add at least one valid item`;return}z.value=!0,B.value=null;try{let e=Z(),t=await f.post(`/org/sales/pos/submit`,e);t?.flag===`SUCCESS`?(V.value=t.data,$(`saved`,t.data)):B.value=t?.message||`Failed to submit`}catch(e){B.value=e.message||`Failed to submit sale`}finally{z.value=!1}}function Z(){let e=W.value.filter(e=>e.item_name&&parseFloat(e.qty)>0&&parseFloat(e.unit_price)>0).map(e=>({product:e.product||null,item_name:e.item_name,qty:parseFloat(e.qty),unit_price:parseFloat(e.unit_price),net_amount:e.net_amount,vat_category:e.vat_category,vat_rate:e.vat_rate,vat_amount:e.vat_amount}));return{posting_date:F.value,customer_name:I.value||null,items:e}}function Pe(){window.print()}function Q(e){return new Intl.NumberFormat(`en-NG`,{style:`currency`,currency:`NGN`,minimumFractionDigits:2}).format(e||0)}function Fe(e){return e?new Date(e).toLocaleDateString(`en-GB`,{day:`2-digit`,month:`short`,year:`numeric`}):`-`}function Ie(e,t){if(e.key===`Enter`&&e.target.classList.contains(`unit-price-input`))if(e.preventDefault(),t===L.value.length-1)J();else{let e=document.querySelectorAll(`.item-name-input`)[t+1];e&&e.focus()}}let $=P;return(e,i)=>(p(),l(`div`,fe,[c(`div`,pe,[c(`div`,me,[c(`div`,he,[m(a(ee),{class:`w-6 h-6 text-gray-200`})]),i[2]||=c(`div`,null,[c(`h1`,{class:`text-xl font-bold text-slate-800`},`Sales POS`),c(`p`,{class:`text-sm text-slate-500`},`Quick sale entry with receipt`)],-1)]),c(`div`,ge,[m(a(h),{variant:`outline`,size:`sm`,onClick:Y,class:`gap-2`},{default:u(()=>[m(a(ce),{class:`w-4 h-4`}),i[3]||=n(` Clear `,-1)]),_:1})])]),c(`div`,_e,[c(`div`,ve,[m(a(_),null,{default:u(()=>[m(a(le),{class:`pb-2`},{default:u(()=>[m(a(ue),{class:`text-sm font-semibold text-slate-600 uppercase tracking-wide`},{default:u(()=>[...i[4]||=[n(` Items `,-1)]]),_:1})]),_:1}),m(a(v),null,{default:u(()=>[c(`div`,ye,[(p(!0),l(r,null,d(L.value,(e,n)=>(p(),l(`div`,{key:e.id,class:`item-row`,onKeydown:e=>Ie(e,n)},[c(`div`,b,[m(de,{modelValue:e.product,"onUpdate:modelValue":[t=>e.product=t,t=>Ae(e)],doctype:`Product`,placeholder:`Product`,compact:``,class:`col-span-3`},null,8,[`modelValue`,`onUpdate:modelValue`]),m(a(g),{modelValue:e.item_name,"onUpdate:modelValue":t=>e.item_name=t,placeholder:`Description`,class:`item-name-input col-span-2`},null,8,[`modelValue`,`onUpdate:modelValue`]),m(a(g),{modelValue:e.qty,"onUpdate:modelValue":t=>e.qty=t,modelModifiers:{number:!0},type:`number`,min:`1`,step:`1`,placeholder:`Qty`,class:`qty-input`},null,8,[`modelValue`,`onUpdate:modelValue`]),m(a(g),{modelValue:e.unit_price,"onUpdate:modelValue":t=>e.unit_price=t,modelModifiers:{number:!0},type:`number`,min:`0`,step:`0.01`,placeholder:`Price`,class:`unit-price-input col-span-2`},null,8,[`modelValue`,`onUpdate:modelValue`]),m(a(h),{variant:`ghost`,size:`icon`,onClick:e=>Me(n),disabled:L.value.length===1,class:`shrink-0`},{default:u(()=>[m(a(t),{class:`w-4 h-4 text-slate-400`})]),_:1},8,[`onClick`,`disabled`])])],40,be))),128))]),m(a(h),{variant:`outline`,size:`sm`,onClick:J,class:`mt-4 w-full gap-2`},{default:u(()=>[m(a(te),{class:`w-4 h-4`}),i[5]||=n(` Add Item `,-1)]),_:1})]),_:1})]),_:1}),m(a(_),{class:`mt-4`},{default:u(()=>[m(a(v),{class:`pt-4`},{default:u(()=>[c(`div`,x,[c(`div`,null,[m(a(y),{class:`text-xs text-slate-500 uppercase tracking-wide`},{default:u(()=>[...i[6]||=[n(`Date`,-1)]]),_:1}),m(a(g),{modelValue:F.value,"onUpdate:modelValue":i[0]||=e=>F.value=e,disabled:``,type:`date`,class:`mt-1`},null,8,[`modelValue`])]),c(`div`,null,[m(a(y),{class:`text-xs text-slate-500 uppercase tracking-wide`},{default:u(()=>[...i[7]||=[n(`Customer (optional)`,-1)]]),_:1}),m(a(g),{modelValue:I.value,"onUpdate:modelValue":i[1]||=e=>I.value=e,placeholder:`Walk-in customer`,class:`mt-1`},null,8,[`modelValue`])])])]),_:1})]),_:1}),B.value?(p(),l(`div`,S,o(B.value),1)):s(``,!0),V.value?(p(),l(`div`,C,[c(`div`,w,[n(` Sale `+o(V.value.status===`Submitted`?`submitted`:`saved`)+`: `,1),c(`span`,T,o(V.value.name),1)])])):s(``,!0),c(`div`,E,[m(a(h),{variant:`outline`,onClick:Ne,disabled:!q.value||R.value,class:`flex-1 gap-2 rounded-full`},{default:u(()=>[m(a(ae),{class:`w-4 h-4`}),n(` `+o(R.value?`Saving...`:`Save Draft`),1)]),_:1},8,[`disabled`]),m(a(h),{onClick:X,disabled:!q.value||z.value,class:`flex-1 gap-2 rounded-full`},{default:u(()=>[m(a(se),{class:`w-4 h-4`}),n(` `+o(z.value?`Paying...`:`Pay`),1)]),_:1},8,[`disabled`])])]),c(`div`,D,[m(a(_),{class:`receipt-card`},{default:u(()=>[m(a(v),{class:`p-6`},{default:u(()=>[c(`div`,O,[i[8]||=c(`h2`,{class:`text-lg font-bold text-slate-800`},` Sales Receipt `,-1),i[9]||=c(`p`,{class:`text-xs text-slate-500 mt-1`},`RECEIPT`,-1),c(`p`,k,o(Fe(F.value)),1),I.value?(p(),l(`p`,A,o(I.value),1)):s(``,!0)]),i[13]||=c(`div`,{class:`border-t border-dashed border-slate-300 my-4`},null,-1),c(`div`,j,[(p(!0),l(r,null,d(W.value,(e,t)=>(p(),l(`div`,{key:e.id,class:`flex justify-between text-sm`},[c(`div`,M,[c(`span`,N,o(e.item_name||`Item `+(t+1)),1),c(`span`,xe,` x`+o(e.qty),1),e.vat_rate>0?(p(),l(`span`,Se,` (`+o(e.vat_rate)+`%) `,1)):s(``,!0)]),c(`span`,Ce,o(Q(e.net_amount)),1)]))),128))]),i[14]||=c(`div`,{class:`border-t border-dashed border-slate-300 my-4`},null,-1),c(`div`,we,[c(`div`,Te,[i[10]||=c(`span`,{class:`text-slate-500`},`Subtotal`,-1),c(`span`,Ee,o(Q(G.value)),1)]),c(`div`,De,[i[11]||=c(`span`,{class:`text-slate-500`},`VAT`,-1),c(`span`,Oe,o(Q(K.value)),1)]),c(`div`,ke,[i[12]||=c(`span`,null,`TOTAL`,-1),c(`span`,null,o(Q(je.value)),1)])]),i[15]||=c(`div`,{class:`text-center mt-6 pt-4 border-t border-dashed border-slate-300`},[c(`p`,{class:`text-xs text-slate-400`},`Thank you for your business!`),c(`p`,{class:`text-xs text-slate-400 mt-1`},`Powered by Seamlessly`)],-1)]),_:1})]),_:1}),m(a(h),{variant:`outline`,onClick:Pe,class:`w-full mt-4 gap-2 no-print`},{default:u(()=>[m(a(re),{class:`w-4 h-4`}),i[16]||=n(` Print Receipt `,-1)]),_:1})])])]))}},[[`__scopeId`,`data-v-6e308ea0`]]);export{P as default};