const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PaymentAllocationSheet-BfT8mFsu.js","assets/index-CTHZVx0Q.js","assets/index-BSM1JQYN.css","assets/useHideOthers-C416Re6d.js","assets/ConfigProvider-BwNXqMge.js","assets/DialogPortal-913ieDuk.js","assets/Teleport-DrGXNRYb.js","assets/utils-BEsFB3CI.js","assets/useId-BEfc-0Pq.js","assets/DialogTitle-BUR1zqy5.js","assets/sheet-CqjRTU1B.js","assets/button-DTHLpYkO.js","assets/AllocationHistory-C7p1SEGg.js"])))=>i.map(i=>d[i]);
import{a as e,i as t,n,o as r,r as i}from"./sheet-CqjRTU1B.js";import{t as a}from"./SelectGroup-d6DuvcVX.js";import{Ai as o,Bi as s,F as c,Fa as l,Gi as u,Hi as d,Hn as ee,Ji as f,Ki as p,La as te,Li as m,Mi as h,Nt as ne,Oa as g,Pa as _,Qn as re,Ra as v,Ui as y,V as b,Vi as x,Wi as S,aa as C,b as ie,ba as w,br as ae,ca as T,da as oe,h as E,ha as se,i as D,ia as ce,l as le,lt as ue,mt as O,n as de,o as k,oa as A,pr as fe,q as pe,qi as j,r as me,t as M,u as N,xa as P,zt as he}from"./index-CTHZVx0Q.js";import{t as F}from"./purify.es-CR14pynC.js";import{n as I,t as ge}from"./DialogContent-DBDLd1Cs.js";import{n as L,r as _e,t as R}from"./DialogTitle-DU64UNVg.js";import{t as ve}from"./DialogFooter-CdocHGcF.js";import{t as z}from"./button-DTHLpYkO.js";import{t as ye}from"./WorkspaceStore-gf1m868h.js";import{t as B}from"./Input-lhwdatZg.js";import{t as be}from"./DynamicIcon-CuHXdgY2.js";import{t as xe}from"./viewRegistry-Mh-A2GPU.js";import{t as V}from"./Label-MW7QlMSj.js";import{t as Se}from"./LinkField-b9J78HXi.js";import{t as Ce}from"./DateField-B6H4tpap.js";import{a as we,i as Te,n as Ee,r as De,t as Oe}from"./SelectValue-DoC6zE2e.js";import{t as H}from"./Textarea-B0oEpfYv.js";import{t as U}from"./badge-DhOUhkIE.js";import{t as W}from"./marked.esm-L-WIQlRx.js";var G={class:`px-4 py-3 bg-stone-50/80 border-b border-stone-200 flex justify-between items-center sticky top-0 z-10`},K={class:`flex items-center gap-3`},ke={class:`p-1.5 bg-stone-100 rounded-lg`},Ae={class:`font-semibold text-stone-900 text-sm tracking-tight`},je={class:`flex items-center gap-2`},q={key:0,class:`p-12 text-center text-stone-400`},Me={class:`w-16 h-16 bg-stone-50 rounded-full flex items-center justify-center mx-auto mb-4 border border-stone-100 group-hover:scale-110 transition-transform duration-300`},Ne={class:`w-full text-sm border-collapse table-fixed min-w-[800px]`},Pe={class:`bg-stone-50/50 text-stone-500 text-left border-b border-stone-100`},Fe={class:`flex items-center gap-1.5`},J={key:0,class:`text-red-500`},Ie={class:`divide-y divide-stone-100`},Le={class:`px-4 py-3 text-stone-400 font-mono text-[10px] text-center align-middle`},Re={key:0},Y={key:1},ze={class:`relative group/input`},X={key:0,class:`absolute left-2 top-1/2 -translate-y-1/2 text-[10px] text-stone-400 font-bold opacity-0 group-focus-within/input:opacity-100 transition-opacity`},Be={key:2},Ve={key:3},He={key:4},Z={key:5,class:`absolute inset-0 pointer-events-none`},Ue={key:6},We={class:`text-stone-400 text-xs truncate block italic px-2`},Ge={class:`px-4 py-3 text-center align-middle`},Q={class:`flex items-center justify-center gap-1`},Ke={key:3,class:`px-4 py-2 bg-stone-50/30 border-t border-stone-100 flex items-center justify-between`},qe={key:0,class:`text-xs font-semibold text-stone-600`},Je={class:`grid grid-cols-2 gap-6 py-4 max-h-[60vh] overflow-y-auto px-1`},Ye={key:0,class:`text-red-500`},Xe={key:0},Ze={key:1},Qe={key:2},$e={key:3},et={key:4},tt={key:5},$={__name:`ChildTableEditor`,props:{fieldname:{type:String,required:!0},options:{type:String,required:!0},label:{type:String,default:`Items`},modelValue:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},defaultTaxPolicy:{type:String,default:null}},emits:[`update:modelValue`,`totalsChanged`],setup(e,{emit:t}){let n=e,r=t,i=g(!1),a=g([]),o=g([]),ee=g({}),f=g(!1),h=g(!1),re=g(-1),C=g({}),ie=0,ae=()=>`new-${++ie}`,oe=s(()=>{let e=a.value.filter(e=>![`parent`,`parenttype`,`parentfield`,`idx`,`name`,`owner`,`docstatus`].includes(e.fieldname)&&!e.hidden&&![`SECTION_BREAK`,`COLUMN_BREAK`,`TAB_BREAK`,`TABLE`].includes(e.fieldtype)),t=e.filter(e=>e.in_list_view);return t.length>0?t:e.slice(0,6)}),E=s(()=>n.options===`InvoiceItem`),D=e=>e.read_only||E.value&&[`amount`,`tax_amount`,`tax_rate`,`net_amount`].includes(e.fieldname),le=e=>e.options?e.options.split(`
`).map(e=>e.trim()).filter(Boolean):[],ue=e=>[`SMALL_TEXT`,`LONG_TEXT`,`TABLE`,`HTML`].includes(e.fieldtype),de=e=>{let t={qty:`80px`,rate:`120px`,amount:`120px`,unit:`80px`,idx:`40px`,product:`180px`,description:`240px`};return t[e.fieldname]?t[e.fieldname]:[`CURRENCY`,`FLOAT`,`INT`].includes(e.fieldtype)?`110px`:e.fieldtype===`DATE`?`160px`:e.fieldtype===`LINK`?`180px`:`1% auto`};function fe(){return o.value.reduce((e,t)=>e+(parseFloat(t.amount)||0),0)}function pe(e){return new Intl.NumberFormat(`en-NG`,{style:`currency`,currency:`NGN`}).format(e||0)}async function me(e){if(!e)return 0;if(ee.value[e]!==void 0)return ee.value[e];try{let t=(await k.get(`/org/doc/TaxPolicy/${encodeURIComponent(e)}`)).data?.rate||0;return ee.value[e]=t,t}catch{return 0}}function M(e){return Math.round((e+2**-52)*100)/100}function N(e){if(!E.value)return;let t=parseFloat(e.qty)||0,n=parseFloat(e.rate)||0,r=parseFloat(e.discount_percent)||0,i=parseFloat(e.tax_rate)||0;e.amount=M(t*n),e.tax_amount=M(e.amount*(i/100));let a=M(e.amount*(r/100));e.net_amount=M(e.amount+e.tax_amount-a)}async function P(e){e.tax_policy?e.tax_rate=await me(e.tax_policy):e.tax_rate=0,N(e)}function F(){if(!E.value)return;let e=o.value.reduce((e,t)=>e+(parseFloat(t.amount)||0),0),t=o.value.reduce((e,t)=>e+(parseFloat(t.tax_amount)||0),0),n=o.value.reduce((e,t)=>e+(parseFloat(t.net_amount)||0),0);r(`totalsChanged`,{grandTotal:e,totalTax:t,totalNet:n})}function ye(){let e={_id:ae()};for(let t of a.value)t.default_value!==void 0&&t.default_value!==null&&(e[t.fieldname]=t.default_value);n.defaultTaxPolicy&&E.value&&(e.tax_policy=n.defaultTaxPolicy,P(e).then(F)),o.value.push(e),$()}function be(e){o.value.splice(e,1),$(),F()}function xe(){confirm(`Are you sure you want to remove all rows?`)&&(o.value=[],$(),F())}async function W(e,t){if(E.value&&t===`product`&&e.product)try{let t=await k.get(`/org/doc/Product/${encodeURIComponent(e.product)}`);t.data&&(e.description=t.data.product_name||t.data.description,e.rate=t.data.standard_rate||0,e.uom=t.data.uom||`Unit`,e.tax_category=t.data.tax_category,e.supply_type=t.data.supply_type,e.vat_applicable=t.data.vat_applicable,e.qty||=1,N(e))}catch(e){console.warn(`Product master lookup failed`,e)}E.value&&t===`tax_policy`?(await P(e),F()):E.value&&[`qty`,`rate`,`discount_percent`,`product`].includes(t)&&(N(e),F()),$()}function $(){let e=o.value.map(e=>{let{_id:t,...n}=e;return n});r(`update:modelValue`,e)}function nt(e){re.value=e,C.value=o.value[e],h.value=!0}function rt(){h.value=!1,C.value&&E.value&&N(C.value),$(),F()}se(()=>n.modelValue,e=>{if(Array.isArray(e)){let t=o.value.map(e=>e.name||e._id).join(`,`),n=e.map(e=>e.name||e._id).join(`,`);t!==n&&(o.value=e.map((e,t)=>({...e,_id:e.name||e._id||`existing-${t}`})),E.value&&setTimeout(()=>{o.value.forEach(e=>P(e)),F()},10))}},{immediate:!0,deep:!0});async function it(){if(n.options){i.value=!0;try{a.value=(await k.get(`/org/doctypes/${encodeURIComponent(n.options)}`,{authorizeRequest:!0,organisationAware:!0})).data?.fields||[]}catch(e){console.error(`Failed to load child schema:`,e)}finally{i.value=!1}}}return ce(()=>{it()}),(t,n)=>(A(),S(`div`,{class:l([`border border-stone-200 rounded-xl overflow-hidden bg-white shadow-sm transition-all duration-200`,{"ring-1 ring-stone-900 border-stone-900":f.value}])},[x(`div`,G,[x(`div`,K,[x(`div`,ke,[j(_(b),{class:`w-4 h-4 text-stone-600`})]),x(`h4`,Ae,v(e.label),1),j(_(U),{variant:`secondary`,class:`rounded-full px-2 py-0 h-5 text-[10px] font-bold bg-stone-200/50 text-stone-600`},{default:w(()=>[p(v(o.value.length)+` `+v(o.value.length===1?`row`:`rows`),1)]),_:1})]),x(`div`,je,[o.value.length>0&&!e.disabled?(A(),d(_(z),{key:0,onClick:xe,type:`button`,variant:`ghost`,size:`sm`,class:`h-8 text-stone-500 hover:text-red-600 rounded-full text-xs font-medium px-3`},{default:w(()=>[j(_(c),{class:`w-3.5 h-3.5 mr-1`}),n[3]||=p(` Clear All `,-1)]),_:1})):y(``,!0),j(_(z),{onClick:ye,type:`button`,size:`sm`,disabled:e.disabled,class:`h-8 bg-stone-900 hover:bg-stone-800 text-white rounded-full text-xs font-semibold px-4 shadow-sm transition-transform active:scale-95`},{default:w(()=>[j(_(O),{class:`w-3.5 h-3.5 mr-1`}),n[4]||=p(` Add Row `,-1)]),_:1},8,[`disabled`])])]),i.value?(A(),S(`div`,q,[j(_(he),{class:`w-6 h-6 animate-spin mx-auto mb-3`}),n[5]||=x(`p`,{class:`text-xs font-medium uppercase tracking-widest opacity-50`},`Initializing Table...`,-1)])):o.value.length?(A(),S(`div`,{key:2,class:`overflow-x-auto relative min-h-[100px]`,onFocusin:n[0]||=e=>f.value=!0,onFocusout:n[1]||=e=>f.value=!1},[x(`table`,Ne,[x(`thead`,Pe,[x(`tr`,null,[n[8]||=x(`th`,{class:`px-4 py-2.5 font-bold uppercase tracking-wider text-[10px] w-12 text-center`},`#`,-1),(A(!0),S(m,null,T(oe.value,e=>(A(),S(`th`,{key:e.fieldname,class:`px-2 py-2.5 font-bold uppercase tracking-wider text-[10px]`,style:te({width:de(e)})},[x(`div`,Fe,[p(v(e.label)+` `,1),e.reqd?(A(),S(`span`,J,`*`)):y(``,!0)])],4))),128)),n[9]||=x(`th`,{class:`px-4 py-2.5 w-24 text-center font-bold uppercase tracking-wider text-[10px]`},`Actions `,-1)])]),x(`tbody`,Ie,[(A(!0),S(m,null,T(o.value,(t,n)=>(A(),S(`tr`,{key:t._id||n,class:`group hover:bg-stone-50/80 transition-colors`},[x(`td`,Le,v(n+1),1),(A(!0),S(m,null,T(oe.value,n=>(A(),S(`td`,{key:n.fieldname,class:`px-2 py-3 align-middle`},[n.fieldtype===`DATA`||n.fieldtype===`TEXT`||n.fieldtype===`SMALL_TEXT`?(A(),S(`div`,Re,[j(_(B),{modelValue:t[n.fieldname],"onUpdate:modelValue":e=>t[n.fieldname]=e,placeholder:n.label,disabled:e.disabled||D(n),class:`h-8 text-xs bg-transparent border-stone-200/50 hover:border-stone-400 focus:bg-white shadow-none rounded-lg`},null,8,[`modelValue`,`onUpdate:modelValue`,`placeholder`,`disabled`])])):[`CURRENCY`,`FLOAT`,`INT`,`PERCENT`].includes(n.fieldtype)?(A(),S(`div`,Y,[x(`div`,ze,[j(_(B),{type:`number`,modelValue:t[n.fieldname],"onUpdate:modelValue":e=>t[n.fieldname]=e,modelModifiers:{number:!0},onInput:e=>W(t,n.fieldname),disabled:e.disabled||D(n),class:`h-8 text-xs text-right pr-2 bg-transparent border-stone-200/50 hover:border-stone-400 focus:bg-white shadow-none rounded-lg [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none`},null,8,[`modelValue`,`onUpdate:modelValue`,`onInput`,`disabled`]),n.fieldtype===`CURRENCY`?(A(),S(`span`,X,`₦`)):y(``,!0)])])):n.fieldtype===`DATE`?(A(),S(`div`,Be,[j(Ce,{modelValue:t[n.fieldname],"onUpdate:modelValue":e=>t[n.fieldname]=e,compact:``,pill:``,disabled:e.disabled||D(n)},null,8,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):n.fieldtype===`SELECT`?(A(),S(`div`,Ve,[j(_(we),{modelValue:t[n.fieldname],"onUpdate:modelValue":e=>t[n.fieldname]=e,disabled:e.disabled||D(n)},{default:w(()=>[j(_(Ee),{class:`h-8 text-xs rounded-full shadow-none bg-transparent border-stone-200/50`},{default:w(()=>[j(_(Oe),{placeholder:n.label},null,8,[`placeholder`])]),_:2},1024),j(_(Te),null,{default:w(()=>[(A(!0),S(m,null,T(le(n),e=>(A(),d(_(De),{key:e,value:e},{default:w(()=>[p(v(e),1)]),_:2},1032,[`value`]))),128))]),_:2},1024)]),_:2},1032,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):n.fieldtype===`LINK`?(A(),S(`div`,He,[j(Se,{modelValue:t[n.fieldname],"onUpdate:modelValue":[e=>t[n.fieldname]=e,e=>W(t,n.fieldname)],doctype:n.options,placeholder:n.label,compact:``,disabled:e.disabled||D(n)},null,8,[`modelValue`,`onUpdate:modelValue`,`doctype`,`placeholder`,`disabled`])])):y(``,!0),E.value&&n.fieldname===`product`?(A(),S(`div`,Z)):[`DATA`,`TEXT`,`SMALL_TEXT`,`CURRENCY`,`FLOAT`,`INT`,`PERCENT`,`DATE`,`SELECT`,`LINK`].includes(n.fieldtype)?y(``,!0):(A(),S(`div`,Ue,[x(`span`,We,v(t[n.fieldname]||`—`),1)]))]))),128)),x(`td`,Ge,[x(`div`,Q,[j(_(z),{variant:`ghost`,size:`sm`,onClick:e=>nt(n),class:`h-7 w-7 p-0 rounded-full text-stone-400 hover:text-stone-900 hover:bg-stone-100`},{default:w(()=>[j(_(ne),{class:`w-3.5 h-3.5`})]),_:1},8,[`onClick`]),j(_(z),{variant:`ghost`,size:`sm`,onClick:e=>be(n),disabled:e.disabled,class:`h-7 w-7 p-0 rounded-full text-stone-300 hover:text-red-500 hover:bg-red-50`},{default:w(()=>[j(_(c),{class:`w-3.5 h-3.5`})]),_:1},8,[`onClick`,`disabled`])])])]))),128))])])],32)):(A(),S(m,{key:1},[e.disabled?y(``,!0):(A(),S(`div`,{key:0,class:`p-16 text-center group cursor-pointer`,onClick:ye},[x(`div`,Me,[j(_(O),{class:`w-8 h-8 text-stone-300 group-hover:text-stone-900 px-0`})]),n[6]||=x(`p`,{class:`text-sm font-medium text-stone-500`},`No items found.`,-1),n[7]||=x(`p`,{class:`text-xs text-stone-400 mt-1`},`Click to add your first row.`,-1)]))],64)),o.value.length>0?(A(),S(`div`,Ke,[n[10]||=u(`<div class="flex items-center gap-4 text-[10px] text-stone-400 font-medium" data-v-6436144a><div class="flex items-center gap-1.5" data-v-6436144a><kbd class="px-1.5 py-0.5 bg-white border border-stone-200 rounded-md text-stone-500" data-v-6436144a>TAB</kbd> Next Field </div><div class="flex items-center gap-1.5" data-v-6436144a><kbd class="px-1.5 py-0.5 bg-white border border-stone-200 rounded-md text-stone-500" data-v-6436144a>ENTER</kbd> New Row </div></div>`,1),E.value?(A(),S(`div`,qe,` Subtotal: `+v(pe(fe())),1)):y(``,!0)])):y(``,!0),j(_(I),{open:h.value,"onUpdate:open":n[2]||=e=>h.value=e},{default:w(()=>[j(_(ge),{class:`max-w-2xl`},{default:w(()=>[j(_(L),null,{default:w(()=>[j(_(R),null,{default:w(()=>[p(`Edit Row #`+v(re.value+1),1)]),_:1}),j(_(_e),null,{default:w(()=>[...n[11]||=[p(`Enter detailed information for this line item.`,-1)]]),_:1})]),_:1}),x(`div`,Je,[(A(!0),S(m,null,T(a.value,e=>(A(),S(`div`,{key:e.fieldname,class:l([`space-y-2`,{"col-span-2":ue(e)}])},[j(_(V),{class:`text-xs font-bold uppercase tracking-wider text-stone-500`},{default:w(()=>[p(v(e.label)+` `,1),e.reqd?(A(),S(`span`,Ye,`*`)):y(``,!0)]),_:2},1024),e.fieldtype===`DATA`||e.fieldtype===`TEXT`?(A(),S(`div`,Xe,[j(_(B),{modelValue:C.value[e.fieldname],"onUpdate:modelValue":t=>C.value[e.fieldname]=t,disabled:D(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):e.fieldtype===`SMALL_TEXT`||e.fieldtype===`LONG_TEXT`?(A(),S(`div`,Ze,[j(_(H),{modelValue:C.value[e.fieldname],"onUpdate:modelValue":t=>C.value[e.fieldname]=t,rows:`3`,disabled:D(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):[`CURRENCY`,`FLOAT`,`INT`].includes(e.fieldtype)?(A(),S(`div`,Qe,[j(_(B),{type:`number`,modelValue:C.value[e.fieldname],"onUpdate:modelValue":t=>C.value[e.fieldname]=t,modelModifiers:{number:!0},onInput:t=>W(C.value,e.fieldname),disabled:D(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`onInput`,`disabled`])])):e.fieldtype===`DATE`?(A(),S(`div`,$e,[j(Ce,{modelValue:C.value[e.fieldname],"onUpdate:modelValue":t=>C.value[e.fieldname]=t,disabled:D(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):e.fieldtype===`SELECT`?(A(),S(`div`,et,[j(_(we),{modelValue:C.value[e.fieldname],"onUpdate:modelValue":t=>C.value[e.fieldname]=t,disabled:D(e)},{default:w(()=>[j(_(Ee),null,{default:w(()=>[j(_(Oe),{placeholder:`Select...`})]),_:1}),j(_(Te),null,{default:w(()=>[(A(!0),S(m,null,T(le(e),e=>(A(),d(_(De),{key:e,value:e},{default:w(()=>[p(v(e),1)]),_:2},1032,[`value`]))),128))]),_:2},1024)]),_:2},1032,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):e.fieldtype===`LINK`?(A(),S(`div`,tt,[j(Se,{modelValue:C.value[e.fieldname],"onUpdate:modelValue":[t=>C.value[e.fieldname]=t,t=>W(C.value,e.fieldname)],doctype:e.options,disabled:D(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`doctype`,`disabled`])])):y(``,!0)],2))),128))]),j(_(ve),null,{default:w(()=>[j(_(z),{onClick:rt,class:`rounded-full bg-stone-900`},{default:w(()=>[...n[12]||=[p(`Done Editing`,-1)]]),_:1})]),_:1})]),_:1})]),_:1},8,[`open`])],2))}},nt=D($,[[`__scopeId`,`data-v-6436144a`]]),rt=[`innerHTML`],it={__name:`DocumentationSheet`,props:{open:{type:Boolean,default:!1},title:{type:String,default:`Documentation`},content:{type:String,default:``}},emits:[`update:open`],setup(a,{emit:o}){let c=a,l=o,u=s(()=>{if(!c.content)return`<p class="text-gray-400 italic">No documentation available.</p>`;let e=W.parse(c.content);return F.sanitize(e)});return(o,s)=>(A(),d(_(r),{open:a.open,"onUpdate:open":s[0]||=e=>l(`update:open`,e)},{default:w(()=>[j(_(e),{side:`right`,class:`w-[400px] sm:w-[540px] overflow-y-auto`},{default:w(()=>[j(_(i),null,{default:w(()=>[j(_(n),{class:`flex items-center gap-2`},{default:w(()=>[j(_(fe),{class:`w-5 h-5`}),p(` `+v(a.title),1)]),_:1}),j(_(t),null,{default:w(()=>[...s[1]||=[p(` Reference documentation for this document type. `,-1)]]),_:1})]),_:1}),x(`div`,{class:`mt-6 prose prose-sm max-w-none`,innerHTML:u.value},null,8,rt)]),_:1})]),_:1},8,[`open`]))}},at=D(it,[[`__scopeId`,`data-v-ac8cb5c0`]]),ot={key:1,class:`h-full flex flex-col bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] to-slate-100/50 from-stone-100/60 from-5%`},st={class:`flex-none px-6 py-4 bg-white border-b border-gray-200 flex items-center justify-between sticky top-0 z-10`},ct={class:`flex items-center space-x-4`},lt={class:`flex items-center gap-2`},ut={class:`text-sm font-medium text-gray-500 uppercase tracking-wider`},dt={class:`text-xl font-bold text-gray-900 mt-1`},ft={class:`flex items-center space-x-3`},pt=[`disabled`],mt=[`disabled`],ht={class:`flex items-center gap-3`},gt={key:0,class:`flex items-center gap-2`},_t=[`disabled`],vt=[`disabled`],yt={key:1,class:`fixed inset-0 bg-black/50 flex items-center justify-center z-50`},bt={class:`bg-white rounded-xl shadow-xl w-full max-w-md p-6 m-4`},xt={class:`flex justify-end gap-2 mt-4`},St=[`disabled`],Ct={class:`flex-1 overflow-auto p-6`},wt={key:0,class:`flex justify-center items-center h-64`},Tt={key:1,class:`max-w-5xl mx-auto space-y-6`},Et={class:`rounded-sm p-6 pt-8`},Dt={class:`grid grid-cols-1 md:grid-cols-2 gap-6`},Ot={class:`block text-sm font-medium text-gray-700`},kt={key:0,class:`text-red-500`},At={key:0},jt={key:1},Mt={key:2},Nt={key:3},Pt={key:4},Ft=[`onUpdate:modelValue`,`placeholder`,`disabled`],It={key:5},Lt={class:`flex items-center space-x-2 cursor-pointer mt-1`},Rt=[`onUpdate:modelValue`,`disabled`],zt={class:`text-sm text-gray-600`},Bt={key:6},Vt={key:7},Ht={class:`flex items-center gap-2`},Ut=[`onUpdate:modelValue`,`disabled`],Wt=[`onUpdate:modelValue`,`disabled`],Gt={key:8},Kt={class:`flex items-center gap-2`},qt={class:`h-10 w-10 flex items-center justify-center rounded border border-gray-300 bg-gray-50`},Jt=[`onUpdate:modelValue`,`disabled`,`placeholder`],Yt={key:9,class:`p-2 bg-gray-50 border border-gray-100 rounded text-sm text-gray-600`},Xt={key:10,class:`p-2 bg-gray-50 border border-gray-200 rounded text-xs text-gray-500`},Zt={key:11,class:`text-[11px] text-gray-400 mt-1 italic px-1`},Qt={key:0,class:`mt-8`},$t={__name:`DocForm`,props:{doctype:{type:String,default:null},name:{type:String,default:null},isNew:{type:Boolean,default:void 0},isEmbedded:{type:Boolean,default:!1}},emits:[`saved`],setup(e,{emit:t}){let n=f(()=>M(()=>import(`./PaymentAllocationSheet-BfT8mFsu.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),r=f(()=>M(()=>import(`./AllocationHistory-C7p1SEGg.js`),__vite__mapDeps([12,1,2]))),{toast:i}=E(),c=ye(),u=e,te=de(),ne=me(),b=s(()=>u.doctype||te.params.doctype),D=s(()=>u.name||te.params.name),O=s(()=>u.isNew===void 0?D.value===`new`:u.isNew),fe=s(()=>{if(!b.value)return null;let e=xe(b.value,`form`);return e?f(e):null}),F=g({}),I=g({}),ge=g(!0),L=g(!1),_e=g(!1);g(!1),g(!1),g(!1);let R=g(!1),ve=g(null),z=g(!1),V=g(!1),H=g(null),U=g(!1),W=g(!1),G=g(!1),K=g(``),ke=new Set([`DATA`,`CURRENCY`,`FLOAT`,`INT`,`PERCENT`,`PHONE`,`EMAIL`,`PASSWORD`,`ATTACH`,`ATTACH_IMAGE`,`URL`]),Ae=new Set([`CURRENCY`,`FLOAT`,`PERCENT`]),je=new Set([`TABLE`,`SECTION_BREAK`,`COLUMN_BREAK`]),q=s(()=>(F.value.fields||[]).map(e=>({...e,_isDataType:ke.has(e.fieldtype),_isNumericType:Ae.has(e.fieldtype),_inputType:Le(e.fieldtype),_parsedOptions:e.options?e.options.split(`
`):[],_step:Ae.has(e.fieldtype)?`0.01`:`1`,_placeholder:e.placeholder||`Select ${e.label}...`}))),Me=s(()=>q.value.filter(e=>!je.has(e.fieldtype)&&!e.hidden)),Ne=s(()=>q.value.filter(e=>e.fieldtype===`TABLE`&&!e.hidden)),Pe=s(()=>{let e=new Map;for(let t of q.value)e.set(t.fieldname,t);return e}),Fe=s(()=>{let e=new Set,t=I.value.docstatus||0;for(let n of q.value)(n.read_only||t>0&&!n.allow_on_submit)&&e.add(n.fieldname);return e}),J=e=>Fe.value.has(e.fieldname),Ie=s(()=>(I.value.docstatus||0)>0),Le=e=>e===`INT`||e===`FLOAT`||e===`CURRENCY`?`number`:e===`DATE`?`date`:e===`PASSWORD`?`password`:`text`,Re=e=>({Draft:`bg-gray-100 text-gray-800`,Submitted:`bg-blue-100 text-blue-800`,Paid:`bg-green-100 text-green-800`,"Partially Paid":`bg-yellow-100 text-yellow-800`,Overdue:`bg-red-100 text-red-800`,Cancelled:`bg-red-100 text-red-800`,Active:`bg-green-100 text-green-800`,Inactive:`bg-gray-100 text-gray-500`,Open:`bg-blue-100 text-blue-800`,Accepted:`bg-green-100 text-green-800`,Rejected:`bg-red-100 text-red-800`,Expired:`bg-gray-100 text-gray-500`,Confirmed:`bg-blue-100 text-blue-800`,Completed:`bg-green-100 text-green-800`,Pending:`bg-yellow-100 text-yellow-800`,Approved:`bg-green-100 text-green-800`})[e]||`bg-gray-100 text-gray-800`,Y=async()=>{ge.value=!0;try{if(F.value=(await k.get(`/org/doctypes/${b.value}`,{authorizeRequest:!0,organisationAware:!0})).data||{},O.value){let e={};if(F.value.fields&&F.value.fields.forEach(t=>{t.default_value&&(e[t.fieldname]=t.default_value)}),I.value=e,b.value===`Sales Invoice`)try{let e=await k.get(`/org/settlement-accounts/primary`,{authorizeRequest:!0,organisationAware:!0});e?.data?.reference&&(I.value.settlement_account=e.data.reference)}catch{console.log(`No primary settlement account configured`)}}else{if(!D.value){console.warn(`Cannot fetch document: docName is undefined`);return}I.value=(await k.get(`/org/doc/${encodeURIComponent(b.value)}/${encodeURIComponent(D.value)}`,{authorizeRequest:!0,organisationAware:!0})).data||{}}}catch(e){console.error(e);let t=e.response?.data?.message||e.message;i({title:`Failed to load`,description:t,variant:`destructive`}),I.value||={}}finally{ge.value=!1}O.value||ze()};async function ze(){if(!(O.value||!b.value||!D.value))try{let e=(await k.get(`/org/doc/Approval%20Pipeline`,{params:{filters:JSON.stringify({target_doctype:b.value,target_document:D.value,status:`Pending`}),limit:1}})).data?.data||[];if(e.length>0){let t=e[0],n=(t.items||[]).find(e=>e.status===`Pending`);H.value=n?{...n,pipeline_name:t.name,target_doctype:t.target_doctype,target_document:t.target_document}:null}else H.value=null}catch(e){console.error(`Failed to fetch pending approval:`,e)}}let X=s(()=>{if(!H.value)return!1;let e=N();return H.value.assigned_to===e.email});async function Be(){if(!(!H.value||U.value)){U.value=!0;try{await k.patch(`/org/doc/Approval%20Pipeline/${encodeURIComponent(H.value.pipeline_name)}`,{data:{items:[{name:H.value.name,status:`Approved`,approver:Q.email,decision_time:new Date().toISOString()}]}}),i({title:`Approved`,description:`Document has been approved successfully.`,variant:`success`}),H.value=null,await Y()}catch(e){console.error(`Failed to approve:`,e),i({title:`Approval Failed`,description:e.response?.data?.message||``,variant:`destructive`})}finally{U.value=!1}}}async function Ve(){if(!(!H.value||W.value)){W.value=!0;try{await k.patch(`/org/doc/Approval%20Pipeline/${encodeURIComponent(H.value.pipeline_name)}`,{data:{items:[{name:H.value.name,status:`Rejected`,approver:Q.email,comments:K.value,decision_time:new Date().toISOString()}]}}),i({title:`Rejected`,description:`Document has been rejected.`,variant:`success`}),H.value=null,G.value=!1,K.value=``,await Y()}catch(e){console.error(`Failed to reject:`,e),i({title:`Rejection Failed`,description:e.response?.data?.message||``,variant:`destructive`})}finally{W.value=!1}}}function He(e){b.value===`Sales Invoice`&&(I.value.grand_total=e.totalNet,I.value.total_tax=e.totalTax,O.value&&(I.value.outstanding_amount=e.totalNet))}let Z=g(null);function Ue(){!O.value||!b.value||(Z.value&&clearTimeout(Z.value),Z.value=setTimeout(()=>{c.saveFormData(b.value,I.value,!0,null)},500))}se(I,()=>{Ue()},{deep:!0});let We=t,Ge=async()=>{L.value=!0;try{let e,t={data:I.value,authorizeRequest:!0,organisationAware:!0};e=O.value?await k.post(`/org/doc/${encodeURIComponent(b.value)}`,t):await k.patch(`/org/doc/${encodeURIComponent(b.value)}/${encodeURIComponent(D.value)}`,t);let n=e?.data;if(!n)throw Error(`Server returned empty data`);I.value=n,We(`saved`,n),i({title:O.value?`Created`:`Saved`,description:`${F.value.name} has been ${O.value?`created`:`saved`} successfully.`,variant:`success`}),b.value&&c.clearFormData(b.value,O.value,O.value?null:D.value),c.notifyDocSaved(b.value,n.name),O.value&&!u.name&&!u.isEmbedded&&ne.replace(`/app/${b.value}/${n.name}`)}catch(e){console.error(e);let t=e.response?.data?.message||e.message;i({title:`Error saving`,description:t,variant:`destructive`})}finally{L.value=!1}};se(()=>te.params.name,Y),se(D,(e,t)=>{e&&e!==t&&Y()}),ce(()=>{if(O.value&&b.value){let e=c.getFormData(b.value,!0,null);e&&e.data&&(I.value={...e.data})}Y()});let Q=le();s(()=>{if(!F.value.is_submittable||I.value.docstatus!==0)return!1;let e=F.value.config?.workflow;return e?!(e.submit_roles&&e.submit_roles.length>0&&(!Q.role||!e.submit_roles.includes(Q.role))):!0}),g(!1);let Ke=async()=>{R.value=!0;try{I.value.status=`Queued`,I.value.error_log=``,await k.patch(`/org/doc/Notification/${encodeURIComponent(D.value)}`,{data:{status:`Queued`,error_log:``},authorizeRequest:!0,organisationAware:!0}),i({title:`Retry Queued`,description:`Notification has been queued for retry.`,variant:`default`})}catch(e){console.error(e),i({title:`Retry Failed`,description:e.response?.data?.message||e.message,variant:`destructive`})}finally{R.value=!1}},qe=e=>{ve.value&&!ve.value.contains(e.target)&&(_e.value=!1)};return ce(()=>document.addEventListener(`click`,qe)),C(()=>document.removeEventListener(`click`,qe)),(t,i)=>(A(),S(m,null,[fe.value?(A(),d(oe(fe.value),{key:0,doctype:b.value,name:D.value,isNew:O.value},null,8,[`doctype`,`name`,`isNew`])):(A(),S(`div`,ot,[x(`header`,st,[x(`div`,ct,[e.isEmbedded?y(``,!0):(A(),S(`button`,{key:0,onClick:i[0]||=e=>t.$router.back(),class:`p-2 hover:bg-gray-100 rounded-full text-gray-500`},[j(_(ae),{class:`w-5 h-5`})])),x(`div`,{class:l({"pl-0":e.isEmbedded})},[x(`div`,lt,[x(`span`,ut,v(F.value.name),1),I.value.status?(A(),S(`span`,{key:0,class:l([`px-2 py-0.5 rounded text-xs font-bold`,Re(I.value.status)])},v(I.value.status),3)):y(``,!0)]),x(`h1`,dt,v(O.value?`New `+F.value.name:I.value[F.value.title_field]||I.value.name),1)],2)]),x(`div`,ft,[F.value.documentation?(A(),S(`button`,{key:0,onClick:i[1]||=e=>z.value=!0,class:`p-2 text-gray-500 hover:bg-gray-100 rounded-full transition-colors`,title:`View Documentation`},[j(_(ee),{class:`w-5 h-5`})])):y(``,!0),b.value===`Payment Record`&&!O.value?(A(),S(`button`,{key:1,onClick:i[2]||=e=>V.value=!0,class:`px-4 py-2 bg-blue-600 text-white rounded-full text-sm font-medium hover:bg-blue-700 transition-colors flex items-center gap-2 shadow-sm`},[j(_(pe),{class:`w-4 h-4`}),i[8]||=p(` Allocate `,-1)])):y(``,!0),b.value===`Notification`&&I.value.status===`Failed`?(A(),S(`button`,{key:2,onClick:Ke,disabled:R.value,class:`px-5 py-2 bg-amber-500 text-white rounded-full text-sm font-medium hover:bg-amber-600 transition-colors flex items-center gap-2 shadow-sm`},[R.value?(A(),d(_(he),{key:1,class:`w-4 h-4 animate-spin`})):(A(),d(_(ue),{key:0,class:`w-4 h-4`})),i[9]||=p(` Retry `,-1)],8,pt)):y(``,!0),x(`button`,{onClick:Ge,disabled:L.value,class:`px-6 py-2 bg-black text-white rounded-full text-sm font-medium hover:bg-gray-900 transition-colors flex items-center gap-2 shadow-sm`},[L.value?(A(),d(_(he),{key:0,class:`w-4 h-4 animate-spin`})):y(``,!0),p(` `+v(O.value?`Create`:`Save`),1)],8,mt)])]),H.value?(A(),S(`div`,{key:0,class:l([`mx-6 mt-4 p-4 rounded-xl border flex items-center justify-between gap-4`,X.value?`bg-amber-50 border-amber-200`:`bg-gray-50 border-gray-200`])},[x(`div`,ht,[x(`div`,{class:l([`w-10 h-10 rounded-full flex items-center justify-center`,X.value?`bg-amber-500`:`bg-gray-400`])},[j(_(re),{class:`w-5 h-5 text-white`})],2),x(`div`,null,[x(`h3`,{class:l([`font-semibold`,X.value?`text-amber-900`:`text-gray-700`])},v(X.value?`Approval Required`:`Pending Approval`),3),x(`p`,{class:l([`text-sm`,X.value?`text-amber-700`:`text-gray-500`])},v(H.value.stage_name||`Approval`)+` • Assigned to `+v(H.value.assigned_to),3)])]),X.value?(A(),S(`div`,gt,[x(`button`,{onClick:Be,disabled:U.value,class:`px-4 py-2 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-1`},[j(_(re),{class:`w-4 h-4`}),i[10]||=p(` Approve `,-1)],8,_t),x(`button`,{onClick:i[3]||=e=>G.value=!0,disabled:W.value,class:`px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-1`},[j(_(ie),{class:`w-4 h-4`}),i[11]||=p(` Reject `,-1)],8,vt)])):y(``,!0)],2)):y(``,!0),G.value?(A(),S(`div`,yt,[x(`div`,bt,[i[12]||=x(`h3`,{class:`text-lg font-semibold text-gray-900 mb-4`},`Reject Document`,-1),P(x(`textarea`,{"onUpdate:modelValue":i[4]||=e=>K.value=e,rows:`3`,placeholder:`Reason for rejection (optional)`,class:`w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500`},null,512),[[h,K.value]]),x(`div`,xt,[x(`button`,{onClick:i[5]||=e=>{G.value=!1,K.value=``},class:`px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-colors`},` Cancel `),x(`button`,{onClick:Ve,disabled:W.value,class:`px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors`},` Reject `,8,St)])])])):y(``,!0),x(`div`,Ct,[ge.value?(A(),S(`div`,wt,[...i[13]||=[x(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-black`},null,-1)]])):(A(),S(`div`,Tt,[x(`div`,Et,[x(`div`,Dt,[(A(!0),S(m,null,T(Me.value,e=>(A(),S(`div`,{key:e.fieldname,class:l([`space-y-1`,{"col-span-2":e.fieldtype===`TEXT`||e.fieldtype===`LONG_TEXT`||e.fieldtype===`TABLE`||e.fieldtype===`HTML`}])},[x(`label`,Ot,[p(v(e.label)+` `,1),e.reqd?(A(),S(`span`,kt,`*`)):y(``,!0)]),e._isDataType?(A(),S(`div`,At,[j(B,{class:`bg-white/40`,type:e._inputType,modelValue:I.value[e.fieldname],"onUpdate:modelValue":t=>I.value[e.fieldname]=t,placeholder:e.placeholder,disabled:J(e),step:e._step},null,8,[`type`,`modelValue`,`onUpdate:modelValue`,`placeholder`,`disabled`,`step`])])):e.fieldtype===`SELECT`?(A(),S(`div`,jt,[j(_(we),{modelValue:I.value[e.fieldname],"onUpdate:modelValue":t=>I.value[e.fieldname]=t,disabled:J(e)},{default:w(()=>[j(_(Ee),{class:`bg-white/40`},{default:w(()=>[j(_(Oe),{placeholder:e._placeholder},null,8,[`placeholder`])]),_:2},1024),j(_(Te),null,{default:w(()=>[j(_(a),null,{default:w(()=>[(A(!0),S(m,null,T(e._parsedOptions,e=>(A(),d(_(De),{key:e,value:e},{default:w(()=>[p(v(e),1)]),_:2},1032,[`value`]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):e.fieldtype===`DATE`?(A(),S(`div`,Mt,[j(Ce,{modelValue:I.value[e.fieldname],"onUpdate:modelValue":t=>I.value[e.fieldname]=t,placeholder:e.placeholder,disabled:J(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`placeholder`,`disabled`])])):[`DATETIME`,`TIME`].includes(e.fieldtype)?(A(),S(`div`,Nt,[j(B,{class:`bg-white/40`,type:e.fieldtype===`TIME`?`time`:`datetime-local`,modelValue:I.value[e.fieldname],"onUpdate:modelValue":t=>I.value[e.fieldname]=t,disabled:J(e)},null,8,[`type`,`modelValue`,`onUpdate:modelValue`,`disabled`])])):[`TEXT`,`SMALL_TEXT`,`LONG_TEXT`,`HTML`,`JSON`].includes(e.fieldtype)?(A(),S(`div`,Pt,[P(x(`textarea`,{class:`flex min-h-[80px] w-full rounded-xl border border-input bg-white/40 px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all focus:ring-black/5`,"onUpdate:modelValue":t=>I.value[e.fieldname]=t,placeholder:e.placeholder,disabled:J(e),rows:`3`},null,8,Ft),[[h,I.value[e.fieldname]]])])):e.fieldtype===`CHECKBOX`?(A(),S(`div`,It,[x(`label`,Lt,[P(x(`input`,{type:`checkbox`,"onUpdate:modelValue":t=>I.value[e.fieldname]=t,disabled:J(e),class:`w-4 h-4 text-black rounded border-gray-300 focus:ring-black`},null,8,Rt),[[o,I.value[e.fieldname]]]),x(`span`,zt,v(e.label),1)])])):e.fieldtype===`LINK`?(A(),S(`div`,Bt,[e.meta?.link_doctype_field?(A(),S(m,{key:0},[I.value[e.meta.link_doctype_field]?(A(),d(Se,{modelValue:I.value[e.fieldname],"onUpdate:modelValue":t=>I.value[e.fieldname]=t,doctype:I.value[e.meta.link_doctype_field],label:e.label,placeholder:e._placeholder,disabled:J(e),key:`${e.fieldname}-${I.value[e.meta.link_doctype_field]}`},null,8,[`modelValue`,`onUpdate:modelValue`,`doctype`,`label`,`placeholder`,`disabled`])):(A(),d(B,{key:1,type:`text`,disabled:``,placeholder:`Select ${Pe.value.get(e.meta.link_doctype_field)?.label||`DocType`} first...`,class:`w-full bg-gray-100 border border-gray-200 rounded-full text-gray-400 cursor-not-allowed`},null,8,[`placeholder`]))],64)):(A(),d(Se,{key:1,modelValue:I.value[e.fieldname],"onUpdate:modelValue":t=>I.value[e.fieldname]=t,doctype:e.options,label:e.label,placeholder:e._placeholder,disabled:J(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`doctype`,`label`,`placeholder`,`disabled`]))])):e.fieldtype===`COLOR`?(A(),S(`div`,Vt,[x(`div`,Ht,[P(x(`input`,{type:`color`,"onUpdate:modelValue":t=>I.value[e.fieldname]=t,disabled:J(e),class:`h-10 w-10 p-1 rounded border border-gray-300 shadow-sm`},null,8,Ut),[[h,I.value[e.fieldname]]]),P(x(`input`,{type:`text`,"onUpdate:modelValue":t=>I.value[e.fieldname]=t,disabled:J(e),class:`flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-black outline-none transition-all`},null,8,Wt),[[h,I.value[e.fieldname]]])])])):e.fieldtype===`ICON`?(A(),S(`div`,Gt,[x(`div`,Kt,[x(`div`,qt,[j(be,{name:I.value[e.fieldname]||`Layers`,class:`size-5 text-gray-600`},null,8,[`name`])]),P(x(`input`,{type:`text`,"onUpdate:modelValue":t=>I.value[e.fieldname]=t,disabled:J(e),placeholder:e.placeholder||`Enter Lucide icon name (e.g., Bell, FileText)`,class:`flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-black outline-none transition-all`},null,8,Jt),[[h,I.value[e.fieldname]]])])])):e.fieldtype===`READ_ONLY`?(A(),S(`div`,Yt,v(I.value[e.fieldname]||`-`),1)):(A(),S(`div`,Xt,` Unsupported field: `+v(e.fieldtype),1)),e.description?(A(),S(`p`,Zt,v(e.description),1)):y(``,!0)],2))),128))])]),(A(!0),S(m,null,T(Ne.value,e=>(A(),S(`div`,{key:e.fieldname,class:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden p-4`},[j(nt,{fieldname:e.fieldname,options:e.options,label:e.label,modelValue:I.value[e.fieldname],"onUpdate:modelValue":t=>I.value[e.fieldname]=t,onTotalsChanged:He,disabled:Ie.value},null,8,[`fieldname`,`options`,`label`,`modelValue`,`onUpdate:modelValue`,`disabled`])]))),128)),b.value===`Sales Invoice`&&!O.value?(A(),S(`div`,Qt,[j(_(r),{targetType:b.value,targetId:D.value},null,8,[`targetType`,`targetId`])])):y(``,!0)]))])])),b.value===`Payment Record`?(A(),d(_(n),{key:2,open:V.value,"onUpdate:open":i[6]||=e=>V.value=e,payment:I.value,onRefresh:Y},null,8,[`open`,`payment`])):y(``,!0),j(at,{open:z.value,"onUpdate:open":i[7]||=e=>z.value=e,title:F.value.name,content:F.value.documentation},null,8,[`open`,`title`,`content`])],64))}};export{$t as t};