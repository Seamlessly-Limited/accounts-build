const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PaymentAllocationSheet-CXNT0FVz.js","assets/index-Caanq2Pw.js","assets/index-CJsvxZRO.css","assets/useHideOthers-BZr43-2a.js","assets/ConfigProvider-CjeiZORM.js","assets/DialogPortal-CwfqAz4S.js","assets/Teleport-kyzT_9hu.js","assets/utils-DUPUPfs8.js","assets/useId-DfGyiNma.js","assets/DialogTitle-BuJgoH9Z.js","assets/sheet-zX6i6iKt.js","assets/button-ByjIr43L.js","assets/AllocationHistory-B4gU44Kv.js"])))=>i.map(i=>d[i]);
import{a as e,i as t,n,o as r,r as i}from"./sheet-zX6i6iKt.js";import{t as a}from"./SelectGroup-DaiXjPR2.js";import{Ai as o,Bi as s,Bt as c,F as l,Fa as u,Gi as d,Hi as f,Hn as ee,Ji as p,Ki as m,La as te,Li as h,Mi as g,Oa as _,Pa as v,Pt as ne,Qn as re,Ra as y,Ui as b,V as x,Vi as S,Wi as C,aa as w,b as ie,ba as T,br as ae,ca as E,da as oe,h as D,ha as se,ht as O,i as k,ia as ce,l as le,n as ue,o as A,oa as j,pr as de,q as fe,qi as M,r as pe,t as me,u as N,ut as P,xa as F}from"./index-Caanq2Pw.js";import{t as I}from"./purify.es-C6pmr44S.js";import{n as L,t as he}from"./DialogContent-CWtdQqVs.js";import{n as R,r as ge,t as z}from"./DialogTitle-Cxe_WBC-.js";import{t as _e}from"./DialogFooter-DAClagmg.js";import{t as B}from"./button-ByjIr43L.js";import{t as ve}from"./WorkspaceStore-c1j8aQzy.js";import{t as V}from"./Input-BqTp7zeg.js";import{t as ye}from"./DynamicIcon-CfLEwZu5.js";import{t as be}from"./viewRegistry-Cbsgq95k.js";import{t as xe}from"./Label-DEhRXbRt.js";import{t as Se}from"./LinkField-B4FwLh6U.js";import{t as Ce}from"./DateField-CmAxNkWw.js";import{a as we,i as Te,n as Ee,r as De,t as Oe}from"./SelectValue-BiNo_ZDO.js";import{t as H}from"./Textarea-CdyDYW_V.js";import{t as U}from"./badge-DQofQxku.js";import{t as W}from"./marked.esm-nzyc4KJ4.js";var G={class:`px-4 py-3 bg-stone-50/80 border-b border-stone-200 flex justify-between items-center sticky top-0 z-10`},K={class:`flex items-center gap-3`},ke={class:`p-1.5 bg-stone-100 rounded-lg`},Ae={class:`font-semibold text-stone-900 text-sm tracking-tight`},je={class:`flex items-center gap-2`},q={key:0,class:`p-12 text-center text-stone-400`},Me={class:`w-16 h-16 bg-stone-50 rounded-full flex items-center justify-center mx-auto mb-4 border border-stone-100 group-hover:scale-110 transition-transform duration-300`},Ne={class:`w-full text-sm border-collapse table-fixed min-w-[800px]`},Pe={class:`bg-stone-50/50 text-stone-500 text-left border-b border-stone-100`},Fe={class:`flex items-center gap-1.5`},J={key:0,class:`text-red-500`},Ie={class:`divide-y divide-stone-100`},Le={class:`px-4 py-3 text-stone-400 font-mono text-[10px] text-center align-middle`},Re={key:0},Y={key:1},ze={class:`relative group/input`},X={key:0,class:`absolute left-2 top-1/2 -translate-y-1/2 text-[10px] text-stone-400 font-bold opacity-0 group-focus-within/input:opacity-100 transition-opacity`},Be={key:2},Ve={key:3},He={key:4},Z={key:5,class:`absolute inset-0 pointer-events-none`},Ue={key:6},We={class:`text-stone-400 text-xs truncate block italic px-2`},Ge={class:`px-4 py-3 text-center align-middle`},Q={class:`flex items-center justify-center gap-1`},Ke={key:3,class:`px-4 py-2 bg-stone-50/30 border-t border-stone-100 flex items-center justify-between`},qe={key:0,class:`text-xs font-semibold text-stone-600`},Je={class:`grid grid-cols-2 gap-6 py-4 max-h-[60vh] overflow-y-auto px-1`},Ye={key:0,class:`text-red-500`},Xe={key:0},Ze={key:1},Qe={key:2},$e={key:3},et={key:4},tt={key:5},$={__name:`ChildTableEditor`,props:{fieldname:{type:String,required:!0},options:{type:String,required:!0},label:{type:String,default:`Items`},modelValue:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},defaultTaxPolicy:{type:String,default:null}},emits:[`update:modelValue`,`totalsChanged`],setup(e,{emit:t}){let n=e,r=t,i=_(!1),a=_([]),o=_([]),ee=_({}),p=_(!1),g=_(!1),re=_(-1),w=_({}),ie=0,ae=()=>`new-${++ie}`,oe=s(()=>{let e=a.value.filter(e=>![`parent`,`parenttype`,`parentfield`,`idx`,`name`,`owner`,`docstatus`].includes(e.fieldname)&&!e.hidden&&![`SECTION_BREAK`,`COLUMN_BREAK`,`TAB_BREAK`,`TABLE`].includes(e.fieldtype)),t=e.filter(e=>e.in_list_view);return t.length>0?t:e.slice(0,6)}),D=s(()=>n.options===`InvoiceItem`),k=e=>e.read_only||D.value&&[`amount`,`tax_amount`,`tax_rate`,`net_amount`].includes(e.fieldname),le=e=>e.options?e.options.split(`
`).map(e=>e.trim()).filter(Boolean):[],ue=e=>[`SMALL_TEXT`,`LONG_TEXT`,`TABLE`,`HTML`].includes(e.fieldtype),de=e=>{let t={qty:`80px`,rate:`120px`,amount:`120px`,unit:`80px`,idx:`40px`,product:`180px`,description:`240px`};return t[e.fieldname]?t[e.fieldname]:[`CURRENCY`,`FLOAT`,`INT`].includes(e.fieldtype)?`110px`:e.fieldtype===`DATE`?`160px`:e.fieldtype===`LINK`?`180px`:`1% auto`};function fe(){return o.value.reduce((e,t)=>e+(parseFloat(t.amount)||0),0)}function pe(e){return new Intl.NumberFormat(`en-NG`,{style:`currency`,currency:`NGN`}).format(e||0)}async function me(e){if(!e)return 0;if(ee.value[e]!==void 0)return ee.value[e];try{let t=(await A.get(`/org/doc/TaxPolicy/${encodeURIComponent(e)}`)).data?.rate||0;return ee.value[e]=t,t}catch{return 0}}function N(e){return Math.round((e+2**-52)*100)/100}function P(e){if(!D.value)return;let t=parseFloat(e.qty)||0,n=parseFloat(e.rate)||0,r=parseFloat(e.discount_percent)||0,i=parseFloat(e.tax_rate)||0;e.amount=N(t*n),e.tax_amount=N(e.amount*(i/100));let a=N(e.amount*(r/100));e.net_amount=N(e.amount+e.tax_amount-a)}async function F(e){e.tax_policy?e.tax_rate=await me(e.tax_policy):e.tax_rate=0,P(e)}function I(){if(!D.value)return;let e=o.value.reduce((e,t)=>e+(parseFloat(t.amount)||0),0),t=o.value.reduce((e,t)=>e+(parseFloat(t.tax_amount)||0),0),n=o.value.reduce((e,t)=>e+(parseFloat(t.net_amount)||0),0);r(`totalsChanged`,{grandTotal:e,totalTax:t,totalNet:n})}function ve(){let e={_id:ae()};for(let t of a.value)t.default_value!==void 0&&t.default_value!==null&&(e[t.fieldname]=t.default_value);n.defaultTaxPolicy&&D.value&&(e.tax_policy=n.defaultTaxPolicy,F(e).then(I)),o.value.push(e),$()}function ye(e){o.value.splice(e,1),$(),I()}function be(){confirm(`Are you sure you want to remove all rows?`)&&(o.value=[],$(),I())}async function W(e,t){if(D.value&&t===`product`&&e.product)try{let t=await A.get(`/org/doc/Product/${encodeURIComponent(e.product)}`);t.data&&(e.description=t.data.product_name||t.data.description,e.rate=t.data.standard_rate||0,e.uom=t.data.uom||`Unit`,e.tax_category=t.data.tax_category,e.supply_type=t.data.supply_type,e.vat_applicable=t.data.vat_applicable,e.qty||=1,P(e))}catch(e){console.warn(`Product master lookup failed`,e)}D.value&&t===`tax_policy`?(await F(e),I()):D.value&&[`qty`,`rate`,`discount_percent`,`product`].includes(t)&&(P(e),I()),$()}function $(){let e=o.value.map(e=>{let{_id:t,...n}=e;return n});r(`update:modelValue`,e)}function nt(e){re.value=e,w.value=o.value[e],g.value=!0}function rt(){g.value=!1,w.value&&D.value&&P(w.value),$(),I()}se(()=>n.modelValue,e=>{if(Array.isArray(e)){let t=o.value.map(e=>e.name||e._id).join(`,`),n=e.map(e=>e.name||e._id).join(`,`);t!==n&&(o.value=e.map((e,t)=>({...e,_id:e.name||e._id||`existing-${t}`})),D.value&&setTimeout(()=>{o.value.forEach(e=>F(e)),I()},10))}},{immediate:!0,deep:!0});async function it(){if(n.options){i.value=!0;try{a.value=(await A.get(`/org/doctypes/${encodeURIComponent(n.options)}`,{authorizeRequest:!0,organisationAware:!0})).data?.fields||[]}catch(e){console.error(`Failed to load child schema:`,e)}finally{i.value=!1}}}return ce(()=>{it()}),(t,n)=>(j(),C(`div`,{class:u([`border border-stone-200 rounded-xl overflow-hidden bg-white shadow-sm transition-all duration-200`,{"ring-1 ring-stone-900 border-stone-900":p.value}])},[S(`div`,G,[S(`div`,K,[S(`div`,ke,[M(v(x),{class:`w-4 h-4 text-stone-600`})]),S(`h4`,Ae,y(e.label),1),M(v(U),{variant:`secondary`,class:`rounded-full px-2 py-0 h-5 text-[10px] font-bold bg-stone-200/50 text-stone-600`},{default:T(()=>[m(y(o.value.length)+` `+y(o.value.length===1?`row`:`rows`),1)]),_:1})]),S(`div`,je,[o.value.length>0&&!e.disabled?(j(),f(v(B),{key:0,onClick:be,type:`button`,variant:`ghost`,size:`sm`,class:`h-8 text-stone-500 hover:text-red-600 rounded-full text-xs font-medium px-3`},{default:T(()=>[M(v(l),{class:`w-3.5 h-3.5 mr-1`}),n[3]||=m(` Clear All `,-1)]),_:1})):b(``,!0),M(v(B),{onClick:ve,type:`button`,size:`sm`,disabled:e.disabled,class:`h-8 bg-stone-900 hover:bg-stone-800 text-white rounded-full text-xs font-semibold px-4 shadow-sm transition-transform active:scale-95`},{default:T(()=>[M(v(O),{class:`w-3.5 h-3.5 mr-1`}),n[4]||=m(` Add Row `,-1)]),_:1},8,[`disabled`])])]),i.value?(j(),C(`div`,q,[M(v(c),{class:`w-6 h-6 animate-spin mx-auto mb-3`}),n[5]||=S(`p`,{class:`text-xs font-medium uppercase tracking-widest opacity-50`},`Initializing Table...`,-1)])):o.value.length?(j(),C(`div`,{key:2,class:`overflow-x-auto relative min-h-[100px]`,onFocusin:n[0]||=e=>p.value=!0,onFocusout:n[1]||=e=>p.value=!1},[S(`table`,Ne,[S(`thead`,Pe,[S(`tr`,null,[n[8]||=S(`th`,{class:`px-4 py-2.5 font-bold uppercase tracking-wider text-[10px] w-12 text-center`},`#`,-1),(j(!0),C(h,null,E(oe.value,e=>(j(),C(`th`,{key:e.fieldname,class:`px-2 py-2.5 font-bold uppercase tracking-wider text-[10px]`,style:te({width:de(e)})},[S(`div`,Fe,[m(y(e.label)+` `,1),e.reqd?(j(),C(`span`,J,`*`)):b(``,!0)])],4))),128)),n[9]||=S(`th`,{class:`px-4 py-2.5 w-24 text-center font-bold uppercase tracking-wider text-[10px]`},`Actions `,-1)])]),S(`tbody`,Ie,[(j(!0),C(h,null,E(o.value,(t,n)=>(j(),C(`tr`,{key:t._id||n,class:`group hover:bg-stone-50/80 transition-colors`},[S(`td`,Le,y(n+1),1),(j(!0),C(h,null,E(oe.value,n=>(j(),C(`td`,{key:n.fieldname,class:`px-2 py-3 align-middle`},[n.fieldtype===`DATA`||n.fieldtype===`TEXT`||n.fieldtype===`SMALL_TEXT`?(j(),C(`div`,Re,[M(v(V),{modelValue:t[n.fieldname],"onUpdate:modelValue":e=>t[n.fieldname]=e,placeholder:n.label,disabled:e.disabled||k(n),class:`h-8 text-xs bg-transparent border-stone-200/50 hover:border-stone-400 focus:bg-white shadow-none rounded-lg`},null,8,[`modelValue`,`onUpdate:modelValue`,`placeholder`,`disabled`])])):[`CURRENCY`,`FLOAT`,`INT`,`PERCENT`].includes(n.fieldtype)?(j(),C(`div`,Y,[S(`div`,ze,[M(v(V),{type:`number`,modelValue:t[n.fieldname],"onUpdate:modelValue":e=>t[n.fieldname]=e,modelModifiers:{number:!0},onInput:e=>W(t,n.fieldname),disabled:e.disabled||k(n),class:`h-8 text-xs text-right pr-2 bg-transparent border-stone-200/50 hover:border-stone-400 focus:bg-white shadow-none rounded-lg [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none`},null,8,[`modelValue`,`onUpdate:modelValue`,`onInput`,`disabled`]),n.fieldtype===`CURRENCY`?(j(),C(`span`,X,`₦`)):b(``,!0)])])):n.fieldtype===`DATE`?(j(),C(`div`,Be,[M(Ce,{modelValue:t[n.fieldname],"onUpdate:modelValue":e=>t[n.fieldname]=e,compact:``,pill:``,disabled:e.disabled||k(n)},null,8,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):n.fieldtype===`SELECT`?(j(),C(`div`,Ve,[M(v(we),{modelValue:t[n.fieldname],"onUpdate:modelValue":e=>t[n.fieldname]=e,disabled:e.disabled||k(n)},{default:T(()=>[M(v(Ee),{class:`h-8 text-xs rounded-full shadow-none bg-transparent border-stone-200/50`},{default:T(()=>[M(v(Oe),{placeholder:n.label},null,8,[`placeholder`])]),_:2},1024),M(v(Te),null,{default:T(()=>[(j(!0),C(h,null,E(le(n),e=>(j(),f(v(De),{key:e,value:e},{default:T(()=>[m(y(e),1)]),_:2},1032,[`value`]))),128))]),_:2},1024)]),_:2},1032,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):n.fieldtype===`LINK`?(j(),C(`div`,He,[M(Se,{modelValue:t[n.fieldname],"onUpdate:modelValue":[e=>t[n.fieldname]=e,e=>W(t,n.fieldname)],doctype:n.options,placeholder:n.label,compact:``,disabled:e.disabled||k(n)},null,8,[`modelValue`,`onUpdate:modelValue`,`doctype`,`placeholder`,`disabled`])])):b(``,!0),D.value&&n.fieldname===`product`?(j(),C(`div`,Z)):[`DATA`,`TEXT`,`SMALL_TEXT`,`CURRENCY`,`FLOAT`,`INT`,`PERCENT`,`DATE`,`SELECT`,`LINK`].includes(n.fieldtype)?b(``,!0):(j(),C(`div`,Ue,[S(`span`,We,y(t[n.fieldname]||`—`),1)]))]))),128)),S(`td`,Ge,[S(`div`,Q,[M(v(B),{variant:`ghost`,size:`sm`,onClick:e=>nt(n),class:`h-7 w-7 p-0 rounded-full text-stone-400 hover:text-stone-900 hover:bg-stone-100`},{default:T(()=>[M(v(ne),{class:`w-3.5 h-3.5`})]),_:1},8,[`onClick`]),M(v(B),{variant:`ghost`,size:`sm`,onClick:e=>ye(n),disabled:e.disabled,class:`h-7 w-7 p-0 rounded-full text-stone-300 hover:text-red-500 hover:bg-red-50`},{default:T(()=>[M(v(l),{class:`w-3.5 h-3.5`})]),_:1},8,[`onClick`,`disabled`])])])]))),128))])])],32)):(j(),C(h,{key:1},[e.disabled?b(``,!0):(j(),C(`div`,{key:0,class:`p-16 text-center group cursor-pointer`,onClick:ve},[S(`div`,Me,[M(v(O),{class:`w-8 h-8 text-stone-300 group-hover:text-stone-900 px-0`})]),n[6]||=S(`p`,{class:`text-sm font-medium text-stone-500`},`No items found.`,-1),n[7]||=S(`p`,{class:`text-xs text-stone-400 mt-1`},`Click to add your first row.`,-1)]))],64)),o.value.length>0?(j(),C(`div`,Ke,[n[10]||=d(`<div class="flex items-center gap-4 text-[10px] text-stone-400 font-medium" data-v-6436144a><div class="flex items-center gap-1.5" data-v-6436144a><kbd class="px-1.5 py-0.5 bg-white border border-stone-200 rounded-md text-stone-500" data-v-6436144a>TAB</kbd> Next Field </div><div class="flex items-center gap-1.5" data-v-6436144a><kbd class="px-1.5 py-0.5 bg-white border border-stone-200 rounded-md text-stone-500" data-v-6436144a>ENTER</kbd> New Row </div></div>`,1),D.value?(j(),C(`div`,qe,` Subtotal: `+y(pe(fe())),1)):b(``,!0)])):b(``,!0),M(v(L),{open:g.value,"onUpdate:open":n[2]||=e=>g.value=e},{default:T(()=>[M(v(he),{class:`max-w-2xl`},{default:T(()=>[M(v(R),null,{default:T(()=>[M(v(z),null,{default:T(()=>[m(`Edit Row #`+y(re.value+1),1)]),_:1}),M(v(ge),null,{default:T(()=>[...n[11]||=[m(`Enter detailed information for this line item.`,-1)]]),_:1})]),_:1}),S(`div`,Je,[(j(!0),C(h,null,E(a.value,e=>(j(),C(`div`,{key:e.fieldname,class:u([`space-y-2`,{"col-span-2":ue(e)}])},[M(v(xe),{class:`text-xs font-bold uppercase tracking-wider text-stone-500`},{default:T(()=>[m(y(e.label)+` `,1),e.reqd?(j(),C(`span`,Ye,`*`)):b(``,!0)]),_:2},1024),e.fieldtype===`DATA`||e.fieldtype===`TEXT`?(j(),C(`div`,Xe,[M(v(V),{modelValue:w.value[e.fieldname],"onUpdate:modelValue":t=>w.value[e.fieldname]=t,disabled:k(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):e.fieldtype===`SMALL_TEXT`||e.fieldtype===`LONG_TEXT`?(j(),C(`div`,Ze,[M(v(H),{modelValue:w.value[e.fieldname],"onUpdate:modelValue":t=>w.value[e.fieldname]=t,rows:`3`,disabled:k(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):[`CURRENCY`,`FLOAT`,`INT`].includes(e.fieldtype)?(j(),C(`div`,Qe,[M(v(V),{type:`number`,modelValue:w.value[e.fieldname],"onUpdate:modelValue":t=>w.value[e.fieldname]=t,modelModifiers:{number:!0},onInput:t=>W(w.value,e.fieldname),disabled:k(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`onInput`,`disabled`])])):e.fieldtype===`DATE`?(j(),C(`div`,$e,[M(Ce,{modelValue:w.value[e.fieldname],"onUpdate:modelValue":t=>w.value[e.fieldname]=t,disabled:k(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):e.fieldtype===`SELECT`?(j(),C(`div`,et,[M(v(we),{modelValue:w.value[e.fieldname],"onUpdate:modelValue":t=>w.value[e.fieldname]=t,disabled:k(e)},{default:T(()=>[M(v(Ee),null,{default:T(()=>[M(v(Oe),{placeholder:`Select...`})]),_:1}),M(v(Te),null,{default:T(()=>[(j(!0),C(h,null,E(le(e),e=>(j(),f(v(De),{key:e,value:e},{default:T(()=>[m(y(e),1)]),_:2},1032,[`value`]))),128))]),_:2},1024)]),_:2},1032,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):e.fieldtype===`LINK`?(j(),C(`div`,tt,[M(Se,{modelValue:w.value[e.fieldname],"onUpdate:modelValue":[t=>w.value[e.fieldname]=t,t=>W(w.value,e.fieldname)],doctype:e.options,disabled:k(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`doctype`,`disabled`])])):b(``,!0)],2))),128))]),M(v(_e),null,{default:T(()=>[M(v(B),{onClick:rt,class:`rounded-full bg-stone-900`},{default:T(()=>[...n[12]||=[m(`Done Editing`,-1)]]),_:1})]),_:1})]),_:1})]),_:1},8,[`open`])],2))}},nt=k($,[[`__scopeId`,`data-v-6436144a`]]),rt=[`innerHTML`],it={__name:`DocumentationSheet`,props:{open:{type:Boolean,default:!1},title:{type:String,default:`Documentation`},content:{type:String,default:``}},emits:[`update:open`],setup(a,{emit:o}){let c=a,l=o,u=s(()=>{if(!c.content)return`<p class="text-gray-400 italic">No documentation available.</p>`;let e=W.parse(c.content);return I.sanitize(e)});return(o,s)=>(j(),f(v(r),{open:a.open,"onUpdate:open":s[0]||=e=>l(`update:open`,e)},{default:T(()=>[M(v(e),{side:`right`,class:`w-[400px] sm:w-[540px] overflow-y-auto`},{default:T(()=>[M(v(i),null,{default:T(()=>[M(v(n),{class:`flex items-center gap-2`},{default:T(()=>[M(v(de),{class:`w-5 h-5`}),m(` `+y(a.title),1)]),_:1}),M(v(t),null,{default:T(()=>[...s[1]||=[m(` Reference documentation for this document type. `,-1)]]),_:1})]),_:1}),S(`div`,{class:`mt-6 prose prose-sm max-w-none`,innerHTML:u.value},null,8,rt)]),_:1})]),_:1},8,[`open`]))}},at=k(it,[[`__scopeId`,`data-v-ac8cb5c0`]]),ot={key:1,class:`h-full flex flex-col bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] to-slate-100/50 from-stone-100/60 from-5%`},st={class:`flex items-center space-x-4`},ct={class:`flex items-center gap-2`},lt={class:`text-sm font-medium text-gray-500 uppercase tracking-wider`},ut={class:`text-xl font-bold text-gray-900 mt-1`},dt={class:`flex items-center space-x-3`},ft=[`disabled`],pt=[`disabled`],mt={class:`flex items-center gap-3`},ht={key:0,class:`flex items-center gap-2`},gt=[`disabled`],_t=[`disabled`],vt={key:1,class:`fixed inset-0 bg-black/50 flex items-center justify-center z-50`},yt={class:`bg-white rounded-xl shadow-xl w-full max-w-md p-6 m-4`},bt={class:`flex justify-end gap-2 mt-4`},xt=[`disabled`],St={class:`flex-1 overflow-auto p-6`},Ct={key:0,class:`flex justify-center items-center h-64`},wt={key:1,class:`max-w-5xl mx-auto space-y-6`},Tt={class:`rounded-sm p-6 pt-8`},Et={class:`grid grid-cols-1 md:grid-cols-2 gap-6`},Dt={class:`block text-sm font-medium text-gray-700`},Ot={key:0,class:`text-red-500`},kt={key:0},At={key:1},jt={key:2},Mt={key:3},Nt={key:4},Pt=[`onUpdate:modelValue`,`placeholder`,`disabled`],Ft={key:5},It={class:`flex items-center space-x-2 cursor-pointer mt-1`},Lt=[`onUpdate:modelValue`,`disabled`],Rt={class:`text-sm text-gray-600`},zt={key:6},Bt={key:7},Vt={class:`flex items-center gap-2`},Ht=[`onUpdate:modelValue`,`disabled`],Ut=[`onUpdate:modelValue`,`disabled`],Wt={key:8},Gt={class:`flex items-center gap-2`},Kt={class:`h-10 w-10 flex items-center justify-center rounded border border-gray-300 bg-gray-50`},qt=[`onUpdate:modelValue`,`disabled`,`placeholder`],Jt={key:9,class:`p-2 bg-gray-50 border border-gray-100 rounded text-sm text-gray-600`},Yt={key:10,class:`p-2 bg-gray-50 border border-gray-200 rounded text-xs text-gray-500`},Xt={key:11,class:`text-[11px] text-gray-400 mt-1 italic px-1`},Zt={key:0,class:`mt-8`},Qt={__name:`DocForm`,props:{doctype:{type:String,default:null},name:{type:String,default:null},isNew:{type:Boolean,default:void 0},isEmbedded:{type:Boolean,default:!1}},emits:[`saved`],setup(e,{emit:t}){let n=p(()=>me(()=>import(`./PaymentAllocationSheet-CXNT0FVz.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),r=p(()=>me(()=>import(`./AllocationHistory-B4gU44Kv.js`),__vite__mapDeps([12,1,2]))),{toast:i}=D(),l=ve(),d=e,te=ue(),ne=pe(),x=s(()=>d.doctype||te.params.doctype),O=s(()=>d.name||te.params.name),k=s(()=>d.isNew===void 0?O.value===`new`:d.isNew),de=s(()=>{if(!x.value)return null;let e=be(x.value,`form`);return e?p(e):null}),I=_({}),L=_({}),he=_(!0),R=_(!1),ge=_(!1);_(!1),_(!1),_(!1);let z=_(!1),_e=_(null),B=_(!1),xe=_(!1),H=_(null),U=_(!1),W=_(!1),G=_(!1),K=_(``),ke=new Set([`DATA`,`CURRENCY`,`FLOAT`,`INT`,`PERCENT`,`PHONE`,`EMAIL`,`PASSWORD`,`ATTACH`,`ATTACH_IMAGE`,`URL`]),Ae=new Set([`CURRENCY`,`FLOAT`,`PERCENT`]),je=new Set([`TABLE`,`SECTION_BREAK`,`COLUMN_BREAK`]),q=s(()=>(I.value.fields||[]).map(e=>({...e,_isDataType:ke.has(e.fieldtype),_isNumericType:Ae.has(e.fieldtype),_inputType:Le(e.fieldtype),_parsedOptions:e.options?e.options.split(`
`):[],_step:Ae.has(e.fieldtype)?`0.01`:`1`,_placeholder:e.placeholder||`Select ${e.label}...`}))),Me=s(()=>q.value.filter(e=>!je.has(e.fieldtype)&&!e.hidden)),Ne=s(()=>q.value.filter(e=>e.fieldtype===`TABLE`&&!e.hidden)),Pe=s(()=>{let e=new Map;for(let t of q.value)e.set(t.fieldname,t);return e}),Fe=s(()=>{let e=new Set,t=L.value.docstatus||0;for(let n of q.value)(n.read_only||t>0&&!n.allow_on_submit)&&e.add(n.fieldname);return e}),J=e=>Fe.value.has(e.fieldname),Ie=s(()=>(L.value.docstatus||0)>0),Le=e=>e===`INT`||e===`FLOAT`||e===`CURRENCY`?`number`:e===`DATE`?`date`:e===`PASSWORD`?`password`:`text`,Re=e=>({Draft:`bg-gray-100 text-gray-800`,Submitted:`bg-blue-100 text-blue-800`,Paid:`bg-green-100 text-green-800`,"Partially Paid":`bg-yellow-100 text-yellow-800`,Overdue:`bg-red-100 text-red-800`,Cancelled:`bg-red-100 text-red-800`,Active:`bg-green-100 text-green-800`,Inactive:`bg-gray-100 text-gray-500`,Open:`bg-blue-100 text-blue-800`,Accepted:`bg-green-100 text-green-800`,Rejected:`bg-red-100 text-red-800`,Expired:`bg-gray-100 text-gray-500`,Confirmed:`bg-blue-100 text-blue-800`,Completed:`bg-green-100 text-green-800`,Pending:`bg-yellow-100 text-yellow-800`,Approved:`bg-green-100 text-green-800`})[e]||`bg-gray-100 text-gray-800`,Y=async()=>{he.value=!0;try{if(I.value=(await A.get(`/org/doctypes/${x.value}`,{authorizeRequest:!0,organisationAware:!0})).data||{},k.value){let e={};if(I.value.fields&&I.value.fields.forEach(t=>{t.default_value&&(e[t.fieldname]=t.default_value)}),L.value=e,x.value===`Sales Invoice`)try{let e=await A.get(`/org/settlement-accounts/primary`,{authorizeRequest:!0,organisationAware:!0});e?.data?.reference&&(L.value.settlement_account=e.data.reference)}catch{console.log(`No primary settlement account configured`)}}else{if(!O.value){console.warn(`Cannot fetch document: docName is undefined`);return}L.value=(await A.get(`/org/doc/${encodeURIComponent(x.value)}/${encodeURIComponent(O.value)}`,{authorizeRequest:!0,organisationAware:!0})).data||{}}}catch(e){console.error(e);let t=e.response?.data?.message||e.message;i({title:`Failed to load`,description:t,variant:`destructive`}),L.value||={}}finally{he.value=!1}k.value||ze()};async function ze(){if(!(k.value||!x.value||!O.value))try{let e=(await A.get(`/org/doc/Approval%20Pipeline`,{params:{filters:JSON.stringify({target_doctype:x.value,target_document:O.value,status:`Pending`}),limit:1}})).data?.data||[];if(e.length>0){let t=e[0],n=(t.items||[]).find(e=>e.status===`Pending`);H.value=n?{...n,pipeline_name:t.name,target_doctype:t.target_doctype,target_document:t.target_document}:null}else H.value=null}catch(e){console.error(`Failed to fetch pending approval:`,e)}}let X=s(()=>{if(!H.value)return!1;let e=N();return H.value.assigned_to===e.email});async function Be(){if(!(!H.value||U.value)){U.value=!0;try{await A.patch(`/org/doc/Approval%20Pipeline/${encodeURIComponent(H.value.pipeline_name)}`,{data:{items:[{name:H.value.name,status:`Approved`,approver:Q.email,decision_time:new Date().toISOString()}]}}),i({title:`Approved`,description:`Document has been approved successfully.`,variant:`success`}),H.value=null,await Y()}catch(e){console.error(`Failed to approve:`,e),i({title:`Approval Failed`,description:e.response?.data?.message||``,variant:`destructive`})}finally{U.value=!1}}}async function Ve(){if(!(!H.value||W.value)){W.value=!0;try{await A.patch(`/org/doc/Approval%20Pipeline/${encodeURIComponent(H.value.pipeline_name)}`,{data:{items:[{name:H.value.name,status:`Rejected`,approver:Q.email,comments:K.value,decision_time:new Date().toISOString()}]}}),i({title:`Rejected`,description:`Document has been rejected.`,variant:`success`}),H.value=null,G.value=!1,K.value=``,await Y()}catch(e){console.error(`Failed to reject:`,e),i({title:`Rejection Failed`,description:e.response?.data?.message||``,variant:`destructive`})}finally{W.value=!1}}}function He(e){x.value===`Sales Invoice`&&(L.value.grand_total=e.totalNet,L.value.total_tax=e.totalTax,k.value&&(L.value.outstanding_amount=e.totalNet))}let Z=_(null);function Ue(){!k.value||!x.value||(Z.value&&clearTimeout(Z.value),Z.value=setTimeout(()=>{l.saveFormData(x.value,L.value,!0,null)},500))}se(L,()=>{Ue()},{deep:!0});let We=t,Ge=async()=>{R.value=!0;try{let e,t={data:L.value,authorizeRequest:!0,organisationAware:!0};e=k.value?await A.post(`/org/doc/${encodeURIComponent(x.value)}`,t):await A.patch(`/org/doc/${encodeURIComponent(x.value)}/${encodeURIComponent(O.value)}`,t);let n=e?.data;if(!n)throw Error(`Server returned empty data`);L.value=n,We(`saved`,n),i({title:k.value?`Created`:`Saved`,description:`${I.value.name} has been ${k.value?`created`:`saved`} successfully.`,variant:`success`}),x.value&&l.clearFormData(x.value,k.value,k.value?null:O.value),l.notifyDocSaved(x.value,n.name),k.value&&!d.name&&!d.isEmbedded&&ne.replace(`/app/${x.value}/${n.name}`)}catch(e){console.error(e);let t=e.response?.data?.message||e.message;i({title:`Error saving`,description:t,variant:`destructive`})}finally{R.value=!1}};se(()=>te.params.name,Y),se(O,(e,t)=>{e&&e!==t&&Y()}),ce(()=>{if(k.value&&x.value){let e=l.getFormData(x.value,!0,null);e&&e.data&&(L.value={...e.data})}Y()});let Q=le();s(()=>{if(!I.value.is_submittable||L.value.docstatus!==0)return!1;let e=I.value.config?.workflow;return e?!(e.submit_roles&&e.submit_roles.length>0&&(!Q.role||!e.submit_roles.includes(Q.role))):!0}),_(!1);let Ke=async()=>{z.value=!0;try{L.value.status=`Queued`,L.value.error_log=``,await A.patch(`/org/doc/Notification/${encodeURIComponent(O.value)}`,{data:{status:`Queued`,error_log:``},authorizeRequest:!0,organisationAware:!0}),i({title:`Retry Queued`,description:`Notification has been queued for retry.`,variant:`default`})}catch(e){console.error(e),i({title:`Retry Failed`,description:e.response?.data?.message||e.message,variant:`destructive`})}finally{z.value=!1}},qe=e=>{_e.value&&!_e.value.contains(e.target)&&(ge.value=!1)};return ce(()=>document.addEventListener(`click`,qe)),w(()=>document.removeEventListener(`click`,qe)),(t,i)=>(j(),C(h,null,[de.value?(j(),f(oe(de.value),{key:0,doctype:x.value,name:O.value,isNew:k.value},null,8,[`doctype`,`name`,`isNew`])):(j(),C(`div`,ot,[S(`header`,{class:u([`flex-none px-6 py-4 flex items-center justify-between sticky top-0 z-10`,[e.isEmbedded?`bg-transparent`:``]])},[S(`div`,st,[e.isEmbedded?b(``,!0):(j(),C(`button`,{key:0,onClick:i[0]||=e=>t.$router.back(),class:`p-2 hover:bg-gray-100 rounded-full text-gray-500`},[M(v(ae),{class:`w-5 h-5`})])),S(`div`,{class:u({"pl-0 hidden":e.isEmbedded})},[S(`div`,ct,[S(`span`,lt,y(I.value.name),1),L.value.status?(j(),C(`span`,{key:0,class:u([`px-2 py-0.5 rounded text-xs font-bold`,Re(L.value.status)])},y(L.value.status),3)):b(``,!0)]),S(`h1`,ut,y(k.value?`New `+I.value.name:L.value[I.value.title_field]||L.value.name),1)],2)]),S(`div`,dt,[I.value.documentation?(j(),C(`button`,{key:0,onClick:i[1]||=e=>B.value=!0,class:`p-2 text-gray-500 hover:bg-gray-100 rounded-full transition-colors`,title:`View Documentation`},[M(v(ee),{class:`w-5 h-5`})])):b(``,!0),x.value===`Payment Record`&&!k.value?(j(),C(`button`,{key:1,onClick:i[2]||=e=>xe.value=!0,class:`px-4 py-2 bg-blue-600 text-white rounded-full text-sm font-medium hover:bg-blue-700 transition-colors flex items-center gap-2 shadow-sm`},[M(v(fe),{class:`w-4 h-4`}),i[8]||=m(` Allocate `,-1)])):b(``,!0),x.value===`Notification`&&L.value.status===`Failed`?(j(),C(`button`,{key:2,onClick:Ke,disabled:z.value,class:`px-5 py-2 bg-amber-500 text-white rounded-full text-sm font-medium hover:bg-amber-600 transition-colors flex items-center gap-2 shadow-sm`},[z.value?(j(),f(v(c),{key:1,class:`w-4 h-4 animate-spin`})):(j(),f(v(P),{key:0,class:`w-4 h-4`})),i[9]||=m(` Retry `,-1)],8,ft)):b(``,!0),S(`button`,{onClick:Ge,disabled:R.value,class:`px-6 py-2 bg-black text-white rounded-full text-sm font-medium hover:bg-gray-900 transition-colors flex items-center gap-2 shadow-sm`},[R.value?(j(),f(v(c),{key:0,class:`w-4 h-4 animate-spin`})):b(``,!0),m(` `+y(k.value?`Create`:`Save`),1)],8,pt)])],2),H.value?(j(),C(`div`,{key:0,class:u([`mx-6 mt-4 p-4 rounded-xl border flex items-center justify-between gap-4`,X.value?`bg-amber-50 border-amber-200`:`bg-gray-50 border-gray-200`])},[S(`div`,mt,[S(`div`,{class:u([`w-10 h-10 rounded-full flex items-center justify-center`,X.value?`bg-amber-500`:`bg-gray-400`])},[M(v(re),{class:`w-5 h-5 text-white`})],2),S(`div`,null,[S(`h3`,{class:u([`font-semibold`,X.value?`text-amber-900`:`text-gray-700`])},y(X.value?`Approval Required`:`Pending Approval`),3),S(`p`,{class:u([`text-sm`,X.value?`text-amber-700`:`text-gray-500`])},y(H.value.stage_name||`Approval`)+` • Assigned to `+y(H.value.assigned_to),3)])]),X.value?(j(),C(`div`,ht,[S(`button`,{onClick:Be,disabled:U.value,class:`px-4 py-2 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-1`},[M(v(re),{class:`w-4 h-4`}),i[10]||=m(` Approve `,-1)],8,gt),S(`button`,{onClick:i[3]||=e=>G.value=!0,disabled:W.value,class:`px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-1`},[M(v(ie),{class:`w-4 h-4`}),i[11]||=m(` Reject `,-1)],8,_t)])):b(``,!0)],2)):b(``,!0),G.value?(j(),C(`div`,vt,[S(`div`,yt,[i[12]||=S(`h3`,{class:`text-lg font-semibold text-gray-900 mb-4`},`Reject Document`,-1),F(S(`textarea`,{"onUpdate:modelValue":i[4]||=e=>K.value=e,rows:`3`,placeholder:`Reason for rejection (optional)`,class:`w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500`},null,512),[[g,K.value]]),S(`div`,bt,[S(`button`,{onClick:i[5]||=e=>{G.value=!1,K.value=``},class:`px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-colors`},` Cancel `),S(`button`,{onClick:Ve,disabled:W.value,class:`px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors`},` Reject `,8,xt)])])])):b(``,!0),S(`div`,St,[he.value?(j(),C(`div`,Ct,[...i[13]||=[S(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-black`},null,-1)]])):(j(),C(`div`,wt,[S(`div`,Tt,[S(`div`,Et,[(j(!0),C(h,null,E(Me.value,e=>(j(),C(`div`,{key:e.fieldname,class:u([`space-y-1`,{"col-span-2":e.fieldtype===`TEXT`||e.fieldtype===`LONG_TEXT`||e.fieldtype===`TABLE`||e.fieldtype===`HTML`}])},[S(`label`,Dt,[m(y(e.label)+` `,1),e.reqd?(j(),C(`span`,Ot,`*`)):b(``,!0)]),e._isDataType?(j(),C(`div`,kt,[M(V,{class:`bg-white/40`,type:e._inputType,modelValue:L.value[e.fieldname],"onUpdate:modelValue":t=>L.value[e.fieldname]=t,placeholder:e.placeholder,disabled:J(e),step:e._step},null,8,[`type`,`modelValue`,`onUpdate:modelValue`,`placeholder`,`disabled`,`step`])])):e.fieldtype===`SELECT`?(j(),C(`div`,At,[M(v(we),{modelValue:L.value[e.fieldname],"onUpdate:modelValue":t=>L.value[e.fieldname]=t,disabled:J(e)},{default:T(()=>[M(v(Ee),{class:`bg-white/40`},{default:T(()=>[M(v(Oe),{placeholder:e._placeholder},null,8,[`placeholder`])]),_:2},1024),M(v(Te),null,{default:T(()=>[M(v(a),null,{default:T(()=>[(j(!0),C(h,null,E(e._parsedOptions,e=>(j(),f(v(De),{key:e,value:e},{default:T(()=>[m(y(e),1)]),_:2},1032,[`value`]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):e.fieldtype===`DATE`?(j(),C(`div`,jt,[M(Ce,{modelValue:L.value[e.fieldname],"onUpdate:modelValue":t=>L.value[e.fieldname]=t,placeholder:e.placeholder,disabled:J(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`placeholder`,`disabled`])])):[`DATETIME`,`TIME`].includes(e.fieldtype)?(j(),C(`div`,Mt,[M(V,{class:`bg-white/40`,type:e.fieldtype===`TIME`?`time`:`datetime-local`,modelValue:L.value[e.fieldname],"onUpdate:modelValue":t=>L.value[e.fieldname]=t,disabled:J(e)},null,8,[`type`,`modelValue`,`onUpdate:modelValue`,`disabled`])])):[`TEXT`,`SMALL_TEXT`,`LONG_TEXT`,`HTML`,`JSON`].includes(e.fieldtype)?(j(),C(`div`,Nt,[F(S(`textarea`,{class:`flex min-h-[80px] w-full rounded-xl border border-input bg-white/40 px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all focus:ring-black/5`,"onUpdate:modelValue":t=>L.value[e.fieldname]=t,placeholder:e.placeholder,disabled:J(e),rows:`3`},null,8,Pt),[[g,L.value[e.fieldname]]])])):e.fieldtype===`CHECKBOX`?(j(),C(`div`,Ft,[S(`label`,It,[F(S(`input`,{type:`checkbox`,"onUpdate:modelValue":t=>L.value[e.fieldname]=t,disabled:J(e),class:`w-4 h-4 text-black rounded border-gray-300 focus:ring-black`},null,8,Lt),[[o,L.value[e.fieldname]]]),S(`span`,Rt,y(e.label),1)])])):e.fieldtype===`LINK`?(j(),C(`div`,zt,[e.meta?.link_doctype_field?(j(),C(h,{key:0},[L.value[e.meta.link_doctype_field]?(j(),f(Se,{modelValue:L.value[e.fieldname],"onUpdate:modelValue":t=>L.value[e.fieldname]=t,doctype:L.value[e.meta.link_doctype_field],label:e.label,placeholder:e._placeholder,disabled:J(e),key:`${e.fieldname}-${L.value[e.meta.link_doctype_field]}`},null,8,[`modelValue`,`onUpdate:modelValue`,`doctype`,`label`,`placeholder`,`disabled`])):(j(),f(V,{key:1,type:`text`,disabled:``,placeholder:`Select ${Pe.value.get(e.meta.link_doctype_field)?.label||`DocType`} first...`,class:`w-full bg-gray-100 border border-gray-200 rounded-full text-gray-400 cursor-not-allowed`},null,8,[`placeholder`]))],64)):(j(),f(Se,{key:1,modelValue:L.value[e.fieldname],"onUpdate:modelValue":t=>L.value[e.fieldname]=t,doctype:e.options,label:e.label,placeholder:e._placeholder,disabled:J(e)},null,8,[`modelValue`,`onUpdate:modelValue`,`doctype`,`label`,`placeholder`,`disabled`]))])):e.fieldtype===`COLOR`?(j(),C(`div`,Bt,[S(`div`,Vt,[F(S(`input`,{type:`color`,"onUpdate:modelValue":t=>L.value[e.fieldname]=t,disabled:J(e),class:`h-10 w-10 p-1 rounded border border-gray-300 shadow-sm`},null,8,Ht),[[g,L.value[e.fieldname]]]),F(S(`input`,{type:`text`,"onUpdate:modelValue":t=>L.value[e.fieldname]=t,disabled:J(e),class:`flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-black outline-none transition-all`},null,8,Ut),[[g,L.value[e.fieldname]]])])])):e.fieldtype===`ICON`?(j(),C(`div`,Wt,[S(`div`,Gt,[S(`div`,Kt,[M(ye,{name:L.value[e.fieldname]||`Layers`,class:`size-5 text-gray-600`},null,8,[`name`])]),F(S(`input`,{type:`text`,"onUpdate:modelValue":t=>L.value[e.fieldname]=t,disabled:J(e),placeholder:e.placeholder||`Enter Lucide icon name (e.g., Bell, FileText)`,class:`flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-black outline-none transition-all`},null,8,qt),[[g,L.value[e.fieldname]]])])])):e.fieldtype===`READ_ONLY`?(j(),C(`div`,Jt,y(L.value[e.fieldname]||`-`),1)):(j(),C(`div`,Yt,` Unsupported field: `+y(e.fieldtype),1)),e.description?(j(),C(`p`,Xt,y(e.description),1)):b(``,!0)],2))),128))])]),(j(!0),C(h,null,E(Ne.value,e=>(j(),C(`div`,{key:e.fieldname,class:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden p-4`},[M(nt,{fieldname:e.fieldname,options:e.options,label:e.label,modelValue:L.value[e.fieldname],"onUpdate:modelValue":t=>L.value[e.fieldname]=t,onTotalsChanged:He,disabled:Ie.value},null,8,[`fieldname`,`options`,`label`,`modelValue`,`onUpdate:modelValue`,`disabled`])]))),128)),x.value===`Sales Invoice`&&!k.value?(j(),C(`div`,Zt,[M(v(r),{targetType:x.value,targetId:O.value},null,8,[`targetType`,`targetId`])])):b(``,!0)]))])])),x.value===`Payment Record`?(j(),f(v(n),{key:2,open:xe.value,"onUpdate:open":i[6]||=e=>xe.value=e,payment:L.value,onRefresh:Y},null,8,[`open`,`payment`])):b(``,!0),M(at,{open:B.value,"onUpdate:open":i[7]||=e=>B.value=e,title:I.value.name,content:I.value.documentation},null,8,[`open`,`title`,`content`])],64))}};export{Qt as t};