import"./ConfigProvider-COTvgjgS.js";import"./useHideOthers-DDpiFsmm.js";import{a as e,c as t,i as n,n as r,r as i,s as a,t as o}from"./PopoverTrigger-Jy5Bv-bg.js";import"./useDirection-D13jZBr-.js";import"./PopperAnchor-D24J2rYd.js";import"./useId-Cbz22I98.js";import"./useKbd-BvGB3m10.js";import"./PopperContent-C4v9BcUF.js";import"./Teleport-BgQd8kcT.js";import"./Label-Nwra6Wd2.js";import{Ai as s,At as c,Di as ee,Gi as l,Ni as u,Oi as d,Pi as f,Sa as p,Ta as m,Yi as h,Yt as te,_n as ne,a as re,ha as g,hr as _,ji as v,ki as y,o as b,qi as x,qn as S,sa as C,tn as w,wi as T,xa as E}from"./index-DYsAJfvN.js";import{t as D}from"./button-JGcPCTN0.js";import"./button-CTk8BIqm.js";import{t as O}from"./Card-B2Jpc861.js";import{t as k}from"./Label-D_0LiB9C.js";import{t as A}from"./badge-D0SwtQcn.js";var j=`/org/tax`,M={getTaxFramework(){return b.get(`${j}/framework`,{organisationAware:!0,authorizeRequest:!0})},updateTaxPolicies(e){return b.put(`${j}/framework`,{data:e,organisationAware:!0,authorizeRequest:!0})},reinitializeFramework(){return b.post(`${j}/framework/initialize`,{organisationAware:!0,authorizeRequest:!0})},generateReport(e,t){return b.get(`${j}/report`,{query:{startDate:e,endDate:t},organisationAware:!0,authorizeRequest:!0})},async exportReport(e,t){return await b.get(`${j}/report/export`,{query:{startDate:e,endDate:t},organisationAware:!0,authorizeRequest:!0,responseType:`blob`})},async downloadReport(e,t){try{let n=await this.exportReport(e,t),r=new Blob([n],{type:`application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`}),i=window.URL.createObjectURL(r),a=document.createElement(`a`);a.href=i,a.setAttribute(`download`,`TaxReport_${e}_to_${t}.xlsx`),document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(i)}catch(e){throw console.error(`Failed to download tax report:`,e),e}}},ie={class:`h-full flex flex-col bg-stone-50`},ae={class:`p-6 bg-white border-b border-stone-200`},oe={class:`flex items-center justify-between mb-4`},se={class:`flex items-center gap-2`},ce={class:`flex flex-wrap items-end gap-4`},le={class:`space-y-1`},ue={class:`space-y-1`},N={class:`flex-1 overflow-y-auto p-6`,style:{"scrollbar-width":`none`}},P={key:0,class:`flex items-center justify-center h-64`},F={class:`text-center`},I={key:1,class:`flex items-center justify-center h-64`},L={class:`text-center`},R={key:2,class:`space-y-6`},z={class:`grid grid-cols-1 md:grid-cols-4 gap-4`},B={class:`text-2xl font-bold text-slate-800`},V={class:`text-2xl font-bold text-slate-800`},H={class:`text-2xl font-bold text-red-600`},U={class:`text-2xl font-bold text-green-600`},de={key:0,class:`text-slate-400 text-sm`},fe={key:1,class:`space-y-3`},pe={class:`flex items-center gap-2`},me={class:`text-sm font-medium text-slate-700`},he={class:`text-sm font-semibold text-slate-800`},ge={class:`p-4 border-b border-slate-100 flex items-center justify-between`},_e={class:`text-sm text-slate-500`},ve={class:`overflow-x-auto`},ye={class:`w-full text-sm`},be={class:`divide-y divide-slate-100`},xe={class:`px-4 py-3 text-slate-600`},Se={class:`px-4 py-3 font-medium text-slate-800 max-w-xs truncate`},Ce={class:`px-4 py-3`},we={key:1,class:`text-slate-400 text-xs`},Te={class:`px-4 py-3 text-right font-medium`},Ee={class:`px-4 py-3 text-right text-red-600 font-medium`},De={class:`px-4 py-3 text-right text-green-600 font-medium`},Oe={class:`px-4 py-3`},ke={class:`flex flex-wrap gap-1`},W={__name:`TaxReportTab`,props:{account:Object},setup(b){let j=re().toast,W=new e(`en-US`,{dateStyle:`medium`}),G=g(null),K=g(null),q=g(!1),J=g(!1),Y=t(a()),X=g(Y.subtract({months:3})),Z=g(Y),Q=ee(()=>X.value&&Z.value);l(async()=>{await Ae()});async function Ae(){try{G.value=await M.getTaxFramework()}catch(e){console.error(`Failed to load tax framework:`,e)}}async function je(){if(Q.value)try{q.value=!0;let e=X.value.toString(),t=Z.value.toString();K.value=await M.generateReport(e,t),j({title:`Report Generated`,description:`Analyzed ${K.value.totalTransactions} transactions`})}catch(e){console.error(`Failed to generate report:`,e),j({title:`Error`,description:`Failed to generate tax report`,variant:`destructive`})}finally{q.value=!1}}async function Me(){if(K.value)try{J.value=!0;let e=X.value.toString(),t=Z.value.toString();await M.downloadReport(e,t),j({title:`Download Started`,description:`Your tax report is downloading`})}catch(e){console.error(`Failed to download report:`,e),j({title:`Error`,description:`Failed to download report`,variant:`destructive`})}finally{J.value=!1}}function $(e){return e==null?`â‚¦0.00`:new Intl.NumberFormat(`en-NG`,{style:`currency`,currency:`NGN`}).format(e)}function Ne(e){return e?new Date(e).toLocaleDateString(`en-US`,{year:`numeric`,month:`short`,day:`numeric`}):`N/A`}return(e,t)=>(x(),v(`div`,ie,[d(`div`,ae,[d(`div`,oe,[t[2]||=d(`div`,null,[d(`h2`,{class:`text-xl font-semibold text-slate-800`},`Tax Report`),d(`p`,{class:`text-sm text-slate-500`},`Generate tax reports based on your transaction history`)],-1),d(`div`,se,[G.value?(x(),y(E(A),{key:0,variant:`outline`,class:`rounded-full`},{default:C(()=>[f(E(te),{class:`h-3 w-3 mr-1`}),u(` `+m(G.value.jurisdiction),1)]),_:1})):s(``,!0)])]),d(`div`,ce,[d(`div`,le,[f(E(k),{class:`text-xs text-slate-500`},{default:C(()=>[...t[3]||=[u(`Start Date`,-1)]]),_:1}),f(E(i),null,{default:C(()=>[f(E(o),{"as-child":``},{default:C(()=>[f(E(D),{variant:`outline`,class:p(E(_)(`w-40 justify-start text-left font-normal rounded-full`,!X.value&&`text-muted-foreground`))},{default:C(()=>[f(E(S),{class:`mr-2 h-4 w-4`}),u(` `+m(X.value?E(W).format(X.value.toDate(E(a)())):`Pick date`),1)]),_:1},8,[`class`])]),_:1}),f(E(r),{class:`w-auto p-0`},{default:C(()=>[f(E(n),{modelValue:X.value,"onUpdate:modelValue":t[0]||=e=>X.value=e,"initial-focus":``},null,8,[`modelValue`])]),_:1})]),_:1})]),d(`div`,ue,[f(E(k),{class:`text-xs text-slate-500`},{default:C(()=>[...t[4]||=[u(`End Date`,-1)]]),_:1}),f(E(i),null,{default:C(()=>[f(E(o),{"as-child":``},{default:C(()=>[f(E(D),{variant:`outline`,class:p(E(_)(`w-40 justify-start text-left font-normal rounded-full`,!Z.value&&`text-muted-foreground`))},{default:C(()=>[f(E(S),{class:`mr-2 h-4 w-4`}),u(` `+m(Z.value?E(W).format(Z.value.toDate(E(a)())):`Pick date`),1)]),_:1},8,[`class`])]),_:1}),f(E(r),{class:`w-auto p-0`},{default:C(()=>[f(E(n),{modelValue:Z.value,"onUpdate:modelValue":t[1]||=e=>Z.value=e,"initial-focus":``},null,8,[`modelValue`])]),_:1})]),_:1})]),f(E(D),{onClick:je,disabled:!Q.value||q.value,class:`rounded-full`},{default:C(()=>[q.value?(x(),y(E(c),{key:0,class:`h-4 w-4 mr-2 animate-spin`})):(x(),y(E(w),{key:1,class:`h-4 w-4 mr-2`})),t[5]||=u(` Generate Report `,-1)]),_:1},8,[`disabled`]),K.value?(x(),y(E(D),{key:0,variant:`outline`,onClick:Me,disabled:J.value,class:`rounded-full`},{default:C(()=>[J.value?(x(),y(E(c),{key:0,class:`h-4 w-4 mr-2 animate-spin`})):(x(),y(E(ne),{key:1,class:`h-4 w-4 mr-2`})),t[6]||=u(` Export XLSX `,-1)]),_:1},8,[`disabled`])):s(``,!0)])]),d(`div`,N,[q.value?(x(),v(`div`,P,[d(`div`,F,[f(E(c),{class:`h-8 w-8 animate-spin mx-auto mb-4 text-blue-600`}),t[7]||=d(`p`,{class:`text-slate-500`},`Generating tax report...`,-1)])])):K.value?(x(),v(`div`,R,[d(`div`,z,[f(E(O),{class:`p-4`},{default:C(()=>[t[10]||=d(`div`,{class:`text-xs text-slate-500 mb-1`},`Total Transactions`,-1),d(`div`,B,m(K.value.totalTransactions),1)]),_:1}),f(E(O),{class:`p-4`},{default:C(()=>[t[11]||=d(`div`,{class:`text-xs text-slate-500 mb-1`},`Gross Amount`,-1),d(`div`,V,m($(K.value.totalGrossAmount)),1)]),_:1}),f(E(O),{class:`p-4`},{default:C(()=>[t[12]||=d(`div`,{class:`text-xs text-slate-500 mb-1`},`Total Tax Liability`,-1),d(`div`,H,m($(K.value.totalTaxLiability)),1)]),_:1}),f(E(O),{class:`p-4`},{default:C(()=>[t[13]||=d(`div`,{class:`text-xs text-slate-500 mb-1`},`Net Amount`,-1),d(`div`,U,m($(K.value.netAmount)),1)]),_:1})]),f(E(O),{class:`p-6`},{default:C(()=>[t[15]||=d(`h3`,{class:`text-lg font-semibold mb-4`},`Tax Breakdown by Policy`,-1),Object.keys(K.value.taxSummaryByPolicy||{}).length===0?(x(),v(`div`,de,` No taxes applied in this period `)):(x(),v(`div`,fe,[(x(!0),v(T,null,h(K.value.taxSummaryByPolicy,(e,n)=>(x(),v(`div`,{key:n,class:`flex items-center justify-between py-2 border-b border-slate-100 last:border-0`},[d(`div`,pe,[t[14]||=d(`div`,{class:`h-2 w-2 rounded-full bg-blue-500`},null,-1),d(`span`,me,m(n),1)]),d(`span`,he,m($(e)),1)]))),128))]))]),_:1}),f(E(O),{class:`p-0 overflow-hidden`},{default:C(()=>[d(`div`,ge,[t[16]||=d(`h3`,{class:`font-semibold`},`Transaction Details`,-1),d(`span`,_e,m(K.value.lines?.length||0)+` transactions`,1)]),d(`div`,ve,[d(`table`,ye,[t[17]||=d(`thead`,{class:`bg-slate-50 text-slate-600 text-xs uppercase`},[d(`tr`,null,[d(`th`,{class:`px-4 py-3 text-left`},`Date`),d(`th`,{class:`px-4 py-3 text-left`},`Description`),d(`th`,{class:`px-4 py-3 text-left`},`Category`),d(`th`,{class:`px-4 py-3 text-right`},`Gross`),d(`th`,{class:`px-4 py-3 text-right`},`Tax`),d(`th`,{class:`px-4 py-3 text-right`},`Net`),d(`th`,{class:`px-4 py-3 text-left`},`Policies`)])],-1),d(`tbody`,be,[(x(!0),v(T,null,h(K.value.lines,e=>(x(),v(`tr`,{key:e.transactionReference,class:`hover:bg-slate-50`},[d(`td`,xe,m(Ne(e.transactionDate)),1),d(`td`,Se,m(e.description),1),d(`td`,Ce,[e.category?(x(),y(E(A),{key:0,variant:`outline`,class:`rounded-full text-xs`},{default:C(()=>[u(m(e.category),1)]),_:2},1024)):(x(),v(`span`,we,`Uncategorized`))]),d(`td`,Te,m($(e.grossAmount)),1),d(`td`,Ee,m($(e.totalTax)),1),d(`td`,De,m($(e.netAmount)),1),d(`td`,Oe,[d(`div`,ke,[(x(!0),v(T,null,h(e.appliedPolicyIds,e=>(x(),y(E(A),{key:e,variant:`secondary`,class:`rounded-full text-xs`},{default:C(()=>[u(m(e),1)]),_:2},1024))),128))])])]))),128))])])])]),_:1})])):(x(),v(`div`,I,[d(`div`,L,[f(E(w),{class:`h-12 w-12 text-slate-300 mx-auto mb-4`}),t[8]||=d(`h3`,{class:`text-lg font-medium text-slate-600 mb-2`},`No Report Generated`,-1),t[9]||=d(`p`,{class:`text-sm text-slate-400 max-w-md`},` Select a date range and click "Generate Report" to create your tax report. `,-1)])]))])]))}};export{W as default};