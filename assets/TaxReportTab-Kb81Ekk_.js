import"./ConfigProvider-BwNXqMge.js";import"./useHideOthers-C416Re6d.js";import{a as e,c as t,i as n,n as r,r as i,s as a,t as o}from"./PopoverTrigger-BZLuwVXx.js";import"./useDirection-DYJPYRsI.js";import"./PopperAnchor-BHV4Kv-d.js";import"./useId-BEfc-0Pq.js";import"./useKbd-BvGB3m10.js";import"./PopperContent-DYn2KUeQ.js";import"./Teleport-DrGXNRYb.js";import"./Label-BycvDR_g.js";import{Bi as s,Dn as ee,Fa as c,Hi as l,Ki as u,Li as d,Oa as f,Or as p,Pa as m,Ra as h,Ui as g,Vi as _,Wi as v,a as te,an as ne,ba as y,ca as b,fn as x,ia as re,o as S,oa as C,qi as w,rr as T,zt as E}from"./index-CTHZVx0Q.js";import{t as D}from"./button-DTHLpYkO.js";import"./button-BXx_oIr0.js";import{t as O}from"./Card-DRBf6cFw.js";import{t as k}from"./Label-MW7QlMSj.js";import{t as A}from"./badge-DhOUhkIE.js";var j=`/org/tax`,M={getTaxFramework(){return S.get(`${j}/framework`,{organisationAware:!0,authorizeRequest:!0})},updateTaxPolicies(e){return S.put(`${j}/framework`,{data:e,organisationAware:!0,authorizeRequest:!0})},reinitializeFramework(){return S.post(`${j}/framework/initialize`,{organisationAware:!0,authorizeRequest:!0})},generateReport(e,t){return S.get(`${j}/report`,{query:{startDate:e,endDate:t},organisationAware:!0,authorizeRequest:!0})},async exportReport(e,t){return await S.get(`${j}/report/export`,{query:{startDate:e,endDate:t},organisationAware:!0,authorizeRequest:!0,responseType:`blob`})},async downloadReport(e,t){try{let n=await this.exportReport(e,t),r=new Blob([n],{type:`application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`}),i=window.URL.createObjectURL(r),a=document.createElement(`a`);a.href=i,a.setAttribute(`download`,`TaxReport_${e}_to_${t}.xlsx`),document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(i)}catch(e){throw console.error(`Failed to download tax report:`,e),e}}},ie={class:`h-full flex flex-col bg-stone-50`},ae={class:`p-6 bg-white border-b border-stone-200`},oe={class:`flex items-center justify-between mb-4`},se={class:`flex items-center gap-2`},ce={class:`flex flex-wrap items-end gap-4`},le={class:`space-y-1`},ue={class:`space-y-1`},N={class:`flex-1 overflow-y-auto p-6`,style:{"scrollbar-width":`none`}},P={key:0,class:`flex items-center justify-center h-64`},F={class:`text-center`},I={key:1,class:`flex items-center justify-center h-64`},L={class:`text-center`},R={key:2,class:`space-y-6`},z={class:`grid grid-cols-1 md:grid-cols-4 gap-4`},B={class:`text-2xl font-bold text-slate-800`},V={class:`text-2xl font-bold text-slate-800`},H={class:`text-2xl font-bold text-red-600`},U={class:`text-2xl font-bold text-green-600`},de={key:0,class:`text-slate-400 text-sm`},fe={key:1,class:`space-y-3`},pe={class:`flex items-center gap-2`},me={class:`text-sm font-medium text-slate-700`},he={class:`text-sm font-semibold text-slate-800`},ge={class:`p-4 border-b border-slate-100 flex items-center justify-between`},_e={class:`text-sm text-slate-500`},ve={class:`overflow-x-auto`},ye={class:`w-full text-sm`},be={class:`divide-y divide-slate-100`},xe={class:`px-4 py-3 text-slate-600`},Se={class:`px-4 py-3 font-medium text-slate-800 max-w-xs truncate`},Ce={class:`px-4 py-3`},we={key:1,class:`text-slate-400 text-xs`},Te={class:`px-4 py-3 text-right font-medium`},Ee={class:`px-4 py-3 text-right text-red-600 font-medium`},De={class:`px-4 py-3 text-right text-green-600 font-medium`},Oe={class:`px-4 py-3`},ke={class:`flex flex-wrap gap-1`},W={__name:`TaxReportTab`,props:{account:Object},setup(S){let j=te().toast,W=new e(`en-US`,{dateStyle:`medium`}),G=f(null),K=f(null),q=f(!1),J=f(!1),Y=t(a()),X=f(Y.subtract({months:3})),Z=f(Y),Q=s(()=>X.value&&Z.value);re(async()=>{await Ae()});async function Ae(){try{G.value=await M.getTaxFramework()}catch(e){console.error(`Failed to load tax framework:`,e)}}async function je(){if(Q.value)try{q.value=!0;let e=X.value.toString(),t=Z.value.toString();K.value=await M.generateReport(e,t),j({title:`Report Generated`,description:`Analyzed ${K.value.totalTransactions} transactions`})}catch(e){console.error(`Failed to generate report:`,e),j({title:`Error`,description:`Failed to generate tax report`,variant:`destructive`})}finally{q.value=!1}}async function Me(){if(K.value)try{J.value=!0;let e=X.value.toString(),t=Z.value.toString();await M.downloadReport(e,t),j({title:`Download Started`,description:`Your tax report is downloading`})}catch(e){console.error(`Failed to download report:`,e),j({title:`Error`,description:`Failed to download report`,variant:`destructive`})}finally{J.value=!1}}function $(e){return e==null?`â‚¦0.00`:new Intl.NumberFormat(`en-NG`,{style:`currency`,currency:`NGN`}).format(e)}function Ne(e){return e?new Date(e).toLocaleDateString(`en-US`,{year:`numeric`,month:`short`,day:`numeric`}):`N/A`}return(e,t)=>(C(),v(`div`,ie,[_(`div`,ae,[_(`div`,oe,[t[2]||=_(`div`,null,[_(`h2`,{class:`text-xl font-semibold text-slate-800`},`Tax Report`),_(`p`,{class:`text-sm text-slate-500`},`Generate tax reports based on your transaction history`)],-1),_(`div`,se,[G.value?(C(),l(m(A),{key:0,variant:`outline`,class:`rounded-full`},{default:y(()=>[w(m(ne),{class:`h-3 w-3 mr-1`}),u(` `+h(G.value.jurisdiction),1)]),_:1})):g(``,!0)])]),_(`div`,ce,[_(`div`,le,[w(m(k),{class:`text-xs text-slate-500`},{default:y(()=>[...t[3]||=[u(`Start Date`,-1)]]),_:1}),w(m(i),null,{default:y(()=>[w(m(o),{"as-child":``},{default:y(()=>[w(m(D),{variant:`outline`,class:c(m(p)(`w-40 justify-start text-left font-normal rounded-full`,!X.value&&`text-muted-foreground`))},{default:y(()=>[w(m(T),{class:`mr-2 h-4 w-4`}),u(` `+h(X.value?m(W).format(X.value.toDate(m(a)())):`Pick date`),1)]),_:1},8,[`class`])]),_:1}),w(m(r),{class:`w-auto p-0`},{default:y(()=>[w(m(n),{modelValue:X.value,"onUpdate:modelValue":t[0]||=e=>X.value=e,"initial-focus":``},null,8,[`modelValue`])]),_:1})]),_:1})]),_(`div`,ue,[w(m(k),{class:`text-xs text-slate-500`},{default:y(()=>[...t[4]||=[u(`End Date`,-1)]]),_:1}),w(m(i),null,{default:y(()=>[w(m(o),{"as-child":``},{default:y(()=>[w(m(D),{variant:`outline`,class:c(m(p)(`w-40 justify-start text-left font-normal rounded-full`,!Z.value&&`text-muted-foreground`))},{default:y(()=>[w(m(T),{class:`mr-2 h-4 w-4`}),u(` `+h(Z.value?m(W).format(Z.value.toDate(m(a)())):`Pick date`),1)]),_:1},8,[`class`])]),_:1}),w(m(r),{class:`w-auto p-0`},{default:y(()=>[w(m(n),{modelValue:Z.value,"onUpdate:modelValue":t[1]||=e=>Z.value=e,"initial-focus":``},null,8,[`modelValue`])]),_:1})]),_:1})]),w(m(D),{onClick:je,disabled:!Q.value||q.value,class:`rounded-full`},{default:y(()=>[q.value?(C(),l(m(E),{key:0,class:`h-4 w-4 mr-2 animate-spin`})):(C(),l(m(x),{key:1,class:`h-4 w-4 mr-2`})),t[5]||=u(` Generate Report `,-1)]),_:1},8,[`disabled`]),K.value?(C(),l(m(D),{key:0,variant:`outline`,onClick:Me,disabled:J.value,class:`rounded-full`},{default:y(()=>[J.value?(C(),l(m(E),{key:0,class:`h-4 w-4 mr-2 animate-spin`})):(C(),l(m(ee),{key:1,class:`h-4 w-4 mr-2`})),t[6]||=u(` Export XLSX `,-1)]),_:1},8,[`disabled`])):g(``,!0)])]),_(`div`,N,[q.value?(C(),v(`div`,P,[_(`div`,F,[w(m(E),{class:`h-8 w-8 animate-spin mx-auto mb-4 text-blue-600`}),t[7]||=_(`p`,{class:`text-slate-500`},`Generating tax report...`,-1)])])):K.value?(C(),v(`div`,R,[_(`div`,z,[w(m(O),{class:`p-4`},{default:y(()=>[t[10]||=_(`div`,{class:`text-xs text-slate-500 mb-1`},`Total Transactions`,-1),_(`div`,B,h(K.value.totalTransactions),1)]),_:1}),w(m(O),{class:`p-4`},{default:y(()=>[t[11]||=_(`div`,{class:`text-xs text-slate-500 mb-1`},`Gross Amount`,-1),_(`div`,V,h($(K.value.totalGrossAmount)),1)]),_:1}),w(m(O),{class:`p-4`},{default:y(()=>[t[12]||=_(`div`,{class:`text-xs text-slate-500 mb-1`},`Total Tax Liability`,-1),_(`div`,H,h($(K.value.totalTaxLiability)),1)]),_:1}),w(m(O),{class:`p-4`},{default:y(()=>[t[13]||=_(`div`,{class:`text-xs text-slate-500 mb-1`},`Net Amount`,-1),_(`div`,U,h($(K.value.netAmount)),1)]),_:1})]),w(m(O),{class:`p-6`},{default:y(()=>[t[15]||=_(`h3`,{class:`text-lg font-semibold mb-4`},`Tax Breakdown by Policy`,-1),Object.keys(K.value.taxSummaryByPolicy||{}).length===0?(C(),v(`div`,de,` No taxes applied in this period `)):(C(),v(`div`,fe,[(C(!0),v(d,null,b(K.value.taxSummaryByPolicy,(e,n)=>(C(),v(`div`,{key:n,class:`flex items-center justify-between py-2 border-b border-slate-100 last:border-0`},[_(`div`,pe,[t[14]||=_(`div`,{class:`h-2 w-2 rounded-full bg-blue-500`},null,-1),_(`span`,me,h(n),1)]),_(`span`,he,h($(e)),1)]))),128))]))]),_:1}),w(m(O),{class:`p-0 overflow-hidden`},{default:y(()=>[_(`div`,ge,[t[16]||=_(`h3`,{class:`font-semibold`},`Transaction Details`,-1),_(`span`,_e,h(K.value.lines?.length||0)+` transactions`,1)]),_(`div`,ve,[_(`table`,ye,[t[17]||=_(`thead`,{class:`bg-slate-50 text-slate-600 text-xs uppercase`},[_(`tr`,null,[_(`th`,{class:`px-4 py-3 text-left`},`Date`),_(`th`,{class:`px-4 py-3 text-left`},`Description`),_(`th`,{class:`px-4 py-3 text-left`},`Category`),_(`th`,{class:`px-4 py-3 text-right`},`Gross`),_(`th`,{class:`px-4 py-3 text-right`},`Tax`),_(`th`,{class:`px-4 py-3 text-right`},`Net`),_(`th`,{class:`px-4 py-3 text-left`},`Policies`)])],-1),_(`tbody`,be,[(C(!0),v(d,null,b(K.value.lines,e=>(C(),v(`tr`,{key:e.transactionReference,class:`hover:bg-slate-50`},[_(`td`,xe,h(Ne(e.transactionDate)),1),_(`td`,Se,h(e.description),1),_(`td`,Ce,[e.category?(C(),l(m(A),{key:0,variant:`outline`,class:`rounded-full text-xs`},{default:y(()=>[u(h(e.category),1)]),_:2},1024)):(C(),v(`span`,we,`Uncategorized`))]),_(`td`,Te,h($(e.grossAmount)),1),_(`td`,Ee,h($(e.totalTax)),1),_(`td`,De,h($(e.netAmount)),1),_(`td`,Oe,[_(`div`,ke,[(C(!0),v(d,null,b(e.appliedPolicyIds,e=>(C(),l(m(A),{key:e,variant:`secondary`,class:`rounded-full text-xs`},{default:y(()=>[u(h(e),1)]),_:2},1024))),128))])])]))),128))])])])]),_:1})])):(C(),v(`div`,I,[_(`div`,L,[w(m(x),{class:`h-12 w-12 text-slate-300 mx-auto mb-4`}),t[8]||=_(`h3`,{class:`text-lg font-medium text-slate-600 mb-2`},`No Report Generated`,-1),t[9]||=_(`p`,{class:`text-sm text-slate-400 max-w-md`},` Select a date range and click "Generate Report" to create your tax report. `,-1)])]))])]))}};export{W as default};