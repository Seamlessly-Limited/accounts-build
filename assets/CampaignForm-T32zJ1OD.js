import{Fa as e,Ki as t,Mi as n,Nt as ee,Oa as r,Pa as i,Qn as te,Ra as a,Ui as o,Vi as s,Wi as c,gt as ne,h as l,ha as u,ia as re,ji as d,o as f,oa as p,ot as ie,qi as m,xa as h}from"./index-Caanq2Pw.js";var g={class:`flex flex-col h-full bg-white`},ae={class:`flex-none px-6 py-4 border-b border-gray-100 flex items-center justify-between`},oe={class:`flex items-center gap-4`},se={class:`p-2 rounded-lg bg-orange-50`},ce={class:`text-xl font-bold text-gray-900`},_={class:`flex items-center gap-2 text-sm text-gray-500`},v={key:0},y={class:`flex items-center gap-3`},b=[`disabled`],x=[`disabled`],S={class:`flex-1 overflow-auto p-8`},C={class:`max-w-4xl mx-auto space-y-8`},w={class:`space-y-4`},T={class:`grid grid-cols-2 gap-6 bg-gray-50 p-6 rounded-xl border border-gray-100`},E={class:`space-y-2`},D={class:`space-y-2`},O={class:`space-y-4`},k={class:`bg-gray-50 p-6 rounded-xl border border-gray-100 space-y-4`},A={class:`flex items-center gap-4`},j={class:`w-1/3 space-y-2`},M={class:`flex-1 flex items-end pb-2`},N={class:`text-sm text-gray-500`},P={class:`bg-white p-4 rounded-lg border border-gray-200`},F={class:`text-xs text-gray-400 mt-1`},I={class:`space-y-4`},L={class:`bg-gray-50 p-6 rounded-xl border border-gray-100 space-y-4`},R={class:`space-y-2`},z={class:`space-y-2`},le={class:`flex gap-2 text-xs text-blue-600`},B={key:0,class:`space-y-4`},V={class:`text-lg font-semibold flex items-center gap-2`},H={class:`flex items-center justify-center w-6 h-6 rounded-full bg-green-600 text-white text-xs`},U={class:`grid grid-cols-4 gap-4`},W={class:`p-4 bg-slate-50 rounded-xl border border-slate-100`},ue={class:`text-2xl font-bold text-slate-700`},de={class:`p-4 bg-blue-50 rounded-xl border border-blue-100`},fe={class:`text-2xl font-bold text-blue-700`},pe={class:`p-4 bg-green-50 rounded-xl border border-green-100`},me={class:`text-2xl font-bold text-green-700`},he={class:`p-4 bg-red-50 rounded-xl border border-red-100`},ge={class:`text-2xl font-bold text-red-700`},G={__name:`CampaignForm`,props:{name:{type:String,default:null}},setup(G){let K=G,{toast:q}=l(),J=r({campaign_name:``,status:`Draft`,channel:`Email`,target_doctype:`Customer`,target_filters:{},message:``,subject:``}),Y=r(`{}`),X=r(!1),Z=r(!1),_e=r(0);re(async()=>{K.name&&await Q()}),u(Y,e=>{try{J.value.target_filters=JSON.parse(e)}catch{}});async function Q(){try{J.value=(await f.get(`/org/doc/Campaign/${K.name}`,{authorizeRequest:!0,organisationAware:!0})).data.data,J.value.target_filters&&(Y.value=JSON.stringify(J.value.target_filters,null,2))}catch(e){console.error(e),q({title:`Error loading campaign`,variant:`destructive`})}}async function ve(){X.value=!0;try{let e={...J.value},t;t=J.value.name?await f.patch(`/org/doc/Campaign/${J.value.name}`,{data:e,authorizeRequest:!0,organisationAware:!0}):await f.post(`/org/doc/Campaign`,{data:e,authorizeRequest:!0,organisationAware:!0}),J.value=t.data.data,q({title:`Campaign saved`,variant:`success`})}catch(e){console.error(e),q({title:`Save failed`,description:e.message,variant:`destructive`})}finally{X.value=!1}}async function ye(){if(J.value.name&&confirm(`Are you sure you want to run this campaign? Messages will be queued immediately.`)){Z.value=!0;try{await f.post(`/org/campaigns/${J.value.name}/run`,{authorizeRequest:!0,organisationAware:!0}),q({title:`Campaign Started`,description:`Messages are being queued.`,variant:`success`}),await Q()}catch(e){q({title:`Failed to run`,description:e.message,variant:`destructive`})}finally{Z.value=!1}}}function $(e){J.value.message+=` `+e}function be(e){switch(e){case`Draft`:return`bg-gray-100 text-gray-700`;case`In Progress`:return`bg-blue-100 text-blue-700`;case`Completed`:return`bg-green-100 text-green-700`;case`Cancelled`:return`bg-red-100 text-red-700`;default:return`bg-gray-100 text-gray-700`}}return(r,l)=>(p(),c(`div`,g,[s(`header`,ae,[s(`div`,oe,[s(`div`,se,[m(i(ee),{class:`w-6 h-6 text-orange-600`})]),s(`div`,null,[s(`h1`,ce,a(J.value.name?J.value.campaign_name:`New Campaign`),1),s(`div`,_,[s(`span`,{class:e([`px-2 py-0.5 rounded-full text-xs font-semibold`,be(J.value.status)])},a(J.value.status||`Draft`),3),J.value.name?(p(),c(`span`,v,a(J.value.name),1)):o(``,!0)])])]),s(`div`,y,[J.value.status!==`Completed`&&J.value.status!==`In Progress`?(p(),c(`button`,{key:0,onClick:ve,disabled:X.value,class:`px-4 py-2 bg-white border border-gray-200 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 flex items-center gap-2`},[m(i(ie),{class:`w-4 h-4`}),t(` `+a(X.value?`Saving...`:`Save Draft`),1)],8,b)):o(``,!0),J.value.name&&J.value.status===`Draft`?(p(),c(`button`,{key:1,onClick:ye,disabled:Z.value,class:`px-4 py-2 bg-black text-white rounded-lg text-sm font-medium hover:bg-gray-900 flex items-center gap-2`},[m(i(ne),{class:`w-4 h-4`}),t(` `+a(Z.value?`Starting...`:`Run Campaign`),1)],8,x)):o(``,!0)])]),s(`div`,S,[s(`div`,C,[s(`section`,w,[l[11]||=s(`h2`,{class:`text-lg font-semibold flex items-center gap-2`},[s(`span`,{class:`flex items-center justify-center w-6 h-6 rounded-full bg-black text-white text-xs`},`1`),t(` Campaign Details `)],-1),s(`div`,T,[s(`div`,E,[l[8]||=s(`label`,{class:`text-sm font-medium`},`Campaign Name`,-1),h(s(`input`,{"onUpdate:modelValue":l[0]||=e=>J.value.campaign_name=e,type:`text`,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`,placeholder:`e.g. End of Year Sale`},null,512),[[n,J.value.campaign_name]])]),s(`div`,D,[l[10]||=s(`label`,{class:`text-sm font-medium`},`Channel`,-1),h(s(`select`,{"onUpdate:modelValue":l[1]||=e=>J.value.channel=e,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`},[...l[9]||=[s(`option`,{value:`Email`},`Email`,-1),s(`option`,{value:`SMS`},`SMS`,-1),s(`option`,{value:`WhatsApp`},`WhatsApp`,-1)]],512),[[d,J.value.channel]])])])]),s(`section`,O,[l[15]||=s(`h2`,{class:`text-lg font-semibold flex items-center gap-2`},[s(`span`,{class:`flex items-center justify-center w-6 h-6 rounded-full bg-black text-white text-xs`},`2`),t(` Audience `)],-1),s(`div`,k,[s(`div`,A,[s(`div`,j,[l[13]||=s(`label`,{class:`text-sm font-medium`},`Target Entity`,-1),h(s(`select`,{"onUpdate:modelValue":l[2]||=e=>J.value.target_doctype=e,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`},[...l[12]||=[s(`option`,{value:`Customer`},`Customer`,-1),s(`option`,{value:`Lead`},`Lead`,-1),s(`option`,{value:`User`},`System User`,-1)]],512),[[d,J.value.target_doctype]])]),s(`div`,M,[s(`p`,N,` Define rules to filter which `+a(J.value.target_doctype)+`s will receive this message. `,1)])]),s(`div`,P,[l[14]||=s(`h3`,{class:`text-xs font-semibold uppercase text-gray-500 mb-3`},`Filters (JSON)`,-1),h(s(`textarea`,{"onUpdate:modelValue":l[3]||=e=>Y.value=e,rows:`4`,class:`w-full font-mono text-sm p-3 bg-slate-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`,placeholder:`{ "status": "Active" }`},null,512),[[n,Y.value]]),s(`p`,F,`Found: `+a(_e.value)+` targets`,1)])])]),s(`section`,I,[l[18]||=s(`h2`,{class:`text-lg font-semibold flex items-center gap-2`},[s(`span`,{class:`flex items-center justify-center w-6 h-6 rounded-full bg-black text-white text-xs`},`3`),t(` Content `)],-1),s(`div`,L,[s(`div`,R,[l[16]||=s(`label`,{class:`text-sm font-medium`},`Subject`,-1),h(s(`input`,{"onUpdate:modelValue":l[4]||=e=>J.value.subject=e,type:`text`,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`,placeholder:`Message subject...`},null,512),[[n,J.value.subject]])]),s(`div`,z,[l[17]||=s(`label`,{class:`text-sm font-medium`},`Message Body`,-1),h(s(`textarea`,{"onUpdate:modelValue":l[5]||=e=>J.value.message=e,rows:`8`,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`,placeholder:`Writes your message here... Use {{customer_name}} for dynamic values.`},null,512),[[n,J.value.message]]),s(`div`,le,[s(`span`,{class:`cursor-pointer hover:underline`,onClick:l[6]||=e=>$(`{{customer_name}}`)},`Insert Name`),s(`span`,{class:`cursor-pointer hover:underline`,onClick:l[7]||=e=>$(`{{email_id}}`)},`Insert Email`)])])])]),J.value.name&&J.value.status!==`Draft`?(p(),c(`section`,B,[s(`h2`,V,[s(`span`,H,[m(i(te),{class:`w-3 h-3`})]),l[19]||=t(` Results `,-1)]),s(`div`,U,[s(`div`,W,[s(`div`,ue,a(J.value.total_targets||0),1),l[20]||=s(`div`,{class:`text-xs text-slate-600 font-medium uppercase`},`Targets`,-1)]),s(`div`,de,[s(`div`,fe,a(J.value.sent_count||0),1),l[21]||=s(`div`,{class:`text-xs text-blue-600 font-medium uppercase`},`Sent`,-1)]),s(`div`,pe,[s(`div`,me,a(J.value.delivered_count||0),1),l[22]||=s(`div`,{class:`text-xs text-green-600 font-medium uppercase`},`Delivered`,-1)]),s(`div`,he,[s(`div`,ge,a(J.value.failed_count||0),1),l[23]||=s(`div`,{class:`text-xs text-red-600 font-medium uppercase`},`Failed`,-1)])])])):o(``,!0)])])]))}};export{G as default};