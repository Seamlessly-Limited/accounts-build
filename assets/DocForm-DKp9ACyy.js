import{t as e}from"./SelectGroup-BefQcyG1.js";import{Ai as t,At as n,Di as r,Fi as i,Gi as a,Hn as ee,Ki as te,Ni as o,Oi as s,P as ne,Pi as c,Pt as re,Qi as ie,Sa as l,Ta as u,Vn as ae,Yi as d,_i as oe,b as se,ca as f,cr as ce,h as le,ha as p,it as ue,ji as m,ki as h,l as de,n as fe,na as g,o as _,qi as v,r as pe,sa as y,wi as b,xa as x,yi as S}from"./index-DYsAJfvN.js";import{t as me}from"./WorkspaceStore-DuZPJ7uQ.js";import{t as C}from"./Input-CVPFaPt_.js";import{t as he}from"./viewRegistry-DbwL8P1g.js";import{t as w}from"./LinkField-CVebdX8A.js";import{a as ge,i as _e,n as ve,r as ye,t as be}from"./SelectValue-BTSASMeG.js";var xe={key:1,class:`h-full flex flex-col bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] to-slate-100/50 from-stone-100/60 from-5%`},Se={class:`flex-none px-6 py-4 bg-white border-b border-gray-200 flex items-center justify-between sticky top-0 z-10`},Ce={class:`flex items-center space-x-4`},we={class:`flex items-center gap-2`},Te={class:`text-sm font-medium text-gray-500 uppercase tracking-wider`},Ee={class:`text-xl font-bold text-gray-900 mt-1`},De={class:`flex items-center space-x-3`},Oe={key:0,class:`absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-20`},ke=[`disabled`],Ae=[`disabled`],je={key:3,class:`border-t border-gray-100 my-1`},Me=[`disabled`],Ne=[`disabled`],Pe=[`disabled`],Fe={class:`flex-1 overflow-auto p-6`},Ie={key:0,class:`flex justify-center items-center h-64`},Le={key:1,class:`max-w-5xl mx-auto space-y-6`},Re={class:`rounded-sm p-6 pt-8`},ze={class:`grid grid-cols-1 md:grid-cols-2 gap-6`},Be={class:`block text-sm font-medium text-gray-700`},Ve={key:0,class:`text-red-500`},He={key:0},Ue={key:1},We={key:2},Ge={key:3},Ke={key:4},qe=[`onUpdate:modelValue`,`placeholder`,`disabled`],Je={key:5},Ye={class:`flex items-center space-x-2 cursor-pointer mt-1`},Xe=[`onUpdate:modelValue`,`disabled`],Ze={class:`text-sm text-gray-600`},Qe={key:6},$e={key:7},et={class:`flex items-center gap-2`},tt=[`onUpdate:modelValue`,`disabled`],nt=[`onUpdate:modelValue`,`disabled`],rt={key:8,class:`p-2 bg-gray-50 border border-gray-100 rounded text-sm text-gray-600`},it={key:9,class:`p-2 bg-gray-50 border border-gray-200 rounded text-xs text-gray-500`},at={key:10,class:`text-[11px] text-gray-400 mt-1 italic px-1`},ot={class:`px-6 py-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center`},T={class:`font-medium text-gray-900`},st={class:`p-6 text-center text-gray-500 text-sm`},E={__name:`DocForm`,props:{doctype:{type:String,default:null},name:{type:String,default:null},isNew:{type:Boolean,default:void 0},isEmbedded:{type:Boolean,default:!1}},emits:[`saved`],setup(E,{emit:ct}){let{toast:D}=le(),O=me(),k=E,A=fe(),j=pe(),M=r(()=>k.doctype||A.params.doctype),N=r(()=>k.name||A.params.name),P=r(()=>k.isNew===void 0?N.value===`new`:k.isNew),F=r(()=>{if(!M.value)return null;let e=he(M.value,`form`);return e?i(e):null}),I=p({}),L=p({}),R=p(!0),z=p(!1),B=p(!1),V=p(!1),H=p(!1),U=p(!1),W=p(!1),G=p(null),lt=new Set([`DATA`,`CURRENCY`,`FLOAT`,`INT`,`PERCENT`,`PHONE`,`EMAIL`,`PASSWORD`,`ATTACH`,`ATTACH_IMAGE`,`URL`]),K=new Set([`CURRENCY`,`FLOAT`,`PERCENT`]),ut=new Set([`TABLE`,`SECTION_BREAK`,`COLUMN_BREAK`]),q=r(()=>(I.value.fields||[]).map(e=>({...e,_isDataType:lt.has(e.fieldtype),_isNumericType:K.has(e.fieldtype),_inputType:ht(e.fieldtype),_parsedOptions:e.options?e.options.split(`
`):[],_step:K.has(e.fieldtype)?`0.01`:`1`,_placeholder:e.placeholder||`Select ${e.label}...`}))),dt=r(()=>q.value.filter(e=>!ut.has(e.fieldtype)&&!e.hidden)),ft=r(()=>q.value.filter(e=>e.fieldtype===`TABLE`&&!e.hidden)),pt=r(()=>{let e=new Map;for(let t of q.value)e.set(t.fieldname,t);return e}),mt=r(()=>{let e=new Set,t=L.value.docstatus||0;for(let n of q.value)(n.read_only||t>0&&!n.allow_on_submit)&&e.add(n.fieldname);return e}),J=e=>mt.value.has(e.fieldname),ht=e=>e===`INT`||e===`FLOAT`||e===`CURRENCY`?`number`:e===`DATE`?`date`:e===`PASSWORD`?`password`:`text`,gt=e=>({Draft:`bg-gray-100 text-gray-800`,Submitted:`bg-blue-100 text-blue-800`,Paid:`bg-green-100 text-green-800`})[e]||`bg-gray-100 text-gray-800`,Y=async()=>{R.value=!0;try{if(I.value=(await _.get(`/org/doctypes/${M.value}`,{authorizeRequest:!0,organisationAware:!0})).data||{},P.value){let e={};I.value.fields&&I.value.fields.forEach(t=>{t.default_value&&(e[t.fieldname]=t.default_value)}),L.value=e}else{if(!N.value){console.warn(`Cannot fetch document: docName is undefined`);return}L.value=(await _.get(`/org/doc/${M.value}/${N.value}`,{authorizeRequest:!0,organisationAware:!0})).data||{}}}catch(e){console.error(e);let t=e.response?.data?.message||e.message;D({title:`Failed to load`,description:t,variant:`destructive`}),L.value||={}}finally{R.value=!1}},X=p(null);function _t(){!P.value||!M.value||(X.value&&clearTimeout(X.value),X.value=setTimeout(()=>{O.saveFormData(M.value,L.value,!0,null)},500))}g(L,()=>{_t()},{deep:!0});let Z=ct,vt=async()=>{z.value=!0;try{let e,t={data:L.value,authorizeRequest:!0,organisationAware:!0};e=P.value?await _.post(`/org/doc/${M.value}`,t):await _.patch(`/org/doc/${M.value}/${N.value}`,t);let n=e?.data;if(!n)throw Error(`Server returned empty data`);L.value=n,Z(`saved`,n),D({title:P.value?`Created`:`Saved`,description:`${I.value.name} has been ${P.value?`created`:`saved`} successfully.`,variant:`success`}),M.value&&O.clearFormData(M.value,P.value,P.value?null:N.value),O.notifyDocSaved(M.value,n.name),P.value&&!k.name&&!k.isEmbedded&&j.replace(`/app/${M.value}/${n.name}`)}catch(e){console.error(e);let t=e.response?.data?.message||e.message;D({title:`Error saving`,description:t,variant:`destructive`})}finally{z.value=!1}};g(()=>A.params.name,Y),g(N,(e,t)=>{e&&e!==t&&Y()}),a(()=>{if(P.value&&M.value){let e=O.getFormData(M.value,!0,null);e&&e.data&&(L.value={...e.data})}Y()});let Q=de(),yt=r(()=>{if(!I.value.is_submittable||L.value.docstatus!==0)return!1;let e=I.value.config?.workflow;return e?!(e.submit_roles&&e.submit_roles.length>0&&(!Q.role||!e.submit_roles.includes(Q.role))):!0}),bt=async()=>{V.value=!0,B.value=!1;try{let e=(await _.patch(`/org/doc/${M.value}/${N.value}`,{data:{docstatus:1},authorizeRequest:!0,organisationAware:!0})).data?.data||{};L.value=e,Z(`saved`,e),D({title:`Submitted`,description:`Document has been submitted successfully.`,variant:`success`})}catch(e){console.error(e);let t=e.response?.data?.message||e.message;D({title:`Result`,description:t,variant:t.includes(`submitted`)?`success`:`destructive`})}finally{V.value=!1}},xt=async()=>{try{let e=crypto.randomUUID();await _.post(`/org/doc/Public Document Access`,{data:{doctype:M.value,doc_name:N.value,token:e,access_type:`View`,max_views:0},authorizeRequest:!0,organisationAware:!0});let t=`${window.location.origin}/public/d/${e}`;navigator.clipboard.writeText(t),D({title:`Link Copied`,description:`Public link has been copied to clipboard.`,variant:`success`}),B.value=!1}catch(e){console.error(e),D({title:`Failed`,description:e.message,variant:`destructive`})}},St=async()=>{if(confirm(`Are you sure you want to cancel this document?`)){H.value=!0,B.value=!1;try{let e=(await _.patch(`/org/doc/${M.value}/${N.value}`,{data:{docstatus:2},authorizeRequest:!0,organisationAware:!0})).data?.data||{};L.value=e,Z(`saved`,e),D({title:`Cancelled`,description:`Document has been cancelled.`,variant:`default`})}catch(e){console.error(e);let t=e.response?.data?.message||e.message;D({title:`Error cancelling`,description:t,variant:`destructive`})}finally{H.value=!1}}},Ct=async()=>{if(confirm(`Are you sure you want to delete this document? This cannot be undone.`)){U.value=!0,B.value=!1;try{await _.delete(`/org/doc/${M.value}/${N.value}`,{authorizeRequest:!0,organisationAware:!0}),D({title:`Deleted`,description:`Document has been deleted.`,variant:`default`}),j.back()}catch(e){console.error(e);let t=e.response?.data?.message||e.message;D({title:`Error deleting`,description:t,variant:`destructive`})}finally{U.value=!1}}},wt=async()=>{W.value=!0;try{L.value.status=`Queued`,L.value.error_log=``,await _.patch(`/org/doc/Notification/${N.value}`,{data:{status:`Queued`,error_log:``},authorizeRequest:!0,organisationAware:!0}),D({title:`Retry Queued`,description:`Notification has been queued for retry.`,variant:`default`})}catch(e){console.error(e),D({title:`Retry Failed`,description:e.response?.data?.message||e.message,variant:`destructive`})}finally{W.value=!1}},$=e=>{G.value&&!G.value.contains(e.target)&&(B.value=!1)};return a(()=>document.addEventListener(`click`,$)),te(()=>document.removeEventListener(`click`,$)),(r,i)=>F.value?(v(),h(ie(F.value),{key:0,doctype:M.value,name:N.value,isNew:P.value},null,8,[`doctype`,`name`,`isNew`])):(v(),m(`div`,xe,[s(`header`,Se,[s(`div`,Ce,[E.isEmbedded?t(``,!0):(v(),m(`button`,{key:0,onClick:i[0]||=e=>r.$router.back(),class:`p-2 hover:bg-gray-100 rounded-full text-gray-500`},[c(x(ce),{class:`w-5 h-5`})])),s(`div`,{class:l({"pl-0":E.isEmbedded})},[s(`div`,we,[s(`span`,Te,u(I.value.name),1),L.value.status?(v(),m(`span`,{key:0,class:l([`px-2 py-0.5 rounded text-xs font-bold`,gt(L.value.status)])},u(L.value.status),3)):t(``,!0)]),s(`h1`,Ee,u(P.value?`New `+I.value.name:L.value[I.value.title_field]||L.value.name),1)],2)]),s(`div`,De,[P.value?t(``,!0):(v(),m(`div`,{key:0,class:`relative`,ref_key:`actionsDropdownRef`,ref:G},[s(`button`,{onClick:i[1]||=e=>B.value=!B.value,class:`px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-full text-sm font-medium transition-colors flex items-center gap-1`},[i[2]||=o(` Actions `,-1),c(x(ae),{class:`w-4 h-4`})]),B.value?(v(),m(`div`,Oe,[yt.value?(v(),m(`button`,{key:0,onClick:bt,disabled:V.value,class:`w-full text-left px-4 py-2 text-sm text-green-700 hover:bg-green-50 flex items-center gap-2`},[c(x(ee),{class:`w-4 h-4`}),i[3]||=o(` Submit `,-1)],8,ke)):t(``,!0),I.value.is_submittable&&L.value.docstatus===1?(v(),m(`button`,{key:1,onClick:St,disabled:H.value,class:`w-full text-left px-4 py-2 text-sm text-red-700 hover:bg-red-50 flex items-center gap-2`},[c(x(se),{class:`w-4 h-4`}),i[4]||=o(` Cancel `,-1)],8,Ae)):t(``,!0),P.value?t(``,!0):(v(),m(`button`,{key:2,onClick:xt,class:`w-full text-left px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 flex items-center gap-2`},[c(x(re),{class:`w-4 h-4`}),i[5]||=o(` Get Public Link `,-1)])),I.value.is_submittable&&(L.value.docstatus===0||L.value.docstatus===1)?(v(),m(`div`,je)):t(``,!0),s(`button`,{onClick:Ct,disabled:U.value,class:`w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-2`},[c(x(ne),{class:`w-4 h-4`}),i[6]||=o(` Delete `,-1)],8,Me)])):t(``,!0)],512)),M.value===`Notification`&&L.value.status===`Failed`?(v(),m(`button`,{key:1,onClick:wt,disabled:W.value,class:`px-5 py-2 bg-amber-500 text-white rounded-full text-sm font-medium hover:bg-amber-600 transition-colors flex items-center gap-2 shadow-sm`},[W.value?(v(),h(x(n),{key:1,class:`w-4 h-4 animate-spin`})):(v(),h(x(ue),{key:0,class:`w-4 h-4`})),i[7]||=o(` Retry `,-1)],8,Ne)):t(``,!0),s(`button`,{onClick:vt,disabled:z.value,class:`px-6 py-2 bg-black text-white rounded-full text-sm font-medium hover:bg-gray-900 transition-colors flex items-center gap-2 shadow-sm`},[z.value?(v(),h(x(n),{key:0,class:`w-4 h-4 animate-spin`})):t(``,!0),o(` `+u(P.value?`Create`:`Save`),1)],8,Pe)])]),s(`div`,Fe,[R.value?(v(),m(`div`,Ie,[...i[8]||=[s(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-black`},null,-1)]])):(v(),m(`div`,Le,[s(`div`,Re,[s(`div`,ze,[(v(!0),m(b,null,d(dt.value,n=>(v(),m(`div`,{key:n.fieldname,class:l([`space-y-1`,{"col-span-2":n.fieldtype===`TEXT`||n.fieldtype===`LONG_TEXT`||n.fieldtype===`TABLE`||n.fieldtype===`HTML`}])},[s(`label`,Be,[o(u(n.label)+` `,1),n.reqd?(v(),m(`span`,Ve,`*`)):t(``,!0)]),n._isDataType?(v(),m(`div`,He,[c(C,{class:`bg-white/40`,type:n._inputType,modelValue:L.value[n.fieldname],"onUpdate:modelValue":e=>L.value[n.fieldname]=e,placeholder:n.placeholder,disabled:J(n),step:n._step},null,8,[`type`,`modelValue`,`onUpdate:modelValue`,`placeholder`,`disabled`,`step`])])):n.fieldtype===`SELECT`?(v(),m(`div`,Ue,[c(x(ge),{modelValue:L.value[n.fieldname],"onUpdate:modelValue":e=>L.value[n.fieldname]=e,disabled:J(n)},{default:y(()=>[c(x(ve),{class:`bg-white/40`},{default:y(()=>[c(x(be),{placeholder:n._placeholder},null,8,[`placeholder`])]),_:2},1024),c(x(_e),null,{default:y(()=>[c(x(e),null,{default:y(()=>[(v(!0),m(b,null,d(n._parsedOptions,e=>(v(),h(x(ye),{key:e,value:e},{default:y(()=>[o(u(e),1)]),_:2},1032,[`value`]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):n.fieldtype===`DATE`?(v(),m(`div`,We,[c(C,{class:`bg-white/40`,type:`date`,modelValue:L.value[n.fieldname],"onUpdate:modelValue":e=>L.value[n.fieldname]=e,disabled:J(n)},null,8,[`modelValue`,`onUpdate:modelValue`,`disabled`])])):[`DATETIME`,`TIME`].includes(n.fieldtype)?(v(),m(`div`,Ge,[c(C,{class:`bg-white/40`,type:n.fieldtype===`TIME`?`time`:`datetime-local`,modelValue:L.value[n.fieldname],"onUpdate:modelValue":e=>L.value[n.fieldname]=e,disabled:J(n)},null,8,[`type`,`modelValue`,`onUpdate:modelValue`,`disabled`])])):[`TEXT`,`SMALL_TEXT`,`LONG_TEXT`,`HTML`,`JSON`].includes(n.fieldtype)?(v(),m(`div`,Ke,[f(s(`textarea`,{class:`flex min-h-[80px] w-full rounded-xl border border-input bg-white/40 px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all focus:ring-black/5`,"onUpdate:modelValue":e=>L.value[n.fieldname]=e,placeholder:n.placeholder,disabled:J(n),rows:`3`},null,8,qe),[[S,L.value[n.fieldname]]])])):n.fieldtype===`CHECKBOX`?(v(),m(`div`,Je,[s(`label`,Ye,[f(s(`input`,{type:`checkbox`,"onUpdate:modelValue":e=>L.value[n.fieldname]=e,disabled:J(n),class:`w-4 h-4 text-black rounded border-gray-300 focus:ring-black`},null,8,Xe),[[oe,L.value[n.fieldname]]]),s(`span`,Ze,u(n.label),1)])])):n.fieldtype===`LINK`?(v(),m(`div`,Qe,[n.meta?.link_doctype_field?(v(),m(b,{key:0},[L.value[n.meta.link_doctype_field]?(v(),h(w,{modelValue:L.value[n.fieldname],"onUpdate:modelValue":e=>L.value[n.fieldname]=e,doctype:L.value[n.meta.link_doctype_field],label:n.label,placeholder:n._placeholder,disabled:J(n),key:`${n.fieldname}-${L.value[n.meta.link_doctype_field]}`},null,8,[`modelValue`,`onUpdate:modelValue`,`doctype`,`label`,`placeholder`,`disabled`])):(v(),h(C,{key:1,type:`text`,disabled:``,placeholder:`Select ${pt.value.get(n.meta.link_doctype_field)?.label||`DocType`} first...`,class:`w-full bg-gray-100 border border-gray-200 rounded-full text-gray-400 cursor-not-allowed`},null,8,[`placeholder`]))],64)):(v(),h(w,{key:1,modelValue:L.value[n.fieldname],"onUpdate:modelValue":e=>L.value[n.fieldname]=e,doctype:n.options,label:n.label,placeholder:n._placeholder,disabled:J(n)},null,8,[`modelValue`,`onUpdate:modelValue`,`doctype`,`label`,`placeholder`,`disabled`]))])):n.fieldtype===`COLOR`?(v(),m(`div`,$e,[s(`div`,et,[f(s(`input`,{type:`color`,"onUpdate:modelValue":e=>L.value[n.fieldname]=e,disabled:J(n),class:`h-10 w-10 p-1 rounded border border-gray-300 shadow-sm`},null,8,tt),[[S,L.value[n.fieldname]]]),f(s(`input`,{type:`text`,"onUpdate:modelValue":e=>L.value[n.fieldname]=e,disabled:J(n),class:`flex-1 px-4 py-2 border border-gray-300 rounded-full focus:ring-2 focus:ring-black outline-none transition-all`},null,8,nt),[[S,L.value[n.fieldname]]])])])):n.fieldtype===`READ_ONLY`?(v(),m(`div`,rt,u(L.value[n.fieldname]||`-`),1)):(v(),m(`div`,it,` Unsupported field: `+u(n.fieldtype),1)),n.description?(v(),m(`p`,at,u(n.description),1)):t(``,!0)],2))),128))])]),(v(!0),m(b,null,d(ft.value,e=>(v(),m(`div`,{key:e.fieldname,class:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden`},[s(`div`,ot,[s(`h3`,T,u(e.label),1),i[9]||=s(`button`,{class:`text-sm text-blue-600 font-medium hover:text-blue-700`},`+ Add Row`,-1)]),s(`div`,st,` Table editing not implemented yet for `+u(e.label),1)]))),128))]))])]))}};export{E as t};