import"./useArrowNavigation-siWGBYoD.js";import"./ConfigProvider-CF_Zn67Q.js";import"./useDirection-D77LTkCz.js";import"./useId-Dh9pzOl8.js";import"./VisuallyHiddenInput-C4chlUyE.js";import"./Label-6WPsLznX.js";import{n as e,r as t,t as n}from"./PinInputSlot-BB8PyhUC.js";import{t as r}from"./circle-check-big-Bzr4zUh3.js";import{t as i}from"./circle-x-D6OweSgU.js";import{t as a}from"./loader-circle-DOhDD5Dh.js";import{Dt as o,Gt as s,Ot as c,St as l,Tt as u,Ut as d,Vt as f,c as p,gt as m,i as h,o as g,tn as _,u as v,vt as y,wt as b,yn as x}from"./index-DUYI2_g5.js";import{t as S}from"./Card-eywxWxCP.js";import{t as C}from"./CardContent-DDiEWivd.js";import{t as w}from"./BackgroundAnimation-C_ou8Yr8.js";import{t as T}from"./button-BRE5vWy0.js";import{a as E,i as D,n as O,r as k,t as A}from"./form-DKkvTCAd.js";import"./Label-CLV41pMb.js";var j={name:`VerifyAccount`,components:{Button:T,Card:S,CardContent:C,Loader2:a,CheckCircle:r,XCircle:i,BackgroundAnimation:w,FormField:E,FormItem:O,FormLabel:A,FormControl:D,PinInput:t,PinInputGroup:e,PinInputSlot:n,FormDescription:k},data(){return{currentStep:0,loading:!1,resendCount:0,resendWaitTime:0,token:[]}},async mounted(){if(this.$route.params.token)await this.verifyAccount(this.$route.params.token);else{let{token:e}=await v.IndexedDB.get(`SeamlesslyDB`,`UserStore`,`preAuthorization`);e||this.$router.push(`/login`)}this.countDown()},computed:{formDisabled(){return this.loading||void 0}},methods:{paste(e){let t=(e.clipboardData||window.clipboardData).getData(`text`).trim();console.log(t,e.clipboardData),this.token=[...t.split(``)],this.token.length===6&&this.completeVerification()},focusNext(e,t){let n=`${e.target.value}`.trim();if(t===6&&n)return this.completeVerification();n.length===1&&t<6&&this.$refs[`otpInput`+(t+1)][0].focus(),n.length===0&&t>1&&this.$refs[`otpInput`+(t-1)][0].focus()},countDown(){this.resendWaitTime=60+this.resendCount;let e=setInterval(()=>--this.resendWaitTime,1e3);setTimeout(()=>{clearInterval(e),this.resendWaitTime=0},this.resendWaitTime*1e3)},async completeVerification(){let e=g(),t=``;try{if(t=this.token.reduce((e,t)=>`${e}${t}`),t.length<6)throw Error(`Invalid code provided!`)}catch{e.toast({message:`Invalid code provided!`,duration:5e3,variant:`error`});return}this.loading=!0;try{if(await p.completeAccountVerification({code:t})){let e=localStorage.getItem(`postAuthenticationPath`);e?(window.location=e,localStorage.removeItem(`postAuthenticationPath`)):window.location=`/`}}catch(t){e.toast({message:t,duration:5e3,variant:`error`})}this.loading=!1},async verifyAccount(e){let t=g();try{this.currentStep=1;let n=await p.verifyAccount(e);t.toast({message:n.message||`Your verification was successful`,variant:`success`,duration:5e3}),this.currentStep=2}catch(e){t.toast({message:e.message||`There was an error with your verification. Try again.`,variant:`error`,duration:5e3}),this.currentStep=3}}}},M={class:`flex min-h-screen justify-center items-center bg-stone-100 text-foreground px-4`},N={class:`grid grid-cols-1 gap-2 mt-4 w-full`},P={class:`flex justify-end`},F={key:0},I={key:1},L={key:1,class:`text-sm text-muted-foreground`},R={key:2,class:`text-sm text-muted-foreground`},z={class:`font-semibold text-foreground`},B={key:3,class:`flex flex-col space-y-3 py-6`},V={key:4,class:`flex flex-col space-y-3 py-6`},H={key:5,class:`flex flex-col space-y-3 py-6`};function U(e,t,n,r,i,a){let p=s(`BackgroundAnimation`),h=s(`PinInputSlot`),g=s(`PinInputGroup`),v=s(`PinInput`),S=s(`FormControl`),C=s(`FormItem`),w=s(`FormField`),T=s(`Button`),E=s(`Loader2`),D=s(`CheckCircle`),O=s(`XCircle`),k=s(`CardContent`),A=s(`Card`);return f(),u(`div`,M,[c(p),c(A,{class:`w-full max-w-lg shadow-none border-solid border-slate-50 rounded-2xl relative`},{default:_(()=>[c(k,{class:`space-y-4`},{default:_(()=>[t[12]||=l(`div`,{class:`flex flex-col space-y-2`},[l(`h2`,{class:`text-2xl font-semibold`},`Verify your account`),l(`p`,{class:`text-muted-foreground`},` Complete your identity verification. `)],-1),i.currentStep===0?(f(),u(`form`,{key:0,onSubmit:t[1]||=m((...e)=>a.completeVerification&&a.completeVerification(...e),[`prevent`]),class:`space-y-6 py-3`},[l(`div`,N,[c(w,{name:`code`},{default:_(()=>[c(C,null,{default:_(()=>[c(S,null,{default:_(()=>[c(v,{class:`rounded-full`,id:`pin-input`,modelValue:i.token,"onUpdate:modelValue":t[0]||=e=>i.token=e,placeholder:`â—‹`,onComplete:a.completeVerification},{default:_(()=>[c(g,null,{default:_(()=>[(f(),u(y,null,d(6,(e,t)=>c(h,{key:e,index:t,onPaste:m(a.paste,[`prevent`])},null,8,[`index`,`onPaste`])),64))]),_:1})]),_:1},8,[`modelValue`,`onComplete`])]),_:1})]),_:1})]),_:1}),t[3]||=l(`div`,{class:`text-sm text-muted-foreground w-full`},[l(`p`,{class:`text-xs`},` Enter the OTP sent to your linked email address. `)],-1)]),l(`div`,P,[c(T,{disabled:i.loading,type:`submit`,class:`bg-primary text-primary-foreground rounded-full`},{default:_(()=>[i.loading?(f(),u(`span`,I,`Loading...`)):(f(),u(`span`,F,`Continue`))]),_:1},8,[`disabled`])])],32)):b(``,!0),i.resendWaitTime===0?(f(),u(`div`,L,[t[4]||=o(` If you do not receive a code in 5 minutes, you can `,-1),l(`span`,{onClick:t[2]||=t=>e.$router.push(`/login`),class:`text-blue-600 cursor-pointer font-semibold`},` retry login. `)])):(f(),u(`div`,R,[t[5]||=o(` You can request another verification code in `,-1),l(`span`,z,x(i.resendWaitTime)+`s`,1)])),i.currentStep===1?(f(),u(`div`,B,[c(E,{class:`w-10 h-10 animate-spin text-primary`}),t[6]||=l(`h3`,{class:`text-lg font-medium`},`Completing Verification...`,-1),t[7]||=l(`p`,{class:`text-sm text-muted-foreground`},`Please wait a moment`,-1)])):b(``,!0),i.currentStep===2?(f(),u(`div`,V,[c(D,{class:`w-10 h-10 text-green-500`}),t[8]||=l(`h3`,{class:`text-lg font-semibold`},`Verification Complete`,-1),t[9]||=l(`p`,{class:`text-sm text-muted-foreground`},[o(`You can now `),l(`a`,{href:`/login`,class:`text-primary underline`},`login`),o(`.`)],-1)])):b(``,!0),i.currentStep===3?(f(),u(`div`,H,[c(O,{class:`w-10 h-10 text-destructive`}),t[10]||=l(`h3`,{class:`text-lg font-semibold text-destructive`},`Verification Failed`,-1),t[11]||=l(`p`,{class:`text-sm text-muted-foreground`},[o(`Please try again or `),l(`a`,{href:`/login`,class:`text-primary underline`},`login`),o(`.`)],-1)])):b(``,!0)]),_:1})]),_:1})])}var W=h(j,[[`render`,U]]);export{W as default};