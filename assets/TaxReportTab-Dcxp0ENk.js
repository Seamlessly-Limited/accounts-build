import"./ConfigProvider-Ckl6KgMj.js";import"./useHideOthers-L15EfXxs.js";import{a as e,c as t,i as n,n as r,r as i,s as a,t as o}from"./PopoverTrigger-Bg99LXGu.js";import"./useDirection-B1kSZwKq.js";import"./PopperAnchor-Sq61S0mP.js";import"./useId-Da-MS2me.js";import"./useKbd-BvGB3m10.js";import"./PopperContent-b6gGwF_E.js";import"./Teleport-BJpx-KiC.js";import"./Label-BsQm4x39.js";import{$i as s,Ea as c,Fi as l,Li as u,Mi as d,Ni as f,Nt as p,Oi as m,Pi as h,Ri as g,Ta as _,Xn as v,Yi as ee,Zi as y,Zt as te,a as b,da as x,ji as ne,ka as S,o as C,rn as w,ya as T,yn as re,yr as E}from"./index-CHNvwQRL.js";import{t as D}from"./button-BRhnnMH3.js";import"./button-DSlecn3R.js";import{t as O}from"./Card-BJPZ_LNY.js";import{t as k}from"./Label-q_qRHf8-.js";import{t as A}from"./badge-BQsIJJpl.js";var j=`/org/tax`,M={getTaxFramework(){return C.get(`${j}/framework`,{organisationAware:!0,authorizeRequest:!0})},updateTaxPolicies(e){return C.put(`${j}/framework`,{data:e,organisationAware:!0,authorizeRequest:!0})},reinitializeFramework(){return C.post(`${j}/framework/initialize`,{organisationAware:!0,authorizeRequest:!0})},generateReport(e,t){return C.get(`${j}/report`,{query:{startDate:e,endDate:t},organisationAware:!0,authorizeRequest:!0})},async exportReport(e,t){return await C.get(`${j}/report/export`,{query:{startDate:e,endDate:t},organisationAware:!0,authorizeRequest:!0,responseType:`blob`})},async downloadReport(e,t){try{let n=await this.exportReport(e,t),r=new Blob([n],{type:`application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`}),i=window.URL.createObjectURL(r),a=document.createElement(`a`);a.href=i,a.setAttribute(`download`,`TaxReport_${e}_to_${t}.xlsx`),document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(i)}catch(e){throw console.error(`Failed to download tax report:`,e),e}}},ie={class:`h-full flex flex-col bg-stone-50`},ae={class:`p-6 bg-white border-b border-stone-200`},oe={class:`flex items-center justify-between mb-4`},se={class:`flex items-center gap-2`},ce={class:`flex flex-wrap items-end gap-4`},le={class:`space-y-1`},ue={class:`space-y-1`},N={class:`flex-1 overflow-y-auto p-6`,style:{"scrollbar-width":`none`}},P={key:0,class:`flex items-center justify-center h-64`},F={class:`text-center`},I={key:1,class:`flex items-center justify-center h-64`},L={class:`text-center`},R={key:2,class:`space-y-6`},z={class:`grid grid-cols-1 md:grid-cols-4 gap-4`},B={class:`text-2xl font-bold text-slate-800`},V={class:`text-2xl font-bold text-slate-800`},H={class:`text-2xl font-bold text-red-600`},U={class:`text-2xl font-bold text-green-600`},de={key:0,class:`text-slate-400 text-sm`},fe={key:1,class:`space-y-3`},pe={class:`flex items-center gap-2`},me={class:`text-sm font-medium text-slate-700`},he={class:`text-sm font-semibold text-slate-800`},ge={class:`p-4 border-b border-slate-100 flex items-center justify-between`},_e={class:`text-sm text-slate-500`},ve={class:`overflow-x-auto`},ye={class:`w-full text-sm`},be={class:`divide-y divide-slate-100`},xe={class:`px-4 py-3 text-slate-600`},Se={class:`px-4 py-3 font-medium text-slate-800 max-w-xs truncate`},Ce={class:`px-4 py-3`},we={key:1,class:`text-slate-400 text-xs`},Te={class:`px-4 py-3 text-right font-medium`},Ee={class:`px-4 py-3 text-right text-red-600 font-medium`},De={class:`px-4 py-3 text-right text-green-600 font-medium`},Oe={class:`px-4 py-3`},ke={class:`flex flex-wrap gap-1`},W={__name:`TaxReportTab`,props:{account:Object},setup(C){let j=b().toast,W=new e(`en-US`,{dateStyle:`medium`}),G=T(null),K=T(null),q=T(!1),J=T(!1),Y=t(a()),X=T(Y.subtract({months:3})),Z=T(Y),Q=ne(()=>X.value&&Z.value);ee(async()=>{await Ae()});async function Ae(){try{G.value=await M.getTaxFramework()}catch(e){console.error(`Failed to load tax framework:`,e)}}async function je(){if(Q.value)try{q.value=!0;let e=X.value.toString(),t=Z.value.toString();K.value=await M.generateReport(e,t),j({title:`Report Generated`,description:`Analyzed ${K.value.totalTransactions} transactions`})}catch(e){console.error(`Failed to generate report:`,e),j({title:`Error`,description:`Failed to generate tax report`,variant:`destructive`})}finally{q.value=!1}}async function Me(){if(K.value)try{J.value=!0;let e=X.value.toString(),t=Z.value.toString();await M.downloadReport(e,t),j({title:`Download Started`,description:`Your tax report is downloading`})}catch(e){console.error(`Failed to download report:`,e),j({title:`Error`,description:`Failed to download report`,variant:`destructive`})}finally{J.value=!1}}function $(e){return e==null?`â‚¦0.00`:new Intl.NumberFormat(`en-NG`,{style:`currency`,currency:`NGN`}).format(e)}function Ne(e){return e?new Date(e).toLocaleDateString(`en-US`,{year:`numeric`,month:`short`,day:`numeric`}):`N/A`}return(e,t)=>(y(),l(`div`,ie,[d(`div`,ae,[d(`div`,oe,[t[2]||=d(`div`,null,[d(`h2`,{class:`text-xl font-semibold text-slate-800`},`Tax Report`),d(`p`,{class:`text-sm text-slate-500`},`Generate tax reports based on your transaction history`)],-1),d(`div`,se,[G.value?(y(),f(_(A),{key:0,variant:`outline`,class:`rounded-full`},{default:x(()=>[g(_(te),{class:`h-3 w-3 mr-1`}),u(` `+S(G.value.jurisdiction),1)]),_:1})):h(``,!0)])]),d(`div`,ce,[d(`div`,le,[g(_(k),{class:`text-xs text-slate-500`},{default:x(()=>[...t[3]||=[u(`Start Date`,-1)]]),_:1}),g(_(i),null,{default:x(()=>[g(_(o),{"as-child":``},{default:x(()=>[g(_(D),{variant:`outline`,class:c(_(E)(`w-40 justify-start text-left font-normal rounded-full`,!X.value&&`text-muted-foreground`))},{default:x(()=>[g(_(v),{class:`mr-2 h-4 w-4`}),u(` `+S(X.value?_(W).format(X.value.toDate(_(a)())):`Pick date`),1)]),_:1},8,[`class`])]),_:1}),g(_(r),{class:`w-auto p-0`},{default:x(()=>[g(_(n),{modelValue:X.value,"onUpdate:modelValue":t[0]||=e=>X.value=e,"initial-focus":``},null,8,[`modelValue`])]),_:1})]),_:1})]),d(`div`,ue,[g(_(k),{class:`text-xs text-slate-500`},{default:x(()=>[...t[4]||=[u(`End Date`,-1)]]),_:1}),g(_(i),null,{default:x(()=>[g(_(o),{"as-child":``},{default:x(()=>[g(_(D),{variant:`outline`,class:c(_(E)(`w-40 justify-start text-left font-normal rounded-full`,!Z.value&&`text-muted-foreground`))},{default:x(()=>[g(_(v),{class:`mr-2 h-4 w-4`}),u(` `+S(Z.value?_(W).format(Z.value.toDate(_(a)())):`Pick date`),1)]),_:1},8,[`class`])]),_:1}),g(_(r),{class:`w-auto p-0`},{default:x(()=>[g(_(n),{modelValue:Z.value,"onUpdate:modelValue":t[1]||=e=>Z.value=e,"initial-focus":``},null,8,[`modelValue`])]),_:1})]),_:1})]),g(_(D),{onClick:je,disabled:!Q.value||q.value,class:`rounded-full`},{default:x(()=>[q.value?(y(),f(_(p),{key:0,class:`h-4 w-4 mr-2 animate-spin`})):(y(),f(_(w),{key:1,class:`h-4 w-4 mr-2`})),t[5]||=u(` Generate Report `,-1)]),_:1},8,[`disabled`]),K.value?(y(),f(_(D),{key:0,variant:`outline`,onClick:Me,disabled:J.value,class:`rounded-full`},{default:x(()=>[J.value?(y(),f(_(p),{key:0,class:`h-4 w-4 mr-2 animate-spin`})):(y(),f(_(re),{key:1,class:`h-4 w-4 mr-2`})),t[6]||=u(` Export XLSX `,-1)]),_:1},8,[`disabled`])):h(``,!0)])]),d(`div`,N,[q.value?(y(),l(`div`,P,[d(`div`,F,[g(_(p),{class:`h-8 w-8 animate-spin mx-auto mb-4 text-blue-600`}),t[7]||=d(`p`,{class:`text-slate-500`},`Generating tax report...`,-1)])])):K.value?(y(),l(`div`,R,[d(`div`,z,[g(_(O),{class:`p-4`},{default:x(()=>[t[10]||=d(`div`,{class:`text-xs text-slate-500 mb-1`},`Total Transactions`,-1),d(`div`,B,S(K.value.totalTransactions),1)]),_:1}),g(_(O),{class:`p-4`},{default:x(()=>[t[11]||=d(`div`,{class:`text-xs text-slate-500 mb-1`},`Gross Amount`,-1),d(`div`,V,S($(K.value.totalGrossAmount)),1)]),_:1}),g(_(O),{class:`p-4`},{default:x(()=>[t[12]||=d(`div`,{class:`text-xs text-slate-500 mb-1`},`Total Tax Liability`,-1),d(`div`,H,S($(K.value.totalTaxLiability)),1)]),_:1}),g(_(O),{class:`p-4`},{default:x(()=>[t[13]||=d(`div`,{class:`text-xs text-slate-500 mb-1`},`Net Amount`,-1),d(`div`,U,S($(K.value.netAmount)),1)]),_:1})]),g(_(O),{class:`p-6`},{default:x(()=>[t[15]||=d(`h3`,{class:`text-lg font-semibold mb-4`},`Tax Breakdown by Policy`,-1),Object.keys(K.value.taxSummaryByPolicy||{}).length===0?(y(),l(`div`,de,` No taxes applied in this period `)):(y(),l(`div`,fe,[(y(!0),l(m,null,s(K.value.taxSummaryByPolicy,(e,n)=>(y(),l(`div`,{key:n,class:`flex items-center justify-between py-2 border-b border-slate-100 last:border-0`},[d(`div`,pe,[t[14]||=d(`div`,{class:`h-2 w-2 rounded-full bg-blue-500`},null,-1),d(`span`,me,S(n),1)]),d(`span`,he,S($(e)),1)]))),128))]))]),_:1}),g(_(O),{class:`p-0 overflow-hidden`},{default:x(()=>[d(`div`,ge,[t[16]||=d(`h3`,{class:`font-semibold`},`Transaction Details`,-1),d(`span`,_e,S(K.value.lines?.length||0)+` transactions`,1)]),d(`div`,ve,[d(`table`,ye,[t[17]||=d(`thead`,{class:`bg-slate-50 text-slate-600 text-xs uppercase`},[d(`tr`,null,[d(`th`,{class:`px-4 py-3 text-left`},`Date`),d(`th`,{class:`px-4 py-3 text-left`},`Description`),d(`th`,{class:`px-4 py-3 text-left`},`Category`),d(`th`,{class:`px-4 py-3 text-right`},`Gross`),d(`th`,{class:`px-4 py-3 text-right`},`Tax`),d(`th`,{class:`px-4 py-3 text-right`},`Net`),d(`th`,{class:`px-4 py-3 text-left`},`Policies`)])],-1),d(`tbody`,be,[(y(!0),l(m,null,s(K.value.lines,e=>(y(),l(`tr`,{key:e.transactionReference,class:`hover:bg-slate-50`},[d(`td`,xe,S(Ne(e.transactionDate)),1),d(`td`,Se,S(e.description),1),d(`td`,Ce,[e.category?(y(),f(_(A),{key:0,variant:`outline`,class:`rounded-full text-xs`},{default:x(()=>[u(S(e.category),1)]),_:2},1024)):(y(),l(`span`,we,`Uncategorized`))]),d(`td`,Te,S($(e.grossAmount)),1),d(`td`,Ee,S($(e.totalTax)),1),d(`td`,De,S($(e.netAmount)),1),d(`td`,Oe,[d(`div`,ke,[(y(!0),l(m,null,s(e.appliedPolicyIds,e=>(y(),f(_(A),{key:e,variant:`secondary`,class:`rounded-full text-xs`},{default:x(()=>[u(S(e),1)]),_:2},1024))),128))])])]))),128))])])])]),_:1})])):(y(),l(`div`,I,[d(`div`,L,[g(_(w),{class:`h-12 w-12 text-slate-300 mx-auto mb-4`}),t[8]||=d(`h3`,{class:`text-lg font-medium text-slate-600 mb-2`},`No Report Generated`,-1),t[9]||=d(`p`,{class:`text-sm text-slate-400 max-w-md`},` Select a date range and click "Generate Report" to create your tax report. `,-1)])]))])]))}};export{W as default};