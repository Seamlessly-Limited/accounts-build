import"./useFormControl-BoSoz5bk.js";import"./ListboxItem-CrspQUEb.js";import"./useNonce-Cry77bU8.js";import"./nullish-CfjOSA4G.js";import"./useArrowNavigation-siWGBYoD.js";import"./ConfigProvider-BeNpEDZu.js";import"./useHideOthers-8j3pZZC2.js";import"./PopoverTrigger-DWkr4HdR.js";import"./useDirection-CkCaHLjJ.js";import"./PopperAnchor-DePKnfPt.js";import"./useId-C9uHTJK1.js";import"./useKbd-BvGB3m10.js";import"./PopperContent-CkzV4Efh.js";import"./useTypeahead-J2lSWUJi.js";import"./DialogPortal-DagulIUC.js";import"./Teleport-CO7T90ZX.js";import"./utils-1j6W-LC4.js";import"./DialogTitle-KNRScshA.js";import"./sheet-BQZlRCZC.js";import"./utils-d0L3vlW4.js";import"./RovingFocusGroup-Dae6_7oN.js";import"./VisuallyHiddenInput-Cr3vcfNb.js";import"./ComboboxItem-BV80ucMH.js";import"./ComboboxGroup-BOfthHuH.js";import"./DropdownMenuTrigger-EYKS1OZz.js";import"./MenuSeparator-Bi9Os3Cj.js";import"./DropdownMenuSeparator-BHAgwTys.js";import"./Label-BQWlwCJI.js";import"./SelectViewport-C4doWK-Y.js";import"./SelectGroup-D40CeBwS.js";import{$ as e,Aa as t,Bi as n,E as r,Hi as i,Ii as a,It as o,Li as s,Ni as c,Pa as l,Pn as u,Qt as d,Ri as f,Sn as p,Ui as m,_ as h,_n as g,bt as _,da as v,dt as y,ea as ee,g as b,ga as x,ia as S,ja as C,kn as w,na as T,o as E,sa as D,sn as te,wa as O,xr as ne,zi as k}from"./index-BW6FH5S4.js";import"./typeof-CVhf3tVy.js";import"./purify.es-C6pmr44S.js";import{n as A,t as j}from"./DialogContent-DzO0B1dQ.js";import{n as M,r as N,t as P}from"./DialogTitle-BAO4s_Rj.js";import{t as F}from"./DialogFooter-BGPl6WoG.js";import{t as I}from"./WorkspaceStore-DkbvTQrR.js";import{t as L}from"./Input-AKTRhZx5.js";import{t as R}from"./button-BIS6kOZQ.js";import{i as re,n as z,r as ie,t as B}from"./DropdownMenuTrigger-B4m7ovRB.js";import{t as V}from"./DropdownMenuSeparator-B4Xk_Axi.js";import"./DynamicIcon-D5-EdDm3.js";import"./button-Cg1Yo4L-.js";import"./BottomSheet-Ckf0geOJ.js";import"./viewRegistry-B23Q0QQW.js";import{t as H}from"./Label-CWz-ReQU.js";import"./LinkField-C2IIEkLF.js";import"./DateField-CuEp_QeT.js";import"./SelectValue-CvGnKkl4.js";import{t as U}from"./Textarea-DDsE0ukV.js";import"./badge-DeOd_cPn.js";import{t as W}from"./DocForm-Cw9ikweC.js";import"./marked.esm-DidRfey3.js";import{n as G,t as K}from"./PDFExportService-kLn7dH0W.js";var q={class:`grid gap-4 py-4`},J={class:`grid gap-2`},Y={class:`grid gap-2`},X={class:`grid gap-2`},ae={__name:`ShareDialog`,props:{modelValue:{type:Boolean,default:!1},doctype:{type:String,required:!0},docName:{type:String,required:!0},defaultRecipient:{type:String,default:``},docData:{type:Object,default:()=>({})}},emits:[`update:modelValue`,`sent`],setup(e,{emit:n}){let r=e,c=n,{toast:u}=b(),d=O(!1),p=a({get:()=>r.modelValue,set:e=>c(`update:modelValue`,e)}),h=O({recipient:``,subject:``,content:``});v(()=>r.modelValue,e=>{e&&(h.value.recipient=r.defaultRecipient||r.docData.email||``,h.value.subject=`${r.doctype} Shared: ${r.docName}`,h.value.content=`Please find the attached ${r.doctype} ${r.docName}.`)});let g=async()=>{if(h.value.recipient){d.value=!0;try{await E.post(`/org/doc/Notification`,{data:{related_document:r.docName,recipient:h.value.recipient,channel:`Email`,subject:h.value.subject,content:h.value.content,status:`Queued`},authorizeRequest:!0,organisationAware:!0}),u({title:`Notification Queued`,description:`Email to ${h.value.recipient} has been queued.`,variant:`success`}),p.value=!1,c(`sent`)}catch(e){console.error(e),u({title:`Failed to Share`,description:e.response?.data?.message||e.message,variant:`destructive`})}finally{d.value=!1}}};return(n,r)=>(T(),f(t(A),{open:p.value,"onUpdate:open":r[4]||=e=>p.value=e},{default:x(()=>[m(t(j),{class:`sm:max-w-[500px]`},{default:x(()=>[m(t(M),null,{default:x(()=>[m(t(P),null,{default:x(()=>[i(`Share `+l(e.doctype),1)]),_:1}),m(t(N),null,{default:x(()=>[...r[5]||=[i(` Send this document via email. `,-1)]]),_:1})]),_:1}),s(`div`,q,[s(`div`,J,[m(t(H),{for:`recipient`},{default:x(()=>[...r[6]||=[i(`Recipient Email`,-1)]]),_:1}),m(t(L),{id:`recipient`,modelValue:h.value.recipient,"onUpdate:modelValue":r[0]||=e=>h.value.recipient=e,placeholder:`name@example.com`,type:`email`},null,8,[`modelValue`])]),s(`div`,Y,[m(t(H),{for:`subject`},{default:x(()=>[...r[7]||=[i(`Subject`,-1)]]),_:1}),m(t(L),{id:`subject`,modelValue:h.value.subject,"onUpdate:modelValue":r[1]||=e=>h.value.subject=e,placeholder:`Subject line`},null,8,[`modelValue`])]),s(`div`,X,[m(t(H),{for:`message`},{default:x(()=>[...r[8]||=[i(`Message (Optional)`,-1)]]),_:1}),m(t(U),{id:`message`,modelValue:h.value.content,"onUpdate:modelValue":r[2]||=e=>h.value.content=e,placeholder:`Add a personal message...`,rows:`4`},null,8,[`modelValue`])])]),m(t(F),null,{default:x(()=>[m(t(R),{variant:`outline`,onClick:r[3]||=e=>p.value=!1},{default:x(()=>[...r[9]||=[i(`Cancel`,-1)]]),_:1}),m(t(R),{onClick:g,disabled:d.value||!h.value.recipient},{default:x(()=>[d.value?(T(),f(t(o),{key:0,class:`w-4 h-4 mr-2 animate-spin`})):k(``,!0),i(` `+l(d.value?`Sending...`:`Send`),1)]),_:1},8,[`disabled`])]),_:1})]),_:1})]),_:1},8,[`open`]))}},oe={class:`h-full flex flex-col bg-slate-50/50`},se={class:`flex-none px-6 py-3 bg-white border-b border-gray-200 flex items-center justify-between sticky top-0 z-20`},ce={class:`flex items-center space-x-4`},le={class:`p-2 rounded-lg bg-stone-100`},ue={class:`flex items-center gap-2`},de={class:`text-[10px] font-bold text-stone-400 uppercase tracking-widest`},fe={class:`text-lg font-bold text-stone-900 leading-tight`},pe={class:`flex items-center gap-2`},Z={class:`flex items-center bg-stone-100 p-0.5 rounded-full border border-stone-200 shadow-sm`},me={class:`p-2 hover:bg-stone-100 rounded-full text-stone-500 transition-colors`},he={class:`flex-1 overflow-auto`},ge={key:0,class:`h-full flex items-center justify-center`},_e={key:1,class:`h-full`},ve={key:0,class:`max-w-4xl mx-auto py-8 px-6`},ye={class:`bg-white rounded-3xl shadow-xl shadow-stone-200/50 border border-stone-200/60 overflow-hidden ring-1 ring-black/5`},be={class:`px-8 py-8 border-b border-stone-100 flex justify-between items-start bg-gradient-to-br from-white to-stone-50/50`},xe={class:`text-3xl font-black text-stone-900 tracking-tight`},Se={class:`text-stone-500 mt-1 flex items-center gap-2`},Ce={class:`text-right`},we={class:`text-sm font-medium text-stone-600`},Te={class:`p-8 space-y-10`},Ee={class:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-12 gap-y-8`},De={class:`block text-[10px] font-bold text-stone-400 uppercase tracking-widest group-hover:text-stone-500 transition-colors`},Oe={class:`text-sm font-semibold text-stone-800 break-words`},ke=[`onClick`],Ae={key:0,class:`space-y-8 pt-6 border-t border-stone-100`},je={class:`block text-[10px] font-bold text-stone-400 uppercase tracking-widest`},Me={class:`text-sm text-stone-600 leading-relaxed bg-stone-50/50 p-4 rounded-xl border border-stone-100 whitespace-pre-wrap`},Ne={class:`pt-10 mt-10 border-t border-stone-100 flex items-center justify-between text-[11px] text-stone-400`},Pe={class:`flex items-center gap-4`},Fe={class:`flex items-center gap-1`},Ie={class:`flex items-center gap-1`},Le={class:`flex items-center gap-1 font-mono uppercase opacity-60`},Re={key:1,class:`h-full`},Q={__name:`DocumentView`,props:{doctype:{type:String,required:!0},name:{type:String,required:!0},initialMode:{type:String,default:`view`}},setup(v){let A=v,{toast:j}=b(),M=I(),N=O(!0),P=O(A.initialMode),F=O({}),L=O({}),R=O(!1),H=a(()=>L.value.fields?L.value.fields.filter(e=>![`TABLE`,`SECTION_BREAK`,`COLUMN_BREAK`,`TEXT`,`LONG_TEXT`,`HTML`,`JSON`,`HEADING`].includes(e.fieldtype)&&!e.hidden):[]),U=a(()=>L.value.fields?L.value.fields.filter(e=>[`TEXT`,`LONG_TEXT`,`HTML`,`JSON`].includes(e.fieldtype)&&!e.hidden):[]);ee(q);async function q(){N.value=!0;try{let[e,t]=await Promise.all([E.get(`/org/doctypes/${encodeURIComponent(A.doctype)}`,{authorizeRequest:!0,organisationAware:!0}),E.get(`/org/doc/${encodeURIComponent(A.doctype)}/${encodeURIComponent(A.name)}`,{authorizeRequest:!0,organisationAware:!0})]);L.value=e.data||e,F.value=t.data||t}catch(e){console.error(e),j({title:`Fetch failed`,description:e.message,variant:`destructive`})}finally{N.value=!1}}function J(e){F.value=e,P.value=`view`,j({title:`Updated`,description:`Changes saved successfully`,variant:`success`})}function Y(e){return h[e]||te}function X(e){return typeof e==`number`?{0:`Draft`,1:`Submitted`,2:`Cancelled`}[e]||`Unknown`:e||`Draft`}function Q(e){return{Draft:`bg-stone-100 text-stone-600`,Submitted:`bg-blue-100 text-blue-600`,Paid:`bg-green-100 text-green-600`,Cancelled:`bg-red-100 text-red-600`,Active:`bg-indigo-100 text-indigo-600`}[X(e)]||`bg-stone-100 text-stone-600`}function $(e){return e?new Date(e).toLocaleString(void 0,{year:`numeric`,month:`short`,day:`numeric`,hour:`2-digit`,minute:`2-digit`}):`—`}function ze(e){return e?new Date(e).toLocaleDateString(void 0,{year:`numeric`,month:`short`,day:`numeric`}):`—`}function Be(e){return e==null?`—`:new Intl.NumberFormat(void 0,{style:`currency`,currency:F.value.currency||`NGN`}).format(e)}function Ve(e,t){!e||!t||M.openTab({id:`doctype-view-${e}-${t}`,title:t,icon:`FileText`,type:`doctype-view`,doctype:e,docName:t,closable:!0})}function He(){R.value=!0}function Ue(){M.openTab({id:`archive-${A.doctype}-${A.name}`,title:`Archive: ${A.name}`,type:`archive`,doctype:A.doctype,docName:A.name,closable:!0})}function We(){j({title:`Duplicate`,description:`Duplication coming soon`})}async function Ge(){try{if(A.doctype.toLowerCase().includes(`invoice`)){let e={};try{e=(await E.get(`/org/doc/Brand Settings/Brand Settings`,{authorizeRequest:!0,organisationAware:!0})).data||{}}catch{}G(F.value,e)}else K(F.value,L.value);j({title:`PDF Generated`,description:`${F.value.name||`Document`}.pdf has been downloaded`,variant:`success`})}catch(e){console.error(`PDF export failed:`,e),j({title:`Export Failed`,description:e.message||`Could not generate PDF`,variant:`destructive`})}}return(a,h)=>(T(),n(c,null,[s(`div`,oe,[s(`header`,se,[s(`div`,ce,[s(`div`,le,[(T(),f(D(Y(L.value.icon)),{class:`w-5 h-5 text-stone-600`}))]),s(`div`,null,[s(`div`,ue,[s(`span`,de,l(L.value.name),1),F.value.status?(T(),n(`span`,{key:0,class:C([`px-1.5 py-0.5 rounded-full text-[9px] font-bold uppercase tracking-wider`,Q(F.value.status||F.value.docstatus)])},l(X(F.value.status||F.value.docstatus)),3)):k(``,!0)]),s(`h1`,fe,l(F.value[L.value.title_field]||F.value.name||v.name),1)])]),s(`div`,pe,[s(`div`,Z,[s(`button`,{onClick:h[0]||=e=>P.value=`view`,class:C([`px-4 py-1.5 rounded-full text-xs font-semibold transition-all flex items-center gap-2`,P.value===`view`?`bg-white text-stone-900 shadow-sm ring-1 ring-stone-900/5`:`text-stone-500 hover:text-stone-700`])},[m(t(g),{class:`w-3.5 h-3.5`}),h[3]||=i(` View `,-1)],2),s(`button`,{onClick:h[1]||=e=>P.value=`edit`,class:C([`px-4 py-1.5 rounded-full text-xs font-semibold transition-all flex items-center gap-2`,P.value===`edit`?`bg-white text-stone-900 shadow-sm ring-1 ring-stone-900/5`:`text-stone-500 hover:text-stone-700`])},[m(t(_),{class:`w-3.5 h-3.5`}),h[4]||=i(` Edit `,-1)],2)]),h[8]||=s(`div`,{class:`w-px h-6 bg-stone-200 mx-1`},null,-1),s(`button`,{onClick:He,class:`p-2 hover:bg-stone-100 rounded-full text-stone-500 transition-colors`},[m(t(e),{class:`w-4 h-4`})]),m(t(re),null,{default:x(()=>[m(t(B),{"as-child":``},{default:x(()=>[s(`button`,me,[m(t(p),{class:`w-4 h-4`})])]),_:1}),m(t(ie),{align:`end`},{default:x(()=>[m(t(z),{onClick:Ge},{default:x(()=>[m(t(y),{class:`w-4 h-4 mr-2`}),h[5]||=i(` Print `,-1)]),_:1}),m(t(z),{onClick:We},{default:x(()=>[m(t(w),{class:`w-4 h-4 mr-2`}),h[6]||=i(` Duplicate `,-1)]),_:1}),m(t(V)),m(t(z),{onClick:Ue,class:`text-amber-600`},{default:x(()=>[m(t(ne),{class:`w-4 h-4 mr-2`}),h[7]||=i(` Archive `,-1)]),_:1})]),_:1})]),_:1})])]),s(`div`,he,[N.value?(T(),n(`div`,ge,[m(t(o),{class:`w-8 h-8 animate-spin text-stone-300`})])):(T(),n(`div`,_e,[P.value===`view`?(T(),n(`div`,ve,[s(`div`,ye,[s(`div`,be,[s(`div`,null,[s(`h2`,xe,l(F.value[L.value.title_field]||F.value.name||v.name),1),s(`p`,Se,[m(t(d),{class:`w-3.5 h-3.5 opacity-40`}),i(` `+l(F.value.name),1)])]),s(`div`,Ce,[h[9]||=s(`p`,{class:`text-[10px] font-bold text-stone-400 uppercase tracking-widest mb-1`},`Created `,-1),s(`p`,we,l($(F.value.created_at)),1)])]),s(`div`,Te,[s(`div`,Ee,[(T(!0),n(c,null,S(H.value,e=>(T(),n(`div`,{key:e.fieldname,class:`space-y-1.5 group`},[s(`label`,De,l(e.label),1),s(`div`,Oe,[e.fieldtype===`CURRENCY`?(T(),n(c,{key:0},[i(l(Be(F.value[e.fieldname])),1)],64)):e.fieldtype===`CHECKBOX`?(T(),n(`span`,{key:1,class:C(F.value[e.fieldname]?`text-green-600`:`text-stone-400 opacity-50`)},l(F.value[e.fieldname]?`Yes`:`No`),3)):e.fieldtype===`DATE`?(T(),n(c,{key:2},[i(l(ze(F.value[e.fieldname])),1)],64)):e.fieldtype===`LINK`?(T(),n(`button`,{key:3,onClick:t=>Ve(e.options,F.value[e.fieldname]),class:`text-blue-600 hover:text-blue-800 hover:underline decoration-2 underline-offset-4 decoration-blue-200 transition-all`},l(F.value[e.fieldname]),9,ke)):(T(),n(c,{key:4},[i(l(F.value[e.fieldname]||`—`),1)],64))])]))),128))]),U.value.length>0?(T(),n(`div`,Ae,[(T(!0),n(c,null,S(U.value,e=>(T(),n(`div`,{key:e.fieldname,class:`space-y-2`},[s(`label`,je,l(e.label),1),s(`div`,Me,l(F.value[e.fieldname]||`No content provided.`),1)]))),128))])):k(``,!0),s(`div`,Ne,[s(`div`,Pe,[s(`span`,Fe,[m(t(r),{class:`w-3 h-3`}),i(` Owner: `+l(F.value.owner||`System`),1)]),s(`span`,Ie,[m(t(u),{class:`w-3 h-3`}),i(` Modified: `+l($(F.value.modified_at||F.value.updated_at)),1)])]),s(`div`,Le,` MOD: `+l(L.value.module),1)])])])])):(T(),n(`div`,Re,[m(W,{doctype:v.doctype,name:v.name,"is-new":!1,"is-embedded":``,onSaved:J},null,8,[`doctype`,`name`])]))]))])]),F.value.name?(T(),f(ae,{key:0,modelValue:R.value,"onUpdate:modelValue":h[2]||=e=>R.value=e,doctype:v.doctype,docName:v.name,docData:F.value},null,8,[`modelValue`,`doctype`,`docName`,`docData`])):k(``,!0)],64))}};export{Q as default};