import{Bt as e,Dn as t,Fa as n,Hi as r,Ki as i,La as a,Li as ee,Mi as te,O as ne,Oa as o,Oi as re,Pa as s,Ra as c,Ui as l,Vi as u,Wi as d,Yi as f,_t as ie,b as ae,ba as oe,ca as se,gt as ce,i as p,in as le,oa as m,qi as h,vt as g,xa as _,zi as v}from"./index-BjUg3jag.js";var y={class:`flex items-center gap-2 text-slate-100`},ue={class:`flex items-center gap-1`},de={class:`flex-1 flex flex-col p-4 bg-slate-50 overflow-hidden`},fe={key:0,class:`flex-1 flex flex-col min-h-0 gap-3`},pe={class:`flex items-center gap-2`},b={class:`btn-secondary cursor-pointer`},x=[`disabled`],S={key:0,class:`bg-red-50 text-red-600 text-xs p-3 rounded-lg border border-red-100`},C={key:1,class:`flex-1 flex flex-col min-h-0 gap-3`},w={class:`flex items-center justify-between`},T={class:`flex-1 overflow-auto bg-white border border-slate-200 rounded-lg`},E={class:`w-full text-xs text-left`},D={class:`divide-y divide-slate-100`},O=[`title`],k={class:`p-2 text-right text-slate-600`},A={class:`p-2 text-right text-slate-600`},j={class:`p-2 text-center`},M={class:`p-2 text-right text-slate-600`},N={class:`bg-slate-100 rounded-lg p-3 grid grid-cols-3 gap-2 text-center`},P={class:`text-sm font-semibold text-slate-700`},F={class:`text-sm font-semibold text-slate-700`},I={class:`text-sm font-semibold text-slate-700`},L=f({__name:`ConsultantWidget`,props:{open:{type:Boolean}},emits:[`update:open`],setup(f,{emit:p}){let L=p,R=o(``),z=o(!1),B=o(!1),V=o(null),H=o(null),U=o(``),W=o(null),G=o({x:window.innerWidth-450,y:100}),K=o({width:420,height:600}),q=o(!1),J=o(!1),Y=o({x:0,y:0}),me=()=>{L(`update:open`,!1)},he=()=>{B.value=!B.value,B.value&&(G.value={x:window.innerWidth-K.value.width-20,y:100})},ge=async e=>{let t=e.target.files?.[0];t&&(t.type===`text/csv`||t.name.endsWith(`.csv`)?R.value=await t.text():H.value=`Excel parsing requires backend processing. Please save as CSV or paste data.`)},_e=async()=>{if(R.value.trim()){z.value=!0,H.value=null,V.value=null,U.value=``;try{let e=await fetch(`/api/consultant/parse`,{method:`POST`,headers:{"Content-Type":`application/json`},body:JSON.stringify({data:R.value})});if(!e.ok)throw Error(`Failed to start parsing`);if(!e.body)throw Error(`No response body`);let t=e.body.getReader(),n=new TextDecoder;for(;;){let{value:e,done:r}=await t.read();if(r)break;let i=n.decode(e,{stream:!0}).split(`
`);for(let e of i)if(e.startsWith(`data:`)){let t=e.slice(5);U.value+=t}}try{let e=JSON.parse(U.value);e.error?H.value=e.error:V.value=e}catch(e){console.error(`Failed to parse JSON response`,e),H.value=`Failed to parse consultant response. Please try again.`}}catch(e){H.value=e.message}finally{z.value=!1}}},ve=()=>{if(!V.value?.sale?.items)return;let e=V.value.sale.items,t=[[`Item`,`Qty`,`Unit Price`,`Net Amount`,`VAT Category`,`VAT Rate`,`VAT Amount`].join(`,`),...e.map(e=>[`"${e.item_name}"`,e.qty,e.unit_price,e.net_amount,e.vat_category,`${e.vat_rate}%`,e.vat_amount].join(`,`))].join(`
`),n=new Blob([t],{type:`text/csv`}),r=URL.createObjectURL(n),i=document.createElement(`a`);i.href=r,i.download=`VAT_Schedule_${new Date().toISOString().split(`T`)[0]}.csv`,i.click()},ye=e=>{if(B.value||J.value||!W.value||e.target.closest(`button`))return;q.value=!0;let t=W.value.getBoundingClientRect();Y.value={x:e.clientX-t.left,y:e.clientY-t.top},document.addEventListener(`mousemove`,X),document.addEventListener(`mouseup`,Z)},X=e=>{if(!q.value)return;let t=e.clientX-Y.value.x,n=e.clientY-Y.value.y,r=window.innerWidth-K.value.width,i=window.innerHeight-K.value.height;G.value={x:Math.max(0,Math.min(t,r)),y:Math.max(0,Math.min(n,i))}},Z=()=>{q.value=!1,document.removeEventListener(`mousemove`,X),document.removeEventListener(`mouseup`,Z)},be=e=>{J.value=!0,document.addEventListener(`mousemove`,Q),document.addEventListener(`mouseup`,$)},Q=e=>{if(!J.value||!W.value)return;let t=W.value.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top;K.value={width:Math.max(300,n),height:Math.max(400,r)}},$=()=>{J.value=!1,document.removeEventListener(`mousemove`,Q),document.removeEventListener(`mouseup`,$)};return(o,p)=>(m(),r(v,{to:`body`},[h(re,{name:`fade`},{default:oe(()=>[f.open?(m(),d(`div`,{key:0,ref_key:`dialogRef`,ref:W,class:`fixed bg-white rounded-xl shadow-2xl border border-slate-200 flex flex-col overflow-hidden z-[100]`,style:a({left:`${G.value.x}px`,top:`${G.value.y}px`,width:`${K.value.width}px`,height:`${K.value.height}px`})},[u(`div`,{class:`h-10 bg-slate-900 flex items-center justify-between px-3 cursor-move shrink-0`,onMousedown:ye},[u(`div`,y,[h(s(le),{class:`w-4 h-4 text-slate-500`}),p[2]||=u(`span`,{class:`text-sm font-medium`},`VAT Consultant`,-1)]),u(`div`,ue,[u(`button`,{onClick:he,class:`p-1 rounded hover:bg-slate-800 text-slate-400 hover:text-white transition-colors`},[B.value?(m(),r(s(g),{key:1,class:`w-3.5 h-3.5 text-blue-400`})):(m(),r(s(ie),{key:0,class:`w-3.5 h-3.5`}))]),u(`button`,{onClick:me,class:`p-1 rounded hover:bg-slate-800 text-slate-400 hover:text-white transition-colors`},[h(s(ae),{class:`w-4 h-4`})])])],32),u(`div`,de,[V.value?(m(),d(`div`,C,[u(`div`,w,[p[7]||=u(`div`,{class:`text-xs text-slate-500 font-medium uppercase tracking-wider`},` VAT Schedule Preview `,-1),u(`button`,{onClick:ve,class:`text-xs flex items-center gap-1 text-blue-600 font-medium hover:underline`},[h(s(t),{class:`w-3 h-3`}),p[6]||=i(` Download CSV `,-1)])]),u(`div`,T,[u(`table`,E,[p[8]||=u(`thead`,{class:`bg-slate-50 text-slate-500 font-medium border-b border-slate-200 sticky top-0`},[u(`tr`,null,[u(`th`,{class:`p-2`},`Item`),u(`th`,{class:`p-2 text-right`},`Qty`),u(`th`,{class:`p-2 text-right`},`Net`),u(`th`,{class:`p-2 text-center`},`Cat`),u(`th`,{class:`p-2 text-right`},`VAT`)])],-1),u(`tbody`,D,[(m(!0),d(ee,null,se(V.value.sale.items,(e,t)=>(m(),d(`tr`,{key:t,class:`hover:bg-slate-50/50`},[u(`td`,{class:`p-2 font-medium text-slate-700 truncate max-w-[120px]`,title:e.item_name},c(e.item_name),9,O),u(`td`,k,c(e.qty),1),u(`td`,A,c(e.net_amount),1),u(`td`,j,[u(`span`,{class:n([`px-1.5 py-0.5 rounded-full text-[10px] font-medium`,{"bg-amber-100 text-amber-700":e.vat_category===`Standard Rated`,"bg-green-100 text-green-700":e.vat_category===`Zero Rated`,"bg-slate-100 text-slate-700":e.vat_category===`Exempt`}])},c(e.vat_category===`Standard Rated`?`S`:e.vat_category===`Zero Rated`?`Z`:`E`),3)]),u(`td`,M,c(e.vat_amount),1)]))),128))])])]),u(`div`,N,[u(`div`,null,[p[9]||=u(`div`,{class:`text-[10px] text-slate-500`},`Net Total`,-1),u(`div`,P,c(V.value.sale.items.reduce((e,t)=>e+t.net_amount,0).toLocaleString()),1)]),u(`div`,null,[p[10]||=u(`div`,{class:`text-[10px] text-slate-500`},`Total VAT`,-1),u(`div`,F,c(V.value.sale.items.reduce((e,t)=>e+t.vat_amount,0).toLocaleString()),1)]),u(`div`,null,[p[11]||=u(`div`,{class:`text-[10px] text-slate-500`},`Gross Total`,-1),u(`div`,I,c((V.value.sale.items.reduce((e,t)=>e+t.net_amount,0)+V.value.sale.items.reduce((e,t)=>e+t.vat_amount,0)).toLocaleString()),1)])]),u(`button`,{onClick:p[1]||=e=>{R.value=``,V.value=null},class:`btn-secondary w-full`},` New Analysis `)])):(m(),d(`div`,fe,[p[5]||=u(`div`,{class:`text-xs text-slate-500 font-medium uppercase tracking-wider`},` Input Sales Data `,-1),_(u(`textarea`,{"onUpdate:modelValue":p[0]||=e=>R.value=e,class:`flex-1 w-full bg-white border border-slate-200 rounded-lg p-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/20 resize-none font-mono`,placeholder:`Paste sales text here...
Example:
3 books at 1500 each
2 bottles of water at 200 each
Consulting service 50000`},null,512),[[te,R.value]]),u(`div`,pe,[u(`label`,b,[h(s(ne),{class:`w-4 h-4 mr-2`}),p[3]||=u(`span`,null,`Upload CSV`,-1),u(`input`,{type:`file`,accept:`.csv`,class:`hidden`,onChange:ge},null,32)]),u(`button`,{onClick:_e,class:`btn-primary ml-auto`,disabled:z.value||!R.value.trim()},[z.value?(m(),r(s(e),{key:0,class:`w-4 h-4 mr-2 animate-spin`})):(m(),r(s(ce),{key:1,class:`w-4 h-4 mr-2`})),p[4]||=i(` Process Data `,-1)],8,x)]),H.value?(m(),d(`div`,S,c(H.value),1)):l(``,!0)]))]),u(`div`,{class:`absolute bottom-0 right-0 w-4 h-4 cursor-nwse-resize`,onMousedown:be},[...p[12]||=[u(`svg`,{viewBox:`0 0 24 24`,class:`w-full h-full text-slate-300 fill-current`},[u(`path`,{d:`M22 22L22 12L12 22H22Z`})],-1)]],32)],4)):l(``,!0)]),_:1})]))}}),R=p(L,[[`__scopeId`,`data-v-589caa34`]]);export{R as default};