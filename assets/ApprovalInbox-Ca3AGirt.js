import{D as e,Fa as t,Ki as n,Li as r,Mi as ee,Oa as i,Pa as a,Qn as te,Ra as o,Ui as s,Un as c,Vi as l,Wi as u,b as d,ca as f,ia as p,o as m,oa as h,qi as g,u as ne,ut as re,xa as ie}from"./index-BjUg3jag.js";import{t as _}from"./WorkspaceStore-Bs6uorzv.js";var v={class:`h-full flex flex-col bg-gradient-to-br from-stone-50 to-slate-100`},y={class:`flex-none px-6 py-4 bg-white border-b border-gray-200 flex items-center justify-between`},b={class:`flex items-center gap-3`},x={class:`w-10 h-10 rounded-full bg-amber-500 flex items-center justify-center`},S=[`disabled`],C={class:`flex-1 overflow-auto p-6`},w={key:0,class:`flex justify-center items-center h-64`},T={key:1,class:`flex flex-col items-center justify-center h-64 text-center`},E={class:`w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mb-4`},D={key:2,class:`max-w-4xl mx-auto space-y-4`},O={class:`flex items-start justify-between gap-4`},k={class:`flex-1 min-w-0`},A={class:`flex items-center gap-2 mb-1`},j={class:`text-xs font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded`},M={class:`text-xs text-gray-400`},N=[`onClick`],P={class:`text-sm text-gray-500 mt-1`},F={class:`font-medium`},I={class:`flex items-center gap-2 flex-shrink-0`},ae=[`onClick`],L=[`onClick`,`disabled`],R=[`onClick`,`disabled`],z={key:0,class:`fixed inset-0 bg-black/50 flex items-center justify-center z-50`},B={class:`bg-white rounded-xl shadow-xl w-full max-w-md p-6 m-4`},V={class:`text-sm text-gray-600 mb-4`},H={class:`flex justify-end gap-2 mt-4`},U=[`disabled`],W={__name:`ApprovalInbox`,setup(W){let G=ne(),K=_(),q=i(!1),J=i([]),Y=i(null),X=i(null),Z=i(``);async function Q(){q.value=!0;try{let e=(await m.get(`/org/doc/Approval Pipeline`,{params:{filters:JSON.stringify({status:[`Pending`,`Partially Approved`]}),order_by:`created_at desc`}})).data?.data||[],t=[];for(let n of e){let e=n.items||[];for(let r of e)r.assigned_to===G.email&&r.status===`Pending`&&t.push({...r,pipeline_name:n.name,target_doctype:n.target_doctype,target_document:n.target_document,requested_by:n.requested_by||n.owner,created_at:r.created_at||n.created_at})}J.value=t}catch(e){console.error(`Failed to fetch approvals:`,e)}finally{q.value=!1}}async function oe(e){Y.value=e.name;try{await m.patch(`/org/doc/Approval Pipeline/${e.pipeline_name}`,{data:{items:[{name:e.name,status:`Approved`,approver:G.email,decision_time:new Date().toISOString()}]}}),J.value=J.value.filter(t=>t.name!==e.name)}catch(e){console.error(`Failed to approve:`,e),alert(`Failed to approve: `+(e.response?.data?.message||``))}finally{Y.value=null}}function se(e){X.value=e,Z.value=``}async function ce(){if(X.value){Y.value=X.value.name;try{await m.patch(`/org/doc/Approval Pipeline/${X.value.pipeline_name}`,{data:{items:[{name:X.value.name,status:`Rejected`,approver:G.email,comments:Z.value,decision_time:new Date().toISOString()}]}}),J.value=J.value.filter(e=>e.name!==X.value.name),X.value=null,Z.value=``}catch(e){console.error(`Failed to reject:`,e),alert(`Failed to reject: `+(e.response?.data?.message||``))}finally{Y.value=null}}}function $(e){K.openTab({type:`doctype-form`,doctype:e.target_doctype,name:e.target_document,label:e.target_document})}function le(e){return e?new Date(e).toLocaleDateString(void 0,{month:`short`,day:`numeric`,hour:`2-digit`,minute:`2-digit`}):``}return p(()=>{Q()}),(i,p)=>(h(),u(`div`,v,[l(`header`,y,[l(`div`,b,[l(`div`,x,[g(a(e),{class:`w-5 h-5 text-white`})]),p[2]||=l(`div`,null,[l(`h1`,{class:`text-xl font-bold text-gray-900`},`Approvals`),l(`p`,{class:`text-sm text-gray-500`},`Pending items requiring your approval`)],-1)]),l(`button`,{onClick:Q,class:`p-2 hover:bg-gray-100 rounded-full text-gray-500 transition-colors`,disabled:q.value},[g(a(re),{class:t([`w-5 h-5`,{"animate-spin":q.value}])},null,8,[`class`])],8,S)]),l(`div`,C,[q.value&&!J.value.length?(h(),u(`div`,w,[...p[3]||=[l(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-black`},null,-1)]])):J.value.length?(h(),u(`div`,D,[(h(!0),u(r,null,f(J.value,e=>(h(),u(`div`,{key:e.name,class:`bg-white rounded-xl border border-gray-200 p-5 hover:shadow-md transition-shadow`},[l(`div`,O,[l(`div`,k,[l(`div`,A,[l(`span`,j,o(e.stage_name||`Approval`),1),l(`span`,M,o(le(e.created_at)),1)]),l(`h3`,{class:`text-lg font-semibold text-gray-900 truncate cursor-pointer hover:text-blue-600`,onClick:t=>$(e)},o(e.target_document),9,N),l(`p`,P,[l(`span`,F,o(e.target_doctype),1),n(` â€¢ Requested by `+o(e.requested_by||`Unknown`),1)])]),l(`div`,I,[l(`button`,{onClick:t=>$(e),class:`px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-colors`},` View `,8,ae),l(`button`,{onClick:t=>oe(e),disabled:Y.value===e.name,class:`px-4 py-1.5 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-1`},[g(a(te),{class:`w-4 h-4`}),p[6]||=n(` Approve `,-1)],8,L),l(`button`,{onClick:t=>se(e),disabled:Y.value===e.name,class:`px-4 py-1.5 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-1`},[g(a(d),{class:`w-4 h-4`}),p[7]||=n(` Reject `,-1)],8,R)])])]))),128))])):(h(),u(`div`,T,[l(`div`,E,[g(a(c),{class:`w-8 h-8 text-green-600`})]),p[4]||=l(`h3`,{class:`text-lg font-medium text-gray-900 mb-1`},`All caught up!`,-1),p[5]||=l(`p`,{class:`text-gray-500`},`You have no pending approvals.`,-1)]))]),X.value?(h(),u(`div`,z,[l(`div`,B,[p[10]||=l(`h3`,{class:`text-lg font-semibold text-gray-900 mb-4`},`Reject Approval`,-1),l(`p`,V,[p[8]||=n(` Are you sure you want to reject `,-1),l(`strong`,null,o(X.value.target_document),1),p[9]||=n(`? `,-1)]),ie(l(`textarea`,{"onUpdate:modelValue":p[0]||=e=>Z.value=e,rows:`3`,placeholder:`Reason for rejection (optional)`,class:`w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500`},null,512),[[ee,Z.value]]),l(`div`,H,[l(`button`,{onClick:p[1]||=e=>{X.value=null,Z.value=``},class:`px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-colors`},` Cancel `),l(`button`,{onClick:ce,disabled:Y.value,class:`px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors`},` Reject `,8,U)])])])):s(``,!0)]))}};export{W as default};