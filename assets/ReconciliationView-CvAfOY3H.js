import"./useNonce-BMN6rGol.js";import"./ConfigProvider-COTvgjgS.js";import"./useDirection-D13jZBr-.js";import"./ScrollAreaViewport-B8MNvpMz.js";import{Ai as e,At as t,Bt as n,Di as r,Gi as i,Hn as a,Ni as o,Oi as s,Pi as c,Sa as l,Si as u,Ta as d,U as f,Xt as ee,Yi as p,ha as m,it as te,ji as h,ki as g,kn as _,na as ne,o as v,qi as y,sa as b,sr as re,tr as ie,wi as x,xa as S}from"./index-DYsAJfvN.js";import{n as C}from"./button-CTk8BIqm.js";import{t as w}from"./ScrollArea-Dbevvb5I.js";import{t as T}from"./badge-MmCqtBxz.js";var E={async getSessions(e=0,t=20){return v.get(`/org/reconciliation`,{query:{page:e,size:t},authorizeRequest:!0,organisationAware:!0})},async startReconciliation(e,t,n,r,i){return v.post(`/org/reconciliation/start`,{data:{bankAccountReference:e,periodStart:t,periodEnd:n,openingBalance:r,closingBalance:i},authorizeRequest:!0,organisationAware:!0})},async getSession(e){return v.get(`/org/reconciliation/${e}`,{authorizeRequest:!0,organisationAware:!0})},async getSessionItems(e){return v.get(`/org/reconciliation/${e}/items`,{authorizeRequest:!0,organisationAware:!0})},async getItemsByStatus(e,t){return v.get(`/org/reconciliation/${e}/items/${t}`,{authorizeRequest:!0,organisationAware:!0})},async approveItem(e){return v.post(`/org/reconciliation/items/${e}/approve`,{data:{},authorizeRequest:!0,organisationAware:!0})},async manualMatch(e,t,n){return v.post(`/org/reconciliation/${e}/match`,{data:{transactionReference:t,entryReference:n},authorizeRequest:!0,organisationAware:!0})},async addAdjustment(e,t,n,r,i,a=!0){return v.post(`/org/reconciliation/${e}/adjustments`,{data:{type:t,description:n,amount:r,adjustmentDate:i,addsToBook:a},authorizeRequest:!0,organisationAware:!0})},async finalizeReconciliation(e){return v.post(`/org/reconciliation/${e}/finalize`,{data:{},authorizeRequest:!0,organisationAware:!0})}},D={class:`flex-1 min-w-0`},O={class:`flex items-center justify-between gap-2`},k={class:`font-medium text-slate-800 truncate`},A={class:`flex items-center gap-2 text-xs text-slate-500`},j={key:0,class:`text-slate-400`},M={__name:`ReconciliationRow`,props:{item:Object,side:String,selected:Boolean,matched:Boolean,suggested:Boolean},emits:[`click`,`approve`],setup(t){function n(e){return new Intl.NumberFormat(`en-NG`,{minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.abs(e||0))}function r(e){return e?new Date(e).toLocaleDateString(`en-US`,{month:`short`,day:`numeric`}):``}return(i,o)=>(y(),h(`div`,{class:l([`flex items-center gap-3 px-3 py-2 rounded-lg cursor-pointer transition-all text-sm`,t.matched?`bg-green-50 border border-green-200`:t.suggested?`bg-blue-50 border border-blue-200`:t.selected?`bg-slate-100 border border-slate-300`:`hover:bg-slate-50 border border-transparent`]),onClick:o[1]||=e=>i.$emit(`click`)},[s(`div`,{class:l([`h-6 w-6 rounded-full flex items-center justify-center flex-shrink-0`,t.matched?`bg-green-500 text-white`:t.suggested?`bg-blue-500 text-white`:`bg-slate-200 text-slate-500`])},[t.matched?(y(),g(S(a),{key:0,class:`h-3.5 w-3.5`})):t.suggested?(y(),g(S(f),{key:1,class:`h-3.5 w-3.5`})):(y(),g(S(_),{key:2,class:`h-3 w-3`}))],2),s(`div`,D,[s(`div`,O,[s(`span`,k,d(t.item.description),1),s(`span`,{class:l([`text-sm font-semibold whitespace-nowrap`,t.item.type===`CREDIT`?`text-green-600`:`text-red-600`])},d(t.item.type===`CREDIT`?`+`:`-`)+d(n(t.item.amount)),3)]),s(`div`,A,[s(`span`,null,d(r(t.item.transactionDate||t.item.entryDate)),1),t.item.reference?(y(),h(`span`,j,`â€¢ `+d(t.item.reference),1)):e(``,!0)])]),t.suggested&&!t.matched?(y(),g(S(C),{key:0,variant:`ghost`,size:`sm`,class:`h-7 w-7 p-0 flex-shrink-0`,onClick:o[0]||=u(e=>i.$emit(`approve`),[`stop`])},{default:b(()=>[c(S(a),{class:`h-4 w-4 text-green-600`})]),_:1})):e(``,!0)],2))}},ae={class:`flex flex-col h-full`},oe={key:0,class:`flex-1 flex items-center justify-center`},se={class:`flex items-center justify-between px-4 py-2 border-b border-slate-100 bg-white`},ce={class:`flex items-center gap-3`},le={class:`flex items-center gap-1.5 text-sm`},ue={class:`font-medium`},de={class:`flex items-center gap-2`},fe={class:`flex items-center justify-between px-4 py-3 bg-slate-50 border-b border-slate-100`},pe={class:`flex items-center gap-6`},N={class:`text-center`},P={class:`text-lg font-bold text-slate-800`},F={class:`text-center`},I={class:`text-lg font-bold text-slate-800`},L={class:`text-lg font-bold`},R={class:`text-xs opacity-80`},z={class:`flex items-center gap-4`},B={class:`text-center`},me={class:`text-lg font-bold text-green-600`},he={class:`text-center`},ge={class:`text-lg font-bold text-amber-600`},_e={class:`text-center`},ve={class:`text-lg font-bold text-slate-800`},ye={class:`flex-1 flex overflow-hidden`},be={class:`w-1/2 border-r border-slate-200 flex flex-col`},xe={class:`px-4 py-2 bg-blue-50 border-b border-slate-200`},Se={class:`flex items-center gap-2`},Ce={class:`p-2 space-y-1`},we={class:`w-1/2 flex flex-col`},Te={class:`px-4 py-2 bg-green-50 border-b border-slate-200`},Ee={class:`flex items-center gap-2`},De={class:`p-2 space-y-1`},Oe={key:0,class:`px-4 py-3 bg-white border-t border-slate-200`},ke={class:`flex items-center justify-between`},Ae={class:`flex items-center gap-4`},je={class:`text-sm`},Me={class:`font-medium ml-1`},Ne={class:`font-medium`},Pe={class:`flex items-center gap-2`},V={__name:`ReconciliationView`,props:{sessionReference:String,account:Object},emits:[`finalized`,`updated`],setup(u,{emit:f}){let _=u,v=f,D=m(!1),O=m(!1),k=m(!1),A=m(!1),j=m(null),V=m([]),H=m(null),U=m(null),Fe=r(()=>j.value?.periodStart&&j.value?.periodEnd?`${$(j.value.periodStart)} - ${$(j.value.periodEnd)}`:j.value?.name||`Reconciliation`),Ie=r(()=>({COMPLETED:`default`,IN_PROGRESS:`secondary`,PENDING_REVIEW:`outline`,DRAFT:`outline`,CANCELLED:`destructive`})[j.value?.status]||`outline`),Le=r(()=>{let e=j.value?.difference||0;return e===0?`bg-green-100 text-green-800`:e>0?`bg-amber-100 text-amber-800`:`bg-red-100 text-red-800`}),Re=r(()=>{let e=j.value?.difference||0;return e===0?`Balanced`:e>0?`Bank Higher`:`Book Higher`}),W=r(()=>(j.value?.unmatchedBankItems||0)+(j.value?.unmatchedBookItems||0)),ze=r(()=>{let e=(j.value?.totalBankItems||0)+(j.value?.totalBookItems||0),t=j.value?.matchedItems||0;return e>0?Math.round(t*2/e*100):0}),Be=r(()=>W.value===0&&j.value?.status!==`COMPLETED`),G=r(()=>V.value.filter(e=>e.bookEntry!=null)),K=r(()=>V.value.filter(e=>e.bankTransaction!=null));i(()=>{_.sessionReference&&q()}),ne(()=>_.sessionReference,e=>{e&&q()});async function q(){D.value=!0;try{let[e,t]=await Promise.all([E.getSession(_.sessionReference),E.getSessionItems(_.sessionReference)]);j.value=e.data,V.value=t.data}catch(e){console.error(`Failed to load session:`,e)}finally{D.value=!1}}async function J(){O.value=!0;try{let[e,t]=await Promise.all([E.getSession(_.sessionReference),E.getSessionItems(_.sessionReference)]);j.value=e.data,V.value=t.data}catch(e){console.error(`Failed to refresh:`,e)}finally{O.value=!1}}function Ve(e){H.value=e}function Y(e){U.value=e}function X(){H.value=null,U.value=null}async function Z(e){try{await E.approveItem(e.reference),await J()}catch(e){console.error(`Failed to approve:`,e)}}async function He(){if(!(!H.value?.bookEntry||!U.value?.bankTransaction)){k.value=!0;try{await E.manualMatch(_.sessionReference,U.value.bankTransaction.reference,H.value.bookEntry.reference),X(),await J(),v(`updated`)}catch(e){console.error(`Failed to match:`,e)}finally{k.value=!1}}}async function Ue(){A.value=!0;try{await E.finalizeReconciliation(_.sessionReference),await J(),v(`finalized`)}catch(e){console.error(`Failed to finalize:`,e)}finally{A.value=!1}}function Q(e){return new Intl.NumberFormat(`en-NG`,{style:`currency`,currency:_.account?.currency||`NGN`,minimumFractionDigits:0}).format(e)}function $(e){return e?new Date(e).toLocaleDateString(`en-US`,{month:`short`,year:`numeric`}):``}return(r,i)=>(y(),h(`div`,ae,[D.value?(y(),h(`div`,oe,[c(S(t),{class:`h-8 w-8 animate-spin text-slate-400`})])):(y(),h(x,{key:1},[s(`div`,se,[s(`div`,ce,[s(`div`,le,[c(S(ee),{class:`h-4 w-4 text-green-600`}),s(`span`,ue,d(Fe.value),1)]),c(S(T),{variant:Ie.value},{default:b(()=>[o(d(j.value?.status||`New`),1)]),_:1},8,[`variant`])]),s(`div`,de,[c(S(C),{variant:`outline`,size:`sm`,class:`h-8`,onClick:J,disabled:O.value},{default:b(()=>[O.value?(y(),g(S(t),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(y(),g(S(te),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),i[0]||=o(` Refresh `,-1)]),_:1},8,[`disabled`]),c(S(C),{size:`sm`,class:`h-8`,disabled:!Be.value||A.value,onClick:Ue},{default:b(()=>[A.value?(y(),g(S(t),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(y(),g(S(a),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),i[1]||=o(` Finalize `,-1)]),_:1},8,[`disabled`])])]),s(`div`,fe,[s(`div`,pe,[s(`div`,N,[s(`div`,P,d(Q(j.value?.bookBalance||0)),1),i[2]||=s(`div`,{class:`text-xs text-slate-500`},`Book Balance`,-1)]),s(`div`,F,[s(`div`,I,d(Q(j.value?.closingBalance||0)),1),i[3]||=s(`div`,{class:`text-xs text-slate-500`},`Bank Balance`,-1)]),s(`div`,{class:l([`text-center px-4 py-1 rounded-lg`,Le.value])},[s(`div`,L,d(Q(Math.abs(j.value?.difference||0))),1),s(`div`,R,d(Re.value),1)],2)]),s(`div`,z,[s(`div`,B,[s(`div`,me,d(j.value?.matchedItems||0),1),i[4]||=s(`div`,{class:`text-xs text-slate-500`},`Matched`,-1)]),s(`div`,he,[s(`div`,ge,d(W.value),1),i[5]||=s(`div`,{class:`text-xs text-slate-500`},`Unmatched`,-1)]),s(`div`,_e,[s(`div`,ve,d(ze.value)+`%`,1),i[6]||=s(`div`,{class:`text-xs text-slate-500`},`Match Rate`,-1)])])]),s(`div`,ye,[s(`div`,be,[s(`div`,xe,[s(`div`,Se,[c(S(ie),{class:`h-4 w-4 text-blue-600`}),i[7]||=s(`span`,{class:`text-sm font-semibold text-blue-800`},`Book Entries`,-1),c(S(T),{variant:`secondary`,class:`ml-auto`},{default:b(()=>[o(d(G.value.length),1)]),_:1})])]),c(S(w),{class:`flex-1`},{default:b(()=>[s(`div`,Ce,[(y(!0),h(x,null,p(G.value,e=>(y(),g(M,{key:e.reference,item:e,side:`book`,selected:H.value?.reference===e.reference,matched:e.matchStatus===`MATCHED`,suggested:e.matchStatus===`SUGGESTED`,onClick:t=>Ve(e),onApprove:t=>Z(e)},null,8,[`item`,`selected`,`matched`,`suggested`,`onClick`,`onApprove`]))),128))])]),_:1})]),s(`div`,we,[s(`div`,Te,[s(`div`,Ee,[c(S(n),{class:`h-4 w-4 text-green-600`}),i[8]||=s(`span`,{class:`text-sm font-semibold text-green-800`},`Bank Transactions`,-1),c(S(T),{variant:`secondary`,class:`ml-auto`},{default:b(()=>[o(d(K.value.length),1)]),_:1})])]),c(S(w),{class:`flex-1`},{default:b(()=>[s(`div`,De,[(y(!0),h(x,null,p(K.value,e=>(y(),g(M,{key:e.reference,item:e,side:`bank`,selected:U.value?.reference===e.reference,matched:e.matchStatus===`MATCHED`,suggested:e.matchStatus===`SUGGESTED`,onClick:t=>Y(e),onApprove:t=>Z(e)},null,8,[`item`,`selected`,`matched`,`suggested`,`onClick`,`onApprove`]))),128))])]),_:1})])]),H.value&&U.value?(y(),h(`div`,Oe,[s(`div`,ke,[s(`div`,Ae,[s(`div`,je,[i[9]||=s(`span`,{class:`text-slate-500`},`Selected:`,-1),s(`span`,Me,d(H.value.bookEntry?.description||`Book Entry`),1),c(S(re),{class:`h-4 w-4 inline mx-2 text-slate-400`}),s(`span`,Ne,d(U.value.bankTransaction?.narration||`Bank Tx`),1)])]),s(`div`,Pe,[c(S(C),{variant:`outline`,size:`sm`,onClick:X},{default:b(()=>[...i[10]||=[o(`Cancel`,-1)]]),_:1}),c(S(C),{size:`sm`,onClick:He,disabled:k.value},{default:b(()=>[k.value?(y(),g(S(t),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(y(),g(S(a),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),i[11]||=o(` Confirm Match `,-1)]),_:1},8,[`disabled`])])])])):e(``,!0)],64))]))}};export{V as default};