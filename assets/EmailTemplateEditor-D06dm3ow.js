import"./useFormControl-Dnp3iC5X.js";import"./ListboxItem-Bfe5qZhm.js";import"./ConfigProvider-Ckl6KgMj.js";import"./useHideOthers-L15EfXxs.js";import"./useDirection-B1kSZwKq.js";import"./useId-Da-MS2me.js";import"./useKbd-BvGB3m10.js";import"./PopperContent-b6gGwF_E.js";import"./useTypeahead---iVCXRs.js";import"./utils-BFR0tnUV.js";import"./VisuallyHiddenInput-B3HVdvGc.js";import"./ComboboxItem-BqMucZ-W.js";import"./ComboboxGroup-BeaaVWt-.js";import{$i as e,Ci as t,Fi as n,Li as r,Mi as i,Ni as a,Nt as ee,Oi as te,Pi as o,Ri as s,Ta as c,Yi as l,Zi as u,fa as d,fr as f,g as p,ji as m,ka as h,n as g,o as _,oa as v,r as ne,ya as y}from"./index-CHNvwQRL.js";import{t as re}from"./WorkspaceStore-Djee2ZJb.js";import{t as b}from"./Input-i1kcrjFD.js";import"./BottomSheet-BHwNzRxP.js";import{t as ie}from"./LinkField-rhGWIhbd.js";var x={class:`h-full flex flex-col bg-white`},S={class:`flex-none px-6 py-4 bg-white border-b border-gray-200 flex items-center justify-between sticky top-0 z-10`},C={class:`flex items-center space-x-4`},w={class:`text-xl font-bold text-gray-900`},T=[`disabled`],E={class:`flex-1 flex overflow-hidden`},D={class:`w-1/3 border-r border-gray-200 overflow-y-auto p-6 bg-gray-50 space-y-6`},O={class:`space-y-4`},k={class:`space-y-1`},A={class:`space-y-1`},j={class:`space-y-1`},M={class:`space-y-1`},N={class:`space-y-1`},P={class:`space-y-1`},F={key:0,class:`pt-4 border-t border-gray-200`},I={class:`text-sm font-bold text-gray-900 mb-2`},ae={class:`space-y-1 max-h-64 overflow-y-auto pr-2`},L=[`onClick`],R={class:`font-mono text-blue-600`},z={class:`text-gray-400 group-hover:text-gray-600 truncate ml-2`},B={class:`w-2/3 flex flex-col`},V={class:`flex-1 p-0 relative`},H={__name:`EmailTemplateEditor`,props:{doctype:String,name:String,isNew:Boolean},setup(H){let{toast:U}=p(),W=re(),G=g(),K=ne(),q=H,J=y({body:`<div>
    <p>Dear \${doc.customer_name},</p>
    <p>Here is an update regarding \${doc.name}.</p>
</div>`}),Y=y(!1),X=y(null),Z=m(()=>q.name||G.params.name),Q=m(()=>q.isNew===void 0?Z.value===`new`:q.isNew),oe=m(()=>!X.value||!X.value.fields?[]:X.value.fields.filter(e=>!e.hidden)),se=async()=>{if(!Q.value)try{J.value=(await _.get(`/org/doc/Email Template/${Z.value}`,{authorizeRequest:!0,organisationAware:!0})).data||{}}catch(e){console.error(e),U({title:`Failed to load`,description:e.message,variant:`destructive`})}},ce=async()=>{if(!J.value.for_doctype){X.value=null;return}try{X.value=(await _.get(`/org/doctypes/${J.value.for_doctype}`,{authorizeRequest:!0,organisationAware:!0})).data}catch(e){console.warn(`Could not fetch target doctype meta`,e)}},le=async()=>{Y.value=!0;try{let e,t={data:J.value,authorizeRequest:!0,organisationAware:!0};e=Q.value?await _.post(`/org/doc/Email Template`,t):await _.patch(`/org/doc/Email Template/${Z.value}`,t);let n=e.data?.data||e.data;J.value=n,U({title:Q.value?`Created`:`Saved`,variant:`success`}),W.notifyDocSaved(`Email Template`,n.name),Q.value&&K.replace(`/app/Email Template/${n.name}`)}catch(e){U({title:`Error saving`,description:e.response?.data?.message||e.message,variant:`destructive`})}finally{Y.value=!1}},$=e=>{let t=`\${doc.${e}}`;navigator.clipboard.writeText(t),U({title:`Copied`,description:t,duration:1e3})};return v(()=>J.value.for_doctype,e=>{e?ce():X.value=null}),l(()=>{se(),v(()=>J.value.for_doctype,()=>{},{once:!0})}),(l,p)=>(u(),n(`div`,x,[i(`header`,S,[i(`div`,C,[i(`button`,{onClick:p[0]||=e=>l.$router.back(),class:`p-2 hover:bg-gray-100 rounded-full text-gray-500`},[s(c(f),{class:`w-5 h-5`})]),i(`div`,null,[i(`h1`,w,h(Q.value?`New Email Template`:J.value.name),1)])]),i(`button`,{onClick:le,disabled:Y.value,class:`px-6 py-2 bg-black text-white rounded-full text-sm font-medium hover:bg-gray-900 transition-colors flex items-center gap-2 shadow-sm`},[Y.value?(u(),a(c(ee),{key:0,class:`w-4 h-4 animate-spin`})):o(``,!0),r(` `+h(Q.value?`Create`:`Save`),1)],8,T)]),i(`div`,E,[i(`div`,D,[i(`div`,O,[i(`div`,k,[p[8]||=i(`label`,{class:`block text-sm font-medium text-gray-700`},`Template Name`,-1),s(b,{modelValue:J.value.name,"onUpdate:modelValue":p[1]||=e=>J.value.name=e,placeholder:`e.g. Welcome Email`,disabled:!Q.value},null,8,[`modelValue`,`disabled`])]),i(`div`,A,[p[9]||=i(`label`,{class:`block text-sm font-medium text-gray-700`},`Subject`,-1),s(b,{modelValue:J.value.subject,"onUpdate:modelValue":p[2]||=e=>J.value.subject=e,placeholder:`Email Subject`},null,8,[`modelValue`])]),i(`div`,j,[p[10]||=i(`label`,{class:`block text-sm font-medium text-gray-700`},`Category`,-1),s(b,{modelValue:J.value.category,"onUpdate:modelValue":p[3]||=e=>J.value.category=e,placeholder:`e.g. Marketing`},null,8,[`modelValue`])]),i(`div`,M,[p[11]||=i(`label`,{class:`block text-sm font-medium text-gray-700`},`For DocType (Context)`,-1),s(ie,{modelValue:J.value.for_doctype,"onUpdate:modelValue":p[4]||=e=>J.value.for_doctype=e,doctype:`DocType`,placeholder:`Select DocType...`},null,8,[`modelValue`]),p[12]||=i(`p`,{class:`text-xs text-gray-500`},`Select a DocType to see available fields for dynamic content. `,-1)]),i(`div`,N,[p[13]||=i(`label`,{class:`block text-sm font-medium text-gray-700`},`Header Logo URL`,-1),s(b,{modelValue:J.value.header_logo,"onUpdate:modelValue":p[5]||=e=>J.value.header_logo=e,placeholder:`https://...`},null,8,[`modelValue`])]),i(`div`,P,[p[14]||=i(`label`,{class:`block text-sm font-medium text-gray-700`},`Footer Text`,-1),d(i(`textarea`,{class:`flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50`,"onUpdate:modelValue":p[6]||=e=>J.value.footer_text=e,rows:`2`},null,512),[[t,J.value.footer_text]])])]),X.value?(u(),n(`div`,F,[i(`h3`,I,`Available Fields (`+h(J.value.for_doctype)+`)`,1),i(`div`,ae,[(u(!0),n(te,null,e(oe.value,e=>(u(),n(`button`,{key:e.fieldname,onClick:t=>$(e.fieldname),class:`w-full text-left px-2 py-1.5 text-xs text-gray-600 hover:bg-gray-200 rounded flex justify-between group`},[i(`span`,R,"${doc."+h(e.fieldname)+`}`,1),i(`span`,z,h(e.label),1)],8,L))),128))])])):o(``,!0)]),i(`div`,B,[p[15]||=i(`div`,{class:`flex-none p-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center`},[i(`span`,{class:`text-sm font-medium text-gray-600`},`Body Content (HTML)`),i(`span`,{class:`text-xs text-gray-400`},`Supports standard HTML & Thymeleaf syntax`)],-1),i(`div`,V,[d(i(`textarea`,{"onUpdate:modelValue":p[7]||=e=>J.value.body=e,class:`w-full h-full resize-none p-6 font-mono text-sm focus:outline-none border-none text-gray-800 leading-relaxed`,placeholder:`<html>...</html> or <div>...</div>`},null,512),[[t,J.value.body]])])])])]))}};export{H as default};