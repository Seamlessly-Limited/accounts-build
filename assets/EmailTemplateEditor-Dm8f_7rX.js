import"./useFormControl-BWOmmYiS.js";import"./ListboxItem-i8wcDEmS.js";import"./ConfigProvider-BwNXqMge.js";import"./useHideOthers-C416Re6d.js";import"./useDirection-DYJPYRsI.js";import"./useId-BEfc-0Pq.js";import"./useKbd-BvGB3m10.js";import"./PopperContent-DYn2KUeQ.js";import"./useTypeahead-b61J-STi.js";import"./utils-DlRpuNf9.js";import"./VisuallyHiddenInput-DK27W3yR.js";import"./ComboboxItem-byr1zsK6.js";import"./ComboboxGroup-BKMuPS_X.js";import{Bi as e,Hi as t,Ki as n,Li as ee,Mi as r,Oa as i,Pa as a,Ra as o,Ui as s,Vi as c,Wi as l,br as u,ca as d,h as f,ha as p,ia as te,n as m,o as h,oa as g,qi as _,r as ne,xa as v,zt as re}from"./index-CTHZVx0Q.js";import{t as ie}from"./WorkspaceStore-gf1m868h.js";import{t as y}from"./Input-lhwdatZg.js";import"./BottomSheet-DEcSnvvp.js";import{t as b}from"./LinkField-b9J78HXi.js";var x={class:`h-full flex flex-col bg-white`},S={class:`flex-none px-6 py-4 bg-white border-b border-gray-200 flex items-center justify-between sticky top-0 z-10`},C={class:`flex items-center space-x-4`},w={class:`text-xl font-bold text-gray-900`},T=[`disabled`],E={class:`flex-1 flex overflow-hidden`},D={class:`w-1/3 border-r border-gray-200 overflow-y-auto p-6 bg-gray-50 space-y-6`},O={class:`space-y-4`},k={class:`space-y-1`},A={class:`space-y-1`},j={class:`space-y-1`},M={class:`space-y-1`},N={class:`space-y-1`},P={class:`space-y-1`},F={key:0,class:`pt-4 border-t border-gray-200`},ae={class:`text-sm font-bold text-gray-900 mb-2`},I={class:`space-y-1 max-h-64 overflow-y-auto pr-2`},L=[`onClick`],R={class:`font-mono text-blue-600`},z={class:`text-gray-400 group-hover:text-gray-600 truncate ml-2`},B={class:`w-2/3 flex flex-col`},V={class:`flex-1 p-0 relative`},H={__name:`EmailTemplateEditor`,props:{doctype:String,name:String,isNew:Boolean},setup(H){let{toast:U}=f(),W=ie(),G=m(),K=ne(),q=H,J=i({content:`<div>
    <p>Dear \${doc.customer_name},</p>
    <p>Here is an update regarding \${doc.name}.</p>
</div>`}),Y=i(!1),X=i(null),Z=e(()=>q.name||G.params.name),Q=e(()=>q.isNew===void 0?Z.value===`new`:q.isNew),oe=e(()=>!X.value||!X.value.fields?[]:X.value.fields.filter(e=>!e.hidden)),se=async()=>{if(!Q.value)try{J.value=(await h.get(`/org/doc/Email Template/${Z.value}`,{authorizeRequest:!0,organisationAware:!0})).data||{}}catch(e){console.error(e),U({title:`Failed to load`,description:e.message,variant:`destructive`})}},ce=async()=>{if(!J.value.for_doctype){X.value=null;return}try{X.value=(await h.get(`/org/doctypes/${J.value.for_doctype}`,{authorizeRequest:!0,organisationAware:!0})).data}catch(e){console.warn(`Could not fetch target doctype meta`,e)}},le=async()=>{Y.value=!0;try{let e,t={data:J.value,authorizeRequest:!0,organisationAware:!0};e=Q.value?await h.post(`/org/doc/Email Template`,t):await h.patch(`/org/doc/Email Template/${Z.value}`,t);let n=e.data?.data||e.data;J.value=n,U({title:Q.value?`Created`:`Saved`,variant:`success`}),W.notifyDocSaved(`Email Template`,n.name),Q.value&&K.replace(`/app/Email Template/${n.name}`)}catch(e){U({title:`Error saving`,description:e.response?.data?.message||e.message,variant:`destructive`})}finally{Y.value=!1}},$=e=>{let t=`\${doc.${e}}`;navigator.clipboard.writeText(t),U({title:`Copied`,description:t,duration:1e3})};return p(()=>J.value.for_doctype,e=>{e?ce():X.value=null}),te(()=>{se(),p(()=>J.value.for_doctype,()=>{},{once:!0})}),(e,i)=>(g(),l(`div`,x,[c(`header`,S,[c(`div`,C,[c(`button`,{onClick:i[0]||=t=>e.$router.back(),class:`p-2 hover:bg-gray-100 rounded-full text-gray-500`},[_(a(u),{class:`w-5 h-5`})]),c(`div`,null,[c(`h1`,w,o(Q.value?`New Email Template`:J.value.name),1)])]),c(`button`,{onClick:le,disabled:Y.value,class:`px-6 py-2 bg-black text-white rounded-full text-sm font-medium hover:bg-gray-900 transition-colors flex items-center gap-2 shadow-sm`},[Y.value?(g(),t(a(re),{key:0,class:`w-4 h-4 animate-spin`})):s(``,!0),n(` `+o(Q.value?`Create`:`Save`),1)],8,T)]),c(`div`,E,[c(`div`,D,[c(`div`,O,[c(`div`,k,[i[8]||=c(`label`,{class:`block text-sm font-medium text-gray-700`},`Template Name`,-1),_(y,{modelValue:J.value.name,"onUpdate:modelValue":i[1]||=e=>J.value.name=e,placeholder:`e.g. Welcome Email`,disabled:!Q.value},null,8,[`modelValue`,`disabled`])]),c(`div`,A,[i[9]||=c(`label`,{class:`block text-sm font-medium text-gray-700`},`Subject`,-1),_(y,{modelValue:J.value.subject,"onUpdate:modelValue":i[2]||=e=>J.value.subject=e,placeholder:`Email Subject`},null,8,[`modelValue`])]),c(`div`,j,[i[10]||=c(`label`,{class:`block text-sm font-medium text-gray-700`},`Category`,-1),_(y,{modelValue:J.value.category,"onUpdate:modelValue":i[3]||=e=>J.value.category=e,placeholder:`e.g. Marketing`},null,8,[`modelValue`])]),c(`div`,M,[i[11]||=c(`label`,{class:`block text-sm font-medium text-gray-700`},`For DocType (Context)`,-1),_(b,{modelValue:J.value.for_doctype,"onUpdate:modelValue":i[4]||=e=>J.value.for_doctype=e,doctype:`DocType`,placeholder:`Select DocType...`},null,8,[`modelValue`]),i[12]||=c(`p`,{class:`text-xs text-gray-500`},`Select a DocType to see available fields for dynamic content. `,-1)]),c(`div`,N,[i[13]||=c(`label`,{class:`block text-sm font-medium text-gray-700`},`Header Logo URL`,-1),_(y,{modelValue:J.value.header_logo,"onUpdate:modelValue":i[5]||=e=>J.value.header_logo=e,placeholder:`https://...`},null,8,[`modelValue`])]),c(`div`,P,[i[14]||=c(`label`,{class:`block text-sm font-medium text-gray-700`},`Footer Text`,-1),v(c(`textarea`,{class:`flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50`,"onUpdate:modelValue":i[6]||=e=>J.value.footer_text=e,rows:`2`},null,512),[[r,J.value.footer_text]])])]),X.value?(g(),l(`div`,F,[c(`h3`,ae,`Available Fields (`+o(J.value.for_doctype)+`)`,1),c(`div`,I,[(g(!0),l(ee,null,d(oe.value,e=>(g(),l(`button`,{key:e.fieldname,onClick:t=>$(e.fieldname),class:`w-full text-left px-2 py-1.5 text-xs text-gray-600 hover:bg-gray-200 rounded flex justify-between group`},[c(`span`,R,"${doc."+o(e.fieldname)+`}`,1),c(`span`,z,o(e.label),1)],8,L))),128))])])):s(``,!0)]),c(`div`,B,[i[15]||=c(`div`,{class:`flex-none p-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center`},[c(`span`,{class:`text-sm font-medium text-gray-600`},`Body Content (HTML)`),c(`span`,{class:`text-xs text-gray-400`},`Supports standard HTML & Thymeleaf syntax`)],-1),c(`div`,V,[v(c(`textarea`,{"onUpdate:modelValue":i[7]||=e=>J.value.content=e,class:`w-full h-full resize-none p-6 font-mono text-sm focus:outline-none border-none text-gray-800 leading-relaxed`,placeholder:`<html>...</html> or <div>...</div>`},null,512),[[r,J.value.content]])])])])]))}};export{H as default};