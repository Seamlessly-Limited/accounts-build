import{Aa as e,At as t,Bi as n,Bt as r,C as i,Ct as a,D as o,Dn as ee,E as te,F as ne,Fn as re,H as ie,Ii as ae,J as oe,K as se,Kt as ce,Li as s,Lt as le,N as ue,Na as de,Ni as c,Nn as fe,Nt as pe,O as me,Oi as he,On as l,Pa as u,Pn as ge,Ri as d,Rn as _e,S as ve,Sr as ye,Tt as be,Ui as f,Ut as xe,X as Se,Y as Ce,Z as p,Zn as m,Zt as h,_a as g,an as _,b as v,cr as y,ct as b,da as x,dn as S,dr as C,ea as w,et as T,fn as E,fr as D,hn as O,i as k,ia as A,in as we,ir as Te,ja as Ee,jn as De,lr as Oe,lt as ke,mn as Ae,mt as je,na as j,nr as Me,nt as M,o as N,on as Ne,pi as Pe,pn as Fe,r as Ie,rr as Le,rt as P,sa as F,sn as Re,sr as ze,st as Be,tn as Ve,tr as He,tt as Ue,un as We,vi as I,w as Ge,wa as L,wt as Ke,xi as qe,z as Je,zi as R,zn as Ye}from"./index-BW6FH5S4.js";import{t as Xe}from"./WorkspaceStore-DkbvTQrR.js";function z(e){let t=e.map(e=>{let t=e.apps.map(e=>e.name).sort().join(`,`);return`${e.name}:[${t}]`}).sort().join(`|`),n=5381;for(let e=0;e<t.length;e++)n=(n<<5)+n+t.charCodeAt(e),n&=n;return Math.abs(n).toString(36)}var B={getDocTypes:async()=>{try{return(await N.get(`/org/doctypes`,{authorizeRequest:!0,organisationAware:!0}))?.data||[]}catch(e){return console.warn(`Failed to fetch doc types:`,e),[]}},getAllApplications:async()=>{let e=await B.getDocTypes(),t={Stock:`Package`,Inventory:`Package`,Selling:`TrendingUp`,Sales:`TrendingUp`,Billing:`Receipt`,CRM:`Users`,Buying:`ShoppingBag`,Purchases:`ShoppingBag`,Accounting:`Calculator`,Finance:`Landmark`,System:`Settings`,Core:`Cog`,Notifications:`Bell`,Setup:`Settings`},n=[`File`,`Brand Settings`,`Application`,`Application Group`,`Doc Event Type`],r={};e.forEach(e=>{if(e.is_child||n.includes(e.name)||!e.module)return;let i=e.module;r[i]||(r[i]={id:`module-${i.toLowerCase().replace(/\s+/g,`-`)}`,name:i,type:`group`,icon:t[i]||`Folder`,apps:[]}),r[i].apps.push({id:`doctype-${e.name.toLowerCase().replace(/\s+/g,`-`)}`,name:e.name,icon:e.icon||`FileText`,background:`bg-slate-950`,route:`/app/${encodeURIComponent(e.name)}`,type:`doctype-app`,doctype:e.name})});let i=Object.values(r);i.sort((e,t)=>e.name.localeCompare(t.name)),i.forEach(e=>{e.apps.sort((e,t)=>e.name.localeCompare(t.name))});let a=z(i);return{groups:i,structureHash:a}}},Ze=B,Qe={key:0,class:`absolute inset-0 z-[100] flex flex-col`},$e={class:`relative z-10 flex flex-col h-full w-full max-w-7xl mx-auto p-4 md:p-8 pointer-events-auto`},et={class:`flex justify-start mb-6 mt-2`},tt={class:`relative w-full pointer-events-auto`},nt={class:`flex items-center gap-4 mb-4 ml-2`},rt={class:`text-xl font-semibold text-slate-800`},it={class:`grid grid-cols-3 md:grid-cols-5 lg:grid-cols-7 gap-4 justify-items-center`},at=[`onClick`],ot={class:`text-black text-xs md:text-sm font-medium text-center line-clamp-3 shadow-black drop-shadow-sm opacity-90 group-hover:opacity-100`},st={key:0,class:`flex flex-col items-center justify-center h-64 text-slate-500`},V={__name:`ApplicationsPane`,props:{isOpen:Boolean},emits:[`close`],setup(k,{emit:N}){let z=k,B=N,V=Ie(),H=Xe(),U={Package:Ke,Box:ze,SlidersHorizontal:oe,Truck:ue,TrendingUp:ne,Users:Ge,UserPlus:o,FileText:Re,FileQuestion:We,Receipt:ke,Bookmark:y,ClipboardList:re,Banknote:D,FileMinus:E,RefreshCw:Be,CreditCard:l,ShoppingCart:Ce,Store:ie,Vault:i,FileInput:Fe,CalendarClock:He,ShoppingBag:Se,PackageCheck:be,Send:Ue,FilePlus:S,RefreshCcw:b,Landmark:ce,Scale:P,Link:r,BookOpen:Oe,Library:xe,Folder:we,FolderOpen:_,Clock:ge,User:te,Building:Le,Building2:Te,Pin:je,File:Ne,Code:fe,FileCode:Ae,Database:ee,Settings:T,BarChart:m,HelpCircle:Ye,Sparkles:se,Mail:pe,AppWindow:ye,UserCheck:me,CircleUserRound:_e,History:h,Zap:v,Globe:Ve,Palette:a,Wallet:ve,List:le,Bell:C,ShieldCheck:p,Terminal:Je,FileJson:O,Megaphone:t,Calculator:Me,Cog:De};function ct(){try{let e=JSON.parse(localStorage.getItem(`organisation`)||`{}`),t=JSON.parse(localStorage.getItem(`user`)||`{}`);return e.creatorId===t.id||e.creator?.id===t.id}catch{return!1}}function W(e){return e&&(e.startsWith(`#`)||e.startsWith(`rgb`))}function lt(e){return!e||W(e)?``:e}function ut(e){return!e||!W(e)?{}:{backgroundColor:e}}function G(e){return e.type===`group`?{...e,apps:e.apps.map(e=>({...e}))}:{...e}}function K(e,t){let n=new Map;t.forEach(e=>{n.set(e.id,e)});let r=new Set(e.map(e=>e.id)),i=[];return e.forEach(e=>{let t=n.get(e.id);if(t)if(t.type===`group`&&e.type===`group`){let n=G(t);n.apps=K(e.apps||[],t.apps||[]),i.push(n)}else i.push(G(t))}),t.forEach(e=>{r.has(e.id)||i.push(G(e))}),i}let q=I(`flow-applications-order`,null),J=I(`flow-cached-apps`,[]),Y=I(`flow-apps-hash`,``),X=L(!0),Z=L([]);w(async()=>{J.value&&J.value.length>0&&(Z.value=J.value,X.value=!1);try{let{groups:e,structureHash:t}=await Ze.getAllApplications();t===Y.value?q.value&&Array.isArray(q.value)?Z.value=K(q.value,e):Z.value=e.map(G):(console.log(`Applications structure changed, resetting order`),q.value=null,Z.value=e.map(G)),J.value=e,Y.value=t}catch(e){console.error(`Failed to load applications:`,e)}finally{X.value=!1}}),qe(Z,e=>{q.value=e},{deep:!0,debounce:500});let Q=L(``),$=ae(()=>{let e=ct(),t=t=>{if(!Q.value)return t.filter(t=>!t.ownerOnly||e);let n=Q.value.toLowerCase();return t.filter(t=>t.ownerOnly&&!e?!1:t.name.toLowerCase().includes(n))},n=[],r=[];return Z.value.forEach(i=>{if(!i.ownerOnly||e)if(i.type===`group`){let e=t(i.apps||[]);e.length>0&&n.push({...i,apps:e})}else (!Q.value||i.name.toLowerCase().includes(Q.value.toLowerCase()))&&r.push(i)}),{groups:n,looseApps:r}}),dt=e=>{try{if(e.doctype){let t={id:e.id||`doctype-${e.doctype.toLowerCase().replace(/\s+/g,`-`)}`,title:e.name,icon:e.icon,type:`doctype`,doctype:e.doctype,props:e.props||{},closable:!0};H.openTab(t),B(`close`),V.push({path:`/workspace`,hash:`#${t.id}`})}else B(`close`),V.push(e.route)}catch(e){console.error(`Failed to open app:`,e)}};return x(()=>z.isOpen,e=>{e||setTimeout(()=>{Q.value=``},300)}),Pe(`Escape`,()=>{z.isOpen&&B(`close`)}),(t,r)=>k.isOpen?(j(),n(`div`,Qe,[s(`div`,{class:`absolute inset-0 bg-white/40 backdrop-blur-xl`,onClick:r[0]||=e=>t.$emit(`close`)}),s(`div`,$e,[s(`div`,et,[s(`div`,tt,[f(e(M),{class:`absolute left-3 top-1/2 -translate-y-1/2 text-black/60 h-5 w-5`}),g(s(`input`,{"onUpdate:modelValue":r[1]||=e=>Q.value=e,type:`text`,placeholder:`Type to search...`,class:`w-full bg-white/90 border-4 border-gray-200 rounded-full py-1.5 pl-10 pr-4 text-black placeholder-black/50 focus:outline-none focus:bg-white/20 focus:border-stone-100/80 transition-all`},null,512),[[he,Q.value]])])]),s(`div`,{class:`flex-1 relative overflow-y-auto px-4 pb-20 pt-10`,onClick:r[2]||=e=>t.$emit(`close`),style:{"scrollbar-width":`none`}},[(j(!0),n(c,null,A($.value.groups,e=>(j(),n(`div`,{key:e.id,class:`mb-20`},[s(`div`,nt,[(j(),d(F(U[e.icon]),{class:`h-5 w-5 text-slate-800`})),s(`h3`,rt,u(e.name),1)]),s(`div`,it,[(j(!0),n(c,null,A(e.apps,e=>(j(),n(`div`,{key:e.id,class:`flex flex-col items-center gap-2 group cursor-pointer pointer-events-auto w-20 md:w-24 transition-transform hover:-translate-y-1 duration-200`,onClick:t=>dt(e)},[s(`div`,{class:Ee([`w-14 h-14 md:w-16 md:h-16 rounded-2xl flex items-center justify-center shadow-md transition-shadow group-hover:shadow-lg duration-200 opacity-80 group-hover:opacity-100`,lt(e.background)]),style:de(ut(e.background))},[(j(),d(F(U[e.icon]),{class:`text-white h-7 w-7 md:h-8 md:w-8`}))],6),s(`span`,ot,u(e.name),1)],8,at))),128))])]))),128)),$.value.groups.length===0&&$.value.looseApps.length===0?(j(),n(`div`,st,[f(e(M),{class:`h-12 w-12 mb-4 opacity-50`}),r[3]||=s(`p`,null,`No applications found`,-1)])):R(``,!0)])])])):R(``,!0)}},H=k(V,[[`__scopeId`,`data-v-dd9cb498`]]);export{H as default};