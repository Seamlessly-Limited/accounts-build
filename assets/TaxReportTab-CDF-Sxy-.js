import"./ConfigProvider-BeNpEDZu.js";import"./useHideOthers-8j3pZZC2.js";import{a as e,c as t,i as n,n as r,r as i,s as a,t as o}from"./PopoverTrigger-DWkr4HdR.js";import"./useDirection-CkCaHLjJ.js";import"./PopperAnchor-DePKnfPt.js";import"./useId-C9uHTJK1.js";import"./useKbd-BvGB3m10.js";import"./PopperContent-CkzV4Efh.js";import"./Teleport-CO7T90ZX.js";import"./Label-BQWlwCJI.js";import{Aa as s,Bi as c,Cn as ee,Hi as l,Ii as te,It as u,Li as d,Ni as f,Pa as p,Ri as m,Ui as h,a as ne,ea as re,er as g,ga as _,ia as v,ja as y,na as b,o as x,sn as S,tn as ie,wa as C,wr as w,zi as T}from"./index-BW6FH5S4.js";import{t as E}from"./button-BIS6kOZQ.js";import"./button-Cg1Yo4L-.js";import{t as D}from"./Card-DL4aOVo_.js";import{t as O}from"./Label-CWz-ReQU.js";import{t as k}from"./badge-DeOd_cPn.js";var A=`/org/tax`,j={getTaxFramework(){return x.get(`${A}/framework`,{organisationAware:!0,authorizeRequest:!0})},updateTaxPolicies(e){return x.put(`${A}/framework`,{data:e,organisationAware:!0,authorizeRequest:!0})},reinitializeFramework(){return x.post(`${A}/framework/initialize`,{organisationAware:!0,authorizeRequest:!0})},generateReport(e,t){return x.get(`${A}/report`,{query:{startDate:e,endDate:t},organisationAware:!0,authorizeRequest:!0})},async exportReport(e,t){return await x.get(`${A}/report/export`,{query:{startDate:e,endDate:t},organisationAware:!0,authorizeRequest:!0,responseType:`blob`})},async downloadReport(e,t){try{let n=await this.exportReport(e,t),r=new Blob([n],{type:`application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`}),i=window.URL.createObjectURL(r),a=document.createElement(`a`);a.href=i,a.setAttribute(`download`,`TaxReport_${e}_to_${t}.xlsx`),document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(i)}catch(e){throw console.error(`Failed to download tax report:`,e),e}}},ae={class:`h-full flex flex-col bg-stone-50`},oe={class:`p-6 bg-white border-b border-stone-200`},se={class:`flex items-center justify-between mb-4`},ce={class:`flex items-center gap-2`},le={class:`flex flex-wrap items-end gap-4`},ue={class:`space-y-1`},de={class:`space-y-1`},M={class:`flex-1 overflow-y-auto p-6`,style:{"scrollbar-width":`none`}},N={key:0,class:`flex items-center justify-center h-64`},P={class:`text-center`},F={key:1,class:`flex items-center justify-center h-64`},I={class:`text-center`},L={key:2,class:`space-y-6`},R={class:`grid grid-cols-1 md:grid-cols-4 gap-4`},z={class:`text-2xl font-bold text-slate-800`},B={class:`text-2xl font-bold text-slate-800`},V={class:`text-2xl font-bold text-red-600`},H={class:`text-2xl font-bold text-green-600`},fe={key:0,class:`text-slate-400 text-sm`},U={key:1,class:`space-y-3`},pe={class:`flex items-center gap-2`},me={class:`text-sm font-medium text-slate-700`},he={class:`text-sm font-semibold text-slate-800`},ge={class:`p-4 border-b border-slate-100 flex items-center justify-between`},_e={class:`text-sm text-slate-500`},ve={class:`overflow-x-auto`},ye={class:`w-full text-sm`},be={class:`divide-y divide-slate-100`},xe={class:`px-4 py-3 text-slate-600`},Se={class:`px-4 py-3 font-medium text-slate-800 max-w-xs truncate`},Ce={class:`px-4 py-3`},we={key:1,class:`text-slate-400 text-xs`},Te={class:`px-4 py-3 text-right font-medium`},Ee={class:`px-4 py-3 text-right text-red-600 font-medium`},De={class:`px-4 py-3 text-right text-green-600 font-medium`},Oe={class:`px-4 py-3`},ke={class:`flex flex-wrap gap-1`},W={__name:`TaxReportTab`,props:{account:Object},setup(x){let A=ne().toast,W=new e(`en-US`,{dateStyle:`medium`}),G=C(null),K=C(null),q=C(!1),J=C(!1),Y=t(a()),X=C(Y.subtract({months:3})),Z=C(Y),Q=te(()=>X.value&&Z.value);re(async()=>{await Ae()});async function Ae(){try{G.value=await j.getTaxFramework()}catch(e){console.error(`Failed to load tax framework:`,e)}}async function je(){if(Q.value)try{q.value=!0;let e=X.value.toString(),t=Z.value.toString();K.value=await j.generateReport(e,t),A({title:`Report Generated`,description:`Analyzed ${K.value.totalTransactions} transactions`})}catch(e){console.error(`Failed to generate report:`,e),A({title:`Error`,description:`Failed to generate tax report`,variant:`destructive`})}finally{q.value=!1}}async function Me(){if(K.value)try{J.value=!0;let e=X.value.toString(),t=Z.value.toString();await j.downloadReport(e,t),A({title:`Download Started`,description:`Your tax report is downloading`})}catch(e){console.error(`Failed to download report:`,e),A({title:`Error`,description:`Failed to download report`,variant:`destructive`})}finally{J.value=!1}}function $(e){return e==null?`â‚¦0.00`:new Intl.NumberFormat(`en-NG`,{style:`currency`,currency:`NGN`}).format(e)}function Ne(e){return e?new Date(e).toLocaleDateString(`en-US`,{year:`numeric`,month:`short`,day:`numeric`}):`N/A`}return(e,t)=>(b(),c(`div`,ae,[d(`div`,oe,[d(`div`,se,[t[2]||=d(`div`,null,[d(`h2`,{class:`text-xl font-semibold text-slate-800`},`Tax Report`),d(`p`,{class:`text-sm text-slate-500`},`Generate tax reports based on your transaction history`)],-1),d(`div`,ce,[G.value?(b(),m(s(k),{key:0,variant:`outline`,class:`rounded-full`},{default:_(()=>[h(s(ie),{class:`h-3 w-3 mr-1`}),l(` `+p(G.value.jurisdiction),1)]),_:1})):T(``,!0)])]),d(`div`,le,[d(`div`,ue,[h(s(O),{class:`text-xs text-slate-500`},{default:_(()=>[...t[3]||=[l(`Start Date`,-1)]]),_:1}),h(s(i),null,{default:_(()=>[h(s(o),{"as-child":``},{default:_(()=>[h(s(E),{variant:`outline`,class:y(s(w)(`w-40 justify-start text-left font-normal rounded-full`,!X.value&&`text-muted-foreground`))},{default:_(()=>[h(s(g),{class:`mr-2 h-4 w-4`}),l(` `+p(X.value?s(W).format(X.value.toDate(s(a)())):`Pick date`),1)]),_:1},8,[`class`])]),_:1}),h(s(r),{class:`w-auto p-0`},{default:_(()=>[h(s(n),{modelValue:X.value,"onUpdate:modelValue":t[0]||=e=>X.value=e,"initial-focus":``},null,8,[`modelValue`])]),_:1})]),_:1})]),d(`div`,de,[h(s(O),{class:`text-xs text-slate-500`},{default:_(()=>[...t[4]||=[l(`End Date`,-1)]]),_:1}),h(s(i),null,{default:_(()=>[h(s(o),{"as-child":``},{default:_(()=>[h(s(E),{variant:`outline`,class:y(s(w)(`w-40 justify-start text-left font-normal rounded-full`,!Z.value&&`text-muted-foreground`))},{default:_(()=>[h(s(g),{class:`mr-2 h-4 w-4`}),l(` `+p(Z.value?s(W).format(Z.value.toDate(s(a)())):`Pick date`),1)]),_:1},8,[`class`])]),_:1}),h(s(r),{class:`w-auto p-0`},{default:_(()=>[h(s(n),{modelValue:Z.value,"onUpdate:modelValue":t[1]||=e=>Z.value=e,"initial-focus":``},null,8,[`modelValue`])]),_:1})]),_:1})]),h(s(E),{onClick:je,disabled:!Q.value||q.value,class:`rounded-full`},{default:_(()=>[q.value?(b(),m(s(u),{key:0,class:`h-4 w-4 mr-2 animate-spin`})):(b(),m(s(S),{key:1,class:`h-4 w-4 mr-2`})),t[5]||=l(` Generate Report `,-1)]),_:1},8,[`disabled`]),K.value?(b(),m(s(E),{key:0,variant:`outline`,onClick:Me,disabled:J.value,class:`rounded-full`},{default:_(()=>[J.value?(b(),m(s(u),{key:0,class:`h-4 w-4 mr-2 animate-spin`})):(b(),m(s(ee),{key:1,class:`h-4 w-4 mr-2`})),t[6]||=l(` Export XLSX `,-1)]),_:1},8,[`disabled`])):T(``,!0)])]),d(`div`,M,[q.value?(b(),c(`div`,N,[d(`div`,P,[h(s(u),{class:`h-8 w-8 animate-spin mx-auto mb-4 text-blue-600`}),t[7]||=d(`p`,{class:`text-slate-500`},`Generating tax report...`,-1)])])):K.value?(b(),c(`div`,L,[d(`div`,R,[h(s(D),{class:`p-4`},{default:_(()=>[t[10]||=d(`div`,{class:`text-xs text-slate-500 mb-1`},`Total Transactions`,-1),d(`div`,z,p(K.value.totalTransactions),1)]),_:1}),h(s(D),{class:`p-4`},{default:_(()=>[t[11]||=d(`div`,{class:`text-xs text-slate-500 mb-1`},`Gross Amount`,-1),d(`div`,B,p($(K.value.totalGrossAmount)),1)]),_:1}),h(s(D),{class:`p-4`},{default:_(()=>[t[12]||=d(`div`,{class:`text-xs text-slate-500 mb-1`},`Total Tax Liability`,-1),d(`div`,V,p($(K.value.totalTaxLiability)),1)]),_:1}),h(s(D),{class:`p-4`},{default:_(()=>[t[13]||=d(`div`,{class:`text-xs text-slate-500 mb-1`},`Net Amount`,-1),d(`div`,H,p($(K.value.netAmount)),1)]),_:1})]),h(s(D),{class:`p-6`},{default:_(()=>[t[15]||=d(`h3`,{class:`text-lg font-semibold mb-4`},`Tax Breakdown by Policy`,-1),Object.keys(K.value.taxSummaryByPolicy||{}).length===0?(b(),c(`div`,fe,` No taxes applied in this period `)):(b(),c(`div`,U,[(b(!0),c(f,null,v(K.value.taxSummaryByPolicy,(e,n)=>(b(),c(`div`,{key:n,class:`flex items-center justify-between py-2 border-b border-slate-100 last:border-0`},[d(`div`,pe,[t[14]||=d(`div`,{class:`h-2 w-2 rounded-full bg-blue-500`},null,-1),d(`span`,me,p(n),1)]),d(`span`,he,p($(e)),1)]))),128))]))]),_:1}),h(s(D),{class:`p-0 overflow-hidden`},{default:_(()=>[d(`div`,ge,[t[16]||=d(`h3`,{class:`font-semibold`},`Transaction Details`,-1),d(`span`,_e,p(K.value.lines?.length||0)+` transactions`,1)]),d(`div`,ve,[d(`table`,ye,[t[17]||=d(`thead`,{class:`bg-slate-50 text-slate-600 text-xs uppercase`},[d(`tr`,null,[d(`th`,{class:`px-4 py-3 text-left`},`Date`),d(`th`,{class:`px-4 py-3 text-left`},`Description`),d(`th`,{class:`px-4 py-3 text-left`},`Category`),d(`th`,{class:`px-4 py-3 text-right`},`Gross`),d(`th`,{class:`px-4 py-3 text-right`},`Tax`),d(`th`,{class:`px-4 py-3 text-right`},`Net`),d(`th`,{class:`px-4 py-3 text-left`},`Policies`)])],-1),d(`tbody`,be,[(b(!0),c(f,null,v(K.value.lines,e=>(b(),c(`tr`,{key:e.transactionReference,class:`hover:bg-slate-50`},[d(`td`,xe,p(Ne(e.transactionDate)),1),d(`td`,Se,p(e.description),1),d(`td`,Ce,[e.category?(b(),m(s(k),{key:0,variant:`outline`,class:`rounded-full text-xs`},{default:_(()=>[l(p(e.category),1)]),_:2},1024)):(b(),c(`span`,we,`Uncategorized`))]),d(`td`,Te,p($(e.grossAmount)),1),d(`td`,Ee,p($(e.totalTax)),1),d(`td`,De,p($(e.netAmount)),1),d(`td`,Oe,[d(`div`,ke,[(b(!0),c(f,null,v(e.appliedPolicyIds,e=>(b(),m(s(k),{key:e,variant:`secondary`,class:`rounded-full text-xs`},{default:_(()=>[l(p(e),1)]),_:2},1024))),128))])])]))),128))])])])]),_:1})])):(b(),c(`div`,F,[d(`div`,I,[h(s(S),{class:`h-12 w-12 text-slate-300 mx-auto mb-4`}),t[8]||=d(`h3`,{class:`text-lg font-medium text-slate-600 mb-2`},`No Report Generated`,-1),t[9]||=d(`p`,{class:`text-sm text-slate-400 max-w-md`},` Select a date range and click "Generate Report" to create your tax report. `,-1)])]))])]))}};export{W as default};