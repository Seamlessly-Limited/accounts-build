const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DocForm-6qnYMqhv.js","assets/PopperContent-DYn2KUeQ.js","assets/index-CTHZVx0Q.js","assets/index-BSM1JQYN.css","assets/PopoverTrigger-BZLuwVXx.js","assets/useHideOthers-C416Re6d.js","assets/ConfigProvider-BwNXqMge.js","assets/Teleport-DrGXNRYb.js","assets/PopperAnchor-BHV4Kv-d.js","assets/useDirection-DYJPYRsI.js","assets/useId-BEfc-0Pq.js","assets/useKbd-BvGB3m10.js","assets/button-BXx_oIr0.js","assets/purify.es-CR14pynC.js","assets/marked.esm-L-WIQlRx.js","assets/useFormControl-BWOmmYiS.js","assets/ComboboxItem-byr1zsK6.js","assets/ListboxItem-i8wcDEmS.js","assets/utils-DlRpuNf9.js","assets/VisuallyHiddenInput-DK27W3yR.js","assets/useTypeahead-b61J-STi.js","assets/ComboboxGroup-BKMuPS_X.js","assets/DialogPortal-913ieDuk.js","assets/utils-BEsFB3CI.js","assets/DialogTitle-BUR1zqy5.js","assets/sheet-CqjRTU1B.js","assets/Label-BycvDR_g.js","assets/SelectViewport-BKt93lbc.js","assets/useNonce-VOgClyGr.js","assets/nullish-CfjOSA4G.js","assets/SelectGroup-d6DuvcVX.js","assets/DocForm-DqV7odGC.js","assets/DynamicIcon-CuHXdgY2.js","assets/DateField-B6H4tpap.js","assets/button-DTHLpYkO.js","assets/badge-DhOUhkIE.js","assets/DialogContent-DBDLd1Cs.js","assets/DialogTitle-DU64UNVg.js","assets/DialogFooter-CdocHGcF.js","assets/Input-lhwdatZg.js","assets/Label-MW7QlMSj.js","assets/SelectValue-DoC6zE2e.js","assets/Textarea-B0oEpfYv.js","assets/viewRegistry-Mh-A2GPU.js","assets/WorkspaceStore-gf1m868h.js","assets/DocForm-DHiu27Dz.css","assets/BottomSheet-DEcSnvvp.js","assets/BottomSheet-HovJvjIf.css"])))=>i.map(i=>d[i]);
import{i as e,n as t,r as n,s as r,t as i}from"./ComboboxItem-byr1zsK6.js";import{t as a}from"./ComboboxGroup-BKMuPS_X.js";import{Fa as ee,Hi as o,Ji as s,Ki as c,Li as l,Oa as u,Pa as d,Qn as f,Ra as p,Ui as m,Vi as h,Wi as g,ba as _,ca as v,h as y,ha as b,ia as x,mt as S,o as C,oa as w,qi as T,qn as te,ra as ne,t as E,zt as D}from"./index-CTHZVx0Q.js";import{t as O}from"./BottomSheet-DEcSnvvp.js";var k={class:`relative w-full`},A={class:`relative w-full`},re={class:`absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400`},ie={key:0,class:`text-sm text-gray-500 p-4 text-center shrink-0`},ae={key:0},j={key:1},M={class:`flex flex-col`},N={class:`font-medium`},P={key:1,class:`p-4 text-center text-sm text-gray-500 flex justify-center items-center gap-2 shrink-0`},F={class:`h-full flex flex-col bg-stone-50`},I={__name:`LinkField`,props:{modelValue:{type:String,default:``},doctype:{type:String,default:``},label:{type:String,default:``},placeholder:{type:String,default:``},disabled:{type:Boolean,default:!1},compact:{type:Boolean,default:!1}},emits:[`update:modelValue`],setup(I,{emit:L}){let R=s(()=>E(()=>import(`./DocForm-6qnYMqhv.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47]))),z=I,B=L,{toast:V}=y(),H=u(!1),U=u([]),W=u(!1),G=u(!1),K=u(``),q=u(``),J=u(null),Y=u(!1),X=async()=>{if(!(J.value||!z.doctype))try{let e=await C.get(`/org/doctypes/${z.doctype}`,{authorizeRequest:!0,organisationAware:!0});e.flag===`SUCCESS`&&(J.value=e.data)}catch(e){console.error(`LinkField: Meta fetch failed`,e)}},Z=async()=>{if(!z.modelValue||!z.doctype){q.value=``,K.value=``;return}if(!Y.value){Y.value=!0;try{let e=U.value.find(e=>e.value===z.modelValue);if(e){q.value=e.label.split(` (`)[0],K.value=q.value;return}J.value||await X();let t=await C.get(`/org/doc/${z.doctype}/${z.modelValue}`,{authorizeRequest:!0,organisationAware:!0});if(t&&t.flag===`SUCCESS`&&t.data){let e=t.data,n=J.value?.title_field,r=n&&e[n]?e[n]:e.name;q.value=r,K.value=r}else q.value=z.modelValue,K.value=z.modelValue}catch(e){console.error(`LinkField: Label resolution failed`,e),q.value=z.modelValue,K.value=z.modelValue}finally{Y.value=!1}}},Q=null,$=async(e=``)=>{if(!z.doctype){U.value=[];return}W.value=!0;try{J.value||await X();let t=[];if(z.doctype===`DocType`){if(t=(await C.get(`/org/doctypes`,{authorizeRequest:!0,organisationAware:!0})).data||[],e){let n=e.toLowerCase();t=t.filter(e=>e.name?.toLowerCase().includes(n))}U.value=t.map(e=>({value:e.name,label:e.name}))}else{let n={size:50};if(e){let t=J.value?.title_field;t?n[`${t}__like`]=e:n.name__like=e}t=(await C.get(`/org/doc/${z.doctype}`,{query:n,authorizeRequest:!0,organisationAware:!0})).data?.content||[];let r=J.value?.title_field;U.value=t.map(e=>({value:e.name,label:r&&e[r]?`${e[r]} (${e.name})`:e.name}))}}catch(e){console.error(`LinkField: Options fetch failed`,e)}finally{W.value=!1}};x(async()=>{z.modelValue&&Z()}),ne(()=>{clearTimeout(Q)}),b(K,e=>{!H.value||e===q.value||(clearTimeout(Q),Q=setTimeout(()=>{$(e)},300))}),b(H,e=>{e?$(K.value):K.value=q.value}),b(()=>z.modelValue,e=>{e?Z():q.value=``});let oe=e=>{e!==`__create_new__`&&(B(`update:modelValue`,e),H.value=!1)},se=e=>{G.value=!1;let t=J.value?.title_field,n=t&&e[t]?e[t]:e.name;U.value.unshift({value:e.name,label:t&&e[t]?`${e[t]} (${e.name})`:e.name}),q.value=n,K.value=n,B(`update:modelValue`,e.name),V({title:`Created & Linked`,description:`${z.doctype} ${e.name} successfully linked.`,variant:`success`})},ce=()=>{H.value=!1,G.value=!0};return(s,u)=>(w(),g(`div`,k,[T(d(n),{"model-value":I.modelValue,"onUpdate:modelValue":oe,open:H.value,"onUpdate:open":u[1]||=e=>H.value=e,"filter-function":e=>e},{default:_(()=>[h(`div`,A,[T(d(e),{class:`w-full`},{default:_(()=>[T(d(t),{modelValue:K.value,"onUpdate:modelValue":u[0]||=e=>K.value=e,placeholder:I.placeholder||`Select ${I.doctype}...`,class:ee([`w-full bg-white dark:bg-gray-950 border border-gray-300 dark:border-gray-800 focus:ring-2 focus:ring-black dark:focus:ring-white transition-all outline-none pr-10`,[I.compact?`px-2 py-1 text-xs rounded-full`:`px-4 py-2 rounded-full`]]),disabled:I.disabled},null,8,[`modelValue`,`placeholder`,`class`,`disabled`]),h(`div`,re,[W.value?(w(),o(d(D),{key:0,class:`h-4 w-4 animate-spin`})):(w(),o(d(te),{key:1,class:`h-4 w-4`}))])]),_:1}),T(d(r),{class:`absolute w-full bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 shadow-xl rounded-xl mt-2 p-1 z-[100] min-w-[200px] max-h-[300px] overflow-hidden flex flex-col`},{default:_(()=>[!W.value&&U.value.length===0?(w(),g(`div`,ie,[K.value?(w(),g(`span`,ae,`No results found for "`+p(K.value)+`"`,1)):(w(),g(`span`,j,`No options available`))])):m(``,!0),T(d(a),{class:`border-b border-gray-100 dark:border-gray-800 mb-1 pb-1 shrink-0`},{default:_(()=>[T(d(i),{value:`__create_new__`,onSelect:ce,class:`flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 cursor-pointer outline-none data-[highlighted]:bg-blue-200 dark:data-[highlighted]:bg-blue-900/20`},{default:_(()=>[T(d(S),{class:`h-4 w-4`}),c(` Create New `+p(I.doctype),1)]),_:1})]),_:1}),T(d(a),{class:`overflow-y-auto flex-1`},{default:_(()=>[(w(!0),g(l,null,v(U.value,e=>(w(),o(d(i),{key:e.value,value:e.value,class:`flex items-center justify-between px-3 py-2 text-sm rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-900 outline-none data-[state=checked]:bg-gray-50 dark:data-[state=checked]:bg-gray-900`},{default:_(()=>[h(`div`,M,[h(`span`,N,p(e.label),1)]),I.modelValue===e.value?(w(),o(d(f),{key:0,class:`h-4 w-4 text-black dark:text-white`})):m(``,!0)]),_:2},1032,[`value`]))),128))]),_:1}),W.value&&U.value.length===0?(w(),g(`div`,P,[T(d(D),{class:`h-4 w-4 animate-spin`}),u[3]||=c(` Searching... `,-1)])):m(``,!0)]),_:1})])]),_:1},8,[`model-value`,`open`,`filter-function`]),T(O,{modelValue:G.value,"onUpdate:modelValue":u[2]||=e=>G.value=e,"initial-height":85},{default:_(()=>[h(`div`,F,[T(d(R),{doctype:I.doctype,"is-new":!0,name:`new`,"is-embedded":!0,onSaved:se},null,8,[`doctype`])])]),_:1},8,[`modelValue`])]))}};export{I as t};