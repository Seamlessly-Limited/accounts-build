import"./useFormControl-BoSoz5bk.js";import"./ListboxItem-CrspQUEb.js";import"./ConfigProvider-BeNpEDZu.js";import"./useHideOthers-8j3pZZC2.js";import"./useDirection-CkCaHLjJ.js";import"./useId-C9uHTJK1.js";import"./useKbd-BvGB3m10.js";import"./PopperContent-CkzV4Efh.js";import"./useTypeahead-J2lSWUJi.js";import"./utils-d0L3vlW4.js";import"./VisuallyHiddenInput-Cr3vcfNb.js";import"./ComboboxItem-BV80ucMH.js";import"./ComboboxGroup-BOfthHuH.js";import{Aa as e,Bi as t,Hi as n,Ii as r,It as i,Li as a,Ni as ee,Oi as o,Pa as s,Ri as te,Ui as c,_a as l,da as u,ea as ne,g as d,gr as f,ia as p,n as m,na as h,o as g,r as re,wa as _,zi as v}from"./index-BW6FH5S4.js";import{t as ie}from"./WorkspaceStore-DkbvTQrR.js";import{t as y}from"./Input-AKTRhZx5.js";import"./BottomSheet-Ckf0geOJ.js";import{t as b}from"./LinkField-C2IIEkLF.js";var x={class:`h-full flex flex-col bg-white`},S={class:`flex-none px-6 py-4 bg-white border-b border-gray-200 flex items-center justify-between sticky top-0 z-10`},C={class:`flex items-center space-x-4`},w={class:`text-xl font-bold text-gray-900`},T=[`disabled`],E={class:`flex-1 flex overflow-hidden`},D={class:`w-1/3 border-r border-gray-200 overflow-y-auto p-6 bg-gray-50 space-y-6`},O={class:`space-y-4`},k={class:`space-y-1`},A={class:`space-y-1`},j={class:`space-y-1`},M={class:`space-y-1`},N={class:`space-y-1`},P={class:`space-y-1`},F={key:0,class:`pt-4 border-t border-gray-200`},I={class:`text-sm font-bold text-gray-900 mb-2`},L={class:`space-y-1 max-h-64 overflow-y-auto pr-2`},R=[`onClick`],ae={class:`font-mono text-blue-600`},z={class:`text-gray-400 group-hover:text-gray-600 truncate ml-2`},B={class:`w-2/3 flex flex-col`},V={class:`flex-1 p-0 relative`},H={__name:`EmailTemplateEditor`,props:{doctype:String,name:String,isNew:Boolean},setup(H){let{toast:U}=d(),W=ie(),G=m(),K=re(),q=H,J=_({body:`<div>
    <p>Dear \${doc.customer_name},</p>
    <p>Here is an update regarding \${doc.name}.</p>
</div>`}),Y=_(!1),X=_(null),Z=r(()=>q.name||G.params.name),Q=r(()=>q.isNew===void 0?Z.value===`new`:q.isNew),oe=r(()=>!X.value||!X.value.fields?[]:X.value.fields.filter(e=>!e.hidden)),se=async()=>{if(!Q.value)try{J.value=(await g.get(`/org/doc/Email Template/${Z.value}`,{authorizeRequest:!0,organisationAware:!0})).data||{}}catch(e){console.error(e),U({title:`Failed to load`,description:e.message,variant:`destructive`})}},ce=async()=>{if(!J.value.for_doctype){X.value=null;return}try{X.value=(await g.get(`/org/doctypes/${J.value.for_doctype}`,{authorizeRequest:!0,organisationAware:!0})).data}catch(e){console.warn(`Could not fetch target doctype meta`,e)}},le=async()=>{Y.value=!0;try{let e,t={data:J.value,authorizeRequest:!0,organisationAware:!0};e=Q.value?await g.post(`/org/doc/Email Template`,t):await g.patch(`/org/doc/Email Template/${Z.value}`,t);let n=e.data?.data||e.data;J.value=n,U({title:Q.value?`Created`:`Saved`,variant:`success`}),W.notifyDocSaved(`Email Template`,n.name),Q.value&&K.replace(`/app/Email Template/${n.name}`)}catch(e){U({title:`Error saving`,description:e.response?.data?.message||e.message,variant:`destructive`})}finally{Y.value=!1}},$=e=>{let t=`\${doc.${e}}`;navigator.clipboard.writeText(t),U({title:`Copied`,description:t,duration:1e3})};return u(()=>J.value.for_doctype,e=>{e?ce():X.value=null}),ne(()=>{se(),u(()=>J.value.for_doctype,()=>{},{once:!0})}),(r,u)=>(h(),t(`div`,x,[a(`header`,S,[a(`div`,C,[a(`button`,{onClick:u[0]||=e=>r.$router.back(),class:`p-2 hover:bg-gray-100 rounded-full text-gray-500`},[c(e(f),{class:`w-5 h-5`})]),a(`div`,null,[a(`h1`,w,s(Q.value?`New Email Template`:J.value.name),1)])]),a(`button`,{onClick:le,disabled:Y.value,class:`px-6 py-2 bg-black text-white rounded-full text-sm font-medium hover:bg-gray-900 transition-colors flex items-center gap-2 shadow-sm`},[Y.value?(h(),te(e(i),{key:0,class:`w-4 h-4 animate-spin`})):v(``,!0),n(` `+s(Q.value?`Create`:`Save`),1)],8,T)]),a(`div`,E,[a(`div`,D,[a(`div`,O,[a(`div`,k,[u[8]||=a(`label`,{class:`block text-sm font-medium text-gray-700`},`Template Name`,-1),c(y,{modelValue:J.value.name,"onUpdate:modelValue":u[1]||=e=>J.value.name=e,placeholder:`e.g. Welcome Email`,disabled:!Q.value},null,8,[`modelValue`,`disabled`])]),a(`div`,A,[u[9]||=a(`label`,{class:`block text-sm font-medium text-gray-700`},`Subject`,-1),c(y,{modelValue:J.value.subject,"onUpdate:modelValue":u[2]||=e=>J.value.subject=e,placeholder:`Email Subject`},null,8,[`modelValue`])]),a(`div`,j,[u[10]||=a(`label`,{class:`block text-sm font-medium text-gray-700`},`Category`,-1),c(y,{modelValue:J.value.category,"onUpdate:modelValue":u[3]||=e=>J.value.category=e,placeholder:`e.g. Marketing`},null,8,[`modelValue`])]),a(`div`,M,[u[11]||=a(`label`,{class:`block text-sm font-medium text-gray-700`},`For DocType (Context)`,-1),c(b,{modelValue:J.value.for_doctype,"onUpdate:modelValue":u[4]||=e=>J.value.for_doctype=e,doctype:`DocType`,placeholder:`Select DocType...`},null,8,[`modelValue`]),u[12]||=a(`p`,{class:`text-xs text-gray-500`},`Select a DocType to see available fields for dynamic content. `,-1)]),a(`div`,N,[u[13]||=a(`label`,{class:`block text-sm font-medium text-gray-700`},`Header Logo URL`,-1),c(y,{modelValue:J.value.header_logo,"onUpdate:modelValue":u[5]||=e=>J.value.header_logo=e,placeholder:`https://...`},null,8,[`modelValue`])]),a(`div`,P,[u[14]||=a(`label`,{class:`block text-sm font-medium text-gray-700`},`Footer Text`,-1),l(a(`textarea`,{class:`flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50`,"onUpdate:modelValue":u[6]||=e=>J.value.footer_text=e,rows:`2`},null,512),[[o,J.value.footer_text]])])]),X.value?(h(),t(`div`,F,[a(`h3`,I,`Available Fields (`+s(J.value.for_doctype)+`)`,1),a(`div`,L,[(h(!0),t(ee,null,p(oe.value,e=>(h(),t(`button`,{key:e.fieldname,onClick:t=>$(e.fieldname),class:`w-full text-left px-2 py-1.5 text-xs text-gray-600 hover:bg-gray-200 rounded flex justify-between group`},[a(`span`,ae,"${doc."+s(e.fieldname)+`}`,1),a(`span`,z,s(e.label),1)],8,R))),128))])])):v(``,!0)]),a(`div`,B,[u[15]||=a(`div`,{class:`flex-none p-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center`},[a(`span`,{class:`text-sm font-medium text-gray-600`},`Body Content (HTML)`),a(`span`,{class:`text-xs text-gray-400`},`Supports standard HTML & Thymeleaf syntax`)],-1),a(`div`,V,[l(a(`textarea`,{"onUpdate:modelValue":u[7]||=e=>J.value.body=e,class:`w-full h-full resize-none p-6 font-mono text-sm focus:outline-none border-none text-gray-800 leading-relaxed`,placeholder:`<html>...</html> or <div>...</div>`},null,512),[[o,J.value.body]])])])])]))}};export{H as default};