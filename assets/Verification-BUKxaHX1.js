import{B as e,H as t,S as n,St as r,T as i,W as a,a as o,et as s,f as c,m as l,o as u,t as d,w as f,x as p,y as m}from"./index-BbbjTprl.js";import{t as h}from"./createLucideIcon-CKY3DUp-.js";import{t as g}from"./circle-check-big-DzthGKfS.js";import{t as _}from"./loader-circle-PefCEOZG.js";import"./VisuallyHidden-CYcIbhM-.js";import"./dist-rCl7Sutb.js";import"./useArrowNavigation-9kt7NZor.js";import"./useForwardExpose-Bmr5sraL.js";import"./useDirection-COFyl7Rw.js";import"./VisuallyHiddenInput-Cfsx8dyJ.js";import"./Label-DyBGV7wr.js";import{n as v,r as y,t as b}from"./PinInputSlot-BGxqDi9m.js";import"./utils-DJKW7nPS.js";import"./dist-Gl_c-550.js";import{r as x}from"./UserService-DN21EUOL.js";import{t as S}from"./Card-BcaHldSu.js";import{t as C}from"./CardContent-C37D1E-X.js";import{t as w}from"./BackgroundAnimation-D5DyPeOZ.js";import{t as T}from"./button-D27hfMR6.js";import{a as E,i as D,n as O,r as k,t as A}from"./form-Bv6oIkmw.js";import"./Label-B2bC3Z5o.js";var j=h(`circle-x`,[[`circle`,{cx:`12`,cy:`12`,r:`10`,key:`1mglay`}],[`path`,{d:`m15 9-6 6`,key:`1uzhvr`}],[`path`,{d:`m9 9 6 6`,key:`z0biqf`}]]),M={name:`VerifyAccount`,components:{Button:T,Card:S,CardContent:C,Loader2:_,CheckCircle:g,XCircle:j,BackgroundAnimation:w,FormField:E,FormItem:O,FormLabel:A,FormControl:D,PinInput:y,PinInputGroup:v,PinInputSlot:b,FormDescription:k},data(){return{currentStep:0,loading:!1,resendCount:0,resendWaitTime:0,token:[]}},async mounted(){if(this.$route.params.token)await this.verifyAccount(this.$route.params.token);else{let{token:e}=await d.IndexedDB.get(`SeamlesslyDB`,`UserStore`,`preAuthorization`);e||this.$router.push(`/login`)}this.countDown()},computed:{formDisabled(){return this.loading||void 0}},methods:{paste(e){let t=(e.clipboardData||window.clipboardData).getData(`text`).trim();this.token=[``,...t.split(``)],t.length===6&&this.completeVerification()},focusNext(e,t){let n=`${e.target.value}`.trim();if(t===6&&n)return this.completeVerification();n.length===1&&t<6&&this.$refs[`otpInput`+(t+1)][0].focus(),n.length===0&&t>1&&this.$refs[`otpInput`+(t-1)][0].focus()},countDown(){this.resendWaitTime=60+this.resendCount;let e=setInterval(()=>--this.resendWaitTime,1e3);setTimeout(()=>{clearInterval(e),this.resendWaitTime=0},this.resendWaitTime*1e3)},async completeVerification(){let e=u(),t=``;try{if(t=this.token.reduce((e,t)=>`${e}${t}`),t.length<6)throw Error(`Invalid code provided!`)}catch{e.toast({message:`Invalid code provided!`,duration:5e3,type:`error`});return}this.loading=!0;try{if(await x.completeAccountVerification({code:t})){let e=localStorage.getItem(`postAuthenticationPath`);e?(this.$router.push(e),localStorage.removeItem(`postAuthenticationPath`)):window.location=`/`}}catch(t){e.toast({message:t,duration:5e3,type:`error`})}this.loading=!1},async verifyAccount(e){let t=u();try{this.currentStep=1;let n=await x.verifyAccount(e);t.toast({message:n.message||`Your verification was successful`,type:`success`,duration:5e3}),this.currentStep=2}catch(e){t.toast({message:e.message||`There was an error with your verification. Try again.`,type:`error`,duration:5e3}),this.currentStep=3}}}},N={class:`flex min-h-screen justify-center items-center bg-stone-100 text-foreground px-4`},P={class:`grid grid-cols-1 gap-2 mt-4 w-full`},F={class:`flex justify-end`},I={key:0},L={key:1},R={key:1,class:`text-sm text-muted-foreground`},z={key:2,class:`text-sm text-muted-foreground`},B={class:`font-semibold text-foreground`},V={key:3,class:`flex flex-col space-y-3 py-6`},H={key:4,class:`flex flex-col space-y-3 py-6`},U={key:5,class:`flex flex-col space-y-3 py-6`};function W(o,u,d,h,g,_){let v=a(`BackgroundAnimation`),y=a(`FormLabel`),b=a(`PinInputSlot`),x=a(`PinInputGroup`),S=a(`PinInput`),C=a(`FormControl`),w=a(`FormItem`),T=a(`FormField`),E=a(`Button`),D=a(`Loader2`),O=a(`CheckCircle`),k=a(`XCircle`),A=a(`CardContent`),j=a(`Card`);return e(),n(`div`,N,[i(v),i(j,{class:`w-full max-w-lg shadow-none border-solid border-slate-50 rounded-2xl relative`},{default:s(()=>[i(A,{class:`space-y-4`},{default:s(()=>[u[13]||=m(`div`,{class:`flex flex-col space-y-2`},[m(`h2`,{class:`text-2xl font-semibold`},`Verify your account`),m(`p`,{class:`text-muted-foreground`},` Complete your identity verification. `)],-1),g.currentStep===0?(e(),n(`form`,{key:0,onSubmit:u[1]||=c((...e)=>_.completeVerification&&_.completeVerification(...e),[`prevent`]),class:`space-y-6 py-3`},[m(`div`,P,[i(T,null,{default:s(()=>[i(w,null,{default:s(()=>[i(y,null,{default:s(()=>[...u[3]||=[f(`OTP`,-1)]]),_:1}),i(C,null,{default:s(()=>[i(S,{class:`rounded-full`,id:`pin-input`,modelValue:g.token,"onUpdate:modelValue":u[0]||=e=>g.token=e,placeholder:`â—‹`,onComplete:_.completeVerification},{default:s(()=>[i(x,null,{default:s(()=>[(e(),n(l,null,t(6,(e,t)=>i(b,{key:e,index:t},null,8,[`index`])),64))]),_:1})]),_:1},8,[`modelValue`,`onComplete`])]),_:1})]),_:1})]),_:1}),u[4]||=m(`div`,{class:`text-sm text-muted-foreground w-full`},[m(`p`,{class:`text-xs`},` Enter the OTP sent to your linked email address. `)],-1)]),m(`div`,F,[i(E,{disabled:g.loading,type:`submit`,class:`bg-primary text-primary-foreground rounded-full`},{default:s(()=>[g.loading?(e(),n(`span`,L,`Loading...`)):(e(),n(`span`,I,`Continue`))]),_:1},8,[`disabled`])])],32)):p(``,!0),g.resendWaitTime===0?(e(),n(`div`,R,[u[5]||=f(` If you do not receive a code in 5 minutes, you can `,-1),m(`span`,{onClick:u[2]||=e=>o.$router.push(`/login`),class:`text-blue-600 cursor-pointer font-semibold`},` retry login. `)])):(e(),n(`div`,z,[u[6]||=f(` You can request another verification code in `,-1),m(`span`,B,r(g.resendWaitTime)+`s`,1)])),g.currentStep===1?(e(),n(`div`,V,[i(D,{class:`w-10 h-10 animate-spin text-primary`}),u[7]||=m(`h3`,{class:`text-lg font-medium`},`Completing Verification...`,-1),u[8]||=m(`p`,{class:`text-sm text-muted-foreground`},`Please wait a moment`,-1)])):p(``,!0),g.currentStep===2?(e(),n(`div`,H,[i(O,{class:`w-10 h-10 text-green-500`}),u[9]||=m(`h3`,{class:`text-lg font-semibold`},`Verification Complete`,-1),u[10]||=m(`p`,{class:`text-sm text-muted-foreground`},[f(`You can now `),m(`a`,{href:`/login`,class:`text-primary underline`},`login`),f(`.`)],-1)])):p(``,!0),g.currentStep===3?(e(),n(`div`,U,[i(k,{class:`w-10 h-10 text-destructive`}),u[11]||=m(`h3`,{class:`text-lg font-semibold text-destructive`},`Verification Failed`,-1),u[12]||=m(`p`,{class:`text-sm text-muted-foreground`},[f(`Please try again or `),m(`a`,{href:`/login`,class:`text-primary underline`},`login`),f(`.`)],-1)])):p(``,!0)]),_:1})]),_:1})])}var G=o(M,[[`render`,W]]);export{G as default};