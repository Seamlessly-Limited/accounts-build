import"./useFormControl-I5e8ntVi.js";import"./ListboxItem-R_jpoZYc.js";import"./ConfigProvider-Cf3TFtJ9.js";import"./useHideOthers-DOFiNZks.js";import"./useDirection-CUs44sCO.js";import"./useId-DsZNdByk.js";import"./useKbd-BvGB3m10.js";import"./PopperContent-Bfs6wgZt.js";import"./useTypeahead-c2JOyg4Z.js";import"./utils-BVHQiFXk.js";import"./VisuallyHiddenInput-H9N0RMFB.js";import"./ComboboxItem-C7Di9fS5.js";import"./ComboboxGroup-DBhLNDdO.js";import{Bi as e,Bt as t,Hi as n,Ki as r,Li as ee,Mi as i,Oa as a,Pa as o,Ra as s,Ui as c,Vi as l,Wi as u,br as d,ca as te,h as ne,ha as f,ia as p,n as m,o as h,oa as g,qi as _,r as re,xa as v}from"./index-HKVTK5TI.js";import{t as ie}from"./WorkspaceStore-DvzhR4zh.js";import{t as y}from"./Input-BwfiGKb1.js";import"./BottomSheet-6JWnJnGj.js";import{t as b}from"./LinkField-D-lwnhnP.js";var x={class:`h-full flex flex-col bg-white`},S={class:`flex-none px-6 py-4 bg-white border-b border-gray-200 flex items-center justify-between sticky top-0 z-10`},C={class:`flex items-center space-x-4`},w={class:`text-xl font-bold text-gray-900`},T=[`disabled`],E={class:`flex-1 flex overflow-hidden`},D={class:`w-1/3 border-r border-gray-200 overflow-y-auto p-6 bg-gray-50 space-y-6`},O={class:`space-y-4`},k={class:`space-y-1`},A={class:`space-y-1`},j={class:`space-y-1`},M={class:`space-y-1`},N={class:`space-y-1`},P={class:`space-y-1`},F={key:0,class:`pt-4 border-t border-gray-200`},ae={class:`text-sm font-bold text-gray-900 mb-2`},I={class:`space-y-1 max-h-64 overflow-y-auto pr-2`},L=[`onClick`],R={class:`font-mono text-blue-600`},z={class:`text-gray-400 group-hover:text-gray-600 truncate ml-2`},B={class:`w-2/3 flex flex-col`},V={class:`flex-1 p-0 relative`},H={__name:`EmailTemplateEditor`,props:{doctype:String,name:String,isNew:Boolean},setup(H){let{toast:U}=ne(),W=ie(),G=m(),K=re(),q=H,J=a({content:`<div>
    <p>Dear \${doc.customer_name},</p>
    <p>Here is an update regarding \${doc.name}.</p>
</div>`}),Y=a(!1),X=a(null),Z=e(()=>q.name||G.params.name),Q=e(()=>q.isNew===void 0?Z.value===`new`:q.isNew),oe=e(()=>!X.value||!X.value.fields?[]:X.value.fields.filter(e=>!e.hidden)),se=async()=>{if(!Q.value)try{J.value=(await h.get(`/org/doc/Email Template/${Z.value}`,{authorizeRequest:!0,organisationAware:!0})).data||{}}catch(e){console.error(e),U({title:`Failed to load`,description:e.message,variant:`destructive`})}},ce=async()=>{if(!J.value.for_doctype){X.value=null;return}try{X.value=(await h.get(`/org/doctypes/${J.value.for_doctype}`,{authorizeRequest:!0,organisationAware:!0})).data}catch(e){console.warn(`Could not fetch target doctype meta`,e)}},le=async()=>{Y.value=!0;try{let e,t={data:J.value,authorizeRequest:!0,organisationAware:!0};e=Q.value?await h.post(`/org/doc/Email Template`,t):await h.patch(`/org/doc/Email Template/${Z.value}`,t);let n=e.data?.data||e.data;J.value=n,U({title:Q.value?`Created`:`Saved`,variant:`success`}),W.notifyDocSaved(`Email Template`,n.name),Q.value&&K.replace(`/app/Email Template/${n.name}`)}catch(e){U({title:`Error saving`,description:e.response?.data?.message||e.message,variant:`destructive`})}finally{Y.value=!1}},$=e=>{let t=`\${doc.${e}}`;navigator.clipboard.writeText(t),U({title:`Copied`,description:t,duration:1e3})};return f(()=>J.value.for_doctype,e=>{e?ce():X.value=null}),p(()=>{se(),f(()=>J.value.for_doctype,()=>{},{once:!0})}),(e,a)=>(g(),u(`div`,x,[l(`header`,S,[l(`div`,C,[l(`button`,{onClick:a[0]||=t=>e.$router.back(),class:`p-2 hover:bg-gray-100 rounded-full text-gray-500`},[_(o(d),{class:`w-5 h-5`})]),l(`div`,null,[l(`h1`,w,s(Q.value?`New Email Template`:J.value.name),1)])]),l(`button`,{onClick:le,disabled:Y.value,class:`px-6 py-2 bg-black text-white rounded-full text-sm font-medium hover:bg-gray-900 transition-colors flex items-center gap-2 shadow-sm`},[Y.value?(g(),n(o(t),{key:0,class:`w-4 h-4 animate-spin`})):c(``,!0),r(` `+s(Q.value?`Create`:`Save`),1)],8,T)]),l(`div`,E,[l(`div`,D,[l(`div`,O,[l(`div`,k,[a[8]||=l(`label`,{class:`block text-sm font-medium text-gray-700`},`Template Name`,-1),_(y,{modelValue:J.value.name,"onUpdate:modelValue":a[1]||=e=>J.value.name=e,placeholder:`e.g. Welcome Email`,disabled:!Q.value},null,8,[`modelValue`,`disabled`])]),l(`div`,A,[a[9]||=l(`label`,{class:`block text-sm font-medium text-gray-700`},`Subject`,-1),_(y,{modelValue:J.value.subject,"onUpdate:modelValue":a[2]||=e=>J.value.subject=e,placeholder:`Email Subject`},null,8,[`modelValue`])]),l(`div`,j,[a[10]||=l(`label`,{class:`block text-sm font-medium text-gray-700`},`Category`,-1),_(y,{modelValue:J.value.category,"onUpdate:modelValue":a[3]||=e=>J.value.category=e,placeholder:`e.g. Marketing`},null,8,[`modelValue`])]),l(`div`,M,[a[11]||=l(`label`,{class:`block text-sm font-medium text-gray-700`},`For DocType (Context)`,-1),_(b,{modelValue:J.value.for_doctype,"onUpdate:modelValue":a[4]||=e=>J.value.for_doctype=e,doctype:`DocType`,placeholder:`Select DocType...`},null,8,[`modelValue`]),a[12]||=l(`p`,{class:`text-xs text-gray-500`},`Select a DocType to see available fields for dynamic content. `,-1)]),l(`div`,N,[a[13]||=l(`label`,{class:`block text-sm font-medium text-gray-700`},`Header Logo URL`,-1),_(y,{modelValue:J.value.header_logo,"onUpdate:modelValue":a[5]||=e=>J.value.header_logo=e,placeholder:`https://...`},null,8,[`modelValue`])]),l(`div`,P,[a[14]||=l(`label`,{class:`block text-sm font-medium text-gray-700`},`Footer Text`,-1),v(l(`textarea`,{class:`flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50`,"onUpdate:modelValue":a[6]||=e=>J.value.footer_text=e,rows:`2`},null,512),[[i,J.value.footer_text]])])]),X.value?(g(),u(`div`,F,[l(`h3`,ae,`Available Fields (`+s(J.value.for_doctype)+`)`,1),l(`div`,I,[(g(!0),u(ee,null,te(oe.value,e=>(g(),u(`button`,{key:e.fieldname,onClick:t=>$(e.fieldname),class:`w-full text-left px-2 py-1.5 text-xs text-gray-600 hover:bg-gray-200 rounded flex justify-between group`},[l(`span`,R,"${doc."+s(e.fieldname)+`}`,1),l(`span`,z,s(e.label),1)],8,L))),128))])])):c(``,!0)]),l(`div`,B,[a[15]||=l(`div`,{class:`flex-none p-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center`},[l(`span`,{class:`text-sm font-medium text-gray-600`},`Body Content (HTML)`),l(`span`,{class:`text-xs text-gray-400`},`Supports standard HTML & Thymeleaf syntax`)],-1),l(`div`,V,[v(l(`textarea`,{"onUpdate:modelValue":a[7]||=e=>J.value.content=e,class:`w-full h-full resize-none p-6 font-mono text-sm focus:outline-none border-none text-gray-800 leading-relaxed`,placeholder:`<html>...</html> or <div>...</div>`},null,512),[[i,J.value.content]])])])])]))}};export{H as default};