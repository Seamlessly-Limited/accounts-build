import"./useNonce-CnEoXn07.js";import"./ConfigProvider-Ckl6KgMj.js";import"./useDirection-B1kSZwKq.js";import{t as e}from"./ScrollArea-DIt3oQvI.js";import{$i as t,Ea as n,Ei as r,Fi as i,G as a,Gn as o,Li as s,Mi as c,Mn as l,Ni as u,Nt as d,Oi as f,Pi as p,Qt as ee,Ri as m,Ta as h,Ut as te,Yi as ne,Zi as g,ar as re,da as _,dr as ie,ji as v,ka as y,o as b,oa as ae,ot as oe,ya as x}from"./index-CHNvwQRL.js";import{n as S}from"./button-DSlecn3R.js";import{t as C}from"./badge-VpN0zBGl.js";var w={async getSessions(e=0,t=20){return b.get(`/org/reconciliation`,{query:{page:e,size:t},authorizeRequest:!0,organisationAware:!0})},async startReconciliation(e,t,n,r,i){return b.post(`/org/reconciliation/start`,{data:{bankAccountReference:e,periodStart:t,periodEnd:n,openingBalance:r,closingBalance:i},authorizeRequest:!0,organisationAware:!0})},async getSession(e){return b.get(`/org/reconciliation/${e}`,{authorizeRequest:!0,organisationAware:!0})},async getSessionItems(e){return b.get(`/org/reconciliation/${e}/items`,{authorizeRequest:!0,organisationAware:!0})},async getItemsByStatus(e,t){return b.get(`/org/reconciliation/${e}/items/${t}`,{authorizeRequest:!0,organisationAware:!0})},async approveItem(e){return b.post(`/org/reconciliation/items/${e}/approve`,{data:{},authorizeRequest:!0,organisationAware:!0})},async manualMatch(e,t,n){return b.post(`/org/reconciliation/${e}/match`,{data:{transactionReference:t,entryReference:n},authorizeRequest:!0,organisationAware:!0})},async addAdjustment(e,t,n,r,i,a=!0){return b.post(`/org/reconciliation/${e}/adjustments`,{data:{type:t,description:n,amount:r,adjustmentDate:i,addsToBook:a},authorizeRequest:!0,organisationAware:!0})},async finalizeReconciliation(e){return b.post(`/org/reconciliation/${e}/finalize`,{data:{},authorizeRequest:!0,organisationAware:!0})}},T={class:`flex-1 min-w-0`},E={class:`flex items-center justify-between gap-2`},D={class:`font-medium text-slate-800 truncate`},O={class:`flex items-center gap-2 text-xs text-slate-500`},k={key:0,class:`text-slate-400`},A={__name:`ReconciliationRow`,props:{item:Object,side:String,selected:Boolean,matched:Boolean,suggested:Boolean},emits:[`click`,`approve`],setup(e){function t(e){return new Intl.NumberFormat(`en-NG`,{minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.abs(e||0))}function s(e){return e?new Date(e).toLocaleDateString(`en-US`,{month:`short`,day:`numeric`}):``}return(d,f)=>(g(),i(`div`,{class:n([`flex items-center gap-3 px-3 py-2 rounded-lg cursor-pointer transition-all text-sm`,e.matched?`bg-green-50 border border-green-200`:e.suggested?`bg-blue-50 border border-blue-200`:e.selected?`bg-slate-100 border border-slate-300`:`hover:bg-slate-50 border border-transparent`]),onClick:f[1]||=e=>d.$emit(`click`)},[c(`div`,{class:n([`h-6 w-6 rounded-full flex items-center justify-center flex-shrink-0`,e.matched?`bg-green-500 text-white`:e.suggested?`bg-blue-500 text-white`:`bg-slate-200 text-slate-500`])},[e.matched?(g(),u(h(o),{key:0,class:`h-3.5 w-3.5`})):e.suggested?(g(),u(h(a),{key:1,class:`h-3.5 w-3.5`})):(g(),u(h(l),{key:2,class:`h-3 w-3`}))],2),c(`div`,T,[c(`div`,E,[c(`span`,D,y(e.item.description),1),c(`span`,{class:n([`text-sm font-semibold whitespace-nowrap`,e.item.type===`CREDIT`?`text-green-600`:`text-red-600`])},y(e.item.type===`CREDIT`?`+`:`-`)+y(t(e.item.amount)),3)]),c(`div`,O,[c(`span`,null,y(s(e.item.transactionDate||e.item.entryDate)),1),e.item.reference?(g(),i(`span`,k,`â€¢ `+y(e.item.reference),1)):p(``,!0)])]),e.suggested&&!e.matched?(g(),u(h(S),{key:0,variant:`ghost`,size:`sm`,class:`h-7 w-7 p-0 flex-shrink-0`,onClick:f[0]||=r(e=>d.$emit(`approve`),[`stop`])},{default:_(()=>[m(h(o),{class:`h-4 w-4 text-green-600`})]),_:1})):p(``,!0)],2))}},se={class:`flex flex-col h-full`},ce={key:0,class:`flex-1 flex items-center justify-center`},le={class:`flex items-center justify-between px-4 py-2 border-b border-slate-100 bg-white`},ue={class:`flex items-center gap-3`},de={class:`flex items-center gap-1.5 text-sm`},fe={class:`font-medium`},pe={class:`flex items-center gap-2`},j={class:`flex items-center justify-between px-4 py-3 bg-slate-50 border-b border-slate-100`},M={class:`flex items-center gap-6`},N={class:`text-center`},P={class:`text-lg font-bold text-slate-800`},F={class:`text-center`},I={class:`text-lg font-bold text-slate-800`},L={class:`text-lg font-bold`},R={class:`text-xs opacity-80`},z={class:`flex items-center gap-4`},B={class:`text-center`},me={class:`text-lg font-bold text-green-600`},he={class:`text-center`},ge={class:`text-lg font-bold text-amber-600`},_e={class:`text-center`},ve={class:`text-lg font-bold text-slate-800`},ye={class:`flex-1 flex overflow-hidden`},be={class:`w-1/2 border-r border-slate-200 flex flex-col`},xe={class:`px-4 py-2 bg-blue-50 border-b border-slate-200`},Se={class:`flex items-center gap-2`},Ce={class:`p-2 space-y-1`},we={class:`w-1/2 flex flex-col`},Te={class:`px-4 py-2 bg-green-50 border-b border-slate-200`},Ee={class:`flex items-center gap-2`},De={class:`p-2 space-y-1`},Oe={key:0,class:`px-4 py-3 bg-white border-t border-slate-200`},ke={class:`flex items-center justify-between`},Ae={class:`flex items-center gap-4`},je={class:`text-sm`},Me={class:`font-medium ml-1`},Ne={class:`font-medium`},Pe={class:`flex items-center gap-2`},V={__name:`ReconciliationView`,props:{sessionReference:String,account:Object},emits:[`finalized`,`updated`],setup(r,{emit:a}){let l=r,b=a,T=x(!1),E=x(!1),D=x(!1),O=x(!1),k=x(null),V=x([]),H=x(null),U=x(null),Fe=v(()=>k.value?.periodStart&&k.value?.periodEnd?`${$(k.value.periodStart)} - ${$(k.value.periodEnd)}`:k.value?.name||`Reconciliation`),Ie=v(()=>({COMPLETED:`default`,IN_PROGRESS:`secondary`,PENDING_REVIEW:`outline`,DRAFT:`outline`,CANCELLED:`destructive`})[k.value?.status]||`outline`),Le=v(()=>{let e=k.value?.difference||0;return e===0?`bg-green-100 text-green-800`:e>0?`bg-amber-100 text-amber-800`:`bg-red-100 text-red-800`}),Re=v(()=>{let e=k.value?.difference||0;return e===0?`Balanced`:e>0?`Bank Higher`:`Book Higher`}),W=v(()=>(k.value?.unmatchedBankItems||0)+(k.value?.unmatchedBookItems||0)),ze=v(()=>{let e=(k.value?.totalBankItems||0)+(k.value?.totalBookItems||0),t=k.value?.matchedItems||0;return e>0?Math.round(t*2/e*100):0}),Be=v(()=>W.value===0&&k.value?.status!==`COMPLETED`),G=v(()=>V.value.filter(e=>e.bookEntry!=null)),K=v(()=>V.value.filter(e=>e.bankTransaction!=null));ne(()=>{l.sessionReference&&q()}),ae(()=>l.sessionReference,e=>{e&&q()});async function q(){T.value=!0;try{let[e,t]=await Promise.all([w.getSession(l.sessionReference),w.getSessionItems(l.sessionReference)]);k.value=e.data,V.value=t.data}catch(e){console.error(`Failed to load session:`,e)}finally{T.value=!1}}async function J(){E.value=!0;try{let[e,t]=await Promise.all([w.getSession(l.sessionReference),w.getSessionItems(l.sessionReference)]);k.value=e.data,V.value=t.data}catch(e){console.error(`Failed to refresh:`,e)}finally{E.value=!1}}function Ve(e){H.value=e}function Y(e){U.value=e}function X(){H.value=null,U.value=null}async function Z(e){try{await w.approveItem(e.reference),await J()}catch(e){console.error(`Failed to approve:`,e)}}async function He(){if(!(!H.value?.bookEntry||!U.value?.bankTransaction)){D.value=!0;try{await w.manualMatch(l.sessionReference,U.value.bankTransaction.reference,H.value.bookEntry.reference),X(),await J(),b(`updated`)}catch(e){console.error(`Failed to match:`,e)}finally{D.value=!1}}}async function Ue(){O.value=!0;try{await w.finalizeReconciliation(l.sessionReference),await J(),b(`finalized`)}catch(e){console.error(`Failed to finalize:`,e)}finally{O.value=!1}}function Q(e){return new Intl.NumberFormat(`en-NG`,{style:`currency`,currency:l.account?.currency||`NGN`,minimumFractionDigits:0}).format(e)}function $(e){return e?new Date(e).toLocaleDateString(`en-US`,{month:`short`,year:`numeric`}):``}return(r,a)=>(g(),i(`div`,se,[T.value?(g(),i(`div`,ce,[m(h(d),{class:`h-8 w-8 animate-spin text-slate-400`})])):(g(),i(f,{key:1},[c(`div`,le,[c(`div`,ue,[c(`div`,de,[m(h(ee),{class:`h-4 w-4 text-green-600`}),c(`span`,fe,y(Fe.value),1)]),m(h(C),{variant:Ie.value},{default:_(()=>[s(y(k.value?.status||`New`),1)]),_:1},8,[`variant`])]),c(`div`,pe,[m(h(S),{variant:`outline`,size:`sm`,class:`h-8`,onClick:J,disabled:E.value},{default:_(()=>[E.value?(g(),u(h(d),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(g(),u(h(oe),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),a[0]||=s(` Refresh `,-1)]),_:1},8,[`disabled`]),m(h(S),{size:`sm`,class:`h-8`,disabled:!Be.value||O.value,onClick:Ue},{default:_(()=>[O.value?(g(),u(h(d),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(g(),u(h(o),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),a[1]||=s(` Finalize `,-1)]),_:1},8,[`disabled`])])]),c(`div`,j,[c(`div`,M,[c(`div`,N,[c(`div`,P,y(Q(k.value?.bookBalance||0)),1),a[2]||=c(`div`,{class:`text-xs text-slate-500`},`Book Balance`,-1)]),c(`div`,F,[c(`div`,I,y(Q(k.value?.closingBalance||0)),1),a[3]||=c(`div`,{class:`text-xs text-slate-500`},`Bank Balance`,-1)]),c(`div`,{class:n([`text-center px-4 py-1 rounded-lg`,Le.value])},[c(`div`,L,y(Q(Math.abs(k.value?.difference||0))),1),c(`div`,R,y(Re.value),1)],2)]),c(`div`,z,[c(`div`,B,[c(`div`,me,y(k.value?.matchedItems||0),1),a[4]||=c(`div`,{class:`text-xs text-slate-500`},`Matched`,-1)]),c(`div`,he,[c(`div`,ge,y(W.value),1),a[5]||=c(`div`,{class:`text-xs text-slate-500`},`Unmatched`,-1)]),c(`div`,_e,[c(`div`,ve,y(ze.value)+`%`,1),a[6]||=c(`div`,{class:`text-xs text-slate-500`},`Match Rate`,-1)])])]),c(`div`,ye,[c(`div`,be,[c(`div`,xe,[c(`div`,Se,[m(h(re),{class:`h-4 w-4 text-blue-600`}),a[7]||=c(`span`,{class:`text-sm font-semibold text-blue-800`},`Book Entries`,-1),m(h(C),{variant:`secondary`,class:`ml-auto`},{default:_(()=>[s(y(G.value.length),1)]),_:1})])]),m(h(e),{class:`flex-1`},{default:_(()=>[c(`div`,Ce,[(g(!0),i(f,null,t(G.value,e=>(g(),u(A,{key:e.reference,item:e,side:`book`,selected:H.value?.reference===e.reference,matched:e.matchStatus===`MATCHED`,suggested:e.matchStatus===`SUGGESTED`,onClick:t=>Ve(e),onApprove:t=>Z(e)},null,8,[`item`,`selected`,`matched`,`suggested`,`onClick`,`onApprove`]))),128))])]),_:1})]),c(`div`,we,[c(`div`,Te,[c(`div`,Ee,[m(h(te),{class:`h-4 w-4 text-green-600`}),a[8]||=c(`span`,{class:`text-sm font-semibold text-green-800`},`Bank Transactions`,-1),m(h(C),{variant:`secondary`,class:`ml-auto`},{default:_(()=>[s(y(K.value.length),1)]),_:1})])]),m(h(e),{class:`flex-1`},{default:_(()=>[c(`div`,De,[(g(!0),i(f,null,t(K.value,e=>(g(),u(A,{key:e.reference,item:e,side:`bank`,selected:U.value?.reference===e.reference,matched:e.matchStatus===`MATCHED`,suggested:e.matchStatus===`SUGGESTED`,onClick:t=>Y(e),onApprove:t=>Z(e)},null,8,[`item`,`selected`,`matched`,`suggested`,`onClick`,`onApprove`]))),128))])]),_:1})])]),H.value&&U.value?(g(),i(`div`,Oe,[c(`div`,ke,[c(`div`,Ae,[c(`div`,je,[a[9]||=c(`span`,{class:`text-slate-500`},`Selected:`,-1),c(`span`,Me,y(H.value.bookEntry?.description||`Book Entry`),1),m(h(ie),{class:`h-4 w-4 inline mx-2 text-slate-400`}),c(`span`,Ne,y(U.value.bankTransaction?.narration||`Bank Tx`),1)])]),c(`div`,Pe,[m(h(S),{variant:`outline`,size:`sm`,onClick:X},{default:_(()=>[...a[10]||=[s(`Cancel`,-1)]]),_:1}),m(h(S),{size:`sm`,onClick:He,disabled:D.value},{default:_(()=>[D.value?(g(),u(h(d),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(g(),u(h(o),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),a[11]||=s(` Confirm Match `,-1)]),_:1},8,[`disabled`])])])])):p(``,!0)],64))]))}};export{V as default};