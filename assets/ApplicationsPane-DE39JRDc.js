import{$ as e,$i as t,$n as n,An as r,At as i,Bt as a,C as ee,Ci as te,Cn as ne,Ct as re,D as ie,E as ae,Ea as o,F as oe,Fi as s,Fn as se,G as ce,J as le,Lt as ue,Mi as c,N as de,Ni as l,O as fe,Oa as u,Oi as d,Ot as pe,Pi as f,Pn as me,Pt as he,Ri as p,S as ge,St as _e,Ta as m,Ut as ve,V as ye,X as be,Y as xe,Yi as Se,Zi as h,Zn as Ce,Zt as we,_r as Te,ar as Ee,b as g,ci as _,cn as v,cr as y,ct as b,dn as x,en as S,er as C,et as w,fa as T,ft as E,gi as D,i as O,ir as De,ji as Oe,jn as ke,ka as k,kn as Ae,ln as je,na as A,nn as Me,nt as Ne,o as j,oa as Pe,on as Fe,ot as Ie,pi as M,q as Le,qn as N,qt as Re,r as ze,rn as Be,rr as Ve,sn as He,sr as Ue,st as We,tn as Ge,tt as P,un as Ke,w as qe,wn as Je,xt as Ye,ya as F,z as Xe}from"./index-CHNvwQRL.js";import{t as Ze}from"./WorkspaceStore-Djee2ZJb.js";function I(e){let t=e.map(e=>{let t=e.apps.map(e=>e.name).sort().join(`,`);return`${e.name}:[${t}]`}).sort().join(`|`),n=5381;for(let e=0;e<t.length;e++)n=(n<<5)+n+t.charCodeAt(e),n&=n;return Math.abs(n).toString(36)}var L={getDocTypes:async()=>{try{return(await j.get(`/org/doctypes`,{authorizeRequest:!0,organisationAware:!0}))?.data||[]}catch(e){return console.warn(`Failed to fetch doc types:`,e),[]}},getAllApplications:async()=>{let e=await L.getDocTypes(),t={Stock:`Package`,Inventory:`Package`,Selling:`TrendingUp`,Sales:`TrendingUp`,Billing:`Receipt`,CRM:`Users`,Buying:`ShoppingBag`,Purchases:`ShoppingBag`,Accounting:`Calculator`,Finance:`Landmark`,System:`Settings`,Core:`Cog`,Notifications:`Bell`,Setup:`Settings`},n=[`File`,`Brand Settings`,`Application`,`Application Group`,`Doc Event Type`,`Approval`],r={};e.forEach(e=>{if(e.is_child||n.includes(e.name)||!e.module)return;let i=e.module;r[i]||(r[i]={id:`module-${i.toLowerCase().replace(/\s+/g,`-`)}`,name:i,type:`group`,icon:t[i]||`Folder`,apps:[]}),r[i].apps.push({id:`doctype-${e.name.toLowerCase().replace(/\s+/g,`-`)}`,name:e.name,icon:e.icon||`FileText`,background:e.color||`bg-stone-400`,route:`/app/${encodeURIComponent(e.name)}`,type:`doctype-app`,doctype:e.name})});let i=Object.values(r);i.sort((e,t)=>e.name.localeCompare(t.name)),i.forEach(e=>{e.apps.sort((e,t)=>e.name.localeCompare(t.name))});let a=I(i);return{groups:i,structureHash:a}}},Qe=L,$e={key:0,class:`absolute inset-0 z-[100] flex flex-col`},et={class:`relative z-10 flex flex-col h-full w-full max-w-7xl mx-auto p-4 md:p-8 pointer-events-auto`},tt={class:`flex justify-start mb-6 mt-2`},nt={class:`relative w-full pointer-events-auto`},rt={class:`flex items-center gap-3 mb-4 ml-2`},it={class:`text-xl font-semibold text-slate-800`},at={class:`grid grid-cols-3 md:grid-cols-6 lg:grid-cols-8 gap-4 justify-items-center`},ot=[`onClick`],st={class:`text-black text-xs md:text-sm font-medium text-center line-clamp-2 shadow-black drop-shadow-sm opacity-90 group-hover:opacity-100`},ct={key:0,class:`mb-20`},lt={class:`grid grid-cols-3 md:grid-cols-6 lg:grid-cols-8 gap-4 justify-items-center`},ut=[`onClick`],dt={class:`text-black text-xs md:text-sm font-medium text-center line-clamp-2 shadow-black drop-shadow-sm opacity-90 group-hover:opacity-100`},ft={key:1,class:`flex flex-col items-center justify-center h-64 text-slate-500`},R={__name:`ApplicationsPane`,props:{isOpen:Boolean},emits:[`close`],setup(O,{emit:j}){let I=O,L=j,R=ze(),z=Ze(),B={Package:_e,Box:Ve,SlidersHorizontal:Le,Truck:de,TrendingUp:oe,Users:qe,UserPlus:ie,FileText:Be,FileQuestion:Fe,Receipt:b,Bookmark:De,ClipboardList:ke,Banknote:y,FileMinus:v,RefreshCw:Ie,CreditCard:Je,ShoppingCart:le,Store:ye,Vault:ee,FileInput:je,CalendarClock:Ce,ShoppingBag:xe,PackageCheck:re,Send:w,FilePlus:He,RefreshCcw:We,Landmark:ve,Scale:Ne,Link:ue,BookOpen:Ee,Library:a,Folder:S,FolderOpen:Ge,Clock:r,User:ae,Building:n,Building2:C,Pin:E,File:Me,Code:Ae,FileCode:Ke,Database:ne,Settings:e,BarChart:N,HelpCircle:se,Sparkles:ce,Mail:i,AppWindow:Te,UserCheck:fe,CircleUserRound:me,History:Re,Zap:g,Globe:we,Palette:Ye,Wallet:ge,List:he,Bell:Ue,ShieldCheck:be,Terminal:Xe,FileJson:x,Megaphone:pe};function pt(){try{let e=JSON.parse(localStorage.getItem(`organisation`)||`{}`),t=JSON.parse(localStorage.getItem(`user`)||`{}`);return e.creatorId===t.id||e.creator?.id===t.id}catch{return!1}}function V(e){return e&&(e.startsWith(`#`)||e.startsWith(`rgb`))}function H(e){return!e||V(e)?``:e}function U(e){return!e||!V(e)?{}:{backgroundColor:e}}function W(e){return e.type===`group`?{...e,apps:e.apps.map(e=>({...e}))}:{...e}}function G(e,t){let n=new Map;t.forEach(e=>{n.set(e.id,e)});let r=new Set(e.map(e=>e.id)),i=[];return e.forEach(e=>{let t=n.get(e.id);if(t)if(t.type===`group`&&e.type===`group`){let n=W(t);n.apps=G(e.apps||[],t.apps||[]),i.push(n)}else i.push(W(t))}),t.forEach(e=>{r.has(e.id)||i.push(W(e))}),i}let K=M(`flow-applications-order`,null),q=M(`flow-cached-apps`,[]),J=M(`flow-apps-hash`,``),Y=F(!0),X=F([]);Se(async()=>{let e=e=>e.some(e=>e.id===`approvals-inbox`)?e:[{id:`approvals-inbox`,name:`Approvals`,icon:`UserCheck`,background:`#334155`,module:`System`,ownerOnly:!1},...e];q.value&&q.value.length>0&&(X.value=e(q.value),Y.value=!1);try{let{groups:t,structureHash:n}=await Qe.getAllApplications(),r=e(t);n===J.value?K.value&&Array.isArray(K.value)?X.value=G(K.value,r):X.value=r.map(W):(console.log(`Applications structure changed, resetting order`),K.value=null,X.value=r.map(W)),q.value=r,J.value=n}catch(e){console.error(`Failed to load applications:`,e)}finally{Y.value=!1}}),D(X,e=>{K.value=e},{deep:!0,debounce:500});let Z=F(``),Q=Oe(()=>{let e=pt(),t=t=>{if(!Z.value)return t.filter(t=>!t.ownerOnly||e);let n=Z.value.toLowerCase();return t.filter(t=>t.ownerOnly&&!e?!1:t.name.toLowerCase().includes(n))},n=[],r=[];return X.value.forEach(i=>{if(!i.ownerOnly||e)if(i.type===`group`){let e=t(i.apps||[]);e.length>0&&n.push({...i,apps:e})}else (!Z.value||i.name.toLowerCase().includes(Z.value.toLowerCase()))&&r.push(i)}),{groups:n,looseApps:r}}),$=e=>{try{if(e.id===`approvals-inbox`){z.openTab({id:`approvals`,title:`Approvals`,type:`approvals`,icon:`UserCheck`,closable:!0,pinned:!0}),L(`close`),R.push({path:`/workspace`,hash:`#approvals`});return}if(e.doctype){let t={id:e.id||`doctype-${e.doctype.toLowerCase().replace(/\s+/g,`-`)}`,title:e.name,icon:e.icon,type:`doctype`,doctype:e.doctype,props:e.props||{},closable:!0};z.openTab(t),L(`close`),R.push({path:`/workspace`,hash:`#${t.id}`})}else L(`close`),R.push(e.route)}catch(e){console.error(`Failed to open app:`,e)}};return Pe(()=>I.isOpen,e=>{e||setTimeout(()=>{Z.value=``},300)}),_(`Escape`,()=>{I.isOpen&&L(`close`)}),(e,n)=>O.isOpen?(h(),s(`div`,$e,[c(`div`,{class:`absolute inset-0 bg-white/40 backdrop-blur-xl`,onClick:n[0]||=t=>e.$emit(`close`)}),c(`div`,et,[c(`div`,tt,[c(`div`,nt,[p(m(P),{class:`absolute left-3 top-1/2 -translate-y-1/2 text-black/60 h-5 w-5`}),T(c(`input`,{"onUpdate:modelValue":n[1]||=e=>Z.value=e,type:`text`,placeholder:`Type to search...`,class:`w-full bg-white/90 border-4 border-gray-200 rounded-full py-1.5 pl-10 pr-4 text-black placeholder-black/50 focus:outline-none focus:bg-white/20 focus:border-stone-100/80 transition-all`},null,512),[[te,Z.value]])])]),c(`div`,{class:`flex-1 relative overflow-y-auto px-4 pb-20 pt-10`,onClick:n[2]||=t=>e.$emit(`close`),style:{"scrollbar-width":`none`}},[(h(!0),s(d,null,t(Q.value.groups,e=>(h(),s(`div`,{key:e.id,class:`mb-20`},[c(`div`,rt,[(h(),l(A(B[e.icon]),{class:`h-5 w-5 text-slate-800`})),c(`h3`,it,k(e.name),1)]),c(`div`,at,[(h(!0),s(d,null,t(e.apps,e=>(h(),s(`div`,{key:e.id,class:`flex flex-col items-center gap-2 group cursor-pointer pointer-events-auto w-20 md:w-24 transition-transform hover:-translate-y-1 duration-200`,onClick:t=>$(e)},[c(`div`,{class:o([`w-14 h-14 md:w-16 md:h-16 rounded-2xl flex items-center justify-center shadow-md transition-shadow group-hover:shadow-lg duration-200`,H(e.background)]),style:u(U(e.background))},[(h(),l(A(B[e.icon]),{class:`text-white h-7 w-7 md:h-8 md:w-8`}))],6),c(`span`,st,k(e.name),1)],8,ot))),128))])]))),128)),Q.value.looseApps.length>0?(h(),s(`div`,ct,[n[3]||=c(`h3`,{class:`text-xl font-semibold text-slate-800 mb-4 ml-2`},`System`,-1),c(`div`,lt,[(h(!0),s(d,null,t(Q.value.looseApps,e=>(h(),s(`div`,{key:e.id,class:`flex flex-col items-center gap-2 group cursor-pointer w-20 md:w-24 transition-transform hover:-translate-y-1 duration-200`,onClick:t=>$(e)},[c(`div`,{class:o([`w-14 h-14 md:w-16 md:h-16 rounded-2xl flex items-center justify-center shadow-md transition-shadow group-hover:shadow-lg duration-200`,H(e.background)]),style:u(U(e.background))},[(h(),l(A(B[e.icon]),{class:`text-white h-7 w-7 md:h-8 md:w-8`}))],6),c(`span`,dt,k(e.name),1)],8,ut))),128))])])):f(``,!0),Q.value.groups.length===0&&Q.value.looseApps.length===0?(h(),s(`div`,ft,[p(m(P),{class:`h-12 w-12 mb-4 opacity-50`}),n[4]||=c(`p`,null,`No applications found`,-1)])):f(``,!0)])])])):f(``,!0)}},z=O(R,[[`__scopeId`,`data-v-844d8a18`]]);export{z as default};