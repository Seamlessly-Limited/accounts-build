import{Ai as e,Gi as t,Ki as n,Li as r,Mi as i,Oa as a,Pa as o,Ra as s,Sr as ee,Ui as c,Vi as l,Wi as u,at as te,b as ne,ca as d,h as f,ht as re,ia as ie,ji as p,mt as ae,o as m,oa as h,qi as g,xa as _,y as v}from"./index-CTHZVx0Q.js";var oe={class:`flex flex-col h-full bg-white`},y={class:`flex-none px-6 py-4 border-b border-gray-100 flex items-center justify-between`},b={class:`flex items-center gap-4`},x={class:`p-2 rounded-lg bg-blue-50`},S={class:`text-xl font-bold text-gray-900`},C={class:`flex items-center gap-2 text-sm text-gray-500`},w={key:0,class:`px-2 py-0.5 rounded-full text-xs font-semibold bg-green-100 text-green-700`},T={key:1,class:`px-2 py-0.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-700`},E=[`disabled`],D={class:`flex-1 overflow-auto p-8 bg-gray-50/50`},O={class:`max-w-3xl mx-auto space-y-6`},k={class:`bg-white p-6 rounded-xl border border-gray-100 shadow-sm space-y-4`},A={class:`flex justify-between`},j={class:`flex items-center gap-2`},M={class:`space-y-1`},N={class:`bg-white p-6 rounded-xl border border-gray-100 shadow-sm space-y-4 relative overflow-hidden`},P={class:`font-semibold text-lg flex items-center gap-2 text-blue-700`},F={class:`grid grid-cols-2 gap-4`},I={class:`space-y-1`},L={class:`space-y-1`},R={class:`space-y-1`},z={class:`flex justify-center`},B={class:`bg-white p-6 rounded-xl border border-gray-100 shadow-sm space-y-4 relative overflow-hidden`},V={class:`flex justify-between items-center`},se={class:`font-semibold text-lg flex items-center gap-2 text-blue-700`},H={key:0,class:`text-center py-8 text-gray-400 bg-gray-50 rounded-lg border shadow-md border-gray-200`},U={class:`flex justify-between items-start`},W={class:`space-y-1 w-1/3`},G=[`onUpdate:modelValue`],K=[`onClick`],ce={key:0,class:`space-y-3 border-t border-gray-200 pt-3`},le={class:`grid grid-cols-2 gap-3`},ue=[`onUpdate:modelValue`],de=[`onUpdate:modelValue`],fe=[`onUpdate:modelValue`],pe=[`onUpdate:modelValue`],me={key:1,class:`text-sm text-gray-500 italic`},q={__name:`AutomationForm`,props:{name:{type:String,default:null}},setup(q){let J=q,{toast:Y}=f(),X=a({title:``,is_active:0,trigger_doctype:``,trigger_event:`on_create`,trigger_conditions:{},actions:[]}),Z=a([]),Q=a(`{}`),$=a(!1);ie(async()=>{J.name?await he():X.value.is_active=1});async function he(){try{X.value=(await m.get(`/org/doc/Automation/${J.name}`,{authorizeRequest:!0,organisationAware:!0})).data.data,X.value.trigger_conditions&&(Q.value=JSON.stringify(X.value.trigger_conditions,null,2)),X.value.actions&&(Z.value=X.value.actions)}catch(e){console.error(e),Z.value=[]}}function ge(){Z.value.push({type:`send_notification`,channel:`Email`,recipient_field:`email_id`,subject:``,content:``})}function _e(e){Z.value.splice(e,1)}async function ve(){$.value=!0;try{let e={...X.value};try{e.trigger_conditions=JSON.parse(Q.value)}catch{Y({title:`Invalid Conditions JSON`,description:`Please correct the JSON syntax.`,variant:`destructive`}),$.value=!1;return}e.actions=Z.value;let t;t=J.name?await m.patch(`/org/doc/Automation/${J.name}`,{data:e,authorizeRequest:!0,organisationAware:!0}):await m.post(`/org/doc/Automation`,{data:e,authorizeRequest:!0,organisationAware:!0}),X.value=t.data.data,Y({title:`Automation saved`,variant:`success`})}catch(e){console.error(e),Y({title:`Save failed`,description:e.message,variant:`destructive`})}finally{$.value=!1}}return(a,f)=>(h(),u(`div`,oe,[l(`header`,y,[l(`div`,b,[l(`div`,x,[g(o(v),{class:`w-6 h-6 text-blue-600`})]),l(`div`,null,[l(`h1`,S,s(X.value.title||`New Automation`),1),l(`div`,C,[X.value.is_active?(h(),u(`span`,w,`Active`)):(h(),u(`span`,T,`Inactive`))])])]),l(`button`,{onClick:ve,disabled:$.value,class:`px-4 py-2 bg-black text-white rounded-lg text-sm font-medium hover:bg-gray-900 flex items-center gap-2`},[g(o(te),{class:`w-4 h-4`}),n(` `+s($.value?`Saving...`:`Save Automation`),1)],8,E)]),l(`div`,D,[l(`div`,O,[l(`div`,k,[l(`div`,A,[f[6]||=l(`h2`,{class:`font-semibold text-lg`},`General Configuration`,-1),l(`div`,j,[f[5]||=l(`label`,{class:`text-sm font-medium text-gray-700`},`Active`,-1),_(l(`input`,{type:`checkbox`,"onUpdate:modelValue":f[0]||=e=>X.value.is_active=e,class:`w-5 h-5 accent-black`},null,512),[[e,X.value.is_active]])])]),l(`div`,M,[f[7]||=l(`label`,{class:`text-sm font-medium`},`Automation Name`,-1),_(l(`input`,{"onUpdate:modelValue":f[1]||=e=>X.value.title=e,type:`text`,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`,placeholder:`e.g. Send Receipt on Payment`},null,512),[[i,X.value.title]])])]),l(`div`,N,[f[13]||=l(`div`,{class:`absolute top-0 left-0 w-1 h-full bg-blue-500`},null,-1),l(`h2`,P,[g(o(v),{class:`w-4 h-4`}),f[8]||=n(` Trigger `,-1)]),l(`div`,F,[l(`div`,I,[f[9]||=l(`label`,{class:`text-sm font-medium`},`DocType`,-1),_(l(`input`,{"onUpdate:modelValue":f[2]||=e=>X.value.trigger_doctype=e,type:`text`,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg`,placeholder:`e.g. Sales Invoice`},null,512),[[i,X.value.trigger_doctype]])]),l(`div`,L,[f[11]||=l(`label`,{class:`text-sm font-medium`},`Event`,-1),_(l(`select`,{"onUpdate:modelValue":f[3]||=e=>X.value.trigger_event=e,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg`},[...f[10]||=[t(`<option value="on_create">Created</option><option value="on_update">Updated</option><option value="on_submit">Submitted</option><option value="on_cancel">Cancelled</option><option value="on_delete">Deleted</option>`,5)]],512),[[p,X.value.trigger_event]])])]),l(`div`,R,[f[12]||=l(`label`,{class:`text-sm font-medium`},`Conditions (JSON)`,-1),_(l(`textarea`,{"onUpdate:modelValue":f[4]||=e=>Q.value=e,rows:`2`,class:`w-full font-mono text-xs p-2 bg-slate-50 border border-gray-200 rounded-lg`,placeholder:`{ "status": "Paid" }`},null,512),[[i,Q.value]])])]),l(`div`,z,[g(o(ee),{class:`w-6 h-6 text-gray-300`})]),l(`div`,B,[f[23]||=l(`div`,{class:`absolute top-0 left-0 w-1 h-full bg-blue-500`},null,-1),l(`div`,V,[l(`h2`,se,[g(o(re),{class:`w-4 h-4`}),f[14]||=n(` Actions `,-1)]),l(`button`,{onClick:ge,class:`text-xs font-medium text-blue-600 hover:text-blue-700 flex items-center gap-1`},[g(o(ae),{class:`w-3 h-3`}),f[15]||=n(` Add Action `,-1)])]),Z.value.length===0?(h(),u(`div`,H,` No actions defined. Add one to start. `)):c(``,!0),(h(!0),u(r,null,d(Z.value,(e,t)=>(h(),u(`div`,{key:t,class:`p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-3`},[l(`div`,U,[l(`div`,W,[f[17]||=l(`label`,{class:`text-xs font-medium uppercase text-gray-500`},`Action Type`,-1),_(l(`select`,{"onUpdate:modelValue":t=>e.type=t,class:`w-full text-sm bg-white border border-gray-200 rounded px-2 py-1`},[...f[16]||=[l(`option`,{value:`send_notification`},`Send Notification`,-1),l(`option`,{value:`update_record`},`Update Record`,-1)]],8,G),[[p,e.type]])]),l(`button`,{onClick:e=>_e(t),class:`text-gray-400 hover:text-red-500`},[g(o(ne),{class:`w-4 h-4`})],8,K)]),e.type===`send_notification`?(h(),u(`div`,ce,[l(`div`,le,[l(`div`,null,[f[19]||=l(`label`,{class:`text-xs font-medium`},`Channel`,-1),_(l(`select`,{"onUpdate:modelValue":t=>e.channel=t,class:`w-full text-sm bg-white border border-gray-200 rounded px-2 py-1`},[...f[18]||=[l(`option`,{value:`Email`},`Email`,-1),l(`option`,{value:`SMS`},`SMS`,-1)]],8,ue),[[p,e.channel]])]),l(`div`,null,[f[20]||=l(`label`,{class:`text-xs font-medium`},`Recipient Field`,-1),_(l(`input`,{"onUpdate:modelValue":t=>e.recipient_field=t,type:`text`,placeholder:`e.g. email_id`,class:`w-full text-sm bg-white border border-gray-200 rounded px-2 py-1`},null,8,de),[[i,e.recipient_field]])])]),l(`div`,null,[f[21]||=l(`label`,{class:`text-xs font-medium`},`Subject`,-1),_(l(`input`,{"onUpdate:modelValue":t=>e.subject=t,type:`text`,class:`w-full text-sm bg-white border border-gray-200 rounded px-2 py-1`},null,8,fe),[[i,e.subject]])]),l(`div`,null,[f[22]||=l(`label`,{class:`text-xs font-medium`},`Content`,-1),_(l(`textarea`,{"onUpdate:modelValue":t=>e.content=t,rows:`3`,class:`w-full text-sm bg-white border border-gray-200 rounded px-2 py-1`},null,8,pe),[[i,e.content]])])])):c(``,!0),e.type===`update_record`?(h(),u(`div`,me,` Update Record Actions are under construction. `)):c(``,!0)]))),128))])])])]))}};export{q as default};