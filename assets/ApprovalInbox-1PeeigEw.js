import{Aa as e,Bi as t,Bn as n,Hi as r,Li as i,Ni as ee,O as a,Oi as te,Pa as o,Ui as s,Yn as c,_a as l,ea as u,ia as ne,ja as re,na as d,o as f,st as ie,u as ae,wa as p,x as m,zi as h}from"./index-BW6FH5S4.js";import{t as g}from"./WorkspaceStore-DkbvTQrR.js";var _={class:`h-full flex flex-col bg-gradient-to-br from-stone-50 to-slate-100`},v={class:`flex-none px-6 py-4 bg-white border-b border-gray-200 flex items-center justify-between`},y={class:`flex items-center gap-3`},b={class:`w-10 h-10 rounded-full bg-amber-500 flex items-center justify-center`},x=[`disabled`],S={class:`flex-1 overflow-auto p-6`},C={key:0,class:`flex justify-center items-center h-64`},w={key:1,class:`flex flex-col items-center justify-center h-64 text-center`},T={class:`w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mb-4`},E={key:2,class:`max-w-4xl mx-auto space-y-4`},D={class:`flex items-start justify-between gap-4`},O={class:`flex-1 min-w-0`},k={class:`flex items-center gap-2 mb-1`},A={class:`text-xs font-medium text-amber-600 bg-amber-50 px-2 py-0.5 rounded`},j={class:`text-xs text-gray-400`},M=[`onClick`],oe={class:`text-sm text-gray-500 mt-1`},N={class:`font-medium`},P={class:`flex items-center gap-2 flex-shrink-0`},F=[`onClick`],I=[`onClick`,`disabled`],L=[`onClick`,`disabled`],R={key:0,class:`fixed inset-0 bg-black/50 flex items-center justify-center z-50`},z={class:`bg-white rounded-xl shadow-xl w-full max-w-md p-6 m-4`},B={class:`text-sm text-gray-600 mb-4`},V={class:`flex justify-end gap-2 mt-4`},H=[`disabled`],U={__name:`ApprovalInbox`,setup(U){let W=ae(),G=g(),K=p(!1),q=p([]),J=p(null),Y=p(null),X=p(``);async function Z(){K.value=!0;try{let e=(await f.get(`/org/doc/Approval Pipeline`,{params:{filters:JSON.stringify({status:[`Pending`,`Partially Approved`]}),order_by:`created_at desc`}})).data?.data||[],t=[];for(let n of e){let e=n.items||[];for(let r of e)r.assigned_to===W.email&&r.status===`Pending`&&t.push({...r,pipeline_name:n.name,target_doctype:n.target_doctype,target_document:n.target_document,requested_by:n.requested_by||n.owner,created_at:r.created_at||n.created_at})}q.value=t}catch(e){console.error(`Failed to fetch approvals:`,e)}finally{K.value=!1}}async function se(e){J.value=e.name;try{await f.patch(`/org/doc/Approval Pipeline/${e.pipeline_name}`,{data:{items:[{name:e.name,status:`Approved`,approver:W.email,decision_time:new Date().toISOString()}]}}),q.value=q.value.filter(t=>t.name!==e.name)}catch(e){console.error(`Failed to approve:`,e),alert(`Failed to approve: `+(e.response?.data?.message||e.message))}finally{J.value=null}}function ce(e){Y.value=e,X.value=``}async function le(){if(Y.value){J.value=Y.value.name;try{await f.patch(`/org/doc/Approval Pipeline/${Y.value.pipeline_name}`,{data:{items:[{name:Y.value.name,status:`Rejected`,approver:W.email,comments:X.value,decision_time:new Date().toISOString()}]}}),q.value=q.value.filter(e=>e.name!==Y.value.name),Y.value=null,X.value=``}catch(e){console.error(`Failed to reject:`,e),alert(`Failed to reject: `+(e.response?.data?.message||e.message))}finally{J.value=null}}}function Q(e){G.openTab({type:`doctype-form`,doctype:e.target_doctype,name:e.target_document,label:e.target_document})}function $(e){return e?new Date(e).toLocaleDateString(void 0,{month:`short`,day:`numeric`,hour:`2-digit`,minute:`2-digit`}):``}return u(()=>{Z()}),(u,f)=>(d(),t(`div`,_,[i(`header`,v,[i(`div`,y,[i(`div`,b,[s(e(a),{class:`w-5 h-5 text-white`})]),f[2]||=i(`div`,null,[i(`h1`,{class:`text-xl font-bold text-gray-900`},`Approvals`),i(`p`,{class:`text-sm text-gray-500`},`Pending items requiring your approval`)],-1)]),i(`button`,{onClick:Z,class:`p-2 hover:bg-gray-100 rounded-full text-gray-500 transition-colors`,disabled:K.value},[s(e(ie),{class:re([`w-5 h-5`,{"animate-spin":K.value}])},null,8,[`class`])],8,x)]),i(`div`,S,[K.value&&!q.value.length?(d(),t(`div`,C,[...f[3]||=[i(`div`,{class:`animate-spin rounded-full h-8 w-8 border-b-2 border-black`},null,-1)]])):q.value.length?(d(),t(`div`,E,[(d(!0),t(ee,null,ne(q.value,n=>(d(),t(`div`,{key:n.name,class:`bg-white rounded-xl border border-gray-200 p-5 hover:shadow-md transition-shadow`},[i(`div`,D,[i(`div`,O,[i(`div`,k,[i(`span`,A,o(n.stage_name||`Approval`),1),i(`span`,j,o($(n.created_at)),1)]),i(`h3`,{class:`text-lg font-semibold text-gray-900 truncate cursor-pointer hover:text-blue-600`,onClick:e=>Q(n)},o(n.target_document),9,M),i(`p`,oe,[i(`span`,N,o(n.target_doctype),1),r(` â€¢ Requested by `+o(n.requested_by||`Unknown`),1)])]),i(`div`,P,[i(`button`,{onClick:e=>Q(n),class:`px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-colors`},` View `,8,F),i(`button`,{onClick:e=>se(n),disabled:J.value===n.name,class:`px-4 py-1.5 text-sm bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-1`},[s(e(c),{class:`w-4 h-4`}),f[6]||=r(` Approve `,-1)],8,I),i(`button`,{onClick:e=>ce(n),disabled:J.value===n.name,class:`px-4 py-1.5 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-1`},[s(e(m),{class:`w-4 h-4`}),f[7]||=r(` Reject `,-1)],8,L)])])]))),128))])):(d(),t(`div`,w,[i(`div`,T,[s(e(n),{class:`w-8 h-8 text-green-600`})]),f[4]||=i(`h3`,{class:`text-lg font-medium text-gray-900 mb-1`},`All caught up!`,-1),f[5]||=i(`p`,{class:`text-gray-500`},`You have no pending approvals.`,-1)]))]),Y.value?(d(),t(`div`,R,[i(`div`,z,[f[10]||=i(`h3`,{class:`text-lg font-semibold text-gray-900 mb-4`},`Reject Approval`,-1),i(`p`,B,[f[8]||=r(` Are you sure you want to reject `,-1),i(`strong`,null,o(Y.value.target_document),1),f[9]||=r(`? `,-1)]),l(i(`textarea`,{"onUpdate:modelValue":f[0]||=e=>X.value=e,rows:`3`,placeholder:`Reason for rejection (optional)`,class:`w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500`},null,512),[[te,X.value]]),i(`div`,V,[i(`button`,{onClick:f[1]||=e=>{Y.value=null,X.value=``},class:`px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition-colors`},` Cancel `),i(`button`,{onClick:le,disabled:J.value,class:`px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors`},` Reject `,8,H)])])])):h(``,!0)]))}};export{U as default};