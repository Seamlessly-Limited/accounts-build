import"./useArrowNavigation-siWGBYoD.js";import"./ConfigProvider-Bfe_xD5n.js";import"./useDirection-aXfNvefe.js";import"./VisuallyHiddenInput-Dl8XWVKK.js";import{n as e,r as t,t as n}from"./PinInputSlot-DoP_NYp7.js";import{Bn as r,Bt as i,Hi as a,Ki as o,Li as s,Ln as c,Oi as l,Q as u,Ra as d,Ui as f,Vi as p,Wi as m,Wn as h,a as g,ba as _,ca as v,i as y,oa as b,qi as x,s as S,ua as C}from"./index-BjUg3jag.js";import{n as w}from"./button-DNrl_4di.js";import{t as T}from"./BackgroundAnimation-Dihdt32F.js";import{t as E}from"./Card-DsDGTDjf.js";import{t as D}from"./CardContent-Cw3hEQpI.js";var O=`pre_auth_token`,k={name:`VerifyAccount`,components:{Button:w,Card:E,CardContent:D,Loader2:i,CheckCircle:h,XCircle:r,ShieldCheck:u,Clock:c,BackgroundAnimation:T,PinInput:t,PinInputGroup:e,PinInputSlot:n},data(){return{currentStep:0,loading:!1,resendCount:0,resendWaitTime:0,token:[],timerInstance:null}},async mounted(){if(!localStorage.getItem(O)){this.$router.push(`/login`);return}this.startCountdown()},beforeUnmount(){this.timerInstance&&clearInterval(this.timerInstance)},methods:{startCountdown(){this.timerInstance&&clearInterval(this.timerInstance),this.resendWaitTime=60+this.resendCount*30,this.timerInstance=setInterval(()=>{this.resendWaitTime>0?this.resendWaitTime--:clearInterval(this.timerInstance)},1e3)},async resendCode(){let e=g();try{await S.resendVerificationCode(),this.resendCount++,this.startCountdown(),e.toast({message:`A new verification code has been sent.`,variant:`success`})}catch{e.toast({message:`Failed to resend code. Please try again later.`,variant:`error`})}},async completeVerification(){if(this.loading||this.token.length<6)return;let e=g(),t=this.token.join(``);this.loading=!0;try{let e=await S.completeAccountVerification({code:t});e&&(this.currentStep=2,localStorage.removeItem(O),this.redirectToApp(e.length===0))}catch{let t=``?.toLowerCase()||``;t.includes(`invalid`)||t.includes(`expire`)||t.includes(`mismatch`)?(this.currentStep=0,this.token=[]):this.currentStep=3,e.toast({message:`Verification failed`,variant:`error`})}finally{this.loading=!1}},redirectToApp(e=!1){if(e){window.location=`/setup-organisation`;return}let t=localStorage.getItem(`postAuthenticationPath`);t&&(localStorage.removeItem(`postAuthenticationPath`),window.location=t)}}},A={class:`flex min-h-screen justify-center items-center bg-stone-50/50 text-foreground px-4 overflow-hidden`},j={class:`flex flex-col items-center text-center space-y-2 mb-8`},M={class:`p-3 bg-primary/5 rounded-2xl mb-2`},N={key:`step-otp`,class:`space-y-8`},P={class:`flex flex-col items-center space-y-6`},F={class:`flex flex-col items-center space-y-4 w-full`},I={key:1},L={class:`h-10 flex items-center justify-center`},R={key:0,class:`text-sm text-muted-foreground flex items-center gap-2`},z={class:`font-bold text-foreground`},B={class:`pt-4 border-t border-stone-100 text-center`},V={key:`step-loading`,class:`flex flex-col items-center py-12 space-y-6`},H={key:`step-success`,class:`flex flex-col items-center py-12 space-y-6`},U={class:`w-20 h-20 bg-green-50 rounded-full flex items-center justify-center`},W={key:`step-error`,class:`flex flex-col items-center py-12 space-y-6`},G={class:`w-20 h-20 bg-destructive/10 rounded-full flex items-center justify-center`};function K(e,t,n,r,i,c){let u=C(`BackgroundAnimation`),h=C(`ShieldCheck`),g=C(`PinInputSlot`),y=C(`PinInputGroup`),S=C(`PinInput`),w=C(`Loader2`),T=C(`Button`),E=C(`Clock`),D=C(`CheckCircle`),O=C(`XCircle`),k=C(`CardContent`),K=C(`Card`);return b(),m(`div`,A,[x(u),x(l,{name:`fade-up`,appear:``},{default:_(()=>[x(K,{class:`w-full max-w-lg shadow-[0_8px_30px_rgb(0,0,0,0.04)] border-none rounded-[2rem] relative bg-white/80 backdrop-blur-xl overflow-hidden`},{default:_(()=>[x(k,{class:`p-8 md:p-12`},{default:_(()=>[p(`div`,j,[p(`div`,M,[x(h,{class:`w-8 h-8 text-primary`})]),t[4]||=p(`h2`,{class:`text-3xl font-bold tracking-tight`},`Verify Identity`,-1),t[5]||=p(`p`,{class:`text-muted-foreground text-balanced max-w-[280px]`},` We've sent a 6-digit verification code to your linked email address. `,-1)]),x(l,{name:`fade-slide`,mode:`out-in`},{default:_(()=>[i.currentStep===0?(b(),m(`div`,N,[p(`div`,P,[x(S,{id:`pin-input`,modelValue:i.token,"onUpdate:modelValue":t[0]||=e=>i.token=e,placeholder:`â—‹`,class:`gap-3`,onComplete:c.completeVerification},{default:_(()=>[x(y,{class:`gap-2 sm:gap-4`},{default:_(()=>[(b(),m(s,null,v(6,(e,t)=>x(g,{key:e,index:t,class:`w-12 h-14 sm:w-14 sm:h-16 text-xl font-bold rounded-2xl border-2 border-stone-100 bg-stone-50/50 focus-within:border-primary focus-within:ring-0 transition-all`},null,8,[`index`])),64))]),_:1})]),_:1},8,[`modelValue`,`onComplete`]),p(`div`,F,[x(T,{disabled:i.loading||i.token.length<6,onClick:c.completeVerification,class:`h-14 w-full max-w-[240px] bg-primary text-primary-foreground rounded-2xl text-lg font-semibold hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50`},{default:_(()=>[i.loading?(b(),a(w,{key:0,class:`mr-2 h-5 w-5 animate-spin`})):(b(),m(`span`,I,`Verify Now`))]),_:1},8,[`disabled`,`onClick`]),p(`div`,L,[x(l,{name:`fade`,mode:`out-in`},{default:_(()=>[i.resendWaitTime>0?(b(),m(`p`,R,[x(E,{class:`w-4 h-4`}),t[6]||=o(` Resend code in `,-1),p(`span`,z,d(i.resendWaitTime)+`s`,1)])):(b(),m(`button`,{key:1,onClick:t[1]||=(...e)=>c.resendCode&&c.resendCode(...e),class:`text-sm font-semibold text-primary hover:underline transition-all`},` Didn't receive a code? Resend `))]),_:1})])])]),p(`div`,B,[p(`button`,{onClick:t[2]||=t=>e.$router.push(`/login`),class:`text-sm text-muted-foreground hover:text-foreground transition-colors`},` Back to login `)])])):i.currentStep===1?(b(),m(`div`,V,[...t[7]||=[p(`div`,{class:`relative w-20 h-20`},[p(`div`,{class:`absolute inset-0 rounded-full border-4 border-primary/10`}),p(`div`,{class:`absolute inset-0 rounded-full border-4 border-primary border-t-transparent animate-spin`})],-1),p(`div`,{class:`text-center`},[p(`h3`,{class:`text-xl font-bold`},`Verifying Code`),p(`p`,{class:`text-muted-foreground mt-2`},`Checking your credentials...`)],-1)]])):i.currentStep===2?(b(),m(`div`,H,[p(`div`,U,[x(D,{class:`w-12 h-12 text-green-500`})]),t[9]||=p(`div`,{class:`text-center`},[p(`h3`,{class:`text-2xl font-bold text-stone-900`},`Successfully Verified`),p(`p`,{class:`text-muted-foreground mt-2`},`Redirecting you to the dashboard...`)],-1),x(T,{onClick:c.redirectToApp,class:`px-8 rounded-2xl`},{default:_(()=>[...t[8]||=[o(` Enter Flow `,-1)]]),_:1},8,[`onClick`])])):i.currentStep===3?(b(),m(`div`,W,[p(`div`,G,[x(O,{class:`w-12 h-12 text-destructive`})]),t[11]||=p(`div`,{class:`text-center`},[p(`h3`,{class:`text-2xl font-bold text-destructive`},`Verification Failed`),p(`p`,{class:`text-muted-foreground mt-2`},`The code you entered is invalid or has expired.`)],-1),x(T,{onClick:t[3]||=e=>i.currentStep=0,variant:`outline`,class:`px-8 rounded-2xl`},{default:_(()=>[...t[10]||=[o(` Try Again `,-1)]]),_:1})])):f(``,!0)]),_:1})]),_:1})]),_:1})]),_:1})])}var q=y(k,[[`render`,K],[`__scopeId`,`data-v-8d8a4b4e`]]);export{q as default};