const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DocForm-BvVHksk5.js","assets/PopperContent-Bfs6wgZt.js","assets/index-HKVTK5TI.js","assets/index-wyyUr_pw.css","assets/PopoverTrigger-BCru-1Is.js","assets/useHideOthers-DOFiNZks.js","assets/ConfigProvider-Cf3TFtJ9.js","assets/Teleport-CsMvEVY_.js","assets/PopperAnchor-DaI7jKFA.js","assets/useDirection-CUs44sCO.js","assets/useId-DsZNdByk.js","assets/useKbd-BvGB3m10.js","assets/button-qjQ8nOQL.js","assets/purify.es-C6pmr44S.js","assets/marked.esm-BtpD3Vd6.js","assets/useFormControl-I5e8ntVi.js","assets/ComboboxItem-C7Di9fS5.js","assets/ListboxItem-R_jpoZYc.js","assets/utils-BVHQiFXk.js","assets/VisuallyHiddenInput-H9N0RMFB.js","assets/useTypeahead-c2JOyg4Z.js","assets/ComboboxGroup-DBhLNDdO.js","assets/DialogPortal-CcJn8zns.js","assets/utils-3tEteioG.js","assets/DialogTitle-DpqPGwZt.js","assets/sheet-DiLFIXnO.js","assets/Label-B9QWuJ3E.js","assets/SelectViewport-DrxmBooI.js","assets/useNonce--_RD7e6O.js","assets/nullish-CfjOSA4G.js","assets/SelectGroup-BkIR8Sj0.js","assets/DocForm-BmjGnOV_.js","assets/DynamicIcon-CPU4drpi.js","assets/DateField-B9P2KdyL.js","assets/button-DuGet5pa.js","assets/badge-DDbnvIBR.js","assets/DialogContent-Cjoaz2Fr.js","assets/DialogTitle-BwthNUJE.js","assets/DialogFooter-Cxs7R0UA.js","assets/Input-BwfiGKb1.js","assets/Label-DYU2ZsWM.js","assets/SelectValue-DDiy6CKz.js","assets/Textarea-Dg0XJf5H.js","assets/viewRegistry-BHmZrFeg.js","assets/WorkspaceStore-DvzhR4zh.js","assets/DocForm-DHiu27Dz.css","assets/BottomSheet-6JWnJnGj.js","assets/BottomSheet-DoNskbDR.css"])))=>i.map(i=>d[i]);
import{i as e,n as t,r as n,s as r,t as i}from"./ComboboxItem-C7Di9fS5.js";import{t as a}from"./ComboboxGroup-DBhLNDdO.js";import{Bt as o,Fa as s,Hi as c,Ji as l,Ki as u,Li as d,Oa as f,Pa as p,Qn as m,Ra as h,Ui as g,Vi as _,Wi as v,ba as y,ca as ee,h as b,ha as x,ht as S,ia as C,o as w,oa as T,qi as E,qn as D,ra as O,t as k}from"./index-HKVTK5TI.js";import{t as A}from"./BottomSheet-6JWnJnGj.js";var te={class:`relative w-full`},ne={class:`relative w-full`},re={class:`absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400`},ie={key:0,class:`text-sm text-gray-500 p-4 text-center shrink-0`},ae={key:0},j={key:1},M={class:`flex flex-col`},N={class:`font-medium`},P={key:1,class:`p-4 text-center text-sm text-gray-500 flex justify-center items-center gap-2 shrink-0`},F={class:`h-full flex flex-col bg-stone-50`},I={__name:`LinkField`,props:{modelValue:{type:String,default:``},doctype:{type:String,default:``},label:{type:String,default:``},placeholder:{type:String,default:``},disabled:{type:Boolean,default:!1},compact:{type:Boolean,default:!1}},emits:[`update:modelValue`],setup(I,{emit:L}){let R=l(()=>k(()=>import(`./DocForm-BvVHksk5.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47]))),z=I,B=L,{toast:V}=b(),H=f(!1),U=f([]),W=f(!1),G=f(!1),K=f(``),q=f(``),J=f(null),Y=f(!1),X=async()=>{if(!(J.value||!z.doctype))try{let e=await w.get(`/org/doctypes/${z.doctype}`,{authorizeRequest:!0,organisationAware:!0});e.flag===`SUCCESS`&&(J.value=e.data)}catch(e){console.error(`LinkField: Meta fetch failed`,e)}},Z=async()=>{if(!z.modelValue||!z.doctype){q.value=``,K.value=``;return}if(!Y.value){Y.value=!0;try{let e=U.value.find(e=>e.value===z.modelValue);if(e){q.value=e.label.split(` (`)[0],K.value=q.value;return}J.value||await X();let t=await w.get(`/org/doc/${z.doctype}/${z.modelValue}`,{authorizeRequest:!0,organisationAware:!0});if(t&&t.flag===`SUCCESS`&&t.data){let e=t.data,n=J.value?.title_field,r=n&&e[n]?e[n]:e.name;q.value=r,K.value=r}else q.value=z.modelValue,K.value=z.modelValue}catch(e){console.error(`LinkField: Label resolution failed`,e),q.value=z.modelValue,K.value=z.modelValue}finally{Y.value=!1}}},Q=null,$=async(e=``)=>{if(!z.doctype){U.value=[];return}W.value=!0;try{J.value||await X();let t=[];if(z.doctype===`DocType`){if(t=(await w.get(`/org/doctypes`,{authorizeRequest:!0,organisationAware:!0})).data||[],e){let n=e.toLowerCase();t=t.filter(e=>e.name?.toLowerCase().includes(n))}U.value=t.map(e=>({value:e.name,label:e.name}))}else{let n={size:50};if(e){let t=J.value?.title_field;t?n[`${t}__like`]=e:n.name__like=e}t=(await w.get(`/org/doc/${z.doctype}`,{query:n,authorizeRequest:!0,organisationAware:!0})).data?.content||[];let r=J.value?.title_field;U.value=t.map(e=>({value:e.name,label:r&&e[r]?`${e[r]} (${e.name})`:e.name}))}}catch(e){console.error(`LinkField: Options fetch failed`,e)}finally{W.value=!1}};C(async()=>{z.modelValue&&Z()}),O(()=>{clearTimeout(Q)}),x(K,e=>{!H.value||e===q.value||(clearTimeout(Q),Q=setTimeout(()=>{$(e)},300))}),x(H,e=>{e?$(K.value):K.value=q.value}),x(()=>z.modelValue,e=>{e?Z():q.value=``});let oe=e=>{e!==`__create_new__`&&(B(`update:modelValue`,e),H.value=!1)},se=e=>{G.value=!1;let t=J.value?.title_field,n=t&&e[t]?e[t]:e.name;U.value.unshift({value:e.name,label:t&&e[t]?`${e[t]} (${e.name})`:e.name}),q.value=n,K.value=n,B(`update:modelValue`,e.name),V({title:`Created & Linked`,description:`${z.doctype} ${e.name} successfully linked.`,variant:`success`})},ce=()=>{H.value=!1,G.value=!0};return(l,f)=>(T(),v(`div`,te,[E(p(n),{"model-value":I.modelValue,"onUpdate:modelValue":oe,open:H.value,"onUpdate:open":f[1]||=e=>H.value=e,"filter-function":e=>e},{default:y(()=>[_(`div`,ne,[E(p(e),{class:`w-full`},{default:y(()=>[E(p(t),{modelValue:K.value,"onUpdate:modelValue":f[0]||=e=>K.value=e,placeholder:I.placeholder||`Select ${I.doctype}...`,class:s([`w-full bg-white dark:bg-gray-950 border border-gray-300 dark:border-gray-800 focus:ring-2 focus:ring-black dark:focus:ring-white transition-all outline-none pr-10`,[I.compact?`px-2 py-1 text-xs rounded-full`:`px-4 py-2 rounded-full`]]),disabled:I.disabled},null,8,[`modelValue`,`placeholder`,`class`,`disabled`]),_(`div`,re,[W.value?(T(),c(p(o),{key:0,class:`h-4 w-4 animate-spin`})):(T(),c(p(D),{key:1,class:`h-4 w-4`}))])]),_:1}),E(p(r),{class:`absolute w-full bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 shadow-xl rounded-xl mt-2 p-1 z-[100] min-w-[200px] max-h-[300px] overflow-hidden flex flex-col`},{default:y(()=>[!W.value&&U.value.length===0?(T(),v(`div`,ie,[K.value?(T(),v(`span`,ae,`No results found for "`+h(K.value)+`"`,1)):(T(),v(`span`,j,`No options available`))])):g(``,!0),E(p(a),{class:`border-b border-gray-100 dark:border-gray-800 mb-1 pb-1 shrink-0`},{default:y(()=>[E(p(i),{value:`__create_new__`,onSelect:ce,class:`flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 cursor-pointer outline-none data-[highlighted]:bg-blue-200 dark:data-[highlighted]:bg-blue-900/20`},{default:y(()=>[E(p(S),{class:`h-4 w-4`}),u(` Create New `+h(I.doctype),1)]),_:1})]),_:1}),E(p(a),{class:`overflow-y-auto flex-1`},{default:y(()=>[(T(!0),v(d,null,ee(U.value,e=>(T(),c(p(i),{key:e.value,value:e.value,class:`flex items-center justify-between px-3 py-2 text-sm rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-900 outline-none data-[state=checked]:bg-gray-50 dark:data-[state=checked]:bg-gray-900`},{default:y(()=>[_(`div`,M,[_(`span`,N,h(e.label),1)]),I.modelValue===e.value?(T(),c(p(m),{key:0,class:`h-4 w-4 text-black dark:text-white`})):g(``,!0)]),_:2},1032,[`value`]))),128))]),_:1}),W.value&&U.value.length===0?(T(),v(`div`,P,[E(p(o),{class:`h-4 w-4 animate-spin`}),f[3]||=u(` Searching... `,-1)])):g(``,!0)]),_:1})])]),_:1},8,[`model-value`,`open`,`filter-function`]),E(A,{modelValue:G.value,"onUpdate:modelValue":f[2]||=e=>G.value=e,"initial-height":85},{default:y(()=>[_(`div`,F,[E(p(R),{doctype:I.doctype,"is-new":!0,name:`new`,"is-embedded":!0,onSaved:se},null,8,[`doctype`])])]),_:1},8,[`modelValue`])]))}};export{I as t};