import{Aa as e,At as t,Bi as n,Di as r,Hi as i,Li as a,Oi as o,Pa as s,Ui as c,Yn as ee,_a as l,da as te,ea as u,g as d,it as ne,ja as re,na as f,o as p,pt as ie,wa as m,zi as h}from"./index-BW6FH5S4.js";var g={class:`flex flex-col h-full bg-white`},ae={class:`flex-none px-6 py-4 border-b border-gray-100 flex items-center justify-between`},oe={class:`flex items-center gap-4`},se={class:`p-2 rounded-lg bg-orange-50`},ce={class:`text-xl font-bold text-gray-900`},_={class:`flex items-center gap-2 text-sm text-gray-500`},v={key:0},y={class:`flex items-center gap-3`},b=[`disabled`],x=[`disabled`],S={class:`flex-1 overflow-auto p-8`},C={class:`max-w-4xl mx-auto space-y-8`},w={class:`space-y-4`},T={class:`grid grid-cols-2 gap-6 bg-gray-50 p-6 rounded-xl border border-gray-100`},E={class:`space-y-2`},D={class:`space-y-2`},O={class:`space-y-4`},k={class:`bg-gray-50 p-6 rounded-xl border border-gray-100 space-y-4`},A={class:`flex items-center gap-4`},j={class:`w-1/3 space-y-2`},M={class:`flex-1 flex items-end pb-2`},N={class:`text-sm text-gray-500`},P={class:`bg-white p-4 rounded-lg border border-gray-200`},F={class:`text-xs text-gray-400 mt-1`},I={class:`space-y-4`},L={class:`bg-gray-50 p-6 rounded-xl border border-gray-100 space-y-4`},R={class:`space-y-2`},z={class:`space-y-2`},le={class:`flex gap-2 text-xs text-blue-600`},B={key:0,class:`space-y-4`},V={class:`text-lg font-semibold flex items-center gap-2`},H={class:`flex items-center justify-center w-6 h-6 rounded-full bg-green-600 text-white text-xs`},U={class:`grid grid-cols-4 gap-4`},W={class:`p-4 bg-purple-50 rounded-xl border border-purple-100`},ue={class:`text-2xl font-bold text-purple-700`},de={class:`p-4 bg-blue-50 rounded-xl border border-blue-100`},fe={class:`text-2xl font-bold text-blue-700`},pe={class:`p-4 bg-green-50 rounded-xl border border-green-100`},me={class:`text-2xl font-bold text-green-700`},he={class:`p-4 bg-red-50 rounded-xl border border-red-100`},ge={class:`text-2xl font-bold text-red-700`},G={__name:`CampaignForm`,props:{name:{type:String,default:null}},setup(G){let K=G,{toast:q}=d(),J=m({campaign_name:``,status:`Draft`,channel:`Email`,target_doctype:`Customer`,target_filters:{},message:``,subject:``}),Y=m(`{}`),X=m(!1),Z=m(!1),_e=m(0);u(async()=>{K.name&&await Q()}),te(Y,e=>{try{J.value.target_filters=JSON.parse(e)}catch{}});async function Q(){try{J.value=(await p.get(`/org/doc/Campaign/${K.name}`,{authorizeRequest:!0,organisationAware:!0})).data.data,J.value.target_filters&&(Y.value=JSON.stringify(J.value.target_filters,null,2))}catch(e){console.error(e),q({title:`Error loading campaign`,variant:`destructive`})}}async function ve(){X.value=!0;try{let e={...J.value},t;t=J.value.name?await p.patch(`/org/doc/Campaign/${J.value.name}`,{data:e,authorizeRequest:!0,organisationAware:!0}):await p.post(`/org/doc/Campaign`,{data:e,authorizeRequest:!0,organisationAware:!0}),J.value=t.data.data,q({title:`Campaign saved`,variant:`success`})}catch(e){console.error(e),q({title:`Save failed`,description:e.message,variant:`destructive`})}finally{X.value=!1}}async function ye(){if(J.value.name&&confirm(`Are you sure you want to run this campaign? Messages will be queued immediately.`)){Z.value=!0;try{await p.post(`/org/campaigns/${J.value.name}/run`,{authorizeRequest:!0,organisationAware:!0}),q({title:`Campaign Started`,description:`Messages are being queued.`,variant:`success`}),await Q()}catch(e){q({title:`Failed to run`,description:e.message,variant:`destructive`})}finally{Z.value=!1}}}function $(e){J.value.message+=` `+e}function be(e){switch(e){case`Draft`:return`bg-gray-100 text-gray-700`;case`In Progress`:return`bg-blue-100 text-blue-700`;case`Completed`:return`bg-green-100 text-green-700`;case`Cancelled`:return`bg-red-100 text-red-700`;default:return`bg-gray-100 text-gray-700`}}return(te,u)=>(f(),n(`div`,g,[a(`header`,ae,[a(`div`,oe,[a(`div`,se,[c(e(t),{class:`w-6 h-6 text-orange-600`})]),a(`div`,null,[a(`h1`,ce,s(J.value.name?J.value.campaign_name:`New Campaign`),1),a(`div`,_,[a(`span`,{class:re([`px-2 py-0.5 rounded-full text-xs font-semibold`,be(J.value.status)])},s(J.value.status||`Draft`),3),J.value.name?(f(),n(`span`,v,s(J.value.name),1)):h(``,!0)])])]),a(`div`,y,[J.value.status!==`Completed`&&J.value.status!==`In Progress`?(f(),n(`button`,{key:0,onClick:ve,disabled:X.value,class:`px-4 py-2 bg-white border border-gray-200 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 flex items-center gap-2`},[c(e(ne),{class:`w-4 h-4`}),i(` `+s(X.value?`Saving...`:`Save Draft`),1)],8,b)):h(``,!0),J.value.name&&J.value.status===`Draft`?(f(),n(`button`,{key:1,onClick:ye,disabled:Z.value,class:`px-4 py-2 bg-black text-white rounded-lg text-sm font-medium hover:bg-gray-900 flex items-center gap-2`},[c(e(ie),{class:`w-4 h-4`}),i(` `+s(Z.value?`Starting...`:`Run Campaign`),1)],8,x)):h(``,!0)])]),a(`div`,S,[a(`div`,C,[a(`section`,w,[u[11]||=a(`h2`,{class:`text-lg font-semibold flex items-center gap-2`},[a(`span`,{class:`flex items-center justify-center w-6 h-6 rounded-full bg-black text-white text-xs`},`1`),i(` Campaign Details `)],-1),a(`div`,T,[a(`div`,E,[u[8]||=a(`label`,{class:`text-sm font-medium`},`Campaign Name`,-1),l(a(`input`,{"onUpdate:modelValue":u[0]||=e=>J.value.campaign_name=e,type:`text`,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`,placeholder:`e.g. End of Year Sale`},null,512),[[o,J.value.campaign_name]])]),a(`div`,D,[u[10]||=a(`label`,{class:`text-sm font-medium`},`Channel`,-1),l(a(`select`,{"onUpdate:modelValue":u[1]||=e=>J.value.channel=e,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`},[...u[9]||=[a(`option`,{value:`Email`},`Email`,-1),a(`option`,{value:`SMS`},`SMS`,-1),a(`option`,{value:`WhatsApp`},`WhatsApp`,-1)]],512),[[r,J.value.channel]])])])]),a(`section`,O,[u[15]||=a(`h2`,{class:`text-lg font-semibold flex items-center gap-2`},[a(`span`,{class:`flex items-center justify-center w-6 h-6 rounded-full bg-black text-white text-xs`},`2`),i(` Audience `)],-1),a(`div`,k,[a(`div`,A,[a(`div`,j,[u[13]||=a(`label`,{class:`text-sm font-medium`},`Target Entity`,-1),l(a(`select`,{"onUpdate:modelValue":u[2]||=e=>J.value.target_doctype=e,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`},[...u[12]||=[a(`option`,{value:`Customer`},`Customer`,-1),a(`option`,{value:`Lead`},`Lead`,-1),a(`option`,{value:`User`},`System User`,-1)]],512),[[r,J.value.target_doctype]])]),a(`div`,M,[a(`p`,N,` Define rules to filter which `+s(J.value.target_doctype)+`s will receive this message. `,1)])]),a(`div`,P,[u[14]||=a(`h3`,{class:`text-xs font-semibold uppercase text-gray-500 mb-3`},`Filters (JSON)`,-1),l(a(`textarea`,{"onUpdate:modelValue":u[3]||=e=>Y.value=e,rows:`4`,class:`w-full font-mono text-sm p-3 bg-slate-50 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`,placeholder:`{ "status": "Active" }`},null,512),[[o,Y.value]]),a(`p`,F,`Found: `+s(_e.value)+` targets`,1)])])]),a(`section`,I,[u[18]||=a(`h2`,{class:`text-lg font-semibold flex items-center gap-2`},[a(`span`,{class:`flex items-center justify-center w-6 h-6 rounded-full bg-black text-white text-xs`},`3`),i(` Content `)],-1),a(`div`,L,[a(`div`,R,[u[16]||=a(`label`,{class:`text-sm font-medium`},`Subject`,-1),l(a(`input`,{"onUpdate:modelValue":u[4]||=e=>J.value.subject=e,type:`text`,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`,placeholder:`Message subject...`},null,512),[[o,J.value.subject]])]),a(`div`,z,[u[17]||=a(`label`,{class:`text-sm font-medium`},`Message Body`,-1),l(a(`textarea`,{"onUpdate:modelValue":u[5]||=e=>J.value.message=e,rows:`8`,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`,placeholder:`Writes your message here... Use {{customer_name}} for dynamic values.`},null,512),[[o,J.value.message]]),a(`div`,le,[a(`span`,{class:`cursor-pointer hover:underline`,onClick:u[6]||=e=>$(`{{customer_name}}`)},`Insert Name`),a(`span`,{class:`cursor-pointer hover:underline`,onClick:u[7]||=e=>$(`{{email_id}}`)},`Insert Email`)])])])]),J.value.name&&J.value.status!==`Draft`?(f(),n(`section`,B,[a(`h2`,V,[a(`span`,H,[c(e(ee),{class:`w-3 h-3`})]),u[19]||=i(` Results `,-1)]),a(`div`,U,[a(`div`,W,[a(`div`,ue,s(J.value.total_targets||0),1),u[20]||=a(`div`,{class:`text-xs text-purple-600 font-medium uppercase`},`Targets`,-1)]),a(`div`,de,[a(`div`,fe,s(J.value.sent_count||0),1),u[21]||=a(`div`,{class:`text-xs text-blue-600 font-medium uppercase`},`Sent`,-1)]),a(`div`,pe,[a(`div`,me,s(J.value.delivered_count||0),1),u[22]||=a(`div`,{class:`text-xs text-green-600 font-medium uppercase`},`Delivered`,-1)]),a(`div`,he,[a(`div`,ge,s(J.value.failed_count||0),1),u[23]||=a(`div`,{class:`text-xs text-red-600 font-medium uppercase`},`Failed`,-1)])])])):h(``,!0)])])]))}};export{G as default};