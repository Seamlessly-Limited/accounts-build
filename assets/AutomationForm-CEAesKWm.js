import{Aa as e,Bi as t,Di as n,Ei as r,Hi as i,Li as a,Ni as o,Oi as s,Pa as c,Ui as l,Vi as ee,_a as u,b as d,ea as te,ft as f,g as p,ia as ne,it as re,na as m,o as h,pt as ie,vr as ae,wa as g,x as oe,zi as _}from"./index-BW6FH5S4.js";var v={class:`flex flex-col h-full bg-white`},y={class:`flex-none px-6 py-4 border-b border-gray-100 flex items-center justify-between`},b={class:`flex items-center gap-4`},x={class:`p-2 rounded-lg bg-indigo-50`},S={class:`text-xl font-bold text-gray-900`},C={class:`flex items-center gap-2 text-sm text-gray-500`},w={key:0,class:`px-2 py-0.5 rounded-full text-xs font-semibold bg-green-100 text-green-700`},T={key:1,class:`px-2 py-0.5 rounded-full text-xs font-semibold bg-gray-100 text-gray-700`},E=[`disabled`],D={class:`flex-1 overflow-auto p-8 bg-gray-50/50`},O={class:`max-w-3xl mx-auto space-y-6`},k={class:`bg-white p-6 rounded-xl border border-gray-100 shadow-sm space-y-4`},A={class:`flex justify-between`},j={class:`flex items-center gap-2`},M={class:`space-y-1`},N={class:`bg-white p-6 rounded-xl border border-gray-100 shadow-sm space-y-4 relative overflow-hidden`},P={class:`font-semibold text-lg flex items-center gap-2 text-blue-700`},F={class:`grid grid-cols-2 gap-4`},I={class:`space-y-1`},L={class:`space-y-1`},R={class:`space-y-1`},z={class:`flex justify-center`},B={class:`bg-white p-6 rounded-xl border border-gray-100 shadow-sm space-y-4 relative overflow-hidden`},se={class:`flex justify-between items-center`},V={class:`font-semibold text-lg flex items-center gap-2 text-purple-700`},H={key:0,class:`text-center py-8 text-gray-400 bg-gray-50 rounded-lg border shadow-md border-gray-200`},U={class:`flex justify-between items-start`},W={class:`space-y-1 w-1/3`},G=[`onUpdate:modelValue`],K=[`onClick`],ce={key:0,class:`space-y-3 border-t border-gray-200 pt-3`},le={class:`grid grid-cols-2 gap-3`},ue=[`onUpdate:modelValue`],de=[`onUpdate:modelValue`],fe=[`onUpdate:modelValue`],pe=[`onUpdate:modelValue`],me={key:1,class:`text-sm text-gray-500 italic`},q={__name:`AutomationForm`,props:{name:{type:String,default:null}},setup(q){let J=q,{toast:Y}=p(),X=g({title:``,is_active:0,trigger_doctype:``,trigger_event:`on_create`,trigger_conditions:{},actions:[]}),Z=g([]),Q=g(`{}`),$=g(!1);te(async()=>{J.name?await he():X.value.is_active=1});async function he(){try{X.value=(await h.get(`/org/doc/Automation/${J.name}`,{authorizeRequest:!0,organisationAware:!0})).data.data,X.value.trigger_conditions&&(Q.value=JSON.stringify(X.value.trigger_conditions,null,2)),X.value.actions&&(Z.value=X.value.actions)}catch(e){console.error(e),Z.value=[]}}function ge(){Z.value.push({type:`send_notification`,channel:`Email`,recipient_field:`email_id`,subject:``,content:``})}function _e(e){Z.value.splice(e,1)}async function ve(){$.value=!0;try{let e={...X.value};try{e.trigger_conditions=JSON.parse(Q.value)}catch{Y({title:`Invalid Conditions JSON`,description:`Please correct the JSON syntax.`,variant:`destructive`}),$.value=!1;return}e.actions=Z.value;let t;t=J.name?await h.patch(`/org/doc/Automation/${J.name}`,{data:e,authorizeRequest:!0,organisationAware:!0}):await h.post(`/org/doc/Automation`,{data:e,authorizeRequest:!0,organisationAware:!0}),X.value=t.data.data,Y({title:`Automation saved`,variant:`success`})}catch(e){console.error(e),Y({title:`Save failed`,description:e.message,variant:`destructive`})}finally{$.value=!1}}return(te,p)=>(m(),t(`div`,v,[a(`header`,y,[a(`div`,b,[a(`div`,x,[l(e(d),{class:`w-6 h-6 text-indigo-600`})]),a(`div`,null,[a(`h1`,S,c(X.value.title||`New Automation`),1),a(`div`,C,[X.value.is_active?(m(),t(`span`,w,`Active`)):(m(),t(`span`,T,`Inactive`))])])]),a(`button`,{onClick:ve,disabled:$.value,class:`px-4 py-2 bg-black text-white rounded-lg text-sm font-medium hover:bg-gray-900 flex items-center gap-2`},[l(e(re),{class:`w-4 h-4`}),i(` `+c($.value?`Saving...`:`Save Automation`),1)],8,E)]),a(`div`,D,[a(`div`,O,[a(`div`,k,[a(`div`,A,[p[6]||=a(`h2`,{class:`font-semibold text-lg`},`General Configuration`,-1),a(`div`,j,[p[5]||=a(`label`,{class:`text-sm font-medium text-gray-700`},`Active`,-1),u(a(`input`,{type:`checkbox`,"onUpdate:modelValue":p[0]||=e=>X.value.is_active=e,class:`w-5 h-5 accent-black`},null,512),[[r,X.value.is_active]])])]),a(`div`,M,[p[7]||=a(`label`,{class:`text-sm font-medium`},`Automation Name`,-1),u(a(`input`,{"onUpdate:modelValue":p[1]||=e=>X.value.title=e,type:`text`,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-black`,placeholder:`e.g. Send Receipt on Payment`},null,512),[[s,X.value.title]])])]),a(`div`,N,[p[13]||=a(`div`,{class:`absolute top-0 left-0 w-1 h-full bg-blue-500`},null,-1),a(`h2`,P,[l(e(d),{class:`w-4 h-4`}),p[8]||=i(` Trigger `,-1)]),a(`div`,F,[a(`div`,I,[p[9]||=a(`label`,{class:`text-sm font-medium`},`DocType`,-1),u(a(`input`,{"onUpdate:modelValue":p[2]||=e=>X.value.trigger_doctype=e,type:`text`,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg`,placeholder:`e.g. Sales Invoice`},null,512),[[s,X.value.trigger_doctype]])]),a(`div`,L,[p[11]||=a(`label`,{class:`text-sm font-medium`},`Event`,-1),u(a(`select`,{"onUpdate:modelValue":p[3]||=e=>X.value.trigger_event=e,class:`w-full px-3 py-2 bg-white border border-gray-200 rounded-lg`},[...p[10]||=[ee(`<option value="on_create">Created</option><option value="on_update">Updated</option><option value="on_submit">Submitted</option><option value="on_cancel">Cancelled</option><option value="on_delete">Deleted</option>`,5)]],512),[[n,X.value.trigger_event]])])]),a(`div`,R,[p[12]||=a(`label`,{class:`text-sm font-medium`},`Conditions (JSON)`,-1),u(a(`textarea`,{"onUpdate:modelValue":p[4]||=e=>Q.value=e,rows:`2`,class:`w-full font-mono text-xs p-2 bg-slate-50 border border-gray-200 rounded-lg`,placeholder:`{ "status": "Paid" }`},null,512),[[s,Q.value]])])]),a(`div`,z,[l(e(ae),{class:`w-6 h-6 text-gray-300`})]),a(`div`,B,[p[23]||=a(`div`,{class:`absolute top-0 left-0 w-1 h-full bg-purple-500`},null,-1),a(`div`,se,[a(`h2`,V,[l(e(ie),{class:`w-4 h-4`}),p[14]||=i(` Actions `,-1)]),a(`button`,{onClick:ge,class:`text-xs font-medium text-purple-600 hover:text-purple-700 flex items-center gap-1`},[l(e(f),{class:`w-3 h-3`}),p[15]||=i(` Add Action `,-1)])]),Z.value.length===0?(m(),t(`div`,H,` No actions defined. Add one to start. `)):_(``,!0),(m(!0),t(o,null,ne(Z.value,(r,i)=>(m(),t(`div`,{key:i,class:`p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-3`},[a(`div`,U,[a(`div`,W,[p[17]||=a(`label`,{class:`text-xs font-medium uppercase text-gray-500`},`Action Type`,-1),u(a(`select`,{"onUpdate:modelValue":e=>r.type=e,class:`w-full text-sm bg-white border border-gray-200 rounded px-2 py-1`},[...p[16]||=[a(`option`,{value:`send_notification`},`Send Notification`,-1),a(`option`,{value:`update_record`},`Update Record`,-1)]],8,G),[[n,r.type]])]),a(`button`,{onClick:e=>_e(i),class:`text-gray-400 hover:text-red-500`},[l(e(oe),{class:`w-4 h-4`})],8,K)]),r.type===`send_notification`?(m(),t(`div`,ce,[a(`div`,le,[a(`div`,null,[p[19]||=a(`label`,{class:`text-xs font-medium`},`Channel`,-1),u(a(`select`,{"onUpdate:modelValue":e=>r.channel=e,class:`w-full text-sm bg-white border border-gray-200 rounded px-2 py-1`},[...p[18]||=[a(`option`,{value:`Email`},`Email`,-1),a(`option`,{value:`SMS`},`SMS`,-1)]],8,ue),[[n,r.channel]])]),a(`div`,null,[p[20]||=a(`label`,{class:`text-xs font-medium`},`Recipient Field`,-1),u(a(`input`,{"onUpdate:modelValue":e=>r.recipient_field=e,type:`text`,placeholder:`e.g. email_id`,class:`w-full text-sm bg-white border border-gray-200 rounded px-2 py-1`},null,8,de),[[s,r.recipient_field]])])]),a(`div`,null,[p[21]||=a(`label`,{class:`text-xs font-medium`},`Subject`,-1),u(a(`input`,{"onUpdate:modelValue":e=>r.subject=e,type:`text`,class:`w-full text-sm bg-white border border-gray-200 rounded px-2 py-1`},null,8,fe),[[s,r.subject]])]),a(`div`,null,[p[22]||=a(`label`,{class:`text-xs font-medium`},`Content`,-1),u(a(`textarea`,{"onUpdate:modelValue":e=>r.content=e,rows:`3`,class:`w-full text-sm bg-white border border-gray-200 rounded px-2 py-1`},null,8,pe),[[s,r.content]])])])):_(``,!0),r.type===`update_record`?(m(),t(`div`,me,` Update Record Actions are under construction. `)):_(``,!0)]))),128))])])])]))}};export{q as default};