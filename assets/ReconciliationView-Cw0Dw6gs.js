import"./useNonce-Cry77bU8.js";import"./ConfigProvider-BeNpEDZu.js";import"./useDirection-CkCaHLjJ.js";import{t as e}from"./ScrollArea-Cveb2SY4.js";import{Aa as t,Bi as n,Hi as r,Ii as i,In as a,It as o,K as s,Kt as c,Li as l,Ni as u,Pa as d,Ri as f,Ui as p,Yn as m,da as ee,ea as te,ga as h,hr as ne,ia as g,ja as _,ji as v,lr as re,na as y,nn as ie,o as b,st as ae,wa as x,zi as S}from"./index-BW6FH5S4.js";import{n as C}from"./button-Cg1Yo4L-.js";import{t as w}from"./badge-DzzxpH5l.js";var T={async getSessions(e=0,t=20){return b.get(`/org/reconciliation`,{query:{page:e,size:t},authorizeRequest:!0,organisationAware:!0})},async startReconciliation(e,t,n,r,i){return b.post(`/org/reconciliation/start`,{data:{bankAccountReference:e,periodStart:t,periodEnd:n,openingBalance:r,closingBalance:i},authorizeRequest:!0,organisationAware:!0})},async getSession(e){return b.get(`/org/reconciliation/${e}`,{authorizeRequest:!0,organisationAware:!0})},async getSessionItems(e){return b.get(`/org/reconciliation/${e}/items`,{authorizeRequest:!0,organisationAware:!0})},async getItemsByStatus(e,t){return b.get(`/org/reconciliation/${e}/items/${t}`,{authorizeRequest:!0,organisationAware:!0})},async approveItem(e){return b.post(`/org/reconciliation/items/${e}/approve`,{data:{},authorizeRequest:!0,organisationAware:!0})},async manualMatch(e,t,n){return b.post(`/org/reconciliation/${e}/match`,{data:{transactionReference:t,entryReference:n},authorizeRequest:!0,organisationAware:!0})},async addAdjustment(e,t,n,r,i,a=!0){return b.post(`/org/reconciliation/${e}/adjustments`,{data:{type:t,description:n,amount:r,adjustmentDate:i,addsToBook:a},authorizeRequest:!0,organisationAware:!0})},async finalizeReconciliation(e){return b.post(`/org/reconciliation/${e}/finalize`,{data:{},authorizeRequest:!0,organisationAware:!0})}},E={class:`flex-1 min-w-0`},D={class:`flex items-center justify-between gap-2`},O={class:`font-medium text-slate-800 truncate`},k={class:`flex items-center gap-2 text-xs text-slate-500`},A={key:0,class:`text-slate-400`},j={__name:`ReconciliationRow`,props:{item:Object,side:String,selected:Boolean,matched:Boolean,suggested:Boolean},emits:[`click`,`approve`],setup(e){function r(e){return new Intl.NumberFormat(`en-NG`,{minimumFractionDigits:2,maximumFractionDigits:2}).format(Math.abs(e||0))}function i(e){return e?new Date(e).toLocaleDateString(`en-US`,{month:`short`,day:`numeric`}):``}return(o,c)=>(y(),n(`div`,{class:_([`flex items-center gap-3 px-3 py-2 rounded-lg cursor-pointer transition-all text-sm`,e.matched?`bg-green-50 border border-green-200`:e.suggested?`bg-blue-50 border border-blue-200`:e.selected?`bg-slate-100 border border-slate-300`:`hover:bg-slate-50 border border-transparent`]),onClick:c[1]||=e=>o.$emit(`click`)},[l(`div`,{class:_([`h-6 w-6 rounded-full flex items-center justify-center flex-shrink-0`,e.matched?`bg-green-500 text-white`:e.suggested?`bg-blue-500 text-white`:`bg-slate-200 text-slate-500`])},[e.matched?(y(),f(t(m),{key:0,class:`h-3.5 w-3.5`})):e.suggested?(y(),f(t(s),{key:1,class:`h-3.5 w-3.5`})):(y(),f(t(a),{key:2,class:`h-3 w-3`}))],2),l(`div`,E,[l(`div`,D,[l(`span`,O,d(e.item.description),1),l(`span`,{class:_([`text-sm font-semibold whitespace-nowrap`,e.item.type===`CREDIT`?`text-green-600`:`text-red-600`])},d(e.item.type===`CREDIT`?`+`:`-`)+d(r(e.item.amount)),3)]),l(`div`,k,[l(`span`,null,d(i(e.item.transactionDate||e.item.entryDate)),1),e.item.reference?(y(),n(`span`,A,`â€¢ `+d(e.item.reference),1)):S(``,!0)])]),e.suggested&&!e.matched?(y(),f(t(C),{key:0,variant:`ghost`,size:`sm`,class:`h-7 w-7 p-0 flex-shrink-0`,onClick:c[0]||=v(e=>o.$emit(`approve`),[`stop`])},{default:h(()=>[p(t(m),{class:`h-4 w-4 text-green-600`})]),_:1})):S(``,!0)],2))}},oe={class:`flex flex-col h-full`},se={key:0,class:`flex-1 flex items-center justify-center`},ce={class:`flex items-center justify-between px-4 py-2 border-b border-slate-100 bg-white`},le={class:`flex items-center gap-3`},ue={class:`flex items-center gap-1.5 text-sm`},de={class:`font-medium`},fe={class:`flex items-center gap-2`},pe={class:`flex items-center justify-between px-4 py-3 bg-slate-50 border-b border-slate-100`},M={class:`flex items-center gap-6`},N={class:`text-center`},P={class:`text-lg font-bold text-slate-800`},F={class:`text-center`},I={class:`text-lg font-bold text-slate-800`},L={class:`text-lg font-bold`},R={class:`text-xs opacity-80`},z={class:`flex items-center gap-4`},B={class:`text-center`},me={class:`text-lg font-bold text-green-600`},he={class:`text-center`},ge={class:`text-lg font-bold text-amber-600`},_e={class:`text-center`},ve={class:`text-lg font-bold text-slate-800`},ye={class:`flex-1 flex overflow-hidden`},be={class:`w-1/2 border-r border-slate-200 flex flex-col`},xe={class:`px-4 py-2 bg-blue-50 border-b border-slate-200`},Se={class:`flex items-center gap-2`},Ce={class:`p-2 space-y-1`},we={class:`w-1/2 flex flex-col`},Te={class:`px-4 py-2 bg-green-50 border-b border-slate-200`},Ee={class:`flex items-center gap-2`},De={class:`p-2 space-y-1`},Oe={key:0,class:`px-4 py-3 bg-white border-t border-slate-200`},ke={class:`flex items-center justify-between`},Ae={class:`flex items-center gap-4`},je={class:`text-sm`},Me={class:`font-medium ml-1`},Ne={class:`font-medium`},Pe={class:`flex items-center gap-2`},V={__name:`ReconciliationView`,props:{sessionReference:String,account:Object},emits:[`finalized`,`updated`],setup(a,{emit:s}){let v=a,b=s,E=x(!1),D=x(!1),O=x(!1),k=x(!1),A=x(null),V=x([]),H=x(null),U=x(null),Fe=i(()=>A.value?.periodStart&&A.value?.periodEnd?`${$(A.value.periodStart)} - ${$(A.value.periodEnd)}`:A.value?.name||`Reconciliation`),Ie=i(()=>({COMPLETED:`default`,IN_PROGRESS:`secondary`,PENDING_REVIEW:`outline`,DRAFT:`outline`,CANCELLED:`destructive`})[A.value?.status]||`outline`),Le=i(()=>{let e=A.value?.difference||0;return e===0?`bg-green-100 text-green-800`:e>0?`bg-amber-100 text-amber-800`:`bg-red-100 text-red-800`}),Re=i(()=>{let e=A.value?.difference||0;return e===0?`Balanced`:e>0?`Bank Higher`:`Book Higher`}),W=i(()=>(A.value?.unmatchedBankItems||0)+(A.value?.unmatchedBookItems||0)),ze=i(()=>{let e=(A.value?.totalBankItems||0)+(A.value?.totalBookItems||0),t=A.value?.matchedItems||0;return e>0?Math.round(t*2/e*100):0}),Be=i(()=>W.value===0&&A.value?.status!==`COMPLETED`),G=i(()=>V.value.filter(e=>e.bookEntry!=null)),K=i(()=>V.value.filter(e=>e.bankTransaction!=null));te(()=>{v.sessionReference&&q()}),ee(()=>v.sessionReference,e=>{e&&q()});async function q(){E.value=!0;try{let[e,t]=await Promise.all([T.getSession(v.sessionReference),T.getSessionItems(v.sessionReference)]);A.value=e.data,V.value=t.data}catch(e){console.error(`Failed to load session:`,e)}finally{E.value=!1}}async function J(){D.value=!0;try{let[e,t]=await Promise.all([T.getSession(v.sessionReference),T.getSessionItems(v.sessionReference)]);A.value=e.data,V.value=t.data}catch(e){console.error(`Failed to refresh:`,e)}finally{D.value=!1}}function Ve(e){H.value=e}function Y(e){U.value=e}function X(){H.value=null,U.value=null}async function Z(e){try{await T.approveItem(e.reference),await J()}catch(e){console.error(`Failed to approve:`,e)}}async function He(){if(!(!H.value?.bookEntry||!U.value?.bankTransaction)){O.value=!0;try{await T.manualMatch(v.sessionReference,U.value.bankTransaction.reference,H.value.bookEntry.reference),X(),await J(),b(`updated`)}catch(e){console.error(`Failed to match:`,e)}finally{O.value=!1}}}async function Ue(){k.value=!0;try{await T.finalizeReconciliation(v.sessionReference),await J(),b(`finalized`)}catch(e){console.error(`Failed to finalize:`,e)}finally{k.value=!1}}function Q(e){return new Intl.NumberFormat(`en-NG`,{style:`currency`,currency:v.account?.currency||`NGN`,minimumFractionDigits:0}).format(e)}function $(e){return e?new Date(e).toLocaleDateString(`en-US`,{month:`short`,year:`numeric`}):``}return(i,a)=>(y(),n(`div`,oe,[E.value?(y(),n(`div`,se,[p(t(o),{class:`h-8 w-8 animate-spin text-slate-400`})])):(y(),n(u,{key:1},[l(`div`,ce,[l(`div`,le,[l(`div`,ue,[p(t(ie),{class:`h-4 w-4 text-green-600`}),l(`span`,de,d(Fe.value),1)]),p(t(w),{variant:Ie.value},{default:h(()=>[r(d(A.value?.status||`New`),1)]),_:1},8,[`variant`])]),l(`div`,fe,[p(t(C),{variant:`outline`,size:`sm`,class:`h-8`,onClick:J,disabled:D.value},{default:h(()=>[D.value?(y(),f(t(o),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(y(),f(t(ae),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),a[0]||=r(` Refresh `,-1)]),_:1},8,[`disabled`]),p(t(C),{size:`sm`,class:`h-8`,disabled:!Be.value||k.value,onClick:Ue},{default:h(()=>[k.value?(y(),f(t(o),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(y(),f(t(m),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),a[1]||=r(` Finalize `,-1)]),_:1},8,[`disabled`])])]),l(`div`,pe,[l(`div`,M,[l(`div`,N,[l(`div`,P,d(Q(A.value?.bookBalance||0)),1),a[2]||=l(`div`,{class:`text-xs text-slate-500`},`Book Balance`,-1)]),l(`div`,F,[l(`div`,I,d(Q(A.value?.closingBalance||0)),1),a[3]||=l(`div`,{class:`text-xs text-slate-500`},`Bank Balance`,-1)]),l(`div`,{class:_([`text-center px-4 py-1 rounded-lg`,Le.value])},[l(`div`,L,d(Q(Math.abs(A.value?.difference||0))),1),l(`div`,R,d(Re.value),1)],2)]),l(`div`,z,[l(`div`,B,[l(`div`,me,d(A.value?.matchedItems||0),1),a[4]||=l(`div`,{class:`text-xs text-slate-500`},`Matched`,-1)]),l(`div`,he,[l(`div`,ge,d(W.value),1),a[5]||=l(`div`,{class:`text-xs text-slate-500`},`Unmatched`,-1)]),l(`div`,_e,[l(`div`,ve,d(ze.value)+`%`,1),a[6]||=l(`div`,{class:`text-xs text-slate-500`},`Match Rate`,-1)])])]),l(`div`,ye,[l(`div`,be,[l(`div`,xe,[l(`div`,Se,[p(t(re),{class:`h-4 w-4 text-blue-600`}),a[7]||=l(`span`,{class:`text-sm font-semibold text-blue-800`},`Book Entries`,-1),p(t(w),{variant:`secondary`,class:`ml-auto`},{default:h(()=>[r(d(G.value.length),1)]),_:1})])]),p(t(e),{class:`flex-1`},{default:h(()=>[l(`div`,Ce,[(y(!0),n(u,null,g(G.value,e=>(y(),f(j,{key:e.reference,item:e,side:`book`,selected:H.value?.reference===e.reference,matched:e.matchStatus===`MATCHED`,suggested:e.matchStatus===`SUGGESTED`,onClick:t=>Ve(e),onApprove:t=>Z(e)},null,8,[`item`,`selected`,`matched`,`suggested`,`onClick`,`onApprove`]))),128))])]),_:1})]),l(`div`,we,[l(`div`,Te,[l(`div`,Ee,[p(t(c),{class:`h-4 w-4 text-green-600`}),a[8]||=l(`span`,{class:`text-sm font-semibold text-green-800`},`Bank Transactions`,-1),p(t(w),{variant:`secondary`,class:`ml-auto`},{default:h(()=>[r(d(K.value.length),1)]),_:1})])]),p(t(e),{class:`flex-1`},{default:h(()=>[l(`div`,De,[(y(!0),n(u,null,g(K.value,e=>(y(),f(j,{key:e.reference,item:e,side:`bank`,selected:U.value?.reference===e.reference,matched:e.matchStatus===`MATCHED`,suggested:e.matchStatus===`SUGGESTED`,onClick:t=>Y(e),onApprove:t=>Z(e)},null,8,[`item`,`selected`,`matched`,`suggested`,`onClick`,`onApprove`]))),128))])]),_:1})])]),H.value&&U.value?(y(),n(`div`,Oe,[l(`div`,ke,[l(`div`,Ae,[l(`div`,je,[a[9]||=l(`span`,{class:`text-slate-500`},`Selected:`,-1),l(`span`,Me,d(H.value.bookEntry?.description||`Book Entry`),1),p(t(ne),{class:`h-4 w-4 inline mx-2 text-slate-400`}),l(`span`,Ne,d(U.value.bankTransaction?.narration||`Bank Tx`),1)])]),l(`div`,Pe,[p(t(C),{variant:`outline`,size:`sm`,onClick:X},{default:h(()=>[...a[10]||=[r(`Cancel`,-1)]]),_:1}),p(t(C),{size:`sm`,onClick:He,disabled:O.value},{default:h(()=>[O.value?(y(),f(t(o),{key:0,class:`h-3.5 w-3.5 mr-1.5 animate-spin`})):(y(),f(t(m),{key:1,class:`h-3.5 w-3.5 mr-1.5`})),a[11]||=r(` Confirm Match `,-1)]),_:1},8,[`disabled`])])])])):S(``,!0)],64))]))}};export{V as default};