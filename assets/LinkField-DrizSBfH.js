const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DocForm-D0ujR-x1.js","assets/PopperContent-D0ERvMe6.js","assets/index-BHNnQTTo.js","assets/index-CJsvxZRO.css","assets/PopoverTrigger-DByAPHCO.js","assets/useHideOthers-CleQw0cI.js","assets/ConfigProvider-BY88vHZH.js","assets/Teleport-DEa0s0fE.js","assets/PopperAnchor-DwwbE5MK.js","assets/useDirection-ZgC7WO53.js","assets/useId-_W-wRvmL.js","assets/useKbd-BvGB3m10.js","assets/button-Db_hM3Yh.js","assets/purify.es-C6pmr44S.js","assets/marked.esm-nzyc4KJ4.js","assets/useFormControl-CjeW_yF1.js","assets/ComboboxItem-BtsvEZMp.js","assets/ListboxItem-C3gY1pGN.js","assets/utils-CbTsZDN1.js","assets/VisuallyHiddenInput-IXKLJ3Dv.js","assets/useTypeahead-Djp42Xey.js","assets/ComboboxGroup-DFukxMZX.js","assets/DialogPortal-CLYD3gNm.js","assets/utils-CELcxEFJ.js","assets/DialogTitle-5CqWEABE.js","assets/sheet-C3Jdvhuo.js","assets/Label-PC3o1Jo3.js","assets/SelectViewport-Ekv9yKFk.js","assets/useNonce-DNy0wtrC.js","assets/nullish-CfjOSA4G.js","assets/SelectGroup-6MMNc9K1.js","assets/DocForm-DWYuxNJ-.js","assets/DynamicIcon-Ed_8jPgr.js","assets/DateField-9loNe9gD.js","assets/button-DHTtQedQ.js","assets/badge-B8qxrXJg.js","assets/DialogContent-BGaCU72q.js","assets/DialogTitle-DBB1pT4d.js","assets/DialogFooter-DJFCMNLh.js","assets/Input-DzP8_N3r.js","assets/Label-C3kqb2rR.js","assets/SelectValue-DxNBlF1-.js","assets/Textarea-C0hZLz9G.js","assets/viewRegistry-DR5G3kdv.js","assets/WorkspaceStore-Mg88f_-M.js","assets/DocForm-DHiu27Dz.css","assets/BottomSheet-hG7xnWEC.js","assets/BottomSheet-DoNskbDR.css"])))=>i.map(i=>d[i]);
import{i as e,n as t,r as n,s as r,t as i}from"./ComboboxItem-BtsvEZMp.js";import{t as a}from"./ComboboxGroup-DFukxMZX.js";import{Bt as o,Fa as s,Hi as c,Ji as l,Ki as u,Li as d,Oa as f,Pa as p,Qn as m,Ra as h,Ui as g,Vi as _,Wi as v,ba as y,ca as b,h as x,ha as S,ht as C,ia as w,o as T,oa as E,qi as D,qn as ee,ra as te,t as O}from"./index-BHNnQTTo.js";import{t as k}from"./BottomSheet-hG7xnWEC.js";var A={class:`relative w-full`},j={class:`relative w-full`},ne={class:`absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400`},re={key:0,class:`text-sm text-gray-500 p-4 text-center shrink-0`},ie={key:0},M={key:1},N={class:`flex flex-col`},P={class:`font-medium`},F={key:1,class:`p-4 text-center text-sm text-gray-500 flex justify-center items-center gap-2 shrink-0`},I={class:`h-full flex flex-col bg-stone-50`},L={__name:`LinkField`,props:{modelValue:{type:String,default:``},doctype:{type:String,default:``},label:{type:String,default:``},placeholder:{type:String,default:``},disabled:{type:Boolean,default:!1},compact:{type:Boolean,default:!1}},emits:[`update:modelValue`],setup(L,{emit:R}){let z=l(()=>O(()=>import(`./DocForm-D0ujR-x1.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47]))),B=L,V=R,{toast:ae}=x(),H=f(!1),U=f([]),W=f(!1),G=f(!1),K=f(``),q=f(``),J=f(null),Y=f(!1),X=async()=>{if(!(J.value||!B.doctype))try{let e=await T.get(`/org/doctypes/${B.doctype}`,{authorizeRequest:!0,organisationAware:!0});e.flag===`SUCCESS`&&(J.value=e.data)}catch(e){console.error(`LinkField: Meta fetch failed`,e)}},Z=async()=>{if(!B.modelValue||!B.doctype){q.value=``,K.value=``;return}if(!Y.value){Y.value=!0;try{let e=U.value.find(e=>e.value===B.modelValue);if(e){q.value=e.rawTitle||e.label,K.value=q.value;return}J.value||await X();let t=await T.get(`/org/doc/${B.doctype}/${B.modelValue}`,{authorizeRequest:!0,organisationAware:!0});if(t&&t.flag===`SUCCESS`&&t.data){let e=t.data,n=J.value?.titleField||J.value?.title_field||`title`,r=n&&e[n]?e[n]:e.title||e.name;q.value=r,K.value=r}}catch(e){console.error(`LinkField: Label resolution failed`,e)}finally{Y.value=!1}}},Q=null,$=async(e=``)=>{if(!B.doctype){U.value=[];return}W.value=!0;try{J.value||await X();let t=J.value?.titleField||J.value?.title_field||`title`,n=[];if(B.doctype===`DocType`){if(n=(await T.get(`/org/doctypes`,{authorizeRequest:!0,organisationAware:!0})).data||[],e){let t=e.toLowerCase();n=n.filter(e=>e.name?.toLowerCase().includes(t))}U.value=n.map(e=>({value:e[t],label:e.name}))}else{let r={size:50};if(e){let t=J.value?.title_field;t?r[`${t}__like`]=e:r.name__like=e}n=(await T.get(`/org/doc/${B.doctype}`,{query:r,authorizeRequest:!0,organisationAware:!0})).data?.content||[],U.value=n.map(e=>{let n=t&&e[t]?e[t]:e.title||e.name;return{value:e[t],label:t&&e[t]&&e[t]!==e.name?`${n} (${e.name})`:n,rawTitle:n}})}}catch(e){console.error(`LinkField: Options fetch failed`,e)}finally{W.value=!1}};w(async()=>{B.modelValue&&Z()}),te(()=>{clearTimeout(Q)}),S(K,e=>{!H.value||e===q.value||(clearTimeout(Q),Q=setTimeout(()=>{$(e)},300))}),S(H,e=>{e?K.value===q.value?$(``):$(K.value):K.value=q.value}),S(()=>B.modelValue,e=>{e?Z():(q.value=``,K.value=``)});let oe=e=>{if(e===`__create_new__`)return;let t=U.value.find(t=>t.value===e);t&&(q.value=t.rawTitle||t.label,K.value=q.value),V(`update:modelValue`,e),H.value=!1},se=e=>{G.value=!1;let t=J.value?.titleField||J.value?.title_field||`title`,n=t&&e[t]?e[t]:e.title||e.name,r=t&&e[t]&&e[t]!==e.name?`${n} (${e.name})`:n;U.value.unshift({value:e.name,label:r,rawTitle:n}),q.value=n,K.value=n,V(`update:modelValue`,e.name)},ce=()=>{H.value=!1,G.value=!0};return(l,f)=>(E(),v(`div`,A,[D(p(n),{"model-value":L.modelValue,"onUpdate:modelValue":oe,open:H.value,"onUpdate:open":f[1]||=e=>H.value=e,"filter-function":e=>e,"display-value":()=>q.value},{default:y(()=>[_(`div`,j,[D(p(e),{class:`w-full`},{default:y(()=>[D(p(t),{modelValue:K.value,"onUpdate:modelValue":f[0]||=e=>K.value=e,placeholder:L.placeholder||`Select ${L.doctype}...`,class:s([`w-full bg-white dark:bg-gray-950 border border-gray-300 dark:border-gray-800 focus:ring-2 focus:ring-black dark:focus:ring-white transition-all outline-none pr-10`,[L.compact?`px-2 py-1 text-xs rounded-full`:`px-4 py-2 rounded-full`]]),disabled:L.disabled},null,8,[`modelValue`,`placeholder`,`class`,`disabled`]),_(`div`,ne,[W.value?(E(),c(p(o),{key:0,class:`h-4 w-4 animate-spin`})):(E(),c(p(ee),{key:1,class:`h-4 w-4`}))])]),_:1}),D(p(r),{class:`absolute w-full bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 shadow-xl rounded-xl mt-2 p-1 z-[100] min-w-[200px] max-h-[300px] overflow-hidden flex flex-col`},{default:y(()=>[!W.value&&U.value.length===0?(E(),v(`div`,re,[K.value?(E(),v(`span`,ie,`No results found for "`+h(K.value)+`"`,1)):(E(),v(`span`,M,`No options available`))])):g(``,!0),D(p(a),{class:`border-b border-gray-100 dark:border-gray-800 mb-1 pb-1 shrink-0`},{default:y(()=>[D(p(i),{value:`__create_new__`,onSelect:ce,class:`flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 cursor-pointer outline-none data-[highlighted]:bg-blue-200 dark:data-[highlighted]:bg-blue-900/20`},{default:y(()=>[D(p(C),{class:`h-4 w-4`}),u(` Create New `+h(L.doctype),1)]),_:1})]),_:1}),D(p(a),{class:`overflow-y-auto flex-1`},{default:y(()=>[(E(!0),v(d,null,b(U.value,e=>(E(),c(p(i),{key:e.value,value:e.value,class:`flex items-center justify-between px-3 py-2 text-sm rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-900 outline-none data-[state=checked]:bg-gray-50 dark:data-[state=checked]:bg-gray-900`},{default:y(()=>[_(`div`,N,[_(`span`,P,h(e.label),1)]),L.modelValue===e.value?(E(),c(p(m),{key:0,class:`h-4 w-4 text-black dark:text-white`})):g(``,!0)]),_:2},1032,[`value`]))),128))]),_:1}),W.value&&U.value.length===0?(E(),v(`div`,F,[D(p(o),{class:`h-4 w-4 animate-spin`}),f[3]||=u(` Searching... `,-1)])):g(``,!0)]),_:1})])]),_:1},8,[`model-value`,`open`,`filter-function`,`display-value`]),D(k,{modelValue:G.value,"onUpdate:modelValue":f[2]||=e=>G.value=e,"initial-height":85},{default:y(()=>[_(`div`,I,[D(p(z),{doctype:L.doctype,"is-new":!0,name:`new`,"is-embedded":!0,onSaved:se},null,8,[`doctype`])])]),_:1},8,[`modelValue`])]))}};export{L as t};