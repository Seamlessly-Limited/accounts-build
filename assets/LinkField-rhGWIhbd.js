const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DocForm-Dhi8y-9j.js","assets/PopperContent-b6gGwF_E.js","assets/index-CHNvwQRL.js","assets/index-DPj_2cLE.css","assets/useHideOthers-L15EfXxs.js","assets/ConfigProvider-Ckl6KgMj.js","assets/purify.es-CrZVVHqb.js","assets/useFormControl-Dnp3iC5X.js","assets/ComboboxItem-BqMucZ-W.js","assets/ListboxItem-Bfe5qZhm.js","assets/utils-BFR0tnUV.js","assets/VisuallyHiddenInput-B3HVdvGc.js","assets/useDirection-B1kSZwKq.js","assets/useId-Da-MS2me.js","assets/useKbd-BvGB3m10.js","assets/useTypeahead---iVCXRs.js","assets/ComboboxGroup-BeaaVWt-.js","assets/DialogPortal-Dl-6IrmI.js","assets/Teleport-BJpx-KiC.js","assets/utils-BpsHH13c.js","assets/DialogTitle-aue_-Krx.js","assets/sheet-NRY9vGcQ.js","assets/PopperAnchor-Sq61S0mP.js","assets/SelectViewport-BHDGvtQj.js","assets/useNonce-CnEoXn07.js","assets/nullish-CfjOSA4G.js","assets/SelectGroup-DgFFtqHX.js","assets/DocForm-COdYPNei.js","assets/DynamicIcon-xdE1DWwJ.js","assets/Input-i1kcrjFD.js","assets/SelectValue-DyPaSYfc.js","assets/viewRegistry-CEBXSj_v.js","assets/WorkspaceStore-Djee2ZJb.js","assets/DocForm-CbIFi6iC.css","assets/BottomSheet-BHwNzRxP.js","assets/BottomSheet-C0veGV1Z.css"])))=>i.map(i=>d[i]);
import{i as e,n as t,r as n,s as r,t as i}from"./ComboboxItem-BqMucZ-W.js";import{t as a}from"./ComboboxGroup-BeaaVWt-.js";import{$i as o,Bn as s,Fi as c,Gn as l,Ji as u,Li as d,Mi as f,Ni as p,Nt as m,Oi as h,Pi as g,Ri as _,Ta as v,Yi as y,Zi as b,da as x,dt as S,g as C,ka as w,o as T,oa as E,t as ee,ya as D,zi as te}from"./index-CHNvwQRL.js";import{t as O}from"./BottomSheet-BHwNzRxP.js";var k={class:`relative w-full`},A={class:`relative w-full`},j={class:`absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-400`},M={key:0,class:`text-sm text-gray-500 p-4 text-center shrink-0`},ne={key:0},re={key:1},ie={class:`flex flex-col`},N={class:`font-medium`},P={key:1,class:`p-4 text-center text-sm text-gray-500 flex justify-center items-center gap-2 shrink-0`},F={class:`h-full flex flex-col bg-stone-50`},I={__name:`LinkField`,props:{modelValue:{type:String,default:``},doctype:{type:String,default:``},label:{type:String,default:``},placeholder:{type:String,default:``},disabled:{type:Boolean,default:!1}},emits:[`update:modelValue`],setup(I,{emit:L}){let R=te(()=>ee(()=>import(`./DocForm-Dhi8y-9j.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35]))),z=I,B=L,{toast:V}=C(),H=D(!1),U=D([]),W=D(!1),G=D(!1),K=D(``),q=D(``),J=D(null),Y=D(!1),X=async()=>{if(!(J.value||!z.doctype))try{let e=await T.get(`/org/doctypes/${z.doctype}`,{authorizeRequest:!0,organisationAware:!0});e.flag===`SUCCESS`&&(J.value=e.data)}catch(e){console.error(`LinkField: Meta fetch failed`,e)}},Z=async()=>{if(!z.modelValue||!z.doctype){q.value=``,K.value=``;return}if(!Y.value){Y.value=!0;try{let e=U.value.find(e=>e.value===z.modelValue);if(e){q.value=e.label.split(` (`)[0],K.value=q.value;return}J.value||await X();let t=await T.get(`/org/doc/${z.doctype}/${z.modelValue}`,{authorizeRequest:!0,organisationAware:!0});if(t&&t.flag===`SUCCESS`&&t.data){let e=t.data,n=J.value?.title_field,r=n&&e[n]?e[n]:e.name;q.value=r,K.value=r}else q.value=z.modelValue,K.value=z.modelValue}catch(e){console.error(`LinkField: Label resolution failed`,e),q.value=z.modelValue,K.value=z.modelValue}finally{Y.value=!1}}},Q=null,$=async(e=``)=>{if(!z.doctype){U.value=[];return}W.value=!0;try{J.value||await X();let t=[];if(z.doctype===`DocType`){if(t=(await T.get(`/org/doctypes`,{authorizeRequest:!0,organisationAware:!0})).data||[],e){let n=e.toLowerCase();t=t.filter(e=>e.name?.toLowerCase().includes(n))}U.value=t.map(e=>({value:e.name,label:e.name}))}else{let n={size:50};if(e){let t=J.value?.title_field;t?n[`${t}__like`]=e:n.name__like=e}t=(await T.get(`/org/doc/${z.doctype}`,{query:n,authorizeRequest:!0,organisationAware:!0})).data?.content||[];let r=J.value?.title_field;U.value=t.map(e=>({value:e.name,label:r&&e[r]?`${e[r]} (${e.name})`:e.name}))}}catch(e){console.error(`LinkField: Options fetch failed`,e)}finally{W.value=!1}};y(async()=>{z.modelValue&&Z()}),u(()=>{clearTimeout(Q)}),E(K,e=>{!H.value||e===q.value||(clearTimeout(Q),Q=setTimeout(()=>{$(e)},300))}),E(H,e=>{e?$(K.value):K.value=q.value}),E(()=>z.modelValue,e=>{e?Z():q.value=``});let ae=e=>{e!==`__create_new__`&&(B(`update:modelValue`,e),H.value=!1)},oe=e=>{G.value=!1;let t=J.value?.title_field,n=t&&e[t]?e[t]:e.name;U.value.unshift({value:e.name,label:t&&e[t]?`${e[t]} (${e.name})`:e.name}),q.value=n,K.value=n,B(`update:modelValue`,e.name),V({title:`Created & Linked`,description:`${z.doctype} ${e.name} successfully linked.`,variant:`success`})},se=()=>{H.value=!1,G.value=!0};return(u,y)=>(b(),c(`div`,k,[_(v(n),{"model-value":I.modelValue,"onUpdate:modelValue":ae,open:H.value,"onUpdate:open":y[1]||=e=>H.value=e,"filter-function":e=>e},{default:x(()=>[f(`div`,A,[_(v(e),{class:`w-full`},{default:x(()=>[_(v(t),{modelValue:K.value,"onUpdate:modelValue":y[0]||=e=>K.value=e,placeholder:I.placeholder||`Select ${I.doctype}...`,class:`w-full px-4 py-2 bg-white dark:bg-gray-950 border border-gray-300 dark:border-gray-800 rounded-full focus:ring-2 focus:ring-black dark:focus:ring-white transition-all outline-none pr-10`,disabled:I.disabled},null,8,[`modelValue`,`placeholder`,`disabled`]),f(`div`,j,[W.value?(b(),p(v(m),{key:0,class:`h-4 w-4 animate-spin`})):(b(),p(v(s),{key:1,class:`h-4 w-4`}))])]),_:1}),_(v(r),{class:`absolute w-full bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 shadow-xl rounded-xl mt-2 p-1 z-[100] min-w-[200px] max-h-[300px] overflow-hidden flex flex-col`},{default:x(()=>[!W.value&&U.value.length===0?(b(),c(`div`,M,[K.value?(b(),c(`span`,ne,`No results found for "`+w(K.value)+`"`,1)):(b(),c(`span`,re,`No options available`))])):g(``,!0),_(v(a),{class:`border-b border-gray-100 dark:border-gray-800 mb-1 pb-1 shrink-0`},{default:x(()=>[_(v(i),{value:`__create_new__`,onSelect:se,class:`flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 cursor-pointer outline-none data-[highlighted]:bg-blue-200 dark:data-[highlighted]:bg-blue-900/20`},{default:x(()=>[_(v(S),{class:`h-4 w-4`}),d(` Create New `+w(I.doctype),1)]),_:1})]),_:1}),_(v(a),{class:`overflow-y-auto flex-1`},{default:x(()=>[(b(!0),c(h,null,o(U.value,e=>(b(),p(v(i),{key:e.value,value:e.value,class:`flex items-center justify-between px-3 py-2 text-sm rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-900 outline-none data-[state=checked]:bg-gray-50 dark:data-[state=checked]:bg-gray-900`},{default:x(()=>[f(`div`,ie,[f(`span`,N,w(e.label),1)]),I.modelValue===e.value?(b(),p(v(l),{key:0,class:`h-4 w-4 text-black dark:text-white`})):g(``,!0)]),_:2},1032,[`value`]))),128))]),_:1}),W.value&&U.value.length===0?(b(),c(`div`,P,[_(v(m),{class:`h-4 w-4 animate-spin`}),y[3]||=d(` Searching... `,-1)])):g(``,!0)]),_:1})])]),_:1},8,[`model-value`,`open`,`filter-function`]),_(O,{modelValue:G.value,"onUpdate:modelValue":y[2]||=e=>G.value=e,"initial-height":85},{default:x(()=>[f(`div`,F,[_(v(R),{doctype:I.doctype,"is-new":!0,name:`new`,"is-embedded":!0,onSaved:oe},null,8,[`doctype`])])]),_:1},8,[`modelValue`])]))}};export{I as t};