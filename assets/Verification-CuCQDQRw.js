import"./useArrowNavigation-siWGBYoD.js";import"./ConfigProvider-BeNpEDZu.js";import"./useDirection-CkCaHLjJ.js";import"./VisuallyHiddenInput-Cr3vcfNb.js";import{n as e,r as t,t as n}from"./PinInputSlot-D1MaWwH7.js";import{Bi as r,Hi as i,It as a,Li as o,Ln as s,Ni as c,Pa as l,Pn as u,Ri as d,Ui as f,Vn as p,Z as m,a as h,d as g,ga as _,i as v,ia as y,na as b,oa as x,s as S,wi as C,zi as w}from"./index-BW6FH5S4.js";import{n as T}from"./button-Cg1Yo4L-.js";import{t as E}from"./Card-DmhOqSpI.js";import{t as D}from"./CardContent-BAgx-xvK.js";import{t as O}from"./BackgroundAnimation-D58OrQ52.js";var k={name:`VerifyAccount`,components:{Button:T,Card:E,CardContent:D,Loader2:a,CheckCircle:p,XCircle:s,ShieldCheck:m,Clock:u,BackgroundAnimation:O,PinInput:t,PinInputGroup:e,PinInputSlot:n},data(){return{currentStep:0,loading:!1,resendCount:0,resendWaitTime:0,token:[],timerInstance:null}},async mounted(){if(this.$route.params.token)await this.verifyAccount(this.$route.params.token);else try{if(!await g.IndexedDB.get(`SeamlesslyDB`,`UserStore`,`preAuthorization`)){this.$router.push(`/login`);return}}catch{this.$router.push(`/login`);return}this.startCountdown()},beforeUnmount(){this.timerInstance&&clearInterval(this.timerInstance)},methods:{startCountdown(){this.timerInstance&&clearInterval(this.timerInstance),this.resendWaitTime=60+this.resendCount*30,this.timerInstance=setInterval(()=>{this.resendWaitTime>0?this.resendWaitTime--:clearInterval(this.timerInstance)},1e3)},async resendCode(){let e=h();try{await S.resendVerificationCode(),this.resendCount++,this.startCountdown(),e.toast({message:`A new verification code has been sent.`,variant:`success`})}catch(t){e.toast({message:t.message||`Failed to resend code. Please try again later.`,variant:`error`})}},async completeVerification(){if(this.loading||this.token.length<6)return;let e=h(),t=this.token.join(``);this.loading=!0;try{let e=await S.completeAccountVerification({code:t});e&&(this.currentStep=2,await g.IndexedDB.delete(`SeamlesslyDB`,`UserStore`,`preAuthorization`),setTimeout(()=>this.redirectToApp(e.length===0),1500))}catch(t){let n=t.message?.toLowerCase()||``;n.includes(`invalid`)||n.includes(`expire`)||n.includes(`mismatch`)?(this.currentStep=0,this.token=[]):this.currentStep=3,e.toast({message:t.message||`Verification failed`,variant:`error`})}finally{this.loading=!1}},redirectToApp(e=!1){if(e){window.location=`/setup-organisation`;return}let t=localStorage.getItem(`postAuthenticationPath`);t?(localStorage.removeItem(`postAuthenticationPath`),window.location=t):window.location=`/`},async verifyAccount(e){let t=h();try{this.currentStep=1;let n=await S.verifyAccount(e);t.toast({message:n.message||`Email verified successfully`,variant:`success`}),this.currentStep=2,setTimeout(()=>this.redirectToApp(),1500)}catch(e){t.toast({message:e.message||`Email verification failed`,variant:`error`}),this.currentStep=3}}}},A={class:`flex min-h-screen justify-center items-center bg-stone-50/50 text-foreground px-4 overflow-hidden`},j={class:`flex flex-col items-center text-center space-y-2 mb-8`},M={class:`p-3 bg-primary/5 rounded-2xl mb-2`},N={key:`step-otp`,class:`space-y-8`},P={class:`flex flex-col items-center space-y-6`},F={class:`flex flex-col items-center space-y-4 w-full`},I={key:1},L={class:`h-10 flex items-center justify-center`},R={key:0,class:`text-sm text-muted-foreground flex items-center gap-2`},z={class:`font-bold text-foreground`},B={class:`pt-4 border-t border-stone-100 text-center`},V={key:`step-loading`,class:`flex flex-col items-center py-12 space-y-6`},H={key:`step-success`,class:`flex flex-col items-center py-12 space-y-6`},U={class:`w-20 h-20 bg-green-50 rounded-full flex items-center justify-center`},W={key:`step-error`,class:`flex flex-col items-center py-12 space-y-6`},G={class:`w-20 h-20 bg-destructive/10 rounded-full flex items-center justify-center`};function K(e,t,n,a,s,u){let p=x(`BackgroundAnimation`),m=x(`ShieldCheck`),h=x(`PinInputSlot`),g=x(`PinInputGroup`),v=x(`PinInput`),S=x(`Loader2`),T=x(`Button`),E=x(`Clock`),D=x(`CheckCircle`),O=x(`XCircle`),k=x(`CardContent`),K=x(`Card`);return b(),r(`div`,A,[f(p),f(C,{name:`fade-up`,appear:``},{default:_(()=>[f(K,{class:`w-full max-w-lg shadow-[0_8px_30px_rgb(0,0,0,0.04)] border-none rounded-[2rem] relative bg-white/80 backdrop-blur-xl overflow-hidden`},{default:_(()=>[f(k,{class:`p-8 md:p-12`},{default:_(()=>[o(`div`,j,[o(`div`,M,[f(m,{class:`w-8 h-8 text-primary`})]),t[4]||=o(`h2`,{class:`text-3xl font-bold tracking-tight`},`Verify Identity`,-1),t[5]||=o(`p`,{class:`text-muted-foreground text-balanced max-w-[280px]`},` We've sent a 6-digit verification code to your linked email address. `,-1)]),f(C,{name:`fade-slide`,mode:`out-in`},{default:_(()=>[s.currentStep===0?(b(),r(`div`,N,[o(`div`,P,[f(v,{id:`pin-input`,modelValue:s.token,"onUpdate:modelValue":t[0]||=e=>s.token=e,placeholder:`â—‹`,class:`gap-3`,onComplete:u.completeVerification},{default:_(()=>[f(g,{class:`gap-2 sm:gap-4`},{default:_(()=>[(b(),r(c,null,y(6,(e,t)=>f(h,{key:e,index:t,class:`w-12 h-14 sm:w-14 sm:h-16 text-xl font-bold rounded-2xl border-2 border-stone-100 bg-stone-50/50 focus-within:border-primary focus-within:ring-0 transition-all`},null,8,[`index`])),64))]),_:1})]),_:1},8,[`modelValue`,`onComplete`]),o(`div`,F,[f(T,{disabled:s.loading||s.token.length<6,onClick:u.completeVerification,class:`h-14 w-full max-w-[240px] bg-primary text-primary-foreground rounded-2xl text-lg font-semibold hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-50`},{default:_(()=>[s.loading?(b(),d(S,{key:0,class:`mr-2 h-5 w-5 animate-spin`})):(b(),r(`span`,I,`Verify Now`))]),_:1},8,[`disabled`,`onClick`]),o(`div`,L,[f(C,{name:`fade`,mode:`out-in`},{default:_(()=>[s.resendWaitTime>0?(b(),r(`p`,R,[f(E,{class:`w-4 h-4`}),t[6]||=i(` Resend code in `,-1),o(`span`,z,l(s.resendWaitTime)+`s`,1)])):(b(),r(`button`,{key:1,onClick:t[1]||=(...e)=>u.resendCode&&u.resendCode(...e),class:`text-sm font-semibold text-primary hover:underline transition-all`},` Didn't receive a code? Resend `))]),_:1})])])]),o(`div`,B,[o(`button`,{onClick:t[2]||=t=>e.$router.push(`/login`),class:`text-sm text-muted-foreground hover:text-foreground transition-colors`},` Back to login `)])])):s.currentStep===1?(b(),r(`div`,V,[...t[7]||=[o(`div`,{class:`relative w-20 h-20`},[o(`div`,{class:`absolute inset-0 rounded-full border-4 border-primary/10`}),o(`div`,{class:`absolute inset-0 rounded-full border-4 border-primary border-t-transparent animate-spin`})],-1),o(`div`,{class:`text-center`},[o(`h3`,{class:`text-xl font-bold`},`Verifying Code`),o(`p`,{class:`text-muted-foreground mt-2`},`Checking your credentials...`)],-1)]])):s.currentStep===2?(b(),r(`div`,H,[o(`div`,U,[f(D,{class:`w-12 h-12 text-green-500`})]),t[9]||=o(`div`,{class:`text-center`},[o(`h3`,{class:`text-2xl font-bold text-stone-900`},`Successfully Verified`),o(`p`,{class:`text-muted-foreground mt-2`},`Redirecting you to the dashboard...`)],-1),f(T,{onClick:u.redirectToApp,class:`px-8 rounded-2xl`},{default:_(()=>[...t[8]||=[i(` Enter Flow `,-1)]]),_:1},8,[`onClick`])])):s.currentStep===3?(b(),r(`div`,W,[o(`div`,G,[f(O,{class:`w-12 h-12 text-destructive`})]),t[11]||=o(`div`,{class:`text-center`},[o(`h3`,{class:`text-2xl font-bold text-destructive`},`Verification Failed`),o(`p`,{class:`text-muted-foreground mt-2`},`The code you entered is invalid or has expired.`)],-1),f(T,{onClick:t[3]||=e=>s.currentStep=0,variant:`outline`,class:`px-8 rounded-2xl`},{default:_(()=>[...t[10]||=[i(` Try Again `,-1)]]),_:1})])):w(``,!0)]),_:1})]),_:1})]),_:1})]),_:1})])}var q=v(k,[[`render`,K],[`__scopeId`,`data-v-e7eb9d43`]]);export{q as default};